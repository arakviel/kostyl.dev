---
title: 'Service Locator: –ü–∞—Ç—Ç–µ—Ä–Ω —Ç–∞ –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω'
description: 'Service Locator ‚Äî –æ–¥–∏–Ω –∑ –ø–µ—Ä—à–∏—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤ –¥–æ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è, –ø–µ—Ä–µ–≤–∞–≥–∏, –∫—Ä–∏—Ç–∏–∫–∞ —Ç–∞ –≤–∏–ø–∞–¥–∫–∏ –¥–µ –≤—ñ–Ω –ø—Ä–∏–π–Ω—è—Ç–Ω–∏–π. –î–µ—Ç–∞–ª—å–Ω–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ Dependency Injection.'
---

# Service Locator: –ü–∞—Ç—Ç–µ—Ä–Ω —Ç–∞ –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω

## –í—Å—Ç—É–ø: –†–∏–Ω–æ–∫ vs –î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ–¥–æ–º—É

–£—è–≤—ñ—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–≤—ñ–∂—ñ –æ–≤–æ—á—ñ:

**–°–ø–æ—Å—ñ–± 1 ‚Äî –†–∏–Ω–æ–∫ (Service Locator):** –í–∏ —Å–∞–º—ñ –π–¥–µ—Ç–µ –Ω–∞ —Ä–∏–Ω–æ–∫, —Å–∞–º—ñ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –ª–æ—Ç–æ–∫, —Å–∞–º—ñ –∑–∞–ø–∏—Ç—É—î—Ç–µ —â–æ —î —ñ —Å–∞–º—ñ –Ω–µ—Å–µ—Ç–µ –¥–æ–¥–æ–º—É. –†–∏–Ω–æ–∫ (–ª–æ–∫–∞—Ç–æ—Ä) –∑–Ω–∞—î –¥–µ –∑–Ω–∞–π—Ç–∏ –≤—Å–µ. –ê–ª–µ —Ü–µ **–≤–∞—à –∫–ª–æ–ø—ñ—Ç**: –ø—ñ—Ç–∏, –∑–Ω–∞–π—Ç–∏, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å.

**–°–ø–æ—Å—ñ–± 2 ‚Äî –î–æ—Å—Ç–∞–≤–∫–∞ (Dependency Injection):** –í–∏ –∫–∞–∂–µ—Ç–µ –∫—É—Ä'—î—Ä—É: "–ü—Ä–∏–Ω–µ—Å–∏ 1 –∫–≥ –ø–æ–º—ñ–¥–æ—Ä—ñ–≤ —ñ 500 –≥ –º–æ—Ä–∫–≤–∏". –ö—É—Ä'—î—Ä —Å–∞–º –∑–Ω–∞—Ö–æ–¥–∏—Ç—å, –∫—É–ø—É—î —ñ –ø—Ä–∏–≤–æ–∑–∏—Ç—å. –í–∏ –ø—Ä–æ—Å—Ç–æ –æ–ø–∏—Å–∞–ª–∏ –ø–æ—Ç—Ä–µ–±—É ‚Äî –≤—Å–µ —ñ–Ω—à–µ –∑—Ä–æ–±–∏–ª–∏ –∑–∞ –≤–∞—Å.

–£ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ —Ü–µ –∫–ª—é—á–æ–≤–∞ —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ Service Locator —Ç–∞ Dependency Injection. –û–±–∏–¥–≤–∞ –≤–∏—Ä—ñ—à—É—é—Ç—å –æ–¥–Ω—É –ø—Ä–æ–±–ª–µ–º—É ‚Äî **—É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏** ‚Äî –∞–ª–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ –ø–æ-—Ä—ñ–∑–Ω–æ–º—É.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 1: –©–æ —Ç–∞–∫–µ Service Locator?

### 1.1. –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ –ö–æ–Ω—Ç–µ–∫—Å—Ç

**Service Locator** ‚Äî —Ü–µ –ø–∞—Ç—Ç–µ—Ä–Ω, –ø—Ä–∏ —è–∫–æ–º—É –∫–ª–∞—Å–∏ –æ—Ç—Ä–∏–º—É—é—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, **–∑–∞–ø—Ä–æ—Å–∏–≤—à–∏ —ó—Ö —É —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–º—É —Ä–µ—î—Å—Ç—Ä—ñ**, –∑–∞–º—ñ—Å—Ç—å –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ó—Ö –∑–∑–æ–≤–Ω—ñ.

–ü–∞—Ç—Ç–µ—Ä–Ω –ø–æ–ø—É–ª—è—Ä–∏–∑—É–≤–∞–≤ –ú–∞—Ä—Ç—ñ–Ω –§–∞—É–ª–µ—Ä —É 2004 —Ä. ‚Äî —ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –ø–æ—è—Å–Ω–∏–≤, —á–æ–º—É Dependency Injection —î –∫—Ä–∞—â–æ—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ—é. –•—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–æ Service Locator –∑'—è–≤–∏–≤—Å—è **—Ä–∞–Ω—ñ—à–µ** DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ —ñ –±—É–≤ —Ä–µ–∞–ª—å–Ω–∏–º –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è–º –ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ `new SomeService()` —É –∫–æ–∂–Ω–æ–º—É –∫–ª–∞—Å—ñ.

### 1.2. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–ª–∞—Å–∏—á–Ω–æ–≥–æ Service Locator

```csharp showLineNumbers
// ServiceLocator.cs
public class ServiceLocator
{
    private static ServiceLocator? _instance;
    private static readonly object _lock = new();

    private readonly Dictionary<Type, Func<object>> _registrations = new();
    private readonly Dictionary<Type, object> _singletonCache = new();

    /// <summary>
    /// –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø—É. –¶—è "–∑—Ä—É—á–Ω—ñ—Å—Ç—å" —ñ —î –∫–æ—Ä—ñ–Ω–Ω—è–º –ø—Ä–æ–±–ª–µ–º!
    /// </summary>
    public static ServiceLocator Current
    {
        get
        {
            if (_instance == null)
                lock (_lock) { _instance ??= new ServiceLocator(); }
            return _instance!;
        }
    }

    private ServiceLocator() { }

    public void Register<TService>(Func<TService> factory) where TService : class
        => _registrations[typeof(TService)] = () => factory();

    public void RegisterSingleton<TService>(Func<TService> factory) where TService : class
    {
        _registrations[typeof(TService)] = () =>
        {
            var type = typeof(TService);
            if (!_singletonCache.TryGetValue(type, out var cached))
            {
                cached = factory()!;
                _singletonCache[type] = cached;
            }
            return cached;
        };
    }

    public void RegisterInstance<TService>(TService instance) where TService : class
    {
        _singletonCache[typeof(TService)] = instance;
        _registrations[typeof(TService)] = () => instance;
    }

    public TService GetService<TService>() where TService : class
    {
        if (_registrations.TryGetValue(typeof(TService), out var factory))
            return (TService)factory();

        throw new InvalidOperationException(
            $"–°–µ—Ä–≤—ñ—Å '{typeof(TService).Name}' –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ —É ServiceLocator.");
    }

    public TService? TryGetService<TService>() where TService : class
    {
        if (_registrations.TryGetValue(typeof(TService), out var factory))
            return (TService?)factory();
        return null;
    }

    public static void Reset() { lock (_lock) { _instance = null; } }
}
```

### 1.3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Service Locator

```csharp showLineNumbers
// Bootstrap: —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–µ—î—Å—Ç—Ä—ñ–≤
var locator = ServiceLocator.Current;
locator.RegisterSingleton<ILogger>(() => new ConsoleLogger());
locator.Register<IOrderRepository>(() => new SqlOrderRepository(connectionString));
locator.Register<IEmailService>(() => new SmtpEmailService(smtpHost));

// OrderService ‚Äî –∑–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ –ª–æ–∫–∞—Ç–æ—Ä–∞ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ
public class OrderService
{
    // ‚ùó –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ü–û–†–û–ñ–ù–Ü–ô ‚Äî –∞–ª–µ –∫–ª–∞—Å –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ 3+ —Ä–µ—á–µ–π!
    public OrderService() { }

    public void PlaceOrder(Order order)
    {
        // –ö–ª–∞—Å —Å–∞–º "—ñ–¥–µ –Ω–∞ —Ä–∏–Ω–æ–∫" –∑–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏
        var repository = ServiceLocator.Current.GetService<IOrderRepository>();
        var emailService = ServiceLocator.Current.GetService<IEmailService>();
        var logger = ServiceLocator.Current.GetService<ILogger>();

        logger.Log($"Placing order {order.Id}");
        repository.Save(order);
        emailService.Send(order.CustomerEmail, "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ!");
    }
}
```

---

## –ß–∞—Å—Ç–∏–Ω–∞ 2: –ü—Ä–æ–±–ª–µ–º–∏ Service Locator

### 2.1. –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (–ì–æ–ª–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞)

–ö–æ–ª–∏ –∫–ª–∞—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î DI ‚Äî –π–æ–≥–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ **—è–≤–Ω—ñ —Ç–∞ –≤–∏–¥–∏–º—ñ** —É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ. –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Service Locator ‚Äî **–ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–µ—Ç–æ–¥—ñ–≤**:

```csharp
// ‚ùå Service Locator: –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –ü–†–ò–•–û–í–ê–ù–Ü
public class OrderService
{
    public OrderService() { } // –ó–¥–∞—î—Ç—å—Å—è, —â–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –Ω–µ–º–∞—î ‚Äî —Ü–µ –ë–†–ï–•–ù–Ø!

    public void PlaceOrder(Order order)
    {
        var repository = ServiceLocator.Current.GetService<IOrderRepository>(); // –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å 1
        var emailService = ServiceLocator.Current.GetService<IEmailService>();  // –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å 2
        var logger = ServiceLocator.Current.GetService<ILogger>();              // –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å 3
        // –ê –º–æ–∂–µ –±—É—Ç–∏ —â–µ –≤ —ñ–Ω—à–∏—Ö –º–µ—Ç–æ–¥–∞—Ö!
    }

    public void CancelOrder(Order order)
    {
        var paymentGateway = ServiceLocator.Current.GetService<IPaymentGateway>(); // –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å 4
        var notifications = ServiceLocator.Current.GetService<INotificationService>(); // 5...
    }
}

// ‚úÖ DI: –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –Ø–í–ù–Ü
public class OrderService
{
    public OrderService(            // –û–¥–Ω–æ–≥–æ –ø–æ–≥–ª—è–¥—É –¥–æ—Å—Ç–∞—Ç–Ω—å–æ!
        IOrderRepository repository,
        IEmailService emailService,
        ILogger logger)
    { /* ... */ }
}
```

**–ù–∞—Å–ª—ñ–¥–∫–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π:**
- –ù–µ–º–æ–∂–ª–∏–≤–æ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –ø–æ—Ç—Ä–µ–±–∏ –∫–ª–∞—Å—É, –ª–∏—à–µ –¥–∏–≤–ª—è—á–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –ù–µ–∑—Ä–æ–∑—É–º—ñ–ª–æ, —è–∫—ñ —Å–µ—Ä–≤—ñ—Å–∏ —Ç—Ä–µ–±–∞ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –≤ –ª–æ–∫–∞—Ç–æ—Ä—ñ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API —Å—Ç–∞—î –Ω–µ–ø–æ–≤–Ω–æ—é

::caution
**–ü–æ—Ä—É—à–µ–Ω–Ω—è "–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ –∑–¥–∏–≤—É–≤–∞–Ω–Ω—è"**: –ü—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç, —â–æ –±–∞—á–∏—Ç—å `new OrderService()`, –¥—É–º–∞—î, —â–æ –∫–ª–∞—Å –Ω–µ –º–∞—î –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π. –í—ñ–Ω –±—É–¥–µ –∑–¥–∏–≤–æ–≤–∞–Ω–∏–π, –∫–æ–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–ø–∞–¥–µ –∑ –ø–æ–º–∏–ª–∫–æ—é "—Å–µ—Ä–≤—ñ—Å –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ" –≤–∂–µ **–ø—ñ—Å–ª—è** —Å—Ç–∞—Ä—Ç—É.
::

### 2.2. –£—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```csharp showLineNumbers
// ‚ùå –¢–µ—Å—Ç –∑ Service Locator ‚Äî –º–∞—î–º–æ –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω!
[TestClass]
public class OrderServiceTests
{
    [TestInitialize]
    public void Setup()
    {
        // –ö–û–ñ–ï–ù —Ç–µ—Å—Ç –ø–æ–≤–∏–Ω–µ–Ω –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≤–µ—Å—å ServiceLocator!
        ServiceLocator.Reset();
        var locator = ServiceLocator.Current;
        locator.Register<IOrderRepository>(() => new FakeOrderRepository());
        locator.Register<IEmailService>(() => new FakeEmailService());
        locator.Register<ILogger>(() => new FakeLogger());
        // –Ø–∫—â–æ –∑–∞–±—É–¥–µ–º–æ —â–æ—Å—å ‚Äî –¥—ñ–∑–Ω–∞—î–º–æ—Å—å —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É!
    }

    [TestCleanup]
    public void Cleanup()
    {
        ServiceLocator.Reset(); // –ë–µ–∑ —Ü—å–æ–≥–æ —ñ–∑–æ–ª—è—Ü—ñ—è –º—ñ–∂ —Ç–µ—Å—Ç–∞–º–∏ –ø–æ—Ä—É—à–µ–Ω–∞!
    }

    [TestMethod]
    public void PlaceOrder_ShouldSaveOrder()
    {
        var service = new OrderService();
        service.PlaceOrder(new Order { Id = 1 });

        // –Ø–∫ –¥—ñ—Å—Ç–∞—Ç–∏ FakeOrderRepository? –ß–µ—Ä–µ–∑ —Ç–æ–π —Å–∞–º–∏–π –ª–æ–∫–∞—Ç–æ—Ä ‚Äî –Ω–µ–∑—Ä—É—á–Ω–æ!
        var fakeRepo = (FakeOrderRepository)ServiceLocator.Current.GetService<IOrderRepository>();
        Assert.AreEqual(1, fakeRepo.SavedOrders.Count);
    }
}

// ‚úÖ –¢–µ—Å—Ç –∑ DI ‚Äî —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π —ñ —á–∏—Å—Ç–∏–π
[TestClass]
public class OrderServiceTests
{
    [TestMethod]
    public void PlaceOrder_ShouldSaveOrder()
    {
        // Arrange: —è–≤–Ω–æ —ñ –∑—Ä–æ–∑—É–º—ñ–ª–æ
        var fakeRepo = new FakeOrderRepository();
        var service = new OrderService(fakeRepo, new FakeEmailService(), new FakeLogger());

        // Act
        service.PlaceOrder(new Order { Id = 1 });

        // Assert
        Assert.AreEqual(1, fakeRepo.SavedOrders.Count);
    }
    // –ù—ñ—è–∫–æ–≥–æ Setup/Cleanup!
}
```

### 2.3. –ì–ª–æ–±–∞–ª—å–Ω–∏–π –∑–º—ñ–Ω–Ω–∏–π —Å—Ç–∞–Ω

–ö–ª–∞—Å–∏—á–Ω–∏–π Service Locator ‚Äî —Ü–µ **Singleton –∑ –≥–ª–æ–±–∞–ª—å–Ω–∏–º —Å—Ç–∞–Ω–æ–º**:
- –ü–æ—Ä—É—à—É—î —ñ–∑–æ–ª—è—Ü—ñ—é –º—ñ–∂ —Ç–µ—Å—Ç–∞–º–∏
- –£—Å–∫–ª–∞–¥–Ω—é—î –ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- –ü—Ä–∏—Ö–æ–≤—É—î —Å–ø—Ä–∞–≤–∂–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
- –ü–æ–º–∏–ª–∫–∏ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –ø–æ—Ä—è–¥–∫—É –≤–∏–∫–ª–∏–∫—ñ–≤

### 2.4. –ü–æ–º–∏–ª–∫–∏ –≤–∏—è–≤–ª—è—é—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

```csharp
public void ProcessOrder(Order order)
{
    // –¶—è –ø–æ–º–∏–ª–∫–∞ –≤–∏—è–≤–∏—Ç—å—Å—è –¢–Ü–õ–¨–ö–ò –∫–æ–ª–∏ –º–µ—Ç–æ–¥ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π
    var inventory = ServiceLocator.Current.GetService<IInventoryService>();
    // ‚Üê –Ø–∫—â–æ IInventoryService –Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ ‚Äî Exception –≤ runtime!
}
```

–ó DI –ø—Ä–æ–±–ª–µ–º—É –≤–∏–¥–Ω–æ —â–µ –ø—Ä–∏ **—Å—Ç–∞—Ä—Ç—ñ** –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É (—è–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ `ValidateOnBuild`).

---

## –ß–∞—Å—Ç–∏–Ω–∞ 3: –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è

| –ö—Ä–∏—Ç–µ—Ä—ñ–π | Dependency Injection | Service Locator |
|---|---|---|
| **–Ø–≤–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π** | ‚úÖ –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä | ‚ùå –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ —É –º–µ—Ç–æ–¥–∞—Ö |
| **–¢–µ—Å—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å** | ‚úÖ –õ–µ–≥–∫–æ ‚Äî –º–æ–∫–∏ —É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä | ‚ö†Ô∏è –°–∫–ª–∞–¥–Ω–æ ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω |
| **–í–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫** | ‚úÖ Compile-time –∞–±–æ startup | ‚ùå Runtime |
| **–ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω** | ‚úÖ –í—ñ–¥—Å—É—Ç–Ω—ñ–π | ‚ùå Singleton |
| **–Ü–∑–æ–ª—è—Ü—ñ—è —Ç–µ—Å—Ç—ñ–≤** | ‚úÖ –Ñ | ‚ùå –ü–æ—Ç—Ä–µ–±—É—î Reset |
| **–î–æ—Ç—Ä–∏–º–∞–Ω–Ω—è SOLID** | ‚úÖ –ü–æ–≤–Ω–µ | ‚ö†Ô∏è –ß–∞—Å—Ç–∫–æ–≤–µ |
| **Legacy support** | ‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É—î –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è | ‚úÖ –õ–µ–≥—à–µ –¥–æ–¥–∞—Ç–∏ –ø–æ—Å—Ç—É–ø–æ–≤–æ |

::mermaid

```mermaid
sequenceDiagram
    participant Client
    participant OrderService
    participant Locator as ServiceLocator
    participant Repo as IOrderRepository

    Note over Client,Repo: ‚ùå Service Locator Flow

    Client->>+OrderService: PlaceOrder(order)
    OrderService->>+Locator: GetService<IOrderRepository>()
    Locator-->>-OrderService: SqlOrderRepository
    OrderService->>+Repo: Save(order)
    Repo-->>-OrderService: done
    OrderService-->>-Client: success

    Note over Client,Repo: ‚úÖ Dependency Injection Flow

    Client->>+OrderService: PlaceOrder(order)
    Note right of OrderService: _repository –≤–∂–µ —î!\n–ü–µ—Ä–µ–¥–∞–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
    OrderService->>+Repo: Save(order)
    Repo-->>-OrderService: done
    OrderService-->>-Client: success
```

::

---

## –ß–∞—Å—Ç–∏–Ω–∞ 4: –ö–æ–ª–∏ Service Locator –í–ò–ü–†–ê–í–î–ê–ù–ò–ô

–ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –∫—Ä–∏—Ç–∏–∫—É, —î —Å–∏—Ç—É–∞—Ü—ñ—ó –¥–µ –≤—ñ–Ω –ø—Ä–∏–π–Ω—è—Ç–Ω–∏–π:

### 4.1. Legacy –∫–æ–¥ (Strangler Fig Pattern)

–£ –≤–µ–ª–∏–∫–æ–º—É legacy-–ø—Ä–æ—î–∫—Ç—ñ –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ DI –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –º—ñ—Å—è—Ü—ñ. Service Locator –¥–æ–∑–≤–æ–ª—è—î —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç–∏ **–ø–æ—Å—Ç—É–ø–æ–≤–æ**:

```csharp
// –ö—Ä–æ–∫ 1: –ó–Ω—ñ–º–∞—î–º–æ hard-coded new —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä
// –ö—Ä–æ–∫ 2: –ü–æ—Å—Ç—É–ø–æ–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ DI –≤ –Ω–æ–≤–∏—Ö –∫–ª–∞—Å–∞—Ö

// "–ü–µ—Ä–µ—Ö—ñ–¥–Ω–∏–π" –∫–ª–∞—Å
public class OrderService
{
    public void PlaceOrder(Order order)
    {
        // –ë—É–ª–æ: var repo = new SqlOrderRepository("...");
        var repo = ServiceLocator.Current.GetService<IOrderRepository>(); // –ó–∞—Ä–∞–∑
        // –°—Ç–∞–Ω–µ: –æ—Ç—Ä–∏–º—É—î–º–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (—É –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó)
        repo.Save(order);
    }
}
```

### 4.2. Framework —Ç–∞ Middleware —Ä—ñ–≤–µ–Ω—å

–î–µ—è–∫—ñ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ –≤–∏–º–∞–≥–∞—é—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ ServiceProvider —è–∫ –ª–æ–∫–∞—Ç–æ—Ä. –¶–µ –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–æ –Ω–∞ **—ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º—É —Ä—ñ–≤–Ω—ñ**, –Ω–µ –≤ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ—Ü—ñ:

```csharp
// Middleware ‚Äî —Ç—É—Ç Service Locator –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–∏–π
public class MyMiddleware
{
    private readonly RequestDelegate _next;
    public MyMiddleware(RequestDelegate next) { _next = next; }

    public async Task InvokeAsync(HttpContext context)
    {
        // context.RequestServices ‚Äî —Ñ–∞–∫—Ç–∏—á–Ω–æ Service Locator, –∞–ª–µ —Ü–µ middleware!
        var dbContext = context.RequestServices.GetRequiredService<AppDbContext>();
        await _next(context);
    }
}
```

### 4.3. –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –≤–∏–±—ñ—Ä —Å–µ—Ä–≤—ñ—Å—É –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

```csharp
// –í–∏–±—ñ—Ä —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ runtime-–¥–∞–Ω–∏—Ö
public class PaymentProcessor
{
    private readonly IServiceProvider _serviceProvider;
    public PaymentProcessor(IServiceProvider sp) { _serviceProvider = sp; }

    public void Process(PaymentMethod method, decimal amount)
    {
        // –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –≤–∏–±—ñ—Ä ‚Äî —Ç—É—Ç Service Locator –¥–æ–ø—É—Å—Ç–∏–º–∏–π
        IPaymentGateway gateway = method switch
        {
            PaymentMethod.Stripe => _serviceProvider.GetRequiredService<IStripeGateway>(),
            PaymentMethod.PayPal => _serviceProvider.GetRequiredService<IPayPalGateway>(),
            _ => throw new ArgumentException($"Unknown: {method}")
        };
        gateway.Charge(amount);
    }
}
```

::note
**Ale –∫—Ä–∞—â–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞** —Ç—É—Ç ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω **Factory**, –¥–µ —Ñ–∞–±—Ä–∏–∫–∞ –æ—Ç—Ä–∏–º—É—î –≤—Å—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —á–µ—Ä–µ–∑ DI —ñ –≤–∏–±–∏—Ä–∞—î –ø–æ—Ç—Ä—ñ–±–Ω–∏–π. –¶–µ –∑–±–µ—Ä—ñ–≥–∞—î —è–≤–Ω—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.
::

---

## –ß–∞—Å—Ç–∏–Ω–∞ 5: IServiceProvider —É Microsoft DI

–¢–µ—Ö–Ω—ñ—á–Ω–æ `IServiceProvider` —É Microsoft DI —î Service Locator. –ê–ª–µ —î –≤–∞–∂–ª–∏–≤–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å:

```csharp
// ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù: IServiceProvider —É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ—Ü—ñ
public class OrderService
{
    private readonly IServiceProvider _sp;
    public OrderService(IServiceProvider sp) { _sp = sp; }

    public void PlaceOrder(Order order)
    {
        var repo = _sp.GetRequiredService<IOrderRepository>(); // –¶–µ Service Locator!
        repo.Save(order);
    }
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: IServiceProvider —Ç—ñ–ª—å–∫–∏ —É Composition Root
static void Main(string[] args)
{
    var services = new ServiceCollection();
    services.AddScoped<IOrderRepository, SqlOrderRepository>();
    services.AddScoped<OrderService>();

    var provider = services.BuildServiceProvider();

    // –¢—É—Ç ‚Äî –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–æ, —Ü–µ Composition Root
    using var scope = provider.CreateScope();
    var orderService = scope.ServiceProvider.GetRequiredService<OrderService>();
    orderService.PlaceOrder(new Order { /* ... */ });
}
```

**–ü—Ä–∞–≤–∏–ª–æ**: `IServiceProvider` —É Composition Root ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ. `IServiceProvider` —É –±—ñ–∑–Ω–µ—Å-–∫–ª–∞—Å–∞—Ö ‚Äî Service Locator –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω.

---

## –ü—ñ–¥—Å—É–º–æ–∫

::card-group

::card{title="‚úÖ Service Locator –ü–Ü–î–•–û–î–ò–¢–¨" icon="i-heroicons-check-circle"}
- Composition Root (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É)
- Legacy-—Å–∏—Å—Ç–µ–º–∏ –ø—ñ–¥ —á–∞—Å –ø–æ—Å—Ç—É–ø–æ–≤–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É  
- Middleware —Ç–∞ Framework —Ä—ñ–≤–µ–Ω—å
- –î–∏–Ω–∞–º—ñ—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É –≤ runtime
- –ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
::

::card{title="‚ùå Service Locator –ù–ï –ü–Ü–î–•–û–î–ò–¢–¨" icon="i-heroicons-x-circle"}
- –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ (Service, Repository, Handler)
- –ö–æ–ª–∏ —î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Constructor Injection
- –ù–æ–≤—ñ –ø—Ä–æ—î–∫—Ç–∏ –±–µ–∑ legacy –æ–±–º–µ–∂–µ–Ω—å
- –ö–æ–ª–∏ –≤–∞–∂–ª–∏–≤–∞ —Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å —Ç–∞ —è–≤–Ω—ñ—Å—Ç—å –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
::

::

**–ó–æ–ª–æ—Ç–µ –ø—Ä–∞–≤–∏–ª–æ**: —è–∫—â–æ —î –≤–∏–±—ñ—Ä –º—ñ–∂ Service Locator —Ç–∞ DI ‚Äî **–æ–±–∏—Ä–∞–π—Ç–µ DI**. Service Locator ‚Äî —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è —Å–∏—Ç—É–∞—Ü—ñ–π, –¥–µ DI –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∞–±–æ –ø–æ–∫–∏ —â–æ –Ω–∞–¥—Ç–æ —Å–∫–ª–∞–¥–Ω–∏–π –¥–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è.

---

## üìù –ó–∞–≤–¥–∞–Ω–Ω—è

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (Medium)

–ö–ª–∞—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Service Locator. –ü—Ä–æ–≤–µ–¥—ñ—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–æ Constructor Injection —Ç–∞ –Ω–∞–ø–∏—à—ñ—Ç—å Unit —Ç–µ—Å—Ç:

```csharp
public class ReportService
{
    public void GenerateMonthlyReport()
    {
        var db = ServiceLocator.Current.GetService<IReportRepository>();
        var excel = ServiceLocator.Current.GetService<IExcelBuilder>();
        var email = ServiceLocator.Current.GetService<IEmailService>();
        var logger = ServiceLocator.Current.GetService<ILogger>();

        logger.Log("Generating report...");
        var data = db.GetMonthlyData();
        var report = excel.Build(data);
        email.Send("director@company.com", "Monthly Report", report);
    }
}
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –î–∏—Å–∫—É—Å—ñ—è (Soft)

–°—Ñ–æ—Ä–º—É–ª—é–π—Ç–µ –∫–æ–Ω—Ç—Ä–∞—Ä–≥—É–º–µ–Ω—Ç–∏ –ø—Ä–æ—Ç–∏:

> "Service Locator –∫—Ä–∞—â–∏–π –Ω—ñ–∂ DI, –±–æ –Ω–µ —Ç—Ä–µ–±–∞ –ø—Ä–æ–∫–∏–¥–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ 5 —Ä—ñ–≤–Ω—ñ–≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ–≤. –ü—Ä–æ—Å—Ç–æ `ServiceLocator.Current.GetService<T>()` –¥–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ."

–ö–æ–ª–∏ —Ü–µ–π –∞—Ä–≥—É–º–µ–Ω—Ç –ø—Ä–æ boilerplate —É DI —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∏–π —ñ —è–∫ –∑ –Ω–∏–º –±–æ—Ä–æ—Ç–∏—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–ø—ñ–¥–∫–∞–∑–∫–∞: Extension Methods, Composition Root)?

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: –ê—É–¥–∏—Ç –∫–æ–¥—É (Hard)

–ó–Ω–∞–π–¥—ñ—Ç—å —É –≤—ñ–¥–æ–º–æ–º—É open-source ASP.NET Core –ø—Ä–æ—î–∫—Ç—ñ (GitHub) –≤—Å—ñ –º—ñ—Å—Ü—è –¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `IServiceProvider` —É –±—ñ–∑–Ω–µ—Å-–∫–ª–∞—Å–∞—Ö. –í–∏–∑–Ω–∞—á—Ç–µ: —Ü–µ –ø—Ä–∞–≤–æ–º—ñ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —á–∏ –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω Service Locator? –û–±“ë—Ä—É–Ω—Ç—É–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å.
