---
title: 'DI –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω–∏ —Ç–∞ –ù–∞–π–∫—Ä–∞—â—ñ –ü—Ä–∞–∫—Ç–∏–∫–∏'
description: '–ù–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à—ñ –ø–æ–º–∏–ª–∫–∏ –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ Dependency Injection —É C# —Ç–∞ .NET. –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω–∏ Service Locator, Captive Dependency, Constructor Over-injection, Static Coupling —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ —á–∏—Å—Ç–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ DI.'
---

# DI –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω–∏ —Ç–∞ –ù–∞–π–∫—Ä–∞—â—ñ –ü—Ä–∞–∫—Ç–∏–∫–∏

## –í—Å—Ç—É–ø: –ß–æ–º—É DI –º–æ–∂–µ —Å—Ç–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–æ—é?

DI ‚Äî –ø–æ—Ç—É–∂–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –ê–ª–µ —è–∫ —ñ –±—É–¥—å-—è–∫–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –π–æ–≥–æ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –î–∏–≤–Ω–æ, —â–æ –ø–æ–º–∏–ª–∫–∏ –∑ DI —á–∞—Å—Ç–æ —Ä–æ–±–ª—è—Ç—å **–¥–æ—Å–≤—ñ–¥—á–µ–Ω—ñ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∏**, –æ—Å–æ–±–ª–∏–≤–æ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –Ω–µ–∑–Ω–∞–π–æ–º–∏–º –∫–æ–¥–æ–º –∞–±–æ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ñ legacy-—Ä—ñ—à–µ–Ω—å.

–¶—è —Å—Ç–∞—Ç—Ç—è ‚Äî –∑–±—ñ—Ä–Ω–∏–∫ –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏—Ö –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ñ–≤, –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π: —á–æ–º—É —Ü–µ –ø–æ–≥–∞–Ω–æ, —ñ —è–∫ —Ü–µ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏.

---

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω 1: Service Locator —É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ—Ü—ñ

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è `IServiceProvider` —É –±—ñ–∑–Ω–µ—Å-—Å–µ—Ä–≤—ñ—Å–∏ —Ç–∞ –≤–∏–∫–ª–∏–∫ `GetRequiredService<T>()` –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–µ—Ç–æ–¥—ñ–≤.

```csharp
// ‚ùå –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω
public class OrderService
{
    private readonly IServiceProvider _sp;

    public OrderService(IServiceProvider sp)
    {
        _sp = sp;
    }

    public void PlaceOrder(Order order)
    {
        // Service Locator —É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ—Ü—ñ!
        var repo = _sp.GetRequiredService<IOrderRepository>();
        var email = _sp.GetRequiredService<IEmailService>();
        repo.Save(order);
        email.Send(order.CustomerEmail, "...");
    }
}
```

**–ß–æ–º—É –ø–æ–≥–∞–Ω–æ:**
- –ü—Ä–∏—Ö–æ–≤–∞–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ä–µ–∞–ª—å–Ω–∏—Ö –ø–æ—Ç—Ä–µ–±)
- –í–∞–∂–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ (—Ç—Ä–µ–±–∞ –º–æ–∫–∞—Ç–∏ `IServiceProvider`)
- –ü–æ—Ä—É—à–µ–Ω–Ω—è SOLID

```csharp
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: Constructor Injection
public class OrderService
{
    private readonly IOrderRepository _repo;
    private readonly IEmailService _email;

    public OrderService(IOrderRepository repo, IEmailService email)
    {
        _repo = repo;
        _email = email;
    }

    public void PlaceOrder(Order order)
    {
        _repo.Save(order);
        _email.Send(order.CustomerEmail, "...");
    }
}
```

---

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω 2: Captive Dependency

**–ü—Ä–æ–±–ª–µ–º–∞**: Singleton —Ç—Ä–∏–º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ Scoped –∞–±–æ Transient —Å–µ—Ä–≤—ñ—Å.

```csharp
// ‚ùå –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω: Singleton –∑–∞—Ö–æ–ø–ª—é—î Scoped
services.AddSingleton<BackgroundJobService>();
services.AddScoped<IJobRepository, SqlJobRepository>();

public class BackgroundJobService // Singleton
{
    private readonly IJobRepository _repo; // Scoped ‚Äî CAPTIVE!

    public BackgroundJobService(IJobRepository repo)
    {
        _repo = repo;  // –ó–∞—Ö–æ–ø–ª–µ–Ω–æ –Ω–∞–∑–∞–≤–∂–¥–∏ –∑ –ø–µ—Ä—à–æ–≥–æ scope
    }
}
```

**–ß–æ–º—É –ø–æ–≥–∞–Ω–æ:**
- Scoped —Å–µ—Ä–≤—ñ—Å –∂–∏–≤–µ –Ω–∞–∑–∞–≤–∂–¥–∏ –∑–∞–º—ñ—Å—Ç—å –æ–¥–Ω–æ–≥–æ scope
- DbContext –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –∞–ª–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –ª–∏—à–∞—î—Ç—å—Å—è ‚Üí `ObjectDisposedException`
- –î–∞–Ω—ñ "–ø—Ä–æ—Ç—ñ–∫–∞—é—Ç—å" –º—ñ–∂ HTTP-–∑–∞–ø–∏—Ç–∞–º–∏

```csharp
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: IServiceScopeFactory –¥–ª—è Scoped –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —É Singleton
public class BackgroundJobService // Singleton
{
    private readonly IServiceScopeFactory _scopeFactory;

    public BackgroundJobService(IServiceScopeFactory scopeFactory)
    {
        _scopeFactory = scopeFactory;
    }

    public void ProcessJobs()
    {
        using var scope = _scopeFactory.CreateScope();
        var repo = scope.ServiceProvider.GetRequiredService<IJobRepository>();
        var jobs = repo.GetPending();
        // ...
    } // ‚Üê repo —Ç–∞ DbContext –∑–Ω–∏—â—É—é—Ç—å—Å—è —Ç—É—Ç
}
```

::tip
–£–≤—ñ–º–∫–Ω—ñ—Ç—å `ValidateScopes = true` —É `BuildServiceProvider`. –£ —Ä–µ–∂–∏–º—ñ Development –≤ ASP.NET Core ‚Äî —Ü–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ**. –ù–µ –≤–∏–º–∏–∫–∞–π—Ç–µ —Ü–µ!
::

---

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω 3: Constructor Over-injection

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑ 6+ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ ‚Äî –æ–∑–Ω–∞–∫–∞ –ø–æ—Ä—É—à–µ–Ω–Ω—è SRP.

```csharp
// ‚ùå –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω: –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
public class OrderService
{
    public OrderService(
        IOrderRepository orderRepo,
        IProductRepository productRepo,
        IUserRepository userRepo,
        IEmailService emailService,
        ISmsService smsService,
        IPushService pushService,
        IPaymentGateway payment,
        IInventoryService inventory,
        IShippingService shipping,
        IAuditService audit,
        ILogger<OrderService> logger)
    { }
}
```

**–ß–æ–º—É –ø–æ–≥–∞–Ω–æ:**
- –ö–ª–∞—Å –º–∞—î –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π (–ø–æ—Ä—É—à–µ–Ω–Ω—è SRP)
- –í–∞–∂–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ (–ø–æ—Ç—Ä—ñ–±–Ω–æ 11 –º–æ–∫—ñ–≤!)
- –û–∑–Ω–∞–∫–∞ "God Class"

```csharp
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–∏–¥—ñ–ª—è—î–º–æ –ø–æ–¥–¥–æ–º–µ–Ω–∏ —É –æ–∫—Ä–µ–º—ñ —Å–µ—Ä–≤—ñ—Å–∏

// –°–µ—Ä–≤—ñ—Å —Å–ø–æ–≤—ñ—â–µ–Ω—å
public class NotificationService
{
    public NotificationService(IEmailService email, ISmsService sms, IPushService push) { }
    public void NotifyCustomer(Order order) { /* ... */ }
}

// –°–µ—Ä–≤—ñ—Å –æ–±—Ä–æ–±–∫–∏ –æ–ø–ª–∞—Ç–∏ —ñ –¥–æ—Å—Ç–∞–≤–∫–∏
public class FulfillmentService
{
    public FulfillmentService(IPaymentGateway payment, IInventoryService inventory, IShippingService shipping) { }
    public bool Fulfill(Order order) { /* ... */ }
}

// –¢–µ–ø–µ—Ä OrderService ‚Äî —Ç—ñ–ª—å–∫–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è
public class OrderService
{
    public OrderService(
        IOrderRepository orderRepo,
        NotificationService notifications,
        FulfillmentService fulfillment,
        IAuditService audit,
        ILogger<OrderService> logger)
    { }
}
```

---

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω 4: Static Coupling —Ç–∞ new —É —Å–µ—Ä–≤—ñ—Å—ñ

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä—è–º–∏–π –≤–∏–∫–ª–∏–∫ `new` –¥–ª—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤.

```csharp
// ‚ùå –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω: new —É —Å–µ—Ä–≤—ñ—Å—ñ
public class OrderService
{
    private readonly IOrderRepository _repo;

    public OrderService(IOrderRepository repo)
    {
        _repo = repo;
    }

    public void PlaceOrder(Order order)
    {
        // Hard-coded new ‚Äî –ø–æ—Ä—É—à—É—î DI!
        var emailService = new SmtpEmailService("smtp.gmail.com", 587); // [!code --]
        // –°—Ç–∞—Ç–∏—á–Ω–∏–π –≤–∏–∫–ª–∏–∫ ‚Äî —Ç–µ —Å–∞–º–µ!
        var logger = LoggerFactory.GetLogger<OrderService>(); // [!code --]

        emailService.Send(order.CustomerEmail, "...");
    }
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
public class OrderService
{
    private readonly IOrderRepository _repo;
    private readonly IEmailService _email; // [!code ++]
    private readonly ILogger<OrderService> _logger; // [!code ++]

    public OrderService( // [!code ++]
        IOrderRepository repo, // [!code ++]
        IEmailService email, // [!code ++]
        ILogger<OrderService> logger) // [!code ++]
    { // [!code ++]
        _repo = repo; // [!code ++]
        _email = email; // [!code ++]
        _logger = logger; // [!code ++]
    } // [!code ++]

    public void PlaceOrder(Order order)
    {
        _email.Send(order.CustomerEmail, "...");
        _logger.LogInformation("Order placed: {Id}", order.Id);
    }
}
```

---

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω 5: Ambient Context (–≥–ª–æ–±–∞–ª—å–Ω—ñ —Å—Ç–∞—Ç–∏—á–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ)

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è static properties –∞–±–æ –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö —Å–∏–Ω–≥–ª—Ç–æ–Ω—ñ–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ "–∫–æ–Ω—Ç–µ–∫—Å—Ç—É".

```csharp
// ‚ùå –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω: –≥–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ç–∏—á–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
public static class CurrentUser
{
    public static string? UserId { get; set; } // –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω!
    public static string? Email { get; set; }
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ‚Äî –∑–¥–∞—î—Ç—å—Å—è –∑—Ä—É—á–Ω–∏–º, –∞–ª–µ...
public class OrderService
{
    public void PlaceOrder(Order order)
    {
        var userId = CurrentUser.UserId; // –ó–≤—ñ–¥–∫–∏ —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ç–µ—Å—Ç—ñ?!
        // ...
    }
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ICurrentUserService —á–µ—Ä–µ–∑ DI
public interface ICurrentUserService
{
    string? UserId { get; }
    string? Email { get; }
}

public class HttpContextCurrentUserService : ICurrentUserService
{
    private readonly IHttpContextAccessor _httpContextAccessor;

    public HttpContextCurrentUserService(IHttpContextAccessor httpContextAccessor)
    {
        _httpContextAccessor = httpContextAccessor;
    }

    public string? UserId =>
        _httpContextAccessor.HttpContext?.User?.FindFirst(ClaimTypes.NameIdentifier)?.Value;

    public string? Email =>
        _httpContextAccessor.HttpContext?.User?.FindFirst(ClaimTypes.Email)?.Value;
}

// –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
services.AddHttpContextAccessor();
services.AddScoped<ICurrentUserService, HttpContextCurrentUserService>();

// –£ —Ç–µ—Å—Ç–∞—Ö ‚Äî –ª–µ–≥–∫–æ –º–æ–∫–∞—Ç–∏!
var mockUser = new Mock<ICurrentUserService>();
mockUser.Setup(u => u.UserId).Returns("test-user-id");
```

---

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω 6: –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤—Å—å–æ–≥–æ —è–∫ Singleton

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏ —Ä–µ—î—Å—Ç—Ä—É—é—Ç—å—Å—è —è–∫ Singleton —á–µ—Ä–µ–∑ "–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å".

```csharp
// ‚ùå –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω: –≤—Å—ñ Singleton
services.AddSingleton<IOrderRepository, SqlOrderRepository>(); // DbContext ‚Äî –ù–ï thread-safe!
services.AddSingleton<AppDbContext>(); // –î–£–ñ–ï –ü–û–ì–ê–ù–û!
services.AddSingleton<IShoppingCart, UserShoppingCart>(); // –°–ø—ñ–ª—å–Ω–∏–π –¥–ª—è –≤—Å—ñ—Ö!
```

**–ù–∞—Å–ª—ñ–¥–∫–∏:**
- `AppDbContext` —è–∫ Singleton ‚Üí —Å–ø—ñ–ª—å–Ω–∏–π –¥–ª—è –≤—Å—ñ—Ö –∑–∞–ø–∏—Ç—ñ–≤ ‚Üí race conditions ‚Üí corrupted data
- `IShoppingCart` —è–∫ Singleton ‚Üí –û–î–ò–ù –∫–æ—à–∏–∫ –¥–ª—è –í–°–Ü–• –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ ‚Üí –¥–∞–Ω—ñ –∑–∞–º–æ–≤–Ω–∏–∫–∞ A —É –∑–∞–º–æ–≤–Ω–∏–∫–∞ B!

```csharp
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π lifetime –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–µ—Ä–≤—ñ—Å—É
services.AddDbContext<AppDbContext>(...); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ Scoped
services.AddScoped<IOrderRepository, SqlOrderRepository>(); // Scoped (–º–∞—î DbContext)
services.AddScoped<IShoppingCart, UserShoppingCart>(); // Scoped (—ñ–∑–æ–ª—å–æ–≤–∞–Ω–∏–π –¥–æ –∑–∞–ø–∏—Ç—É)
services.AddSingleton<ICacheService, MemoryCacheService>(); // Singleton (thread-safe, shared cache)
```

---

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω 7: –Ü–Ω'—î–∫—Ü—ñ—è IConfiguration –Ω–∞–ø—Ä—è–º—É

**–ü—Ä–æ–±–ª–µ–º–∞**: Inject IConfiguration —ñ —á–∏—Ç–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è `configuration["Key"]` —É –±—ñ–∑–Ω–µ—Å-–∫–ª–∞—Å–∞—Ö.

```csharp
// ‚ùå –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω
public class EmailService
{
    private readonly IConfiguration _config; // –ü—Ä—è–º–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ IConfiguration!

    public EmailService(IConfiguration configuration)
    {
        _config = configuration;
    }

    public void Send(string to, string body)
    {
        var host = _config["Smtp:Host"]!; // Magic strings!
        var port = int.Parse(_config["Smtp:Port"]!); // –ú–æ–∂–µ –∫–∏–Ω—É—Ç–∏ FormatException!
        // ...
    }
}
```

**–ß–æ–º—É –ø–æ–≥–∞–Ω–æ:**
- "Magic strings" ‚Äî –ø–æ–º–∏–ª–∫–∏ —Ç—ñ–ª—å–∫–∏ –≤ runtime
- –í–∞–∂–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ (—Ç—Ä–µ–±–∞ mock IConfiguration)
- –ö–ª–∞—Å –∑–Ω–∞—î –ø—Ä–æ –≤—Å—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é, –∞ –Ω–µ —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ —Å–≤–æ—é —á–∞—Å—Ç–∏–Ω—É

```csharp
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: Options Pattern —á–µ—Ä–µ–∑ IOptions<T>
public class SmtpOptions
{
    public string Host { get; set; } = string.Empty;
    public int Port { get; set; } = 587;
    public string Username { get; set; } = string.Empty;
    public string Password { get; set; } = string.Empty;
}

// –£ Program.cs:
services.Configure<SmtpOptions>(configuration.GetSection("Smtp"));

// –£ —Å–µ—Ä–≤—ñ—Å—ñ:
public class EmailService
{
    private readonly SmtpOptions _options;

    // IOptions<T> –∞–±–æ IOptionsSnapshot<T> ‚Äî —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø!
    public EmailService(IOptions<SmtpOptions> options)
    {
        _options = options.Value;
    }

    public void Send(string to, string body)
    {
        var host = _options.Host;   // –¢–∏–ø–æ–±–µ–∑–ø–µ—á–Ω–æ! Compile-time –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞!
        var port = _options.Port;
        // ...
    }
}

// –£ —Ç–µ—Å—Ç–∞—Ö:
var options = Options.Create(new SmtpOptions { Host = "test-smtp", Port = 465 });
var emailService = new EmailService(options); // –õ–µ–≥–∫–æ!
```

---

## –ù–∞–π–∫—Ä–∞—â—ñ –ü—Ä–∞–∫—Ç–∏–∫–∏: –ó–∞–≥–∞–ª—å–Ω–∏–π –ß–µ–∫–ª—ñ—Å—Ç

::card-group

::card{title="–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è" icon="i-heroicons-list-bullet"}
- –û—Ä–≥–∞–Ω—ñ–∑–æ–≤—É–π—Ç–µ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ **Extension Methods** –ø–æ –º–æ–¥—É–ª—è—Ö
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `TryAdd*` —É –±—ñ–±–ª—ñ–æ—Ç–µ—á–Ω–æ–º—É –∫–æ–¥—ñ
- –ó–∞–≤–∂–¥–∏ –≤–º–∏–∫–∞–π—Ç–µ `ValidateOnBuild` —Ç–∞ `ValidateScopes`
- –†–µ—î—Å—Ç—Ä—É–π—Ç–µ –∑ **–Ω–∞–π–º–µ–Ω—à –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–º** lifetime (Transient ‚Üí Scoped ‚Üí Singleton)
::

::card{title="–Ü–Ω'—î–∫—Ü—ñ—è" icon="i-heroicons-arrow-down-tray"}
- **Constructor Injection** ‚Äî –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–∞–≤–∂–¥–∏
- `readonly` –¥–ª—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
- Guard clauses (`?? throw new ArgumentNullException`) –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
- –£–Ω–∏–∫–∞–π—Ç–µ `IServiceProvider` —É –±—ñ–∑–Ω–µ—Å-–∫–ª–∞—Å–∞—Ö
::

::card{title="Lifetimes" icon="i-heroicons-clock"}
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ Captive Dependency –ø–µ—Ä–µ–¥ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—î—é
- Singleton ‚Äî —Ç—ñ–ª—å–∫–∏ thread-safe —Å–µ—Ä–≤—ñ—Å–∏ –±–µ–∑ DbContext
- Scoped ‚Äî –¥–ª—è –≤—Å—å–æ–≥–æ –ø–æ–≤'—è–∑–∞–Ω–æ–≥–æ –∑ DbContext
- BackgroundService ‚Üí `IServiceScopeFactory` –¥–ª—è Scoped
::

::card{title="–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è" icon="i-heroicons-beaker"}
- –¢–µ—Å—Ç–∏ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –º–æ–∫–∏ –Ω–∞–ø—Ä—è–º—É
- –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –∫–æ—Ä–µ–∫—Ç–Ω—ñ—Å—Ç—å —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ–π —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `WebApplicationFactory<T>` –¥–ª—è —Ç–µ—Å—Ç—ñ–≤ ASP.NET Core
::

::

---

## üìù –ü—ñ–¥—Å—É–º–∫–æ–≤–µ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ù–∞–ø—Ä–∏–∫—ñ–Ω—Ü—ñ –∫—É—Ä—Å—É –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–≤–æ—ó –∑–Ω–∞–Ω–Ω—è –∑ —É—Å—å–æ–≥–æ –º–æ–¥—É–ª—é. –î–∞–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è –±–µ–∑ –¥–æ–ø–æ–º–æ–≥–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤, –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–µ–±–µ:

::field-group

  ::field{name="1. –£ —á–æ–º—É —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ IoC —Ç–∞ DI?"}
  **IoC** ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø —ñ–Ω–≤–µ—Ä—Å—ñ—ó —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è (—Ö—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª—é—î –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ). **DI** ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó IoC (–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –∑–∑–æ–≤–Ω—ñ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä/–≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å/–º–µ—Ç–æ–¥).
  ::

  ::field{name="2. –©–æ —Ç–∞–∫–µ Captive Dependency —Ç–∞ —è–∫ –π–æ–≥–æ –≤–∏—è–≤–∏—Ç–∏?"}
  –°–∏—Ç—É–∞—Ü—ñ—è, –∫–æ–ª–∏ —Å–µ—Ä–≤—ñ—Å —ñ–∑ –±—ñ–ª—å—à–∏–º lifetime (Singleton) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–µ—Ä–≤—ñ—Å —ñ–∑ –º–µ–Ω—à–∏–º (Scoped). –í–∏—è–≤–ª–µ–Ω–Ω—è: `ValidateScopes = true` —É `BuildServiceProvider`. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è: `IServiceScopeFactory` —É Singleton.
  ::

  ::field{name="3. –ö–æ–ª–∏ Service Locator –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–∏–π?"}
  –õ–∏—à–µ —É Composition Root (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É), Middleware, Legacy-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É –∞–±–æ –ø—Ä–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ–º—É –≤–∏–±–æ—Ä—ñ —Ç–∏–ø—É –≤ runtime. –£ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ—Ü—ñ ‚Äî –∑–∞–≤–∂–¥–∏ –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω.
  ::

  ::field{name="4. –Ø–∫—É —Ä–æ–ª—å –≤—ñ–¥—ñ–≥—Ä–∞—î —Ä–µ—Ñ–ª–µ–∫—Å—ñ—è —É DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ?"}
  –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `Type.GetConstructors()` —Ç–∞ `ConstructorInfo.GetParameters()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –∫–ª–∞—Å—É —Ç–∞ —ó—Ö resolve —á–µ—Ä–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ `GetService()`.
  ::

  ::field{name="5. –£ —á–æ–º—É —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ AddScoped —Ç–∞ AddTransient?"}
  **Scoped**: –æ–¥–∏–Ω –µ–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ –≤–µ—Å—å scope (HTTP-–∑–∞–ø–∏—Ç). **Transient**: –Ω–æ–≤–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É `GetService<T>()`. –û–±–∏–¥–≤–∞ –∑–Ω–∏—â—É—é—Ç—å—Å—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ scope —è–∫—â–æ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å `IDisposable`.
  ::

::

---

## –ö–æ—Ä–∏—Å–Ω—ñ –ü–æ—Å–∏–ª–∞–Ω–Ω—è

::card-group

::card{title="–û—Ñ—ñ—Ü—ñ–π–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Microsoft DI" icon="i-simple-icons-microsoft" to="https://docs.microsoft.com/en-us/dotnet/core/extensions/dependency-injection"}
–ü–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Microsoft.Extensions.DependencyInjection
::

::card{title="Autofac ‚Äî –ø—Ä–æ—Å—É–Ω—É—Ç–∏–π DI" icon="i-heroicons-puzzle-piece" to="https://autofac.org/"}
–ë—ñ–ª—å—à –ø–æ—Ç—É–∂–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ (Decorators, Modules, AOP)
::

::card{title="Scrutor ‚Äî —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Microsoft DI" icon="i-heroicons-sparkles" to="https://github.com/khellang/Scrutor"}
Assembly scanning —Ç–∞ Decorator support –¥–ª—è Microsoft DI
::

::card{title="Mark Seemann: Pure DI" icon="i-heroicons-book-open" to="https://blog.ploeh.dk/2014/06/10/pure-di/"}
–ê—Ä–≥—É–º–µ–Ω—Ç–∏ –∑–∞ —Ç–∞ –ø—Ä–æ—Ç–∏ DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤ –≤—ñ–¥ –∞–≤—Ç–æ—Ä–∞ DI .NET –∫–Ω–∏–≥–∏
::

::
