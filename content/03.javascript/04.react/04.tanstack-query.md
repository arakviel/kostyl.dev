# TanStack Query: –ö–µ—Ä—É–≤–∞–Ω–Ω—è –°—Ç–∞–Ω–æ–º –°–µ—Ä–≤–µ—Ä–∞

–í–∏ —â–æ–π–Ω–æ –Ω–∞–≤—á–∏–ª–∏—Å—è —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏ —á–µ—Ä–µ–∑ Axios. –í–∞—à –∫–æ–¥ –≤–∏–≥–ª—è–¥–∞—î –Ω–µ–ø–æ–≥–∞–Ω–æ, –∞–ª–µ –∑ —Ä–æ—Å—Ç–æ–º –¥–æ–¥–∞—Ç–∫—É –≤–∏–Ω–∏–∫–∞—é—Ç—å –Ω–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏:

- **–ö–µ—à—É–≤–∞–Ω–Ω—è**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ–π—à–æ–≤ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ü—Ä–æ—Ñ—ñ–ª—å", –ø–æ—Ç—ñ–º –Ω–∞ "–ì–æ–ª–æ–≤–Ω—É", –∞ –ø–æ—Ç—ñ–º –∑–Ω–æ–≤—É –Ω–∞ "–ü—Ä–æ—Ñ—ñ–ª—å". –ß–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–æ–≤—É —Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç, —è–∫—â–æ –¥–∞–Ω—ñ –Ω–µ –∑–º—ñ–Ω–∏–ª–∏—Å—è?
- **–î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è**: –î–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –ø—Ä–æ—Å—è—Ç—å –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –í–∏ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–µ –¥–≤–∞ –∑–∞–ø–∏—Ç–∏?
- **–ê–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å**: –Ø–∫ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —â–æ –¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –∑–º—ñ–Ω–∏–ª–∏—Å—è, –ø–æ–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É?
- **Pagination/Infinite Scroll**: –ù–∞–ø–∏—Å–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —â–µ" –≤—Ä—É—á–Ω—É ‚Äî —Ü–µ –±—ñ–ª—å.

–¢—É—Ç –Ω–∞ —Å—Ü–µ–Ω—É –≤–∏—Ö–æ–¥–∏—Ç—å **TanStack Query** (—Ä–∞–Ω—ñ—à–µ React Query). –¶–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ "–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤", —Ü–µ **Async State Manager**.

::tip
**–ê–Ω–∞–ª–æ–≥—ñ—è**: –Ø–∫—â–æ **Axios** ‚Äî —Ü–µ –∫—É—Ä'—î—Ä, —è–∫–∏–π –±—ñ–≥–∞—î –∑–∞ –ø–æ—Å–∏–ª–∫–æ—é, —Ç–æ **TanStack Query** ‚Äî —Ü–µ –∑–∞–≤–≥–æ—Å–ø, —è–∫–∏–π –∫–∞–∂–µ: "–°—Ç—ñ–π, —É –Ω–∞—Å —Ü—è –ø–æ—Å–∏–ª–∫–∞ –≤–∂–µ –ª–µ–∂–∏—Ç—å –Ω–∞ —Å–∫–ª–∞–¥—ñ –∑ –º–∏–Ω—É–ª–æ–≥–æ —Ä–∞–∑—É, –Ω–µ –±—ñ–∂–∏ –¥–∞—Ä–º–∞".
::

## –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è: Client State vs Server State

–©–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏ TanStack Query, —Ç—Ä–µ–±–∞ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ —Å—Ç–∞–Ω —É –≤–∞—à—ñ–π –≥–æ–ª–æ–≤—ñ –Ω–∞ –¥–≤–∞ —Ç–∏–ø–∏:

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Client State (UI) | Server State (Data) |
| :--- | :--- | :--- |
| **–ü—Ä–∏–∫–ª–∞–¥** | `isModalOpen`, `inputValue`, `theme` | –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤, –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ |
| **–î–µ –∂–∏–≤–µ** | –£ –ø–∞–º'—è—Ç—ñ –±—Ä–∞—É–∑–µ—Ä–∞ | –ù–∞ –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ |
| **–ö–æ–Ω—Ç—Ä–æ–ª—å** | –ú–∏ –ø–æ–≤–Ω—ñ—Å—Ç—é –∫–æ–Ω—Ç—Ä–æ–ª—é—î–º–æ | –ú–∏ –ª–∏—à–µ –º–∞—î–º–æ "–∑–Ω—ñ–º–æ–∫" –¥–∞–Ω–∏—Ö |
| **–ü—Ä–æ–±–ª–µ–º–∞** | –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ | **–ó–∞—Å—Ç–∞—Ä—ñ–≤–∞–Ω–Ω—è (Staleness)** |
| **–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** | Context API, Zustand, Redux | **TanStack Query** |

::warning
**–ì–æ–ª–æ–≤–Ω–∞ –ø–æ–º–∏–ª–∫–∞**: –ù–∞–º–∞–≥–∞—Ç–∏—Å—è –∑–∞–ø–∏—Ö–Ω—É—Ç–∏ Server State —É Redux –∞–±–æ Zustand. –¶–µ –∑–º—É—à—É—î –≤–∞—Å –ø–∏—Å–∞—Ç–∏ —Ç–æ–Ω–Ω–∏ boilerplate-–∫–æ–¥—É –¥–ª—è –æ–±—Ä–æ–±–∫–∏ `loading`, `error`, `caching`, —è–∫–∏–π TanStack Query —Ä–æ–±–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.
::

---

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –Ü–Ω—Å—Ç–∞–ª—è—Ü—ñ—è

–ú–∏ –±—É–¥–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤–µ—Ä—Å—ñ—é 5 (–æ—Å—Ç–∞–Ω–Ω—é —Å—Ç–∞–±—ñ–ª—å–Ω—É –Ω–∞ –º–æ–º–µ–Ω—Ç React 19).

```bash
npm install @tanstack/react-query @tanstack/react-query-devtools
```

### 2. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

–û–≥–æ—Ä–Ω—ñ—Ç—å –≤–∞—à –¥–æ–¥–∞—Ç–æ–∫ —É `QueryClientProvider`. –¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∫–µ—à—É.

```jsx [main.jsx]
import React from 'react';
import ReactDOM from 'react-dom/client';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import App from './App';

// 1. –°—Ç–≤–æ—Ä—é—î–º–æ –∫–ª—ñ—î–Ω—Ç
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // –ì–ª–æ–±–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
      staleTime: 1000 * 60, // –î–∞–Ω—ñ –≤–≤–∞–∂–∞—é—Ç—å—Å—è "—Å–≤—ñ–∂–∏–º–∏" 1 —Ö–≤–∏–ª–∏–Ω—É
    },
  },
});

ReactDOM.createRoot(document.getElementById('root')).render(
  <QueryClientProvider client={queryClient}>
    <App />
    {/* DevTools ‚Äî —Ü–µ –º–∞—Å—Ç—Ö–µ–≤ –¥–ª—è –¥–µ–±–∞–≥—É! */}
    <ReactQueryDevtools initialIsOpen={false} />
  </QueryClientProvider>
);
```

---

## –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö: `useQuery`

–ó–∞–±—É–¥—å—Ç–µ –ø—Ä–æ `useEffect` + `useState` + `isLoading`. –•—É–∫ `useQuery` —Ä–æ–±–∏—Ç—å –≤—Å–µ —Ü–µ –∑–∞ –≤–∞—Å.

### –ê–Ω–∞—Ç–æ–º—ñ—è —Ö—É–∫–∞

::code-group

```javascript [–°–∏–Ω—Ç–∞–∫—Å–∏—Å]
const { data, isLoading, isError, error } = useQuery({
  queryKey: ['unique-key'], // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –≤ –∫–µ—à—ñ
  queryFn: fetchFunction,   // –§—É–Ω–∫—Ü—ñ—è, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î Promise
});
```

```jsx [–ü—Ä–∏–∫–ª–∞–¥ –∑ Axios]
import { useQuery } from '@tanstack/react-query';
import axios from 'axios';

// –§—É–Ω–∫—Ü—ñ—è –∑–∞–ø–∏—Ç—É (–∫—Ä–∞—â–µ –≤–∏–Ω–æ—Å–∏—Ç–∏ –≤ –æ–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª api)
const fetchProducts = async () => {
  const { data } = await axios.get('https://api.escuelajs.co/api/v1/products');
  return data;
};

function ProductsList() {
  const { data, isLoading, isError, error } = useQuery({
    queryKey: ['products'],
    queryFn: fetchProducts,
  });

  if (isLoading) return <div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>;
  if (isError) return <div>–ü–æ–º–∏–ª–∫–∞: {error.message}</div>;

  return (
    <ul>
      {data.map(product => (
        <li key={product.id}>{product.title}</li>
      ))}
    </ul>
  );
}
```

::

### –ú–∞–≥—ñ—è Query Keys

`queryKey` ‚Äî —Ü–µ –º–∞—Å–∏–≤, —è–∫–∏–π –ø—Ä–∞—Ü—é—î —è–∫ –º–∞—Å–∏–≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –≤ `useEffect`. –Ø–∫—â–æ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –º–∞—Å–∏–≤—ñ –∑–º—ñ–Ω—é—î—Ç—å—Å—è, Query –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–±–∏—Ç—å –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç.

```javascript
// ‚úÖ –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫
useQuery({ queryKey: ['todos'], ... })

// ‚úÖ –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç (—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è)
useQuery({ queryKey: ['todos', { status: 'done' }], ... })

// ‚úÖ –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ ID
useQuery({ 
  queryKey: ['todos', todoId], 
  queryFn: () => fetchTodoById(todoId) 
})
```

::mermaid
graph TD
    A[Component Renders] --> B{Check Cache for Key}
    B -- Found & Fresh --> C[Return Cached Data]
    B -- Found & Stale --> D[Return Cached Data]
    D --> E[Refetch in Background]
    B -- Not Found --> F[Fetch Data]
    
    style E stroke:#f59e0b,stroke-width:2px
    style C stroke:#10b981,stroke-width:2px
::

---

## –ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó: StaleTime vs GcTime

–¶–µ —Ç–µ, –¥–µ –ø–ª—É—Ç–∞—é—Ç—å—Å—è 90% –Ω–æ–≤–∞—á–∫—ñ–≤.

### `staleTime` (–ß–∞—Å —Å–≤—ñ–∂–æ—Å—Ç—ñ)
**–ü–∏—Ç–∞–Ω–Ω—è**: "–Ø–∫ –¥–æ–≤–≥–æ —Ü—ñ –¥–∞–Ω—ñ –≤–≤–∞–∂–∞—é—Ç—å—Å—è –∞–∫—Ç—É–∞–ª—å–Ω–∏–º–∏, –ø–µ—Ä—à –Ω—ñ–∂ —è —Å–ø—Ä–æ–±—É—é –æ–Ω–æ–≤–∏—Ç–∏ —ó—Ö?"
- –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: **0 ms**.
- –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ Query –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–≤–∞–∂–∞—î –¥–∞–Ω—ñ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–º–∏ –º–∏—Ç—Ç—î–≤–æ. –ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø–µ—Ä–µ—Ñ–æ–∫—É—Å—É–≤–∞–Ω–Ω—ñ –≤—ñ–∫–Ω–∞ –∞–±–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –±—É–¥–µ –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—è —Ñ–æ–Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç.
- –Ø–∫—â–æ –≤–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `staleTime: 5000` (5 —Å–µ–∫—É–Ω–¥), —Ç–æ –ø—Ä–æ—Ç—è–≥–æ–º 5 —Å–µ–∫—É–Ω–¥ –∑–∞–ø–∏—Ç–∏ –Ω–µ –±—É–¥—É—Ç—å –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏—Å—è, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –≤–∏–∫–ª–∏—á–µ—Ç–µ —ó—Ö –∑–Ω–æ–≤—É.

### `gcTime` (Garbage Collection Time, —Ä–∞–Ω—ñ—à–µ cacheTime)
**–ü–∏—Ç–∞–Ω–Ω—è**: "–Ø–∫ –¥–æ–≤–≥–æ —Ç—Ä–∏–º–∞—Ç–∏ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω—ñ –¥–∞–Ω—ñ –≤ –ø–∞–º'—è—Ç—ñ?"
- –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: **5 —Ö–≤–∏–ª–∏–Ω**.
- –Ø–∫—â–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–µ–º–æ–Ω—Ç—É—î—Ç—å—Å—è, –¥–∞–Ω—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤ "—Ö–æ–ª–æ–¥–Ω–æ–º—É —Å—Ö–æ–≤–∏—â—ñ". –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–≤–µ—Ä–Ω–µ—Ç—å—Å—è –ø—Ä–æ—Ç—è–≥–æ–º 5 —Ö–≤–∏–ª–∏–Ω ‚Äî –¥–∞–Ω—ñ –º–∏—Ç—Ç—î–≤–æ –∑'—è–≤–ª—è—Ç—å—Å—è –∑ –∫–µ—à—É, –ø–æ–∫–∏ –π–¥–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è. –Ø–∫—â–æ –Ω—ñ ‚Äî –≤–æ–Ω–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –¥–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ.

---

## –ú—É—Ç–∞—Ü—ñ—ó: `useMutation`

–î–ª—è –∑–º—ñ–Ω–∏ –¥–∞–Ω–∏—Ö (POST, PUT, DELETE) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `useMutation`. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ `useQuery`, –º—É—Ç–∞—Ü—ñ—ó –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ ‚Äî –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ —ó—Ö –≤—Ä—É—á–Ω—É.

### –ü–∞—Ç–µ—Ä–Ω: "Invalidation" (–û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö)

–¶–µ "–°–≤—è—Ç–∏–π –ì—Ä–∞–∞–ª—å" TanStack Query. –ö–æ–ª–∏ –º–∏ —â–æ—Å—å –∑–º—ñ–Ω—é—î–º–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ, –Ω–∞—à –ª–æ–∫–∞–ª—å–Ω–∏–π –∫–µ—à —Å—Ç–∞—î –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–∏–º. –ú–∏ –ø–æ–≤–∏–Ω–Ω—ñ —Å–∫–∞–∑–∞—Ç–∏ Query: "–ü–æ–∑–Ω–∞—á —Ü—ñ –¥–∞–Ω—ñ —è–∫ —Å—Ç–∞—Ä—ñ —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂ –Ω–æ–≤—ñ".

```jsx [CreateProduct.jsx]
import { useMutation, useQueryClient } from '@tanstack/react-query';
import axios from 'axios';

function CreateProduct() {
  const queryClient = useQueryClient(); // –î–æ—Å—Ç—É–ø –¥–æ –∫–µ—à—É

  const mutation = useMutation({
    mutationFn: (newProduct) => {
      return axios.post('https://api.escuelajs.co/api/v1/products', newProduct);
    },
    // –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—Ä–∏ —É—Å–ø—ñ—à–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ
    onSuccess: () => {
      // üí• –ë–£–ú! –ú–∏ –∫–∞–∂–µ–º–æ: –¥–∞–Ω—ñ –∑–∞ –∫–ª—é—á–µ–º ['products'] –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏.
      // Query –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑—Ä–æ–±–∏—Ç—å refetch —Ç–∞–º, –¥–µ —Ü–µ–π –∫–ª—é—á –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è.
      queryClient.invalidateQueries({ queryKey: ['products'] });
      alert('–ü—Ä–æ–¥—É–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ!');
    },
  });

  return (
    <button 
      onClick={() => mutation.mutate({ title: 'New Item', price: 100 })}
      disabled={mutation.isPending}
    >
      {mutation.isPending ? '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è...' : '–°—Ç–≤–æ—Ä–∏—Ç–∏ –ü—Ä–æ–¥—É–∫—Ç'}
    </button>
  );
}
```

::note
–í–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä—É—á–Ω—É –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –º–∞—Å–∏–≤ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ —É —Å—Ç–∞–Ω—ñ. –ü—Ä–æ—Å—Ç–æ —ñ–Ω–≤–∞–ª—ñ–¥—É–π—Ç–µ –∫–ª—é—á, —ñ `ProductsList` —Å–∞–º –æ–Ω–æ–≤–∏—Ç—å –¥–∞–Ω—ñ. –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î "Single Source of Truth".
::

---

## Advanced: –û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (Optimistic Updates)

–ö–æ–ª–∏ –≤–∏ —Å—Ç–∞–≤–∏—Ç–µ "–ª–∞–π–∫", –≤–∏ –Ω–µ —Ö–æ—á–µ—Ç–µ —á–µ–∫–∞—Ç–∏. –í–∏ —Ö–æ—á–µ—Ç–µ –±–∞—á–∏—Ç–∏ —á–µ—Ä–≤–æ–Ω–µ —Å–µ—Ä–¥–µ—á–∫–æ –º–∏—Ç—Ç—î–≤–æ.

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –û–Ω–æ–≤–∏—Ç–∏ UI **–¥–æ** –∑–∞–ø–∏—Ç—É.
2. –ó—Ä–æ–±–∏—Ç–∏ –∑–∞–ø–∏—Ç.
3. –Ø–∫—â–æ –ø–æ–º–∏–ª–∫–∞ ‚Äî –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ –∑–º—ñ–Ω–∏ –Ω–∞–∑–∞–¥.
4. –Ø–∫—â–æ —É—Å–ø—ñ—Ö ‚Äî (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ "—Å–ø—Ä–∞–≤–∂–Ω—ñ" –¥–∞–Ω—ñ.

```jsx [LikeButton.jsx]
import { useMutation, useQueryClient } from '@tanstack/react-query';

function LikeButton({ postId }) {
  const queryClient = useQueryClient();

  const { mutate } = useMutation({
    mutationFn: likePostApi,
    
    // 1. –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –î–û –∑–∞–ø–∏—Ç—É
    onMutate: async (newLike) => {
      // –ó—É–ø–∏–Ω—è—î–º–æ –±—É–¥—å-—è–∫—ñ —Ñ–æ–Ω–æ–≤—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü—å–æ–≥–æ –ø–æ—Å—Ç–∞, —â–æ–± –≤–æ–Ω–∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–ª–∏ –Ω–∞—à –æ–ø—Ç–∏–º—ñ–∑–º
      await queryClient.cancelQueries({ queryKey: ['post', postId] });

      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å—Ç–∞–Ω (snapshot) –¥–ª—è –º–æ–∂–ª–∏–≤–æ–≥–æ –≤—ñ–¥–∫–∞—Ç—É
      const previousPost = queryClient.getQueryData(['post', postId]);

      // –û–Ω–æ–≤–ª—é—î–º–æ –∫–µ—à –≤—Ä—É—á–Ω—É "–æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–æ"
      queryClient.setQueryData(['post', postId], (old) => ({
        ...old,
        likes: old.likes + 1,
        isLiked: true,
      }));

      // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ snapshot —É –∫–æ–Ω—Ç–µ–∫—Å—Ç
      return { previousPost };
    },

    // 2. –Ø–∫—â–æ —Å—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞
    onError: (err, newLike, context) => {
      // –í—ñ–¥–∫–æ—á—É—î–º–æ—Å—è –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å—Ç–∞–Ω—É
      queryClient.setQueryData(['post', postId], context.previousPost);
    },

    // 3. –ó–∞–≤–∂–¥–∏ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (—É—Å–ø—ñ—Ö —á–∏ –ø–æ–º–∏–ª–∫–∞)
    onSettled: () => {
      // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ—Å—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º –¥–ª—è –ø–µ–≤–Ω–æ—Å—Ç—ñ
      queryClient.invalidateQueries({ queryKey: ['post', postId] });
    },
  });

  return <button onClick={() => mutate()}>‚ù§Ô∏è Like</button>;
}
```

---

## React 19: Suspense Integration

–í React 19 Suspense —Å—Ç–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. TanStack Query v5 –º–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Ö—É–∫ –¥–ª—è —Ü—å–æ–≥–æ ‚Äî `useSuspenseQuery`.

–í—ñ–Ω –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ `data` –∑–∞–≤–∂–¥–∏ –≤–∏–∑–Ω–∞—á–µ–Ω–∞ (–Ω–µ `undefined`), –∞ —Å—Ç–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –Ω–∞–π–±–ª–∏–∂—á–∏–º `<Suspense>` boundary.

```jsx [SuspenseComponent.jsx]
import { Suspense } from 'react';
import { useSuspenseQuery } from '@tanstack/react-query';

function UserProfile({ userId }) {
  // –¢—É—Ç –Ω–µ–º–∞—î isLoading! –ö–æ–º–ø–æ–Ω–µ–Ω—Ç "–∑–∞–≤–∏—Å–Ω–µ", —è–∫—â–æ –¥–∞–Ω–∏—Ö –Ω–µ–º–∞—î.
  const { data } = useSuspenseQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
  });

  return <h1>{data.name}</h1>;
}

export function App() {
  return (
    <Suspense fallback={<div className="skeleton">Loading Profile...</div>}>
      <UserProfile userId={1} />
    </Suspense>
  );
}
```

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø–æ—Ä–∞–¥–∏ (Best Practices)

::card-group
::card{title="–ö–æ–ª–æ–∫–∞—Ü—ñ—è –∫–ª—é—á—ñ–≤" icon="i-heroicons-key"}
–¢—Ä–∏–º–∞–π—Ç–µ `queryKey` –ø–æ—Ä—É—á —ñ–∑ —Ñ—É–Ω–∫—Ü—ñ—î—é –∑–∞–ø–∏—Ç—É. –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±'—î–∫—Ç `productKeys` (factory pattern), —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ñ —Ä—è–¥–∫—ñ–≤:
`const productKeys = { all: ['products'], detail: (id) => ['products', id] }`
::

::card{title="DevTools" icon="i-heroicons-computer-desktop"}
–ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `ReactQueryDevtools` —É —Ä–æ–∑—Ä–æ–±—Ü—ñ. –¶–µ —î–¥–∏–Ω–∏–π —Å–ø–æ—Å—ñ–± –ø–æ–±–∞—á–∏—Ç–∏, —â–æ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —É –≤–∞—à–æ–º—É –∫–µ—à—ñ (—â–æ —Å–≤—ñ–∂–µ, —â–æ –∑–∞—Å—Ç–∞—Ä—ñ–ª–µ, —â–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è).
::

::card{title="Custom Hooks" icon="i-heroicons-code-bracket"}
–ù–µ –≤–∏–∫–ª–∏–∫–∞–π—Ç–µ `useQuery` –ø—Ä—è–º–æ –≤ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö. –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–∞—Å—Ç–æ–º–Ω–∏–π —Ö—É–∫ `useProducts`, `useCreateProduct`. –¶–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `staleTime`) –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ.
::
::

## –ü—ñ–¥—Å—É–º–æ–∫

TanStack Query ‚Äî —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–º—ñ–Ω–∞ `useEffect`. –¶–µ –∑–º—ñ–Ω–∞ –ø–∞—Ä–∞–¥–∏–≥–º–∏.

1.  **Server State** != **Client State**.
2.  **Query Keys** ‚Äî —Ü–µ –≤–∞—à—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ.
3.  **Invalidation** ‚Äî —Ü–µ —Å–ø–æ—Å—ñ–± —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –ø—ñ—Å–ª—è –∑–º—ñ–Ω.
4.  **StaleTime** –∫–æ–Ω—Ç—Ä–æ–ª—é—î —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø–∏—Ç—ñ–≤.

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –≤–∏ –≤–∏–¥–∞–ª—è—î—Ç–µ —Å–æ—Ç–Ω—ñ —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É, –ø–æ–≤'—è–∑–∞–Ω–æ–≥–æ –∑—ñ —Å—Ç–∞–Ω–∞–º–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —ñ –æ—Ç—Ä–∏–º—É—î—Ç–µ –¥–æ–¥–∞—Ç–æ–∫, —è–∫–∏–π –≤—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è "–º–∏—Ç—Ç—î–≤–∏–º" –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞–≤–¥—è–∫–∏ —Ä–æ–∑—É–º–Ω–æ–º—É –∫–µ—à—É–≤–∞–Ω–Ω—é.
