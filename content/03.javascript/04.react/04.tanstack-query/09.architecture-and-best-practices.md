# –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ Best Practices

–ú–∏ –≤–∏–≤—á–∏–ª–∏ API. –¢–µ–ø–µ—Ä –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ —Ç–µ, —è–∫ –Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–º—ñ—Ç–Ω–∏–∫.
TanStack Query –¥–∞—î –±–∞–≥–∞—Ç–æ —Å–≤–æ–±–æ–¥–∏, –∞–ª–µ "–∑ –≤–µ–ª–∏–∫–æ—é —Å–∏–ª–æ—é –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤–µ–ª–∏–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å".

–û—Å—å –ø—Ä–∞–≤–∏–ª–∞, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ –∫–æ–º–∞–Ω–¥–∏.

## 1. –ö–∞—Å—Ç–æ–º–Ω—ñ –•—É–∫–∏ ‚Äî –¶–µ –ó–∞–∫–æ–Ω

**–ù—ñ–∫–æ–ª–∏** –Ω–µ –≤–∏–∫–ª–∏–∫–∞–π—Ç–µ `useQuery` –ø—Ä—è–º–æ –≤ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (—è–∫—â–æ —Ü–µ –Ω–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø –Ω–∞ –∫–æ–ª—ñ–Ω—ñ).

### –ß–æ–º—É?
1.  **–ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –º–∞—î –∑–Ω–∞—Ç–∏ –ø—Ä–æ `queryKey` –∞–±–æ `staleTime`.
2.  **–ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –Ø–∫—â–æ –≤–∞–º —Ç—Ä–µ–±–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ Header —ñ –≤ Sidebar, –≤–∏ –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ `useUser()`.
3.  **–õ–µ–≥–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**: –ó–º—ñ–Ω–∏–≤—Å—è –∫–ª—é—á? –ó–º—ñ–Ω–∏–ª–∞—Å—å –ª–æ–≥—ñ–∫–∞? –í–∏ –ø—Ä–∞–≤–∏—Ç–µ —Ü–µ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ.

```tsx
// ‚ùå –ü–æ–≥–∞–Ω–æ: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–Ω–∞—î –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ
function UserProfile() {
  const { data } = useQuery({ queryKey: ['user'], queryFn: fetchUser });
  // ...
}

// ‚úÖ –î–æ–±—Ä–µ: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ—Å–∏—Ç—å –¥–∞–Ω—ñ
function UserProfile() {
  const { data } = useUser();
  // ...
}

// hooks/useUser.ts
export const useUser = () => {
  return useQuery({
    queryKey: userKeys.me(),
    queryFn: api.getUser,
    staleTime: 1000 * 60 * 30, // –ú–∏ –≤–∏—Ä—ñ—à–∏–ª–∏, —â–æ —é–∑–µ—Ä –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è —á–∞—Å—Ç–æ
  });
};
```

## 2. –§–∞–±—Ä–∏–∫–∏ –ö–ª—é—á—ñ–≤ (Query Key Factories)

–ú–∏ –∑–≥–∞–¥—É–≤–∞–ª–∏ —Ü–µ –≤ —Ä–æ–∑–¥—ñ–ª—ñ 3, –∞–ª–µ —Ü–µ –≤–∞—Ä—Ç–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏. –•–∞–æ—Å —É –∫–ª—é—á–∞—Ö ‚Äî –≥–æ–ª–æ–≤–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –±–∞–≥—ñ–≤ —ñ–Ω–≤–∞–ª—ñ–¥–∞—Ü—ñ—ó.

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É `@lukemorales/query-key-factory` –∞–±–æ –ø–∏—à—ñ—Ç—å –æ–±'—î–∫—Ç–∏ –≤—Ä—É—á–Ω—É.

```typescript
const todoKeys = {
  all: ['todos'] as const,
  lists: () => [...todoKeys.all, 'list'] as const,
  list: (filters: string) => [...todoKeys.lists(), { filters }] as const,
  details: () => [...todoKeys.all, 'detail'] as const,
  detail: (id: number) => [...todoKeys.details(), id] as const,
};
```

## 3. –†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –®–∞—Ä—ñ–≤ (Layered Architecture)

–ß—ñ—Ç–∫–æ —Ä–æ–∑–¥—ñ–ª—è–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å:

1.  **API Layer** (`api/todos.ts`): –ß–∏—Å—Ç—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ —Ä–æ–±–ª—è—Ç—å `fetch` / `axios` —ñ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å Promise. –ù—ñ—è–∫–æ–≥–æ React.
2.  **Query Layer** (`hooks/useTodos.ts`): –ö–∞—Å—Ç–æ–º–Ω—ñ —Ö—É–∫–∏, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å API —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ –¥–æ–¥–∞—é—Ç—å –ª–æ–≥—ñ–∫—É –∫–µ—à—É–≤–∞–Ω–Ω—è (`useQuery`).
3.  **UI Layer** (`components/TodoList.tsx`): –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ö—É–∫–∏ —Ç–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å JSX.

## 4. –ì–ª–æ–±–∞–ª—å–Ω–∞ –û–±—Ä–æ–±–∫–∞ –ü–æ–º–∏–ª–æ–∫

–ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ `isError` —É –∫–æ–∂–Ω–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `QueryCache` global callbacks –¥–ª—è —Ç–æ—Å—Ç—ñ–≤, —Ç–∞ **Error Boundaries** –¥–ª—è UI.

```typescript
// queryClient.ts
const queryClient = new QueryClient({
  queryCache: new QueryCache({
    onError: (error) => {
      toast.error(`Something went wrong: ${error.message}`);
    },
  }),
});
```

–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö:

```tsx
// –Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ useSuspenseQuery, –ø–æ–º–∏–ª–∫–∞ "—Å–ø–ª–∏–≤–µ" –¥–æ –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ ErrorBoundary
function App() {
  return (
    <ErrorBoundary fallback={<div>Something broke!</div>}>
      <Suspense fallback={<div>Loading...</div>}>
        <UserProfile />
      </Suspense>
    </ErrorBoundary>
  );
}
```

## 5. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ù–µ —Ç–µ—Å—Ç—É–π—Ç–µ `TanStack Query`. –í—ñ–Ω –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–∏–π –∞–≤—Ç–æ—Ä–∞–º–∏. –¢–µ—Å—Ç—É–π—Ç–µ **–≤–∞—à—ñ** —Ö—É–∫–∏ —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é.

–î–ª—è —Ç–µ—Å—Ç—ñ–≤ —Å—Ç–≤–æ—Ä—ñ—Ç—å –æ–∫—Ä–µ–º–∏–π `queryClient` –∑ –≤–∏–º–∫–Ω–µ–Ω–∏–º–∏ `retry` (—â–æ–± —Ç–µ—Å—Ç–∏ –Ω–µ —á–µ–∫–∞–ª–∏ –≤—ñ—á–Ω—ñ—Å—Ç—å –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö).

```typescript
const createTestQueryClient = () => new QueryClient({
  defaultOptions: {
    queries: {
      retry: false, // –í–∞–∂–ª–∏–≤–æ –¥–ª—è —Ç–µ—Å—Ç—ñ–≤!
    },
  },
});

test('renders todos', async () => {
  render(
    <QueryClientProvider client={createTestQueryClient()}>
      <TodoList />
    </QueryClientProvider>
  );
  // ...
});
```

## –í–∏—Å–Ω–æ–≤–æ–∫

TanStack Query ‚Äî —Ü–µ –ø–æ—Ç—É–∂–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Ä–æ–±–∏—Ç—å –≤–∞—à –∫–æ–¥ —á–∏—Å—Ç—ñ—à–∏–º, –∞ –¥–æ–¥–∞—Ç–æ–∫ ‚Äî —à–≤–∏–¥—à–∏–º.

**–ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª–∞:**
- [ ] –í—Å—ñ –∑–∞–ø–∏—Ç–∏ –≤ –∫–∞—Å—Ç–æ–º–Ω–∏—Ö —Ö—É–∫–∞—Ö.
- [ ] –ö–ª—é—á—ñ –∑—ñ–±—Ä–∞–Ω—ñ –≤ Key Factory.
- [ ] `staleTime` –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –≥–ª–æ–±–∞–ª—å–Ω–æ —Ç–∞ –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –¥–µ —Ç—Ä–µ–±–∞.
- [ ] –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è `DevTools`.
- [ ] –ú—É—Ç–∞—Ü—ñ—ó –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —ñ–Ω–≤–∞–ª—ñ–¥—É—é—Ç—å –ø–æ–≤'—è–∑–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏.

–í—ñ—Ç–∞—î–º–æ! –í–∏ –ø—Ä–æ–π—à–ª–∏ –∫—É—Ä—Å –º–∞–π—Å—Ç–µ—Ä–Ω–æ—Å—Ç—ñ TanStack Query. –¢–µ–ø–µ—Ä –π–¥—ñ—Ç—å —ñ –≤–∏–¥–∞–ª—ñ—Ç—å –≤–µ—Å—å —Ü–µ–π `useEffect` –∫–æ–¥ –∑—ñ —Å–≤–æ—ó—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤! üöÄ
