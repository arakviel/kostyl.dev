# Middleware —Ç–∞ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ—Å—Ç—å (Redux Thunk)

–¶–µ –æ—Å—Ç–∞–Ω–Ω—ñ–π –ø–∞–∑–ª —É "–∫–ª–∞—Å–∏—á–Ω–æ–º—É" Redux.

–î–æ—Å—ñ –Ω–∞—à—ñ actions –±—É–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º–∏: –Ω–∞—Ç–∏—Å–Ω—É–ª–∏ –∫–Ω–æ–ø–∫—É -> –º–∏—Ç—Ç—î–≤–æ –∑–º—ñ–Ω–∏–≤—Å—è —Å—Ç–∞–Ω. –ê–ª–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É –∂–∏—Ç—Ç—ñ –º–∏ —Ä–æ–±–∏–º–æ –∑–∞–ø–∏—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —è–∫—ñ –∑–∞–π–º–∞—é—Ç—å —á–∞—Å.

## –ß–æ–º—É –Ω–µ –º–æ–∂–Ω–∞ —Ä–æ–±–∏—Ç–∏ fetch –≤ —Ä–µ–¥—é—Å–µ—Ä—ñ?

–ó–≥–∞–¥–∞—î–º–æ –ø—Ä–∞–≤–∏–ª–æ: **–†–µ–¥—é—Å–µ—Ä–∏ –º–∞—é—Ç—å –±—É—Ç–∏ —á–∏—Å—Ç–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏**.
-   `fetch` ‚Äî —Ü–µ –ø–æ–±—ñ—á–Ω–∏–π –µ—Ñ–µ–∫—Ç.
-   `fetch` ‚Äî —Ü–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è (Promise).

–†–µ–¥—é—Å–µ—Ä –ø–æ–≤–∏–Ω–µ–Ω –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –Ω–æ–≤–∏–π —Å—Ç–∞–Ω **–º–∏—Ç—Ç—î–≤–æ**. –í—ñ–Ω –Ω–µ –º–æ–∂–µ —á–µ–∫–∞—Ç–∏.

## Middleware (–ü—Ä–æ–º—ñ–∂–Ω–µ –ü–ó)

–£ Redux —î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–µ –º—ñ—Å—Ü–µ –¥–ª—è –ø–æ–±—ñ—á–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤ ‚Äî **Middleware**. –¶–µ –ø—Ä–æ—à–∞—Ä–æ–∫ –º—ñ–∂ –º–æ–º–µ–Ω—Ç–æ–º, –∫–æ–ª–∏ –≤–∏ —Å–∫–∞–∑–∞–ª–∏ `dispatch(action)`, —ñ –º–æ–º–µ–Ω—Ç–æ–º, –∫–æ–ª–∏ action –¥—ñ–π—à–æ–≤ –¥–æ —Ä–µ–¥—é—Å–µ—Ä–∞.

```
UI -> dispatch -> [ Middleware ] -> Reducer -> Store
```

–ù–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π middleware –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—ñ ‚Äî **Redux Thunk**.

## Redux Thunk

–Ü–¥–µ—è –≥–µ–Ω—ñ–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞:
–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º Redux –≤–º—ñ—î –¥—ñ—Å–ø–∞—Ç—á–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –æ–±'—î–∫—Ç–∏ (`{ type: '...' }`).
Redux Thunk "–≤—á–∏—Ç—å" Redux –¥—ñ—Å–ø–∞—Ç—á–∏—Ç–∏ **—Ñ—É–Ω–∫—Ü—ñ—ó**.

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
npm install redux-thunk
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Store

```javascript [store.js]
import { createStore, applyMiddleware } from 'redux';
import thunk from 'redux-thunk'; // –Ü–º–ø–æ—Ä—Ç—É—î–º–æ middleware
import rootReducer from './reducers';

// –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –π–æ–≥–æ –¥–æ store
const store = createStore(
  rootReducer,
  applyMiddleware(thunk)
);

export default store;
```

### –ù–∞–ø–∏—Å–∞–Ω–Ω—è Thunk Action

–¢–µ–ø–µ—Ä –º–∏ –º–æ–∂–µ–º–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ action creator, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–µ –æ–±'—î–∫—Ç, –∞ —Ñ—É–Ω–∫—Ü—ñ—é. –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –æ—Ç—Ä–∏–º–∞—î `dispatch` —è–∫ –∞—Ä–≥—É–º–µ–Ω—Ç.

```javascript [actions/todoActions.js]
// –ó–≤–∏—á–∞–π–Ω—ñ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –µ–∫—à–µ–Ω–∏
const fetchStarted = () => ({ type: 'todos/fetchStarted' });
const fetchSuccess = (todos) => ({ type: 'todos/fetchSuccess', payload: todos });
const fetchError = (error) => ({ type: 'todos/fetchError', payload: error });

// Thunk Action (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π)
export const fetchTodos = () => {
  // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é!
  return async (dispatch, getState) => {
    // 1. –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ, —â–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—á–∞–ª–æ—Å—è (Spinner –∫—Ä—É—Ç–∏—Ç—å—Å—è)
    dispatch(fetchStarted());

    try {
      // 2. –†–æ–±–∏–º–æ –∑–∞–ø–∏—Ç
      const response = await fetch('https://jsonplaceholder.typicode.com/todos');
      const data = await response.json();

      // 3. –£—Å–ø—ñ—Ö! –ö–ª–∞–¥–µ–º–æ –¥–∞–Ω—ñ –≤ —Å—Ç–æ—Ä
      dispatch(fetchSuccess(data));
    } catch (err) {
      // 4. –ü–æ–º–∏–ª–∫–∞!
      dispatch(fetchError(err.message));
    }
  };
};
```

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ

–î–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è. –í—ñ–Ω —Ç–∞–∫ —Å–∞–º–æ –≤–∏–∫–ª–∏–∫–∞—î `dispatch`.

```jsx
import { useEffect } from 'react';
import { useDispatch } from 'react-redux';
import { fetchTodos } from './actions/todoActions';

const TodoList = () => {
  const dispatch = useDispatch();

  useEffect(() => {
    // –í–∏–∫–ª–∏–∫–∞—î–º–æ —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π action
    dispatch(fetchTodos());
  }, [dispatch]);

  return <div>...</div>;
};
```

## –ü—ñ–¥—Å—É–º–æ–∫ –∫–ª–∞—Å–∏—á–Ω–æ–≥–æ Redux

–ú–∏ –ø—Ä–æ–π—à–ª–∏ –¥–æ–≤–≥–∏–π —à–ª—è—Ö. –©–æ–± –∑—Ä–æ–±–∏—Ç–∏ –æ–¥–Ω—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é, –Ω–∞–º –¥–æ–≤–µ–ª–æ—Å—è:
1.  –°—Ç–≤–æ—Ä–∏—Ç–∏ 3 –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ (`REQ`, `SUCCESS`, `FAIL`).
2.  –°—Ç–≤–æ—Ä–∏—Ç–∏ 3 action creators.
3.  –ù–∞–ø–∏—Å–∞—Ç–∏ thunk —Ñ—É–Ω–∫—Ü—ñ—é.
4.  –û–±—Ä–æ–±–∏—Ç–∏ 3 –∫–µ–π—Å–∏ –≤ `switch` —Ä–µ–¥—é—Å–µ—Ä–∞.

–¶–µ **–¥—É–∂–µ –±–∞–≥–∞—Ç–æ –∫–æ–¥—É** (Boilerplate). –°–∞–º–µ —Ü–µ –¥—Ä–∞—Ç—É–≤–∞–ª–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ —Ä–æ–∫–∞–º–∏. –Ü —Å–∞–º–µ —Ç–æ–º—É –∑'—è–≤–∏–≤—Å—è **Redux Toolkit**.

–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –º–∏ –ø–æ–±–∞—á–∏–º–æ, —è–∫ Redux Toolkit —Å–∫–æ—Ä–æ—á—É—î —Ü–µ–π –∫–æ–¥ –≤ 4 —Ä–∞–∑–∏.

üëâ [–î–∞–ª—ñ: –ß–æ–º—É –º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ Redux Toolkit?](../03.transition-to-rtk/01.problems-with-classic.md)
