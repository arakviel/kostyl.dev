# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Store –∑ configureStore

Redux Toolkit –∑–º—ñ–Ω—é—î –ø—ñ–¥—Ö—ñ–¥ –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è store, –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É—é—á–∏ –Ω–∞–π–∫—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ç–∞ —É—Å—É–≤–∞—é—á–∏ –±–∞–≥–∞—Ç–æ boilerplate –∫–æ–¥—É. –î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–±–µ—Ä–µ–º–æ—Å—è, —è–∫ —Ü–µ –ø—Ä–∞—Ü—é—î —ñ —á–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ.

## –ü—Ä–æ–±–ª–µ–º–∞ –∫–ª–∞—Å–∏—á–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É

–î–æ –ø–æ—è–≤–∏ Redux Toolkit –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è store –≤–∏–º–∞–≥–∞–ª–æ –∑–Ω–∞—á–Ω–∏—Ö –∑—É—Å–∏–ª—å:

```javascript
// –ö–ª–∞—Å–∏—á–Ω–∏–π Redux - –±–∞–≥–∞—Ç–æ —Ä—É—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏
import { createStore, applyMiddleware, compose } from 'redux'
import thunk from 'redux-thunk'
import rootReducer from './reducers'

const composeEnhancers = (typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) || compose

const store = createStore(rootReducer, composeEnhancers(applyMiddleware(thunk)))
```

### –©–æ –Ω–µ —Ç–∞–∫ –∑ —Ü–∏–º –∫–æ–¥–æ–º?

::card-group
::card{title="‚ùå –ë–∞–≥–∞—Ç–æ boilerplate" icon="i-lucide-code"}

- –Ü–º–ø–æ—Ä—Ç –¥–µ–∫—ñ–ª—å–∫–æ—Ö —Ñ—É–Ω–∫—Ü—ñ–π
- –†—É—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è DevTools
- –†—É—á–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è middleware

::

::card{title="‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∑–∞—Ö–∏—Å—Ç—É" icon="i-lucide-shield-alert"}

- –ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –Ω–∞ –º—É—Ç–∞—Ü—ñ—é state
- –ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –Ω–∞ non-serializable –¥–∞–Ω—ñ
- –õ–µ–≥–∫–æ –¥–æ–ø—É—Å—Ç–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É

::

::card{title="‚ùå –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –¥–ª—è –Ω–æ–≤–∞—á–∫—ñ–≤" icon="i-lucide-user-x"}

- –ù–µ–∑—Ä–æ–∑—É–º—ñ–ª–æ, —â–æ —Ç–∞–∫–µ `compose` —Ç–∞ `enhancers`
- –ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏ –ø—Ä–æ DevTools extension API
- –ë–∞—Ä'—î—Ä –≤—Ö–æ–¥—É –∑–∞–Ω–∞–¥—Ç–æ –≤–∏—Å–æ–∫–∏–π

::
::

## –†—ñ—à–µ–Ω–Ω—è: configureStore

Redux Toolkit –Ω–∞–¥–∞—î —Ñ—É–Ω–∫—Ü—ñ—é `configureStore`, —è–∫–∞ —ñ–Ω–∫–∞–ø—Å—É–ª—é—î –≤—Å—ñ –Ω–∞–π–∫—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏:

```javascript
import { configureStore } from '@reduxjs/toolkit'

const store = configureStore({
    reducer: {
        // –í–∞—à—ñ reducers
    },
})
```

–û–¥–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–∞–º—ñ–Ω—é—î –≤–µ—Å—å boilerplate —ñ –¥–æ–¥–∞—î captures –ø–æ—Ç—É–∂–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

---

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

::steps

### –ö—Ä–æ–∫ 1: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤

Redux Toolkit –≤–∂–µ –≤–∫–ª—é—á–∞—î –≤ —Å–µ–±–µ Redux core, —Ç–æ–º—É –æ–∫—Ä–µ–º–æ `redux` –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

::code-group

```bash [npm]
npm install @reduxjs/toolkit react-redux
```

```bash [yarn]
yarn add @reduxjs/toolkit react-redux
```

```bash [pnpm]
pnpm add @reduxjs/toolkit react-redux
```

::

::note
**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –ü–∞–∫–µ—Ç `react-redux` –ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –∑–≤'—è–∑–∫–∏ Redux store –∑ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ hooks —Ç–∞ Provider.
::

### –ö—Ä–æ–∫ 2: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è store —Ñ–∞–π–ª—É

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `src/store.js` (–∞–±–æ `src/app/store.js` –¥–ª—è –±—ñ–ª—å—à–∏—Ö –ø—Ä–æ—î–∫—Ç—ñ–≤).

::

---

## –ü–æ–≤–Ω–∏–π API configureStore

–§—É–Ω–∫—Ü—ñ—è `configureStore` –ø—Ä–∏–π–º–∞—î –æ–±'—î–∫—Ç –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä         | –¢–∏–ø             | –û–±–æ–≤'—è–∑–∫–æ–≤–∏–π | –û–ø–∏—Å                                               |
| ---------------- | --------------- | ------------ | -------------------------------------------------- |
| `reducer`        | Object/Function | ‚úÖ           | Root reducer –∞–±–æ –æ–±'—î–∫—Ç –∑ slice reducers           |
| `middleware`     | Function        | ‚ùå           | –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è middleware                |
| `devTools`       | Boolean/Object  | ‚ùå           | –£–≤—ñ–º–∫–Ω—É—Ç–∏ DevTools (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `true` —É dev) |
| `preloadedState` | Object          | ‚ùå           | –ü–æ—á–∞—Ç–∫–æ–≤–∏–π state (–¥–ª—è SSR, hydration)              |
| `enhancers`      | Array/Function  | ‚ùå           | –î–æ–¥–∞—Ç–∫–æ–≤—ñ store enhancers                          |

::tip
**–ü–æ—Ä–∞–¥–∞**: –£ 90% –≤–∏–ø–∞–¥–∫—ñ–≤ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –ª–∏—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `reducer`. –†–µ—à—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –¥–ª—è advanced use cases.
::

---

## –ë–∞–∑–æ–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ü—Ä–æ—Å—Ç–∏–π –ø—Ä–∏–∫–ª–∞–¥

```javascript [src/store.js]
import { configureStore } from '@reduxjs/toolkit'
import counterReducer from './features/counter/counterSlice'
import userReducer from './features/user/userSlice'

export const store = configureStore({
    reducer: {
        counter: counterReducer,
        user: userReducer,
    },
})
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ state

–ó —Ç–∞–∫–æ—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é –≤–∞—à –≥–ª–æ–±–∞–ª—å–Ω–∏–π state –º–∞—Ç–∏–º–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```javascript
{
  counter: { /* state –∑ counterSlice */ },
  user: { /* state –∑ userSlice */ }
}
```

::note
–ö–ª—é—á—ñ –≤ –æ–±'—î–∫—Ç—ñ `reducer` —Å—Ç–∞—é—Ç—å –∫–ª—é—á–∞–º–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É state. –í–∏–±–∏—Ä–∞–π—Ç–µ —ó—Ö –æ–±–¥—É–º–∞–Ω–æ!
::

---

## Middleware Pipeline

### –©–æ —Ç–∞–∫–µ Middleware?

Middleware (–ø—Ä–æ–º—ñ–∂–Ω–µ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è) ‚Äî —Ü–µ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –ø–µ—Ä–µ—Ö–æ–ø–ª—é—é—Ç—å –∫–æ–∂–µ–Ω dispatched action –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ –≤—ñ–Ω –¥–æ—Å—è–≥–Ω–µ reducer.

::mermaid

```mermaid
graph LR
    A[Component] -->|dispatch action| B[Middleware 1]
    B --> C[Middleware 2]
    C --> D[Middleware 3]
    D --> E[Reducers]
    E --> F[New State]
    F -->|re-render| A

    style A fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style B fill:#f59e0b,stroke:#b45309,color:#ffffff
    style C fill:#f59e0b,stroke:#b45309,color:#ffffff
    style D fill:#f59e0b,stroke:#b45309,color:#ffffff
    style E fill:#10b981,stroke:#059669,color:#ffffff
    style F fill:#64748b,stroke:#334155,color:#ffffff
```

::

### Middleware –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

`configureStore` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î –Ω–∞—Å—Ç—É–ø–Ω—ñ middleware:

1. **Redux Thunk** ‚Äî –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö actions
2. **Immutability Check** (dev only) ‚Äî –≤–∏—è–≤–ª—è—î –º—É—Ç–∞—Ü—ñ—ó state
3. **Serializability Check** (dev only) ‚Äî –≤–∏—è–≤–ª—è—î non-serializable –∑–Ω–∞—á–µ–Ω–Ω—è

::warning
**–í–∞–∂–ª–∏–≤–æ**: Immutability —Ç–∞ Serializability –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–º–∏–∫–∞—é—Ç—å—Å—è** –≤ production (`NODE_ENV === 'production'`) –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è performance.
::

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ middleware

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ callback `getDefaultMiddleware()`:

```javascript [src/store.js]
import { configureStore } from '@reduxjs/toolkit'
import logger from 'redux-logger'
import counterReducer from './features/counter/counterSlice'

export const store = configureStore({
    reducer: {
        counter: counterReducer,
    },
    middleware: (getDefaultMiddleware) => getDefaultMiddleware().concat(logger),
})
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö middleware

–ú–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫—É –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö middleware:

```javascript
middleware: (getDefaultMiddleware) =>
  getDefaultMiddleware({
    // –í–∏–º–∫–Ω—É—Ç–∏ immutability check –¥–ª—è specific —à–ª—è—Ö—ñ–≤
    immutableCheck: {
      ignoredPaths: ['items.data'],
    },
    // –í–∏–º–∫–Ω—É—Ç–∏ serializability check –¥–ª—è –ø–µ–≤–Ω–∏—Ö actions
    serializableCheck: {
      ignoredActions: ['your/action/type'],
      ignoredPaths: ['items.date'],
    },
    // –ü–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–º–∫–Ω—É—Ç–∏ thunk (—è–∫—â–æ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ)
    thunk: false,
  }),
```

::tip
**Use case**: –í–∏–º–∏–∫–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Å–ø–∏—Å–∫—ñ–≤ (10000+ items), —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ lag –ø—Ä–∏ —Ä–æ–∑—Ä–æ–±—Ü—ñ.
::

### –ö–∞—Å—Ç–æ–º–Ω–∏–π logger middleware

–ü—Ä–∏–∫–ª–∞–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ–≥–æ logger middleware:

```javascript
const loggerMiddleware = (store) => (next) => (action) => {
    console.group(action.type)
    console.log('Dispatching:', action)
    console.log('Previous State:', store.getState())

    const result = next(action)

    console.log('Next State:', store.getState())
    console.groupEnd()

    return result
}

export const store = configureStore({
    reducer: {
        counter: counterReducer,
    },
    middleware: (getDefaultMiddleware) => getDefaultMiddleware().concat(loggerMiddleware),
})
```

---

## DevTools —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

Redux DevTools –ø—Ä–∞—Ü—é—é—Ç—å "–∑ –∫–æ—Ä–æ–±–∫–∏" –±–µ–∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å:

```javascript
// DevTools –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω—ñ!
export const store = configureStore({
    reducer: {
        counter: counterReducer,
    },
})
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è DevTools

–î–ª—è advanced —Ñ—É–Ω–∫—Ü—ñ–π –ø–µ—Ä–µ–¥–∞–π—Ç–µ –æ–±'—î–∫—Ç –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:

```javascript
export const store = configureStore({
    reducer: {
        counter: counterReducer,
    },
    devTools: {
        // –ö—ñ–ª—å–∫—ñ—Å—Ç—å actions –≤ —ñ—Å—Ç–æ—Ä—ñ—ó
        maxAge: 50,

        // Trace –¥–ª—è actions (–ø–æ–∫–∞–∑—É—î stack trace)
        trace: true,

        // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø–µ–≤–Ω—ñ –µ–∫—à–µ–Ω–∏
        actionsBlacklist: ['SOME_NOISY_ACTION'],

        // Sanitize state (–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ)
        stateSanitizer: (state) => ({
            ...state,
            user: state.user ? { ...state.user, password: '***HIDDEN***' } : null,
        }),
    },
})
```

### –í–∏–º–∫–Ω–µ–Ω–Ω—è DevTools —É production

::tabs
::tabs-item{label="–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)"}

```javascript
// DevTools –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–º–∫–Ω–µ–Ω—ñ –≤ production
export const store = configureStore({
    reducer: {
        counter: counterReducer,
    },
    // devTools: true ‚Äî –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É dev, false —É prod
})
```

::

::tabs-item{label="–í—Ä—É—á–Ω—É"}

```javascript
export const store = configureStore({
    reducer: {
        counter: counterReducer,
    },
    devTools: process.env.NODE_ENV !== 'production',
})
```

::
::

---

## –û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö Reducers

### Feature-based —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

```
src/
‚îú‚îÄ‚îÄ store.js
‚îú‚îÄ‚îÄ features/
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authSlice.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthForm.jsx
‚îÇ   ‚îú‚îÄ‚îÄ todos/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ todosSlice.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TodoList.jsx
‚îÇ   ‚îî‚îÄ‚îÄ posts/
‚îÇ       ‚îú‚îÄ‚îÄ postsSlice.js
‚îÇ       ‚îî‚îÄ‚îÄ PostsList.jsx
```

```javascript [src/store.js]
import { configureStore } from '@reduxjs/toolkit'
import authReducer from './features/auth/authSlice'
import todosReducer from './features/todos/todosSlice'
import postsReducer from './features/posts/postsSlice'

export const store = configureStore({
    reducer: {
        auth: authReducer,
        todos: todosReducer,
        posts: postsReducer,
    },
})
```

::tip
**–ü–µ—Ä–µ–≤–∞–≥–∏**: –ö–æ–∂–Ω–∞ feature —î —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–º –º–æ–¥—É–ª–µ–º. –õ–µ–≥–∫–æ –≤–∏–¥–∞–ª–∏—Ç–∏, –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∞–±–æ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ.
::

### Code Splitting –¥–ª—è Reducers

–î–ª—è –≤–µ–ª–∏–∫–∏—Ö –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤ –º–æ–∂–Ω–∞ lazy load slices:

```javascript [src/store.js]
import { configureStore } from '@reduxjs/toolkit'
import authReducer from './features/auth/authSlice'

export const store = configureStore({
    reducer: {
        auth: authReducer,
        // –Ü–Ω—à—ñ reducers –¥–æ–¥–∞–¥—É—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ
    },
})

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è reducers –¥–∏–Ω–∞–º—ñ—á–Ω–æ
export function injectReducer(key, reducer) {
    store.replaceReducer({
        ...store.getState(),
        [key]: reducer,
    })
}
```

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:

```javascript
// –£ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ, —è–∫–∏–π lazy loads
import { lazy, Suspense } from 'react'
import { injectReducer } from './store'

const AdminPanel = lazy(async () => {
    const module = await import('./features/admin/adminSlice')
    injectReducer('admin', module.default)
    return import('./features/admin/AdminPanel')
})
```

---

## Preloaded State (SSR —Ç–∞ Hydration)

–î–ª—è Server-Side Rendering –ø–µ—Ä–µ–¥–∞–π—Ç–µ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π state:

```javascript [server.js]
import { configureStore } from '@reduxjs/toolkit'
import rootReducer from './rootReducer'

// –ù–∞ —Å–µ—Ä–≤–µ—Ä—ñ –æ—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ
const preloadedState = {
    user: await fetchUser(),
    posts: await fetchPost(),
}

const store = configureStore({
    reducer: rootReducer,
    preloadedState, // –Ü–Ω'—î–∫—Ü—ñ—è –¥–∞–Ω–∏—Ö –∑ —Å–µ—Ä–≤–µ—Ä–∞
})

// –°–µ—Ä—ñ–∞–ª—ñ–∑—É—î–º–æ –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞
const html = `
  <script>
    window.__PRELOADED_STATE__ = ${JSON.stringify(preloadedState)}
  </script>
`
```

–ù–∞ –∫–ª—ñ—î–Ω—Ç—ñ:

```javascript [client.js]
const preloadedState = window.__PRELOADED_STATE__
delete window.__PRELOADED_STATE__

const store = configureStore({
    reducer: rootReducer,
    preloadedState,
})
```

---

## TypeScript –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è

### –¢–∏–ø—ñ–∑–∞—Ü—ñ—è RootState —Ç–∞ Dispatch

```typescript [src/store.ts]
import { configureStore } from '@reduxjs/toolkit'
import counterReducer from './features/counter/counterSlice'

export const store = configureStore({
    reducer: {
        counter: counterReducer,
    },
})

// –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ —Ç–∏–ø–∏ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –¥–æ–¥–∞—Ç–∫—É
export type RootState = ReturnType<typeof store.getState>
export type AppDispatch = typeof store.dispatch
```

### Typed Hooks

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω—ñ –≤–µ—Ä—Å—ñ—ó —Ö—É–∫—ñ–≤:

```typescript [src/hooks/redux.ts]
import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'
import type { RootState, AppDispatch } from '../store'

// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü—ñ —Ö—É–∫–∏ –∑–∞–º—ñ—Å—Ç—å –∑–≤–∏—á–∞–π–Ω–∏—Ö useDispatch —Ç–∞ useSelector
export const useAppDispatch = () => useDispatch<AppDispatch>()
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector
```

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö:

```typescript
import { useAppSelector, useAppDispatch } from '../hooks/redux'

function Counter() {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π type inference!
    const count = useAppSelector((state) => state.counter.value)
    const dispatch = useAppDispatch()

    // ...
}
```

::tip
**Best Practice**: –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω—ñ —Ö—É–∫–∏ –¥–ª—è –∞–≤—Ç–æ–∫–æ–º–ø–ª—ñ—Ç—É —Ç–∞ type safety.
::

---

## Production –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

### –í–∏–º–∫–Ω–µ–Ω–Ω—è Development –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫

–£ production build RTK –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–º–∏–∫–∞—î:

- Immutability check middleware
- Serializability check middleware
- Redux DevTools

–¶–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `process.env.NODE_ENV`:

```javascript
// Webpack/Vite –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–º—ñ–Ω—è—Ç—å process.env.NODE_ENV –Ω–∞ 'production'
// —ñ dead code elimination –≤–∏–¥–∞–ª–∏—Ç—å development –∫–æ–¥
```

### –†—É—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è production

```javascript
export const store = configureStore({
    reducer: {
        counter: counterReducer,
    },
    middleware: (getDefaultMiddleware) =>
        getDefaultMiddleware({
            // –£ production –≤–∏–º–∏–∫–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
            immutableCheck: process.env.NODE_ENV !== 'production',
            serializableCheck: process.env.NODE_ENV !== 'production',
        }),
    devTools: process.env.NODE_ENV !== 'production',
})
```

::warning
**–£–≤–∞–≥–∞**: –ù–µ –≤–∏–º–∏–∫–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —É development! –í–æ–Ω–∏ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –≤–∏—è–≤–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏ –Ω–∞ —Ä–∞–Ω–Ω—ñ—Ö –µ—Ç–∞–ø–∞—Ö.
::

---

## –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ React

–û–±–µ—Ä–Ω—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫ —É `<Provider>`:

```jsx [src/index.jsx]
import React from 'react'
import ReactDOM from 'react-dom/client'
import { Provider } from 'react-redux'
import { store } from './store'
import App from './App'

const root = ReactDOM.createRoot(document.getElementById('root'))

root.render(
    <React.StrictMode>
        <Provider store={store}>
            <App />
        </Provider>
    </React.StrictMode>,
)
```

::note
`<Provider>` —Ä–æ–±–∏—Ç—å store –¥–æ—Å—Ç—É–ø–Ω–∏–º –¥–ª—è –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ React Context.
::

---

## –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: createStore vs configureStore

| –ê—Å–ø–µ–∫—Ç                     | createStore (–∫–ª–∞—Å–∏—á–Ω–∏–π)   | configureStore (RTK) |
| -------------------------- | ------------------------- | -------------------- |
| **Boilerplate**            | –í–∏—Å–æ–∫–∏–π (10-15 —Ä—è–¥–∫—ñ–≤)    | –ù–∏–∑—å–∫–∏–π (3-5 —Ä—è–¥–∫—ñ–≤) |
| **DevTools**               | –†—É—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è        | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ          |
| **Thunk middleware**       | –†—É—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è           | Included             |
| **Immutability check**     | –ù–µ–º–∞—î                     | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (dev)    |
| **Serializability check**  | –ù–µ–º–∞—î                     | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (dev)    |
| **TypeScript support**     | –ü–æ—Ç—Ä–µ–±—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ –∫–æ–¥—É | –í—ñ–¥–º—ñ–Ω–Ω–∏–π –∑ –∫–æ—Ä–æ–±–∫–∏  |
| **Production –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó** | –†—É—á–Ω—ñ                     | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ          |
| **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**           | ‚ùå –ó–∞—Å—Ç–∞—Ä—ñ–≤               | ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç          |

---

## Troubleshooting

::accordion
::accordion-item{label="–ü–æ–º–∏–ª–∫–∞: Actions must be plain objects" icon="i-lucide-alert-circle"}

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∏ –Ω–∞–º–∞–≥–∞—î—Ç–µ—Å—è dispatch –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é, –∞–ª–µ thunk middleware –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ.

```javascript
// ‚ùå –ü–æ–º–∏–ª–∫–∞
dispatch(async () => {
    const data = await fetch('/api')
})
```

**–†—ñ—à–µ–Ω–Ω—è**: `configureStore` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∫–ª—é—á–∞—î thunk. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤–∏ –Ω–µ –≤–∏–º–∫–Ω—É–ª–∏ –π–æ–≥–æ:

```javascript
middleware: (getDefaultMiddleware) =>
  getDefaultMiddleware({
    thunk: true, // –ú–∞—î –±—É—Ç–∏ true (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
  }),
```

::

::accordion-item{label="Immutability Error –≤ –∫–æ–Ω—Å–æ–ª—ñ" icon="i-lucide-alert-triangle"}

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∏ –º—É—Ç—É—î—Ç–µ state –ø–æ–∑–∞ createSlice:

```javascript
// ‚ùå –ú—É—Ç–∞—Ü—ñ—è –≤ component—ñ
const handleClick = () => {
    state.counter.value++ // –ó–ê–ë–û–†–û–ù–ï–ù–û!
}
```

**–†—ñ—à–µ–Ω–Ω—è**: –ó–∞–≤–∂–¥–∏ dispatch actions:

```javascript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
const handleClick = () => {
    dispatch(increment())
}
```

::

::accordion-item{label="Serializability Error: Date, Promise, Function" icon="i-lucide-ban"}

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∏ –ø–æ–∫–ª–∞–ª–∏ –≤ state non-serializable –∑–Ω–∞—á–µ–Ω–Ω—è:

```javascript
// ‚ùå –ü—Ä–æ–±–ª–µ–º–Ω–∏–π –∫–æ–¥
const initialState = {
    lastUpdated: new Date(), // Date object
    fetchPromise: fetch('/api'), // Promise
    callback: () => {}, // Function
}
```

**–†—ñ—à–µ–Ω–Ω—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ plain objects, arrays, primitives:

```javascript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
const initialState = {
    lastUpdated: new Date().toISOString(), // String
    isFetching: false, // Boolean
}
```

–ê–±–æ —ñ–≥–Ω–æ—Ä—É–π—Ç–µ –ø–µ–≤–Ω—ñ —à–ª—è—Ö–∏ (—è–∫—â–æ —Ü–µ –¥—ñ–π—Å–Ω–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ):

```javascript
middleware: (getDefaultMiddleware) =>
  getDefaultMiddleware({
    serializableCheck: {
      ignoredPaths: ['form.dateField'],
    },
  }),
```

::

::accordion-item{label="DevTools –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è" icon="i-lucide-bug"}

**–ü—Ä–∏—á–∏–Ω–∏**:

1. –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ([Install Redux DevTools](https://github.com/reduxjs/redux-devtools))
2. –í–∏ –≤—Ä—É—á–Ω—É –≤–∏–º–∫–Ω—É–ª–∏: `devTools: false`
3. Production build (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–º–∫–Ω–µ–Ω–æ)

**–†—ñ—à–µ–Ω–Ω—è**: –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é.
::
::

---

## –í–∏—Å–Ω–æ–≤–æ–∫

`configureStore` ‚Äî —Ü–µ –ø–æ—Ç—É–∂–Ω–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è, —è–∫–∞:

‚úÖ –£—Å—É–≤–∞—î boilerplate –∫–æ–¥  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î best practices  
‚úÖ –ó–∞—Ö–∏—â–∞—î –≤—ñ–¥ —Ç–∏–ø–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫  
‚úÖ –û–ø—Ç–∏–º—ñ–∑—É—î performance —É production  
‚úÖ –Ü–¥–µ–∞–ª—å–Ω–æ –ø—Ä–∞—Ü—é—î –∑ TypeScript

::tip
**–ó–æ–ª–æ—Ç–µ –ø—Ä–∞–≤–∏–ª–æ**: –ù—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `createStore` —É –Ω–æ–≤–∏—Ö –ø—Ä–æ—î–∫—Ç–∞—Ö. `configureStore` ‚Äî —î–¥–∏–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä.
::

---

## –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ store –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ, –¥–∞–≤–∞–π—Ç–µ —Å—Ç–≤–æ—Ä–∏–º–æ –ª–æ–≥—ñ–∫—É (reducers —Ç–∞ actions) –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞–π–ø–æ—Ç—É–∂–Ω—ñ—à–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É RTK.

üëâ [–î–∞–ª—ñ: createSlice —Ç–∞ –º–∞–≥—ñ—è Immer](./02.create-slice.md)
