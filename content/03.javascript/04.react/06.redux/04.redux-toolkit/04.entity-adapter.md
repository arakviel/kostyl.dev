# –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö (createEntityAdapter)

–ö–æ–ª–∏ –≤–∏ –ø—Ä–∞—Ü—é—î—Ç–µ –∑—ñ —Å–ø–∏—Å–∫–∞–º–∏ –¥–∞–Ω–∏—Ö (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, –ø–æ—Å—Ç–∏, —Ç–æ–≤–∞—Ä–∏), –≤–∏ —á–∞—Å—Ç–æ —Å—Ç–∏–∫–∞—î—Ç–µ—Å—è –∑ –æ–¥–Ω–∏–º–∏ –π —Ç–∏–º–∏ –∂ –ø—Ä–æ–±–ª–µ–º–∞–º–∏:
-   –Ø–∫ –∑–Ω–∞–π—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç –∑–∞ ID –±–µ–∑ `find()` (—è–∫–∏–π –ø–æ–≤—ñ–ª—å–Ω–∏–π)?
-   –Ø–∫ —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤?
-   –Ø–∫ –æ–Ω–æ–≤–∏—Ç–∏ –æ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç –º–∞—Å–∏–≤—É –±–µ–∑ `map()`?

–†—ñ—à–µ–Ω–Ω—è ‚Äî **–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è**. –¶–µ –∫–æ–ª–∏ –º–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –Ω–µ –º–∞—Å–∏–≤–æ–º, –∞ –æ–±'—î–∫—Ç–æ–º (—Å–ª–æ–≤–Ω–∏–∫–æ–º), –¥–µ –∫–ª—é—á—ñ ‚Äî —Ü–µ ID.

Redux Toolkit –Ω–∞–¥–∞—î —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `createEntityAdapter`, —è–∫–∏–π —Ä–æ–±–∏—Ç—å —Ü–µ –∑–∞ –Ω–∞—Å.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞–Ω—É

–ó–∞–∑–≤–∏—á–∞–π –º–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ —Ç–∞–∫:
```javascript
{
  users: [
    { id: 1, name: 'A' },
    { id: 2, name: 'B' }
  ]
}
```

–ó `createEntityAdapter` —Å—Ç–∞–Ω –±—É–¥–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —Ç–∞–∫:
```javascript
{
  ids: [1, 2],           // –ú–∞—Å–∏–≤ ID –¥–ª—è –ø–æ—Ä—è–¥–∫—É —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  entities: {            // –°–ª–æ–≤–Ω–∏–∫ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É O(1)
    1: { id: 1, name: 'A' },
    2: { id: 2, name: 'B' }
  }
}
```

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–¥–∞–ø—Ç–µ—Ä–∞

```javascript [features/posts/postsSlice.js]
import { createSlice, createEntityAdapter } from '@reduxjs/toolkit';

// 1. –°—Ç–≤–æ—Ä—é—î–º–æ –∞–¥–∞–ø—Ç–µ—Ä
const postsAdapter = createEntityAdapter({
  // –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: —Ñ—É–Ω–∫—Ü—ñ—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  sortComparer: (a, b) => b.date.localeCompare(a.date),
});

// 2. –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω { ids: [], entities: {} }
const initialState = postsAdapter.getInitialState({
  // –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–ª—è
  loading: 'idle'
});

const postsSlice = createSlice({
  name: 'posts',
  initialState,
  reducers: {
    // 3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≥–æ—Ç–æ–≤—ñ –º–µ—Ç–æ–¥–∏ CRUD
    addPost: postsAdapter.addOne,
    addPosts: postsAdapter.addMany,
    updatePost: postsAdapter.updateOne,
    removePost: postsAdapter.removeOne,
    setPosts: postsAdapter.setAll,
    clearPosts: postsAdapter.removeAll,
  },
});

export const { addPost, updatePost, removePost } = postsSlice.actions;
export default postsSlice.reducer;
```

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤

–ê–¥–∞–ø—Ç–µ—Ä –Ω–∞–¥–∞—î –±–∞–≥–∞—Ç–æ –º–µ—Ç–æ–¥—ñ–≤, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å —è–∫ —Ä–µ–¥—é—Å–µ—Ä–∏ (–∞–±–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä–µ–¥—é—Å–µ—Ä—ñ–≤):

-   `addOne`: –î–æ–¥–∞—î –æ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç. –Ø–∫—â–æ ID –≤–∂–µ —ñ—Å–Ω—É—î ‚Äî —ñ–≥–Ω–æ—Ä—É—î.
-   `upsertOne`: –î–æ–¥–∞—î –∞–±–æ –æ–Ω–æ–≤–ª—é—î (—è–∫—â–æ —ñ—Å–Ω—É—î).
-   `addMany`: –î–æ–¥–∞—î –º–∞—Å–∏–≤ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.
-   `setAll`: –ó–∞–º—ñ–Ω—é—î –í–°–Ü –¥–∞–Ω—ñ –Ω–æ–≤–∏–º –º–∞—Å–∏–≤–æ–º.
-   `removeOne`: –í–∏–¥–∞–ª—è—î –∑–∞ ID.
-   `updateOne`: –û–Ω–æ–≤–ª—é—î –ø–æ–ª—è –µ–ª–µ–º–µ–Ω—Ç–∞. –ü—Ä–∏–π–º–∞—î `{ id: 1, changes: { name: 'New' } }`.

–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `extraReducers`:

```javascript
extraReducers: (builder) => {
  builder.addCase(fetchPosts.fulfilled, (state, action) => {
    // action.payload - —Ü–µ –º–∞—Å–∏–≤ –ø–æ—Å—Ç—ñ–≤ –∑ —Å–µ—Ä–≤–µ—Ä–∞
    postsAdapter.setAll(state, action.payload);
    state.loading = 'succeeded';
  });
}
```

## –°–µ–ª–µ–∫—Ç–æ—Ä–∏

–ù–∞–π–ø—Ä–∏—î–º–Ω—ñ—à–µ ‚Äî –∞–¥–∞–ø—Ç–µ—Ä –≥–µ–Ω–µ—Ä—É—î —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –∑–∞ –≤–∞—Å!

```javascript
// postsSlice.js
// getSelectors –ø—Ä–∏–π–º–∞—î —Ñ—É–Ω–∫—Ü—ñ—é, —è–∫ –∑–Ω–∞–π—Ç–∏ —Ü–µ–π —Å–ª–∞–π—Å –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É —Å—Ç–µ–π—Ç—ñ
export const {
  selectAll: selectAllPosts,
  selectById: selectPostById,
  selectIds: selectPostIds
} = postsAdapter.getSelectors(state => state.posts);
```

–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ:

```jsx
import { useSelector } from 'react-redux';
import { selectAllPosts, selectPostById } from './postsSlice';

function PostsList() {
  // –ü–æ–≤–µ—Ä–Ω–µ –º–∞—Å–∏–≤ –æ–±'—î–∫—Ç—ñ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–µ–Ω–æ—Ä–º–∞–ª—ñ–∑—É—î)
  const posts = useSelector(selectAllPosts); 
  
  return (
    <ul>
      {posts.map(post => <PostItem key={post.id} post={post} />)}
    </ul>
  );
}

function PostPage({ postId }) {
  // –ü–æ—à—É–∫ –∑–∞ O(1)
  const post = useSelector(state => selectPostById(state, postId));
  
  // ...
}
```

–¶–µ –∑–Ω–∞—á–Ω–æ —Å–ø—Ä–æ—â—É—î —Ä–æ–±–æ—Ç—É –∑ CRUD –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏ —ñ —Ä–æ–±–∏—Ç—å –∫–æ–¥ —á–∏—Å—Ç—ñ—à–∏–º.

---

–ú–∏ —Ä–æ–∑—ñ–±—Ä–∞–ª–∏ –æ—Å–Ω–æ–≤–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ RTK. –¢–µ–ø–µ—Ä –¥–∞–≤–∞–π—Ç–µ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ –ø—Ä–æ—Å—É–Ω—É—Ç—ñ —Ç–µ—Ö–Ω—ñ–∫–∏: —è–∫ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–±—ñ—Ä–∫–∏ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `reselect`.

üëâ [–î–∞–ª—ñ: –°–µ–ª–µ–∫—Ç–æ—Ä–∏ —Ç–∞ –ú–µ–º–æ—ñ–∑–∞—Ü—ñ—è](../05.advanced/01.selectors-reselect.md)
