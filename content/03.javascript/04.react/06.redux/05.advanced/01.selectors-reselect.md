# –ú–µ–º–æ—ñ–∑–∞—Ü—ñ—è —Ç–∞ –°–µ–ª–µ–∫—Ç–æ—Ä–∏: –ü–æ–≤–Ω–∏–π –ì–∞–π–¥ –ø–æ Reselect

–£ —Å–≤—ñ—Ç—ñ Redux —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ —á–∞—Å—Ç–æ –Ω–µ–¥–æ–æ—Ü—ñ–Ω—é—é—Ç—å. –ë–∞–≥–∞—Ç–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ —Å–ø—Ä–∏–π–º–∞—é—Ç—å —ó—Ö –ø—Ä–æ—Å—Ç–æ —è–∫ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —à–º–∞—Ç–æ—á–∫–∞ –¥–∞–Ω–∏—Ö –∑—ñ —Å—Ç–µ–π—Ç—É. –ê–ª–µ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ, —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ ‚Äî —Ü–µ –ø–æ—Ç—É–∂–Ω–∏–π —à–∞—Ä –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ **–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**, **—ñ–Ω–∫–∞–º–∏—Å—É–ª—è—Ü—ñ—é** —Ç–∞ **–æ–±—á–∏—Å–ª–µ–Ω–Ω—è –ø–æ—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö**.

–ö–æ–ª–∏ –≤–∞—à –¥–æ–¥–∞—Ç–æ–∫ —Ä–æ–∑—Ä–æ—Å—Ç–∞—î—Ç—å—Å—è (–æ—Å–æ–±–ª–∏–≤–æ —Ü–µ —Å—Ç–æ—Å—É—î—Ç—å—Å—è Enterprise-–ø—Ä–æ—î–∫—Ç—ñ–≤ –∑ —Ç–∏—Å—è—á–∞–º–∏ —Å—É—Ç–Ω–æ—Å—Ç–µ–π), –±–µ–∑–¥—É–º–Ω–∞ –≤–∏–±—ñ—Ä–∫–∞ –¥–∞–Ω–∏—Ö –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ñ—á–Ω–∏—Ö –≤—Ç—Ä–∞—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—è—Ç—å—Å—è –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏, –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä—é—é—Ç—å—Å—è —Ç–∏—Å—è—á—ñ —Ä–∞–∑—ñ–≤ –Ω–∞ —Å–µ–∫—É–Ω–¥—É, –∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—á–∏–Ω–∞—î "–≥–∞–ª—å–º—É–≤–∞—Ç–∏" –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–ª–∞–≤—ñ—à—ñ.

–¶–µ–π –≥–∞–π–¥ –ø–æ–≤–Ω—ñ—Å—Ç—é —Ä–æ–∑–∫—Ä–∏—î —Ç–µ–º—É —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤: –≤—ñ–¥ –±–∞–∑–æ–≤–æ—ó —Ñ—ñ–ª–æ—Å–æ—Ñ—ñ—ó –¥–æ —Å–∫–ª–∞–¥–Ω–∏—Ö –ø–∞—Ç–µ—Ä–Ω—ñ–≤ –º–µ–º–æ—ñ–∑–∞—Ü—ñ—ó –∑ Reselect, —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó –≤ TypeScript —Ç–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏—Ö —Ä—ñ—à–µ–Ω—å.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 1: –§—ñ–ª–æ—Å–æ—Ñ—ñ—è –°–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤

### –©–æ —Ç–∞–∫–µ —Å–µ–ª–µ–∫—Ç–æ—Ä?

–§–æ—Ä–º–∞–ª—å–Ω–æ, **—Å–µ–ª–µ–∫—Ç–æ—Ä** ‚Äî —Ü–µ –±—É–¥—å-—è–∫–∞ —á–∏—Å—Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –ø—Ä–∏–π–º–∞—î –≤–µ—Å—å —Å—Ç–µ–π—Ç Redux (–∞–±–æ –π–æ–≥–æ —á–∞—Å—Ç–∏–Ω—É) —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è.

```javascript
// –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
const selectUser = (state) => state.user

// –°–µ–ª–µ–∫—Ç–æ—Ä –∑ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è–º
const selectUserAge = (state) => {
    const birthDate = new Date(state.user.birthDate)
    const today = new Date()
    return today.getFullYear() - birthDate.getFullYear()
}
```

–ê–ª–µ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ, —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ ‚Äî —Ü–µ **Query Layer** (–®–∞—Ä –ó–∞–ø–∏—Ç—ñ–≤) –¥–ª—è –≤–∞—à–æ–≥–æ —Å—Ç–µ–π—Ç—É.

::mermaid
graph TD
UI[React Components] -->|–í–∏–∫–ª–∏–∫–∞—é—Ç—å| SL[Selectors Layer]
SL -->|–ß–∏—Ç–∞—î| RS[Redux State]

    subgraph "Query Logic"
    SL
    end

    style SL fill:#3b82f6,stroke:#1d4ed8,color:#ffffff

::

**–ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ?**

1.  **–Ü–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—è**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –∑–Ω–∞—Ç–∏ –ø—Ä–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç–µ–π—Ç—É. –Ø–∫—â–æ –≤–∏ –∑–º—ñ–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `state.user` –Ω–∞ `state.auth.user`, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –æ–Ω–æ–≤–∏—Ç–∏ –ª–∏—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä, –∞ –Ω–µ 50 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤.
2.  **–ü–æ—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (Derived Data)**: –°—Ç–µ–π—Ç –ø–æ–≤–∏–Ω–µ–Ω –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ _–º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ_ –¥–∞–Ω—ñ. –í—Å–µ —ñ–Ω—à–µ (–≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω—ñ —Å–ø–∏—Å–∫–∏, —Å—É–º–∏, —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω—ñ –¥–∞—Ç–∏) –º–∞—î –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏—Å—è "–Ω–∞ –ª—å–æ—Ç—É" –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞—Ö.
3.  **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**: –ü—Ä–∞–≤–∏–ª—å–Ω—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –∑–∞–ø–æ–±—ñ–≥–∞—é—Ç—å –∑–∞–π–≤–∏–º —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∞–º.

### –ü—Ä–∏–Ω—Ü–∏–ø "Derived Data"

–û–¥–Ω–µ –∑ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏—Ö –ø—Ä–∞–≤–∏–ª Redux: **–∑–±–µ—Ä—ñ–≥–∞–π—Ç–µ –≤ —Å—Ç–µ–π—Ç—ñ –º—ñ–Ω—ñ–º—É–º –¥–∞–Ω–∏—Ö**. –í—Å–µ —ñ–Ω—à–µ –æ–±—á–∏—Å–ª—é–π—Ç–µ.

**–ü—Ä–∏–∫–ª–∞–¥:**
–£ –Ω–∞—Å —î —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ —ñ —Ñ—ñ–ª—å—Ç—Ä.

- ‚ùå **–ü–æ–≥–∞–Ω–æ**: –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤ —Å—Ç–µ–π—Ç—ñ `items` —ñ –æ–∫—Ä–µ–º–æ `filteredItems`.
- ‚úÖ **–î–æ–±—Ä–µ**: –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ `items` —ñ `filter`. `filteredItems` –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º.

–ß–æ–º—É? –¢–æ–º—É —â–æ —è–∫—â–æ –≤–∏ –¥–æ–¥–∞—Å—Ç–µ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä, –≤–∞–º –¥–æ–≤–µ–¥–µ—Ç—å—Å—è –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —ñ `items`, —ñ `filteredItems`. –¶–µ –ø–æ—Ä—É—à–µ–Ω–Ω—è **Single Source of Truth**.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 2: –ü—Ä–æ–±–ª–µ–º–∞ –†–µ—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–Ω–æ—ó –¶—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ (Referential Integrity)

–¶–µ "—Å–µ—Ä—Ü–µ" –ø—Ä–æ–±–ª–µ–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤ React + Redux. –Ø–∫—â–æ –≤–∏ –Ω–µ –∑—Ä–æ–∑—É–º—ñ—î—Ç–µ —Ü–µ–π —Ä–æ–∑–¥—ñ–ª, –≤–∏ –Ω–µ –∑—Ä–æ–∑—É–º—ñ—î—Ç–µ Reselect.

### –Ø–∫ –ø—Ä–∞—Ü—é—î `useSelector`?

–•—É–∫ `useSelector` –ø—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è Redux Store. –©–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –±—É–¥—å-—è–∫–∞ –µ–∫—à–µ–Ω –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —ñ —Å—Ç–µ–π—Ç –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è, `useSelector`:

1.  –ó–∞–ø—É—Å–∫–∞—î –≤–∞—à—É —Ñ—É–Ω–∫—Ü—ñ—é-—Å–µ–ª–µ–∫—Ç–æ—Ä.
2.  –ü–æ—Ä—ñ–≤–Ω—é—î **—Ä–µ–∑—É–ª—å—Ç–∞—Ç** –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.
3.  –Ø–∫—â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç **–∑–º—ñ–Ω–∏–≤—Å—è** (–Ω–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è), –≤—ñ–Ω –∑–º—É—à—É—î –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç–∏—Å—è.
4.  –Ø–∫—â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç **—Ç–æ–π —Å–∞–º–∏–π** (—Ç–µ —Å–∞–º–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è), –Ω—ñ—á–æ–≥–æ –Ω–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è.

–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å—É–≤–æ—Ä—É —Ä—ñ–≤–Ω—ñ—Å—Ç—å (`===`).

### –ü–∞—Å—Ç–∫–∞ –Ω–æ–≤–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à—É –ø–æ–º–∏–ª–∫—É:

```javascript
// ‚ùå –ü–û–ì–ê–ù–û: –ó–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
const selectActiveTodos = (state) => {
    // .filter() –ó–ê–í–ñ–î–ò —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –º–∞—Å–∏–≤, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–º—ñ—Å—Ç –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è!
    return state.todos.filter((todo) => !todo.completed)
}
```

–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º:

1.  –ï–∫—à–µ–Ω: `dispatch({ type: 'UI/THEME_CHANGED' })`.
2.  Redux —Å—Ç–µ–π—Ç –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è (–∑–º—ñ–Ω–∏–ª–∞—Å—è —Ç–µ–º–∞, –∞–ª–µ `todos` —Ç—ñ —Å–∞–º—ñ).
3.  `useSelector` –∑–∞–ø—É—Å–∫–∞—î `selectActiveTodos`.
4.  `state.todos.filter(...)` –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —ñ —Å—Ç–≤–æ—Ä—é—î **–Ω–æ–≤–∏–π –º–∞—Å–∏–≤** `Array(5)`.
5.  –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–≤ `Array(5)`.
6.  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: `newArray === oldArray` -> **false**.
7.  **React Re-render!** üò±

–ú–∏ –∑–º—ñ–Ω–∏–ª–∏ —Ç–µ–º—É, –∞ –≤—Å—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–ø–∏—Å–∫—É –∑–∞–≤–¥–∞–Ω—å –ø–µ—Ä–µ–º–∞–ª—é–≤–∞–ª–∏—Å—è. –¶–µ —ñ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è "wasted renders".

### –ü—Ä–∏–∫–ª–∞–¥–∏ –ø–æ—Ä—É—à–µ–Ω–Ω—è Referenital Integrity

| –û–ø–µ—Ä–∞—Ü—ñ—è          | –ß–æ–º—É —Ü–µ –ø–æ–≥–∞–Ω–æ –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ?                                  |
| :---------------- | :----------------------------------------------------------- |
| `.map(...)`       | –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –º–∞—Å–∏–≤.                                         |
| `.filter(...)`    | –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –º–∞—Å–∏–≤.                                         |
| `[...array]`      | –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –º–∞—Å–∏–≤.                                         |
| `{ ...object }`   | –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç.                                        |
| `obj \|\| {}`     | –Ø–∫—â–æ `obj` falsy, —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç `{}`.                 |
| `Date.parse(...)` | –ß–∏—Å–ª–∞ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω—ñ, —Ü–µ –û–ö. –ê–ª–µ `new Date()` - —Ü–µ –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç. |

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ–±–ª–µ–º–∏

```javascript
const state = {
    items: [1, 2, 3],
}

// –í–∏–∫–ª–∏–∫ 1
const result1 = state.items.map((x) => x * 2)
// result1 = [2, 4, 6]

// –í–∏–∫–ª–∏–∫ 2 (—Å—Ç–µ–π—Ç –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è!)
const result2 = state.items.map((x) => x * 2)
// result2 = [2, 4, 6]

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞
console.log(result1 === result2) // FALSE ‚ùå
```

–î–ª—è React —Ü–µ –æ–∑–Ω–∞—á–∞—î: "–î–∞–Ω—ñ –∑–º—ñ–Ω–∏–ª–∏—Å—è, —Ç—Ä–µ–±–∞ –º–∞–ª—é–≤–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ".

---

## –ß–∞—Å—Ç–∏–Ω–∞ 3: Reselect —Ç–∞ –ú–µ–º–æ—ñ–∑–∞—Ü—ñ—è

**–ú–µ–º–æ—ñ–∑–∞—Ü—ñ—è** ‚Äî —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó, —è–∫–∞ –∫–µ—à—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–∞ –æ—Å–Ω–æ–≤—ñ —ó—ó –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤. –Ø–∫—â–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –Ω–µ –∑–º—ñ–Ω–∏–ª–∏—Å—è, —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î –∑–∞–∫–µ—à–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–µ –≤–∏–∫–æ–Ω—É—é—á–∏ –æ–±—á–∏—Å–ª–µ–Ω—å.

–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ **Reselect** (—è–∫–∞ —Ç–µ–ø–µ—Ä –≤–±—É–¥–æ–≤–∞–Ω–∞ –≤ Redux Toolkit) –Ω–∞–¥–∞—î —Ñ—É–Ω–∫—Ü—ñ—é `createSelector` –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–µ–º–æ—ñ–∑–æ–≤–∞–Ω–∏—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤.

### –ê–Ω–∞—Ç–æ–º—ñ—è `createSelector`

```javascript
import { createSelector } from '@reduxjs/toolkit'

const selectMemoizedData = createSelector(
    // [A] Input Selectors (–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ)
    [inputSelector1, inputSelector2],

    // [B] Result Function (–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ç–æ—Ä)
    (result1, result2) => {
        // [C] –í–∞–∂–∫—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è
        return doExpensiveCalculation(result1, result2)
    },
)
```

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–±–æ—Ç–∏:**

1.  **–í–∏–∫–ª–∏–∫ Input Selectors**: –ö–æ–ª–∏ –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ `selectMemoizedData(state)`, Reselect —Å–ø–æ—á–∞—Ç–∫—É –∑–∞–ø—É—Å–∫–∞—î –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑ –º–∞—Å–∏–≤—É `[A]`.
2.  **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–º—ñ–Ω**: –í—ñ–Ω –ø–æ—Ä—ñ–≤–Ω—é—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ü–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (saved arguments).
3.  **–ö–µ—à-—Ö—ñ—Ç (Cache Hit)**: –Ø–∫—â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ input selectors **—ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ** (`===`) –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º, Reselect **–Ω–µ –∑–∞–ø—É—Å–∫–∞—î** Result Function `[B]` —ñ –æ–¥—Ä–∞–∑—É –ø–æ–≤–µ—Ä—Ç–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
4.  **–ö–µ—à-–º—ñ—Å (Cache Miss)**: –Ø–∫—â–æ —Ö–æ—á–∞ –± –æ–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–º—ñ–Ω–∏–≤—Å—è, Reselect –∑–∞–ø—É—Å–∫–∞—î Result Function `[B]`, –∑–±–µ—Ä—ñ–≥–∞—î –Ω–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –π–æ–≥–æ.

### –í–∏–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞—à –ø—Ä–∏–∫–ª–∞–¥

```javascript
const selectTodos = (state) => state.todos

// ‚úÖ –î–û–ë–†–ï: –ú–µ–º–æ—ñ–∑–æ–≤–∞–Ω–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
const selectActiveTodos = createSelector([selectTodos], (todos) => {
    console.log('–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è...') // –í–∏–∫–æ–Ω–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ todos –∑–º—ñ–Ω—è—Ç—å—Å—è
    return todos.filter((todo) => !todo.completed)
})
```

–¢–µ–ø–µ—Ä, —è–∫—â–æ –º–∏ –∑–º—ñ–Ω–∏–º–æ —Ç–µ–º—É (`UI/THEME_CHANGED`):

1.  `selectTodos` –ø–æ–≤–µ—Ä–Ω–µ —Ç–æ–π —Å–∞–º–∏–π –º–∞—Å–∏–≤ `todos` (–±–æ –≤—ñ–Ω –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è).
2.  `createSelector` –ø–æ–±–∞—á–∏—Ç—å, —â–æ –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è.
3.  –í—ñ–Ω –ø–æ–≤–µ—Ä–Ω–µ **—Ç–æ–π —Å–∞–º–∏–π –º–∞—Å–∏–≤** (–ø–æ—Å–∏–ª–∞–Ω–Ω—è), —â–æ –π –º–∏–Ω—É–ª–æ–≥–æ —Ä–∞–∑—É.
4.  `useSelector` –ø–æ–±–∞—á–∏—Ç—å, —â–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–µ —Å–∞–º–µ -> **Re-render —Å–∫–∞—Å–æ–≤–∞–Ω–æ**. üéâ

---

## –ß–∞—Å—Ç–∏–Ω–∞ 4: –ö–∞—Å–∫–∞–¥–Ω–∞ –ú–µ–º–æ—ñ–∑–∞—Ü—ñ—è (Composition)

–°–ø—Ä–∞–≤–∂–Ω—è —Å–∏–ª–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤ —Ä–æ–∑–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –≤ —ó—Ö –∫–æ–º–ø–æ–Ω—É–≤–∞–Ω–Ω—ñ. –í–∏ –º–æ–∂–µ—Ç–µ –±—É–¥—É–≤–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –Ω–∞ –±–∞–∑—ñ —ñ–Ω—à–∏—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤.

### –ü—ñ—Ä–∞–º—ñ–¥–∞ –¥–∞–Ω–∏—Ö

–£—è–≤—ñ—Ç—å —Å–æ–±—ñ –ø—ñ—Ä–∞–º—ñ–¥—É:

- **–†—ñ–≤–µ–Ω—å 0**: "–°–∏—Ä—ñ" –¥–∞–Ω—ñ (Raw State).
- **–†—ñ–≤–µ–Ω—å 1**: –ü—Ä–æ—Å—Ç—ñ –≤–∏–±–æ—Ä–∫–∏ (Simple Lookups).
- **–†—ñ–≤–µ–Ω—å 2**: –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó (—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è, —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è).
- **–†—ñ–≤–µ–Ω—å 3**: –ê–≥—Ä–µ–≥–∞—Ü—ñ—ó (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∑–≤—ñ—Ç–∏).
- **–†—ñ–≤–µ–Ω—å 4**: View Models (–¥–∞–Ω—ñ, –≥–æ—Ç–æ–≤—ñ –¥–ª—è UI).

```javascript
// --- –†—ñ–≤–µ–Ω—å 0/1: Input Selectors ---
const selectAllTodos = (state) => state.todos.items
const selectFilter = (state) => state.todos.filter
const selectSearchQuery = (state) => state.todos.search

// --- –†—ñ–≤–µ–Ω—å 2: –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è ---
const selectFilteredTodos = createSelector(
    [selectAllTodos, selectFilter, selectSearchQuery],
    (todos, filter, query) => {
        // –í–∞–∂–∫–∞ –ª–æ–≥—ñ–∫–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
        let result = todos

        if (filter === 'completed') {
            result = result.filter((t) => t.completed)
        }

        if (query) {
            result = result.filter((t) => t.title.includes(query))
        }

        return result
    },
)

// --- –†—ñ–≤–µ–Ω—å 3: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ---
const selectTodoStats = createSelector(
    [selectFilteredTodos], // –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≤–∂–µ —Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏—Ö!
    (todos) => {
        return {
            count: todos.length,
            urgent: todos.filter((t) => t.priority === 'high').length,
        }
    },
)

// --- –†—ñ–≤–µ–Ω—å 4: View Model ---
const selectTodoListViewModel = createSelector([selectFilteredTodos, selectTodoStats], (todos, stats) => ({
    items: todos,
    subtitle: `Shown ${stats.count} items (${stats.urgent} urgent)`,
}))
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ?**
–ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–º—ñ–Ω–∏–≤ `searchQuery`.

1.  `selectSearchQuery` -> –ù–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è.
2.  `selectFilteredTodos` -> Input –∑–º—ñ–Ω–∏–≤—Å—è -> –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é -> –ù–æ–≤–∏–π –º–∞—Å–∏–≤ `todos`.
3.  `selectTodoStats` -> Input –∑–º—ñ–Ω–∏–≤—Å—è -> –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.
4.  `selectTodoListViewModel` -> Inputs –∑–º—ñ–Ω–∏–ª–∏—Å—è -> –û–Ω–æ–≤–ª—é—î View Model.
5.  **React UI –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è**.

–ê —Ç–µ–ø–µ—Ä –ø—Ä–∏–ø—É—Å—Ç–∏–º–æ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–º—ñ–Ω–∏–≤ —Å–≤–æ—î —ñ–º'—è –≤ –ø—Ä–æ—Ñ—ñ–ª—ñ (`user.name`).

1.  `selectSearchQuery` -> –¢–µ —Å–∞–º–µ. `selectAllTodos` -> –¢–µ —Å–∞–º–µ. `selectFilter` -> –¢–µ —Å–∞–º–µ.
2.  `selectFilteredTodos` -> Inputs –Ω–µ –∑–º—ñ–Ω–∏–ª–∏—Å—è -> **Cache Hit**. –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ä–∏–π –º–∞—Å–∏–≤.
3.  `selectTodoStats` -> Input (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ) –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è -> **Cache Hit**.
4.  `selectTodoListViewModel` -> Inputs –Ω–µ –∑–º—ñ–Ω–∏–ª–∏—Å—è -> **Cache Hit**.
5.  **React UI –ù–ï –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è**. –ï–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤ –∫–æ–ª–æ—Å–∞–ª—å–Ω–∞!

---

## –ß–∞—Å—Ç–∏–Ω–∞ 5: –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ú–µ–º–æ—ñ–∑–∞—Ü—ñ—ó

Reselect –Ω–∞–¥–∞—î –ø–æ—Ç—É–∂–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ —Å–∞–º–µ –ø—Ä–∞—Ü—é—î –º–µ–º–æ—ñ–∑–∞—Ü—ñ—è.

### `lruMemoize` vs `weakMapMemoize`

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `createSelector` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é **LRU (Least Recently Used)** –∑ —Ä–æ–∑–º—ñ—Ä–æ–º –∫–µ—à—É 1.

#### `lruMemoize`

–¶–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –º–µ–º–æ—ñ–∑–∞—Ü—ñ—ó. –í–æ–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—î –æ—Å—Ç–∞–Ω–Ω—ñ N –≤–∏–∫–ª–∏–∫—ñ–≤.

```javascript
import { createSelector, lruMemoize } from '@reduxjs/toolkit'

const selectItems = createSelector([input], resultFunc, {
    memoize: lruMemoize,
    memoizeOptions: {
        equalityCheck: (a, b) => a === b, // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
        maxSize: 1, // –†–æ–∑–º—ñ—Ä –∫–µ—à—É
        resultEqualityCheck: (a, b) => a === b, // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
    },
})
```

**–ö–æ–ª–∏ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ `maxSize`?**
–Ø–∫—â–æ –æ–¥–∏–Ω —ñ —Ç–æ–π –∂–µ —Å–µ–ª–µ–∫—Ç–æ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö –∑ —Ä—ñ–∑–Ω–∏–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ (–∞–ª–µ –Ω–µ –æ–¥–Ω–æ—á–∞—Å–Ω–æ), –∑–±—ñ–ª—å—à–µ–Ω–Ω—è `maxSize` –º–æ–∂–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—ñ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—ñ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.

#### `weakMapMemoize`

–ù–æ–≤–∞ –æ–ø—Ü—ñ—è –≤ Reselect 5.0. –í–æ–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `WeakMap` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- **–¢—ñ–ª—å–∫–∏ –¥–ª—è –æ–±'—î–∫—Ç—ñ–≤**: –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –æ–±'—î–∫—Ç–∞–º–∏ (–Ω–µ –ø—Ä–∏–º—ñ—Ç–∏–≤–∞–º–∏).
- **–ù–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π –∫–µ—à**: –ü–æ–∫–∏ –æ–±'—î–∫—Ç-–∫–ª—é—á —ñ—Å–Ω—É—î –≤ –ø–∞–º'—è—Ç—ñ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è.
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è**: –ö–æ–ª–∏ –æ–±'—î–∫—Ç-–∫–ª—é—á –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è Garbage Collector, –∑–∞–ø–∏—Å —É –∫–µ—à—ñ —Ç–µ–∂ –∑–Ω–∏–∫–∞—î.

–¶–µ —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å, –∫–æ–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —î —Å–∞–º —Å—Ç–µ–π—Ç –∞–±–æ –≤–µ–ª–∏–∫–∏–π –æ–±'—î–∫—Ç –ø—Ä–æ–ø—Å—ñ–≤.

```javascript
import { createSelector, weakMapMemoize } from '@reduxjs/toolkit'

const selectData = createSelector([(state) => state.someObject], (obj) => complexCalculation(obj), {
    memoize: weakMapMemoize, // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ WeakMap
    argsMemoize: weakMapMemoize, // –î–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ —Ç–µ–∂
})
```

### –ö–∞—Å—Ç–æ–º–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä—ñ–≤–Ω–æ—Å—Ç—ñ (`equalityCheck`)

–Ü–Ω–æ–¥—ñ `===` –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ input selector –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π –º–∞—Å–∏–≤, –∞–ª–µ –π–æ–≥–æ –≤–º—ñ—Å—Ç —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏–π.

```javascript
import { createSelector } from '@reduxjs/toolkit'
import { isEqual } from 'lodash'

const selectDeep = createSelector([(state) => state.deeplyNestedObject], (obj) => calculate(obj), {
    memoizeOptions: {
        // ‚ö†Ô∏è Use with caution! Deep comparison is slow!
        equalityCheck: isEqual,
    },
})
```

**–ó–∞—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è**: –ì–ª–∏–±–æ–∫–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è (deep equality) –º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω–∏–º —Å–∞–º–µ –ø–æ —Å–æ–±—ñ. –Ü–Ω–æ–¥—ñ —à–≤–∏–¥—à–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä, –Ω—ñ–∂ –ø–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ –¥–≤–∞ –≤–µ–ª–∏—á–µ–∑–Ω–∏—Ö –¥–µ—Ä–µ–≤–∞ –æ–±'—î–∫—Ç—ñ–≤.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 6: –°–µ–ª–µ–∫—Ç–æ—Ä–∏ –∑ –ø—Ä–æ–ø—Å–∞–º–∏ (Arguments)

–Ü–Ω–æ–¥—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–∞–Ω—ñ –Ω–µ —Ç—ñ–ª—å–∫–∏ –∑—ñ —Å—Ç–µ–π—Ç—É, –∞–ª–µ –π –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `id` –ø—Ä–æ–¥—É–∫—Ç—É).

```javascript
const selectProductById = (state, productId) => state.products.entities[productId]
```

–¶–µ –ø—Ä–∞—Ü—é—î, –∞–ª–µ —è–∫ —Ü–µ –º–µ–º–æ—ñ–∑—É–≤–∞—Ç–∏? `createSelector` –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –∞—Ä–≥—É–º–µ–Ω—Ç–∏. –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –∑ `useSelector` –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –≤ Input Selectors —è–∫ –¥—Ä—É–≥–∏–π, —Ç—Ä–µ—Ç—ñ–π —ñ —Ç.–¥. –∞—Ä–≥—É–º–µ–Ω—Ç–∏.

```javascript
// Input Selectors
const selectItems = (state) => state.items
const selectItemId = (state, itemId) => itemId // –ü—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ ID

const selectItemById = createSelector(
    [selectItems, selectItemId], // –ü–µ—Ä–µ–¥–∞—î–º–æ –æ–±–∏–¥–≤–∞
    (items, itemId) => {
        console.log(`Searching for item ${itemId}`)
        return items.find((item) => item.id === itemId)
    },
)
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ:**

```javascript
function ItemComponent({ id }) {
    // –ü–µ—Ä–µ–¥–∞—î–º–æ state –¢–ê id
    const item = useSelector((state) => selectItemById(state, id))

    return <div>{item.name}</div>
}
```

### üö® –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞: Shared Cache

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `createSelector` –º–∞—î **—Ä–æ–∑–º—ñ—Ä –∫–µ—à—É = 1**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤—ñ–Ω –ø–∞–º'—è—Ç–∞—î –ª–∏—à–µ –æ—Å—Ç–∞–Ω–Ω—ñ–π –Ω–∞–±—ñ—Ä –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤.

–Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ —Ü–µ–π —Å–µ–ª–µ–∫—Ç–æ—Ä —É —Å–ø–∏—Å–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤:

```javascript
function ItemList() {
    return (
        <>
            <ItemComponent id={1} />
            <ItemComponent id={2} />
            <ItemComponent id={1} />
        </>
    )
}
```

–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:

1.  `ItemComponent(1)` –≤–∏–∫–ª–∏–∫–∞—î —Å–µ–ª–µ–∫—Ç–æ—Ä –∑ `id=1`. –ö–µ—à—É—î—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è `1`.
2.  `ItemComponent(2)` –≤–∏–∫–ª–∏–∫–∞—î —Å–µ–ª–µ–∫—Ç–æ—Ä –∑ `id=2`. –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –∑–º—ñ–Ω–∏–ª–∏—Å—è! –ö–µ—à –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è –¥–ª—è `2`.
3.  `ItemComponent(1)` (—Ä–µ-—Ä–µ–Ω–¥–µ—Ä) –≤–∏–∫–ª–∏–∫–∞—î —Å–µ–ª–µ–∫—Ç–æ—Ä –∑ `id=1`. –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –∑–º—ñ–Ω–∏–ª–∏—Å—è (–ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ `2`)! –ö–µ—à –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è.

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–µ–º–æ—ñ–∑–∞—Ü—ñ—è –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–ª–∞–º–∞–Ω–∞. –°–µ–ª–µ–∫—Ç–æ—Ä –ø–æ—Å—Ç—ñ–π–Ω–æ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è. –¶–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è **Selector Thrashing**.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 7: Factory Pattern (–†—ñ—à–µ–Ω–Ω—è –¥–ª—è Shared Cache)

–©–æ–± –≤–∏—Ä—ñ—à–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É shared cache, –∫–æ–∂–Ω–æ–º—É –µ–∫–∑–µ–º–ø–ª—è—Ä—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø–æ—Ç—Ä—ñ–±–µ–Ω **–≤–ª–∞—Å–Ω–∏–π –µ–∫–∑–µ–º–ø–ª—è—Ä —Å–µ–ª–µ–∫—Ç–æ—Ä–∞**.

–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–∞—Ç–µ—Ä–Ω **Factory Function** ‚Äî —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ —Å—Ç–≤–æ—Ä—é—î —Å–µ–ª–µ–∫—Ç–æ—Ä.

```javascript
// 1. –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é-—Ñ–∞–±—Ä–∏–∫—É (make...)
const makeSelectItemById = () => {
    // 2. –í—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ç–≤–æ—Ä—é—î–º–æ –ù–û–í–ò–ô createSelector
    return createSelector([(state) => state.items, (state, id) => id], (items, id) => {
        console.log('Complex finding logic...')
        return items.find((i) => i.id === id)
    })
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ –∑ `useMemo`:**

```javascript
function ItemComponent({ id }) {
    // 1. –°—Ç–≤–æ—Ä—é—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –¶–¨–û–ì–û –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    // useMemo –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ —Å–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç–≤–æ—Ä–∏—Ç—å—Å—è –ª–∏—à–µ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –∂–∏—Ç—Ç—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    const selectItemById = useMemo(() => makeSelectItemById(), []) // [] - –±–µ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

    // 2. –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ü–µ–π —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
    const item = useSelector((state) => selectItemById(state, id))

    return <div>{item?.name}</div>
}
```

–¢–µ–ø–µ—Ä:

- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç A (id=1) –º–∞—î —Å–≤—ñ–π —Å–µ–ª–µ–∫—Ç–æ—Ä. –î–ª—è –Ω—å–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ `(state, 1)` —Å—Ç–∞–±—ñ–ª—å–Ω—ñ.
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç B (id=2) –º–∞—î —Å–≤—ñ–π —Å–µ–ª–µ–∫—Ç–æ—Ä. –î–ª—è –Ω—å–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ `(state, 2)` —Å—Ç–∞–±—ñ–ª—å–Ω—ñ.

–ú–µ–º–æ—ñ–∑–∞—Ü—ñ—è –ø—Ä–∞—Ü—é—î —ñ–¥–µ–∞–ª—å–Ω–æ!

::note
–ü–æ—á–∏–Ω–∞—é—á–∏ –∑ React-Redux v7+, —Ü–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø–∞—Ç–µ—Ä–Ω –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤, –∑–∞–ª–µ–∂–Ω–∏—Ö –≤—ñ–¥ –ø—Ä–æ–ø—Å—ñ–≤.
::

### Advanced Factory with Props that Change

–©–æ —Ä–æ–±–∏—Ç–∏, —è–∫—â–æ –ø—Ä–æ–ø—Å–∏ –∑–º—ñ–Ω—é—é—Ç—å—Å—è? (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `filterType`).

```javascript
const makeSelectVisibleTodos = () => {
    return createSelector([(state) => state.todos, (state, props) => props.filterType], (todos, filterType) => {
        switch (filterType) {
            case 'SHOW_COMPLETED':
                return todos.filter((t) => t.completed)
            case 'SHOW_ACTIVE':
                return todos.filter((t) => !t.completed)
            default:
                return todos
        }
    })
}

function VisibleTodoList({ filterType }) {
    const selectVisibleTodos = useMemo(makeSelectVisibleTodos, [])
    const todoList = useSelector((state) => selectVisibleTodos(state, { filterType }))

    // ...
}
```

–Ø–∫—â–æ `filterType` –∑–º—ñ–Ω–∏—Ç—å—Å—è, —Å–µ–ª–µ–∫—Ç–æ—Ä –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ä–∞—Ö—É—î –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –æ–Ω–æ–≤–∏—Ç—å —Å–≤—ñ–π –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –∫–µ—à.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 8: –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –°–µ–ª–µ–∫—Ç–æ—Ä–∏ (Structured Selectors)

–ß–∞—Å—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ —à–º–∞—Ç–∫—ñ–≤ –¥–∞–Ω–∏—Ö. –ü–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ —Ä–æ–±–ª—è—Ç—å —Ç–∞–∫:

```javascript
// ‚ùå 3 –≤–∏–∫–ª–∏–∫–∏ —Ö—É–∫–∞
const user = useSelector(selectUser)
const theme = useSelector(selectTheme)
const notifications = useSelector(selectNotifications)
```

–ê–±–æ —Ç–∞–∫:

```javascript
// ‚ùå –ü–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç —â–æ—Ä–∞–∑—É -> re-render
const { user, theme } = useSelector((state) => ({
    user: state.auth.user,
    theme: state.ui.theme,
}))
```

**–†—ñ—à–µ–Ω–Ω—è 1: `shallowEqual`**
–ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è.

```javascript
import { shallowEqual, useSelector } from 'react-redux'

const { user, theme } = useSelector(
    (state) => ({
        user: state.auth.user,
        theme: state.ui.theme,
    }),
    shallowEqual,
) // ‚úÖ –ü–æ—Ä—ñ–≤–Ω—é—î –≤–º—ñ—Å—Ç –æ–±'—î–∫—Ç–∞, –∞ –Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
```

**–†—ñ—à–µ–Ω–Ω—è 2: –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä –∑ Reselect**
`createSelector` –º–æ–∂–µ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –æ–±'—î–∫—Ç–∏, —ñ –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –º–µ–º–æ—ñ–∑–æ–≤–∞–Ω–∏–π, –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ü–µ–π –æ–±'—î–∫—Ç –±—É–¥–µ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–º.

```javascript
const selectUserData = createSelector([selectUser, selectTheme], (user, theme) => ({
    user,
    theme,
    isDark: theme === 'dark',
}))

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ
const { user, isDark } = useSelector(selectUserData)
```

–¶–µ –∫—Ä–∞—â–µ, —Ç–æ–º—É —â–æ —Å–µ–ª–µ–∫—Ç–æ—Ä –º–æ–∂–µ —ñ–Ω–∫–∞–ø—Å—É–ª—é–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –∫–æ–º–±—ñ–Ω—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 9: –†–µ–∫—É—Ä—Å–∏–≤–Ω—ñ –°–µ–ª–µ–∫—Ç–æ—Ä–∏

–†–æ–±–æ—Ç–∞ –∑ –¥–µ—Ä–µ–≤–æ–≤–∏–¥–Ω–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –∑ –≤–∫–ª–∞–¥–µ–Ω—ñ—Å—Ç—é) –≤–∏–º–∞–≥–∞—î –æ—Å–æ–±–ª–∏–≤–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É.

–ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —É –Ω–∞—Å —î –ø–ª–æ—Å–∫–∏–π —Å—Ç–µ–π—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ (–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π):

```javascript
const state = {
    comments: {
        1: { id: 1, text: 'Hello', parentId: null },
        2: { id: 2, text: 'World', parentId: 1 },
        3: { id: 3, text: '!!!!!', parentId: 2 },
    },
}
```

–ú–∏ —Ö–æ—á–µ–º–æ –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –¥–µ—Ä–µ–≤–æ.

```javascript
const selectComments = (state) => state.comments

const selectCommentTree = createSelector([selectComments], (comments) => {
    // 1. –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞–ø—É
    const map = {}
    const roots = []

    Object.values(comments).forEach((c) => {
        map[c.id] = { ...c, children: [] } // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–ø—ñ—é –∑ children
    })

    // 2. –ë—É–¥—É—î–º–æ –¥–µ—Ä–µ–≤–æ
    Object.values(map).forEach((c) => {
        if (c.parentId && map[c.parentId]) {
            map[c.parentId].children.push(c)
        } else {
            roots.push(c)
        }
    })

    return roots // –ü–æ–≤–µ—Ä—Ç–∞—î –¥–µ—Ä–µ–≤–æ
})
```

–¶–µ–π —Å–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–≤–µ—Ä–Ω–µ **–Ω–æ–≤–µ –¥–µ—Ä–µ–≤–æ** —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –∑–º—ñ–Ω–∏—Ç—å—Å—è —Ö–æ—á–∞ –± –æ–¥–∏–Ω –∫–æ–º–µ–Ω—Ç–∞—Ä. –¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤. –ê–ª–µ —è–∫—â–æ –¥–µ—Ä–µ–≤–æ –≤–µ–ª–∏—á–µ–∑–Ω–µ, –º–æ–∂–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ —Ü–µ, –º–µ–º–æ—ñ–∑—É—é—á–∏ –æ–∫—Ä–µ–º—ñ –≥—ñ–ª–∫–∏, —Ö–æ—á–∞ —Ü–µ –∑–Ω–∞—á–Ω–æ —É—Å–∫–ª–∞–¥–Ω—é—î –∫–æ–¥.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 10: Reselect 5.0 —Ç–∞ –°—É—á–∞—Å–Ω—ñ –§—ñ—á—ñ

–£ 2023 —Ä–æ—Ü—ñ –≤–∏–π—à–æ–≤ Reselect 5.0 (—á–∞—Å—Ç–∏–Ω–∞ RTK 2.0). –í—ñ–Ω –ø—Ä–∏–Ω—ñ—Å –≤–∞–∂–ª–∏–≤—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –¥–µ–±–∞–≥–≥—ñ–Ω–≥—É.

### Dev Mode Checks

–£ —Ä–µ–∂–∏–º—ñ —Ä–æ–∑—Ä–æ–±–∫–∏ (process.env.NODE_ENV !== 'production') Reselect —Ç–µ–ø–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –≤–∞—à—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –Ω–∞ —Ç–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏.

1.  **Input Stability Check**:
    –í—ñ–Ω –∑–∞–ø—É—Å–∫–∞—î input selectors –¥–≤—ñ—á—ñ. –Ø–∫—â–æ –≤–æ–Ω–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –ø—Ä–∏ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö, –≤—ñ–Ω –≤–∏–∫–∏–¥–∞—î –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è.

    ```javascript
    // ‚ö†Ô∏è Console Warn in Dev: The result function returned a new reference...
    const selectBad = createSelector(
        [(state) => state.items.map((i) => i.id)], // map –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π –º–∞—Å–∏–≤!
        (ids) => ids,
    )
    ```

    –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–º–∫–Ω—É—Ç–∏ —Ü–µ: `createSelector(..., { devModeChecks: { inputStabilityCheck: 'never' } })`.

2.  **Identity Function Check**:
    –Ø–∫—â–æ Result Function –ø—Ä–æ—Å—Ç–æ –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –∞—Ä–≥—É–º–µ–Ω—Ç—É –±–µ–∑ –∑–º—ñ–Ω.
    ```javascript
    createSelector([selectData], (data) => data) // –ù–∞–≤—ñ—â–æ —Ç—É—Ç createSelector?
    ```

---

## –ß–∞—Å—Ç–∏–Ω–∞ 11: TypeScript –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è

Reselect –Ω–∞–ø–∏—Å–∞–Ω–∏–π –Ω–∞ TS, —Ç–æ–º—É —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è —á—É–¥–æ–≤–∞, –∞–ª–µ —ñ–Ω–æ–¥—ñ —Å–∫–ª–∞–¥–Ω–∞.

### –ë–∞–∑–æ–≤–∞ —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è

```typescript
import { RootState } from './store'

// –Ø–≤–Ω–æ –≤–∫–∞–∑—É—î–º–æ —Ç–∏–ø state
const selectCount = (state: RootState) => state.counter.value

// createSelector –≤–∏–≤–æ–¥–∏—Ç—å —Ç–∏–ø–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
const selectDoubleCount = createSelector(
    [selectCount],
    (count) => count * 2, // TS –∑–Ω–∞—î, —â–æ count —Ü–µ number
)
```

### –¢–∏–ø—ñ–∑–∞—Ü—ñ—è —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤ –∑ –ø—Ä–æ–ø—Å–∞–º–∏

```typescript
// –¢–∏–ø—ñ–∑—É—î–º–æ –ø—Ä–æ–ø—Å–∏
const selectItemById = createSelector(
    [
        (state: RootState) => state.items,
        (state: RootState, itemId: string) => itemId, // –í–∫–∞–∑—É—î–º–æ —Ç–∏–ø –¥—Ä—É–≥–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç—É
    ],
    (items, itemId) => items.find((i) => i.id === itemId),
)
```

### –¢–∏–ø—ñ–∑–∞—Ü—ñ—è Output Selector

–Ü–Ω–æ–¥—ñ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —Ç–∏–ø —Å–∞–º–æ–≥–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞.

```typescript
import { OutputSelector } from '@reduxjs/toolkit';

export const selectUser: OutputSelector<
  [typeof selectAuth], // Inputs
  User,                // Result
  (res: AuthState) => User // Combiner
> = createSelector(...)
```

(–ó–∞–∑–≤–∏—á–∞–π `typeof selectUser` –¥–æ—Å—Ç–∞—Ç–Ω—å–æ).

### –¢–∏–ø—ñ–∑–∞—Ü—ñ—è Factory Selector

```typescript
export const makeSelectUserById = () => {
    return createSelector([selectUsers, (state: RootState, id: number) => id], (users, id) => users[id])
}

// –¢–∏–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —Ñ–∞–±—Ä–∏–∫–∏
type SelectUserById = ReturnType<typeof makeSelectUserById>
```

---

## –ß–∞—Å—Ç–∏–Ω–∞ 12: –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –†–æ–∑–º—ñ—â–µ–Ω–Ω—è

–î–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏? –Ñ –¥–≤–∞ –ø—ñ–¥—Ö–æ–¥–∏.

### –ü—ñ–¥—Ö—ñ–¥ 1. –ö–æ–ª–æ–∫–∞—Ü—ñ—è (Colocation - –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

–ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –ø–æ—Ä—É—á –∑ —Ä–µ–¥—é—Å–µ—Ä–æ–º —É —Ñ–∞–π–ª—ñ —Å–ª–∞–π—Å—É.

```javascript
// features/users/usersSlice.js

const usersSlice = createSlice({ ... });

// –ü—Ä–∏–≤–∞—Ç–Ω—ñ input selectors
const selectUsersState = state => state.users;

// –ü—É–±–ª—ñ—á–Ω—ñ –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏
export const selectAllUsers = createSelector(
    [selectUsersState],
    state => state.ids.map(id => state.entities[id])
);

export default usersSlice.reducer;
```

### –ü—ñ–¥—Ö—ñ–¥ 2. –û–∫—Ä–µ–º—ñ —Ñ–∞–π–ª–∏

–î–ª—è –≤–µ–ª–∏–∫–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤ –º–æ–∂–Ω–∞ –≤–∏–Ω–µ—Å—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –≤ `usersSelectors.js`. –¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î —É–Ω–∏–∫–Ω—É—Ç–∏ —Ü–∏–∫–ª—ñ—á–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π, —è–∫—â–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –æ–¥–Ω–æ–≥–æ —Å–ª–∞–π—Å—É –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ.

### RTK 2.0 `selectors` –ø–æ–ª–µ

–í –Ω–æ–≤—ñ–π –≤–µ—Ä—Å—ñ—ó RTK –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∑–Ω–∞—á–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –ø—Ä—è–º–æ –≤ `createSlice`:

```javascript
const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: { ... },
  // –ù–æ–≤–µ –ø–æ–ª–µ!
  selectors: {
    selectDouble: (state) => state.value * 2,
    selectQuadruple: (state) => state.value * 4,
  },
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≥–µ–Ω–µ—Ä—É–≤–∞–Ω–Ω—è —ñ–º–µ–Ω (–∞–ª–µ –º–æ–∂–Ω–∞ –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞—Ç–∏)
export const { selectDouble, selectQuadruple } = counterSlice.selectors;
```

**–í–∞–∂–ª–∏–≤–æ**: `state` —Ç—É—Ç ‚Äî —Ü–µ _–ª–æ–∫–∞–ª—å–Ω–∏–π_ —Å—Ç–µ–π—Ç —Å–ª–∞–π—Å—É, –∞ –Ω–µ –≥–ª–æ–±–∞–ª—å–Ω–∏–π RootState.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 13: –¢–∏–ø–æ–≤—ñ –ü–æ–º–∏–ª–∫–∏ —Ç–∞ Anti-Patterns

### 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

```javascript
// ‚ùå –ñ–ê–•
function UserProfile() {
    // –¶–µ–π —Å–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É —Ä–µ–Ω–¥–µ—Ä—ñ
    // –ô–æ–≥–æ –∫–µ—à –∑–∞–≤–∂–¥–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π!
    const selectUser = createSelector(...);
    const user = useSelector(selectUser);
}
```

**–†—ñ—à–µ–Ω–Ω—è**: –í–∏–Ω–µ—Å—ñ—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä –∑–∞ –º–µ–∂—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `useMemo` (Factory Pattern).

### 2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `createSelector` –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π

```javascript
// üòê –ü–ï–†–ï–ë–Ü–†
const selectCount = createSelector([(state) => state.counter], (counter) => counter.value)
```

–¶–µ –æ–≤–µ—Ä—Ö–µ–¥. –ü—Ä–æ—Å—Ç—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ `state => state.value` –ø—Ä–∞—Ü—é—é—Ç—å —à–≤–∏–¥—à–µ, –±–æ –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–µ—à–µ–≤—à–∏–π –∑–∞ –ª–æ–≥—ñ–∫—É –º–µ–º–æ—ñ–∑–∞—Ü—ñ—ó. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `createSelector` —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î:

- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö (map, filter).
- –û–±'—î–¥–Ω–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö —Å–ª–∞–π—Å—ñ–≤.
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –æ–±'—î–∫—Ç—ñ–≤/–º–∞—Å–∏–≤—ñ–≤.

### 3. –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è `undefined` –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å

```javascript
// ‚ùå –ú–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç {} –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É, —è–∫—â–æ —é–∑–µ—Ä–∞ –Ω–µ–º–∞—î
const selectUser = createSelector([selectState], (state) => state.user || {})
```

**–†—ñ—à–µ–Ω–Ω—è**: –í–∏–Ω–µ—Å—ñ—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É.

```javascript
const EMPTY_USER = {}
const selectUser = createSelector([selectState], (state) => state.user || EMPTY_USER)
```

---

## –ß–∞—Å—Ç–∏–Ω–∞ 14: Debugging Selectors

–©–æ —Ä–æ–±–∏—Ç–∏, —è–∫—â–æ —Å–µ–ª–µ–∫—Ç–æ—Ä –Ω–µ –º–µ–º–æ—ñ–∑—É—î—Ç—å—Å—è, —ñ –≤–∏ –Ω–µ —Ä–æ–∑—É–º—ñ—î—Ç–µ —á–æ–º—É?

### 1. Re-reselect

–Ü—Å–Ω—É—î –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ `re-reselect` (–∞–±–æ –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞–π—Ç–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è), —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–µ—à.

–ê–ª–µ –ø—Ä–æ—Å—Ç—ñ—à–µ –¥–æ–¥–∞—Ç–∏ –ª–æ–≥ –≤ —Å–∞–º —Å–µ–ª–µ–∫—Ç–æ—Ä:

```javascript
const selectComplex = createSelector([input1, input2], (res1, res2) => {
    console.log('Recalculating!', { res1, res2 }) // –Ø–∫—â–æ –≤–∏ –±–∞—á–∏—Ç–µ —Ü–µ –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –≤ inputs
    return res1 + res2
})
```

### 2. React Profiler

1.  –í—ñ–¥–∫—Ä–∏–π—Ç–µ React DevTools -> Profiler.
2.  –ó–∞–ø–∏—à—ñ—Ç—å –¥—ñ—é.
3.  –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫ "Commits".
4.  –Ø–∫—â–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è, –Ω–∞–≤–µ–¥—ñ—Ç—å –Ω–∞ –Ω—å–æ–≥–æ. React —Å–∫–∞–∂–µ "Why did this render?".
5.  –Ø–∫—â–æ –ø—Ä–∏—á–∏–Ω–∞ "Hooks changed", —ñ —Ü–µ `useSelector` ‚Äî –≤–∞—à —Å–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–≤–µ—Ä–Ω—É–≤ –Ω–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.

### 3. Debugging Input Output

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ-–æ–±—á–∏—Å–ª–µ–Ω—å:

```javascript
selectComplex.recomputations() // –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–∞–∑—ñ–≤, –∫–æ–ª–∏ resultFunc –≤–∏–∫–æ–Ω—É–≤–∞–ª–∞—Å—å
selectComplex.resetRecomputations() // –°–∫–∏–Ω—É—Ç–∏ –ª—ñ—á–∏–ª—å–Ω–∏–∫
```

–¶–µ –∫–æ—Ä–∏—Å–Ω–æ –≤ —Ç–µ—Å—Ç–∞—Ö –∞–±–æ –∫–æ–Ω—Å–æ–ª—ñ.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 15: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –°–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤

–û—Å–∫—ñ–ª—å–∫–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ ‚Äî —Ü–µ —á–∏—Å—Ç—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —ó—Ö –æ–¥–Ω–µ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è. –í–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω Redux Store, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —á–∏ –º–æ–∫–∏. –ü—Ä–æ—Å—Ç–æ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ —ñ –æ—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

```javascript
// selectors.test.js
import { selectVisibleOrders } from './ordersSlice'

describe('selectVisibleOrders', () => {
    it('should filter by status', () => {
        const orders = [
            { id: 1, status: 'pending' },
            { id: 2, status: 'completed' },
        ]
        const filters = { status: 'pending', sort: 'date' }

        // –í–∏–∫–ª–∏–∫–∞—î–º–æ result function –Ω–∞–ø—Ä—è–º—É –¥–ª—è —ñ–∑–æ–ª—å–æ–≤–∞–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è!
        // createSelector.resultFunc –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç—ñ–≤
        const result = selectVisibleOrders.resultFunc(orders, filters)

        expect(result).toHaveLength(1)
        expect(result[0].id).toBe(1)
    })

    it('should act as a memoized selector', () => {
        const state = {
            /* ... */
        }
        const result1 = selectVisibleOrders(state)
        const result2 = selectVisibleOrders(state)

        expect(result1).toBe(result2) // Reference equality check
    })
})
```

–ê–±–æ —Ç–µ—Å—Ç—É–π—Ç–µ —è–∫ –∑–≤–∏—á–∞–π–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é, –ø–µ—Ä–µ–¥–∞—é—á–∏ –ø–æ–≤–Ω–∏–π —Å—Ç–µ–π—Ç:

```javascript
const state = {
    orders: { list: [...], filters: {...} }
};
const result = selectVisibleOrders(state);
```

---

## –ß–∞—Å—Ç–∏–Ω–∞ 16: FAQ (–ß–∞—Å—Ç—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è)

### –ü: –ß–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `async` –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞—Ö?

**–í: –ù–Ü!** –°–µ–ª–µ–∫—Ç–æ—Ä–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ —á–∏—Å—Ç–∏–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏. –Ø–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–±–∏—Ç–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∑–∞–ø–∏—Ç–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ **Thunks** –∞–±–æ **RTK Query**. –°–µ–ª–µ–∫—Ç–æ—Ä –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –∑ —Ç–∏–º, —â–æ _–≤–∂–µ_ —î –≤ —Å—Ç–µ–π—Ç—ñ.

### –ü: –ß–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ö—É–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤?

**–í: –ù–Ü!** –°–µ–ª–µ–∫—Ç–æ—Ä ‚Äî —Ü–µ –∑–≤–∏—á–∞–π–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è JS. –•—É–∫–∏ (`useSelector`, `useState`) –ø—Ä–∞—Ü—é—é—Ç—å —Ç—ñ–ª—å–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –∞–±–æ —ñ–Ω—à–∏—Ö —Ö—É–∫—ñ–≤.

### –ü: –Ø–∫ –ø–µ—Ä–µ–¥–∞—Ç–∏ 3+ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ —É —Å–µ–ª–µ–∫—Ç–æ—Ä?

**–í:** –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ —è–∫ –æ–±'—î–∫—Ç.

```javascript
const selectItem = (state, { id, type, role }) => ...
```

–ê—Ä–≥—É–º–µ–Ω—Ç–∏ –¥–ª—è `createSelector` –±—É–¥—É—Ç—å: `(state, props) => props.xyz`.

### –ü: –ß–∏ –ø—Ä–∞—Ü—é—î Reselect –∑ Context API –∞–±–æ Zustland?

**–í:** –¢–∞–∫! `createSelector` ‚Äî —Ü–µ –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ —É—Ç–∏–ª—ñ—Ç–∞.

- **Zustand**: –ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è derived state.
- **Context API**: –ú–æ–∂–Ω–∞ –º–µ–º–æ—ñ–∑—É–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.

```javascript
// Zustand example
import { createStore } from 'zustand';
import { createSelector } from 'reselect'; // –∞–±–æ @reduxjs/toolkit

const useStore = createStore((set) => ({ ... }));

const selectDoubled = createSelector(
  [state => state.count],
  count => count * 2
);

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ
const doubled = useStore(selectDoubled);
```

### –ü: –ß–∏ –≤–∞—Ä—Ç–æ –º–µ–º–æ—ñ–∑—É–≤–∞—Ç–∏ –≤—Å–µ –ø—ñ–¥—Ä—è–¥?

**–í: –ù—ñ.** –ú–µ–º–æ—ñ–∑–∞—Ü—ñ—è –º–∞—î —Å–≤–æ—é —Ü—ñ–Ω—É (–ø–∞–º'—è—Ç—å, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏). –ù–µ –º–µ–º–æ—ñ–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—ñ –¥–æ—Å—Ç—É–ø–∏ (`state => state.x`) –∞–±–æ –¥—É–∂–µ –¥–µ—à–µ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó (`a + b`). –ú–µ–º–æ—ñ–∑—É–π—Ç–µ:

1.  –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –º–∞—Å–∏–≤—ñ–≤.
2.  –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è.
3.  –ú–∞–ø—ñ–Ω–≥ –≤–µ–ª–∏–∫–∏—Ö —Å–ø–∏—Å–∫—ñ–≤.
4.  –°–∫–ª–∞–¥–Ω—É –º–∞—Ç–µ–º–∞—Ç–∏–∫—É.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 17: Benchmarking Script

–•–æ—á–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ —à–≤–∏–¥—à—ñ? –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ü–µ–π —Å–∫—Ä–∏–ø—Ç —É Node.js.

```javascript
/* benchmark.js */
const { createSelector } = require('@reduxjs/toolkit')

// 1. –°—Ç–≤–æ—Ä–∏–º–æ –≤–µ–ª–∏–∫–∏–π –º–∞—Å–∏–≤
const ITEMS_COUNT = 100000
const state = {
    items: Array.from({ length: ITEMS_COUNT }, (_, i) => ({
        id: i,
        completed: Math.random() > 0.5,
        value: Math.random() * 100,
    })),
}

// 2. –ó–≤–∏—á–∞–π–Ω–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
const selectBad = (state) => state.items.filter((i) => i.completed)

// 3. –ú–µ–º–æ—ñ–∑–æ–≤–∞–Ω–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
const selectMemoized = createSelector([(state) => state.items], (items) => items.filter((i) => i.completed))

// 4. –¢–µ—Å—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
console.time('Bad Selector (First Run)')
selectBad(state)
console.timeEnd('Bad Selector (First Run)')

console.time('Bad Selector (Second Run)')
selectBad(state) // –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î –∑–Ω–æ–≤—É!
console.timeEnd('Bad Selector (Second Run)')

console.time('Memoized (First Run)')
selectMemoized(state)
console.timeEnd('Memoized (First Run)')

console.time('Memoized (Second Run)')
selectMemoized(state) // –ú–∏—Ç—Ç—î–≤–æ!
console.timeEnd('Memoized (Second Run)')

/*
–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
Bad Selector (First Run): 5.2ms
Bad Selector (Second Run): 5.1ms
Memoized (First Run): 5.3ms
Memoized (Second Run): 0.005ms üöÄ (1000x —à–≤–∏–¥—à–µ!)
*/
```

---

---

## –ß–∞—Å—Ç–∏–Ω–∞ 18: –ö–µ–π—Å-—Å—Ç–∞–¥—ñ (High Frequency Updates)

–î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ —Ä–µ–∞–ª—å–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –∑ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó —Å—Ñ–µ—Ä–∏ (–∫—Ä–∏–ø—Ç–æ-–±—ñ—Ä–∂–∞), –¥–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ "–≤–±–∏–≤–∞—é—Ç—å" CPU.

### –°—Ü–µ–Ω–∞—Ä—ñ–π

–£ –Ω–∞—Å —î WebSocket, —è–∫–∏–π –ø—Ä–∏—Å–∏–ª–∞—î 100 –æ–Ω–æ–≤–ª–µ–Ω—å —Ü—ñ–Ω –Ω–∞ —Å–µ–∫—É–Ω–¥—É.
–°—Ç–µ–π—Ç –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫:

```javascript
/* state.market */
{
    tickers: {
        'BTC-USDT': { price: 45000.50, volume: 1000 },
        'ETH-USDT': { price: 3200.10, volume: 5000 },
        // ... —â–µ 500 –ø–∞—Ä
    },
    favorites: ['BTC-USDT', 'DOGE-USDT'] // –°–ø–∏—Å–æ–∫ —É–ª—é–±–ª–µ–Ω–∏—Ö
}
```

### –ü–æ–≥–∞–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è (Naive Approach)

```javascript
// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫—É —É–ª—é–±–ª–µ–Ω–∏—Ö
function FavoritesList() {
    // ‚ùå –¶–µ–π —Å–µ–ª–µ–∫—Ç–æ—Ä —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –º–∞—Å–∏–≤ 100 —Ä–∞–∑—ñ–≤ –Ω–∞ —Å–µ–∫—É–Ω–¥—É!
    const favorites = useSelector((state) => {
        return state.market.favorites.map((symbol) => state.market.tickers[symbol])
    })

    return (
        <div>
            {favorites.map((ticker) => (
                <TickerRow key={ticker.symbol} data={ticker} />
            ))}
        </div>
    )
}
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è?**

1.  –ü—Ä–∏—Ö–æ–¥–∏—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü—ñ–Ω–∏ –¥–ª—è –ø–∞—Ä–∏ `XRP-USDT` (—è–∫–æ—ó –Ω–∞–≤—ñ—Ç—å –Ω–µ–º–∞—î –≤ `favorites`).
2.  Redux —Å—Ç–µ–π—Ç –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è (–Ω–æ–≤–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ `state.market.tickers`).
3.  `useSelector` –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è.
4.  –í—ñ–Ω —Ä–æ–±–∏—Ç—å `.map(...)` —ñ —Å—Ç–≤–æ—Ä—é—î **–Ω–æ–≤–∏–π –º–∞—Å–∏–≤** –æ–±'—î–∫—Ç—ñ–≤ (–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Ü—ñ–Ω–∏ BTC —ñ DOGE –Ω–µ –∑–º—ñ–Ω–∏–ª–∏—Å—è!).
5.  –ù–æ–≤–∏–π –º–∞—Å–∏–≤ !== —Å—Ç–∞—Ä–∏–π –º–∞—Å–∏–≤.
6.  `FavoritesList` —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è 100 —Ä–∞–∑—ñ–≤ –Ω–∞ —Å–µ–∫—É–Ω–¥—É.
7.  –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å "—Ñ—Ä–∏–∑–∏—Ç—å".

### –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è (Reselect)

–ú–∏ –ø–æ–≤–∏–Ω–Ω—ñ —ñ–∑–æ–ª—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ. –Ø–∫—â–æ –∑–º—ñ–Ω–∏–≤—Å—è `XRP`, —Å–µ–ª–µ–∫—Ç–æ—Ä `favorites` –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏—Å—å.

```javascript
// 1. Input selectors
const selectTickers = (state) => state.market.tickers
const selectFavoritesIDs = (state) => state.market.favorites

// 2. Memoized selector
const selectFavoriteTickers = createSelector(
    [selectTickers, selectFavoritesIDs],
    (tickers, favoriteIds) => {
        return favoriteIds.map((id) => tickers[id])
    },
    {
        // üö® –¶—å–æ–≥–æ –≤—Å–µ —â–µ –ù–ï–î–û–°–¢–ê–¢–ù–¨–û!
        // –Ø–∫—â–æ tickers –∑–º—ñ–Ω–∏–≤—Å—è (—á–µ—Ä–µ–∑ XRP), —Ç–æ –ø–µ—Ä—à–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç –∑–º—ñ–Ω–∏–≤—Å—è.
        // Reselect —Å–∫–∏–Ω–µ –∫–µ—à —ñ –ø–µ—Ä–µ—Ä–∞—Ö—É—î –º–∞—Å–∏–≤.
    },
)
```

–ú–∏ –≤—Å–µ —â–µ –º–∞—î–º–æ –ø—Ä–æ–±–ª–µ–º—É! `state.market.tickers` ‚Äî —Ü–µ –æ–¥–∏–Ω –≤–µ–ª–∏–∫–∏–π –æ–±'—î–∫—Ç. –ë—É–¥—å-—è–∫–∞ –∑–º—ñ–Ω–∞ –±—É–¥—å-—è–∫–æ—ó —Ü—ñ–Ω–∏ –∑–º—ñ–Ω—é—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ü–µ–π –æ–±'—î–∫—Ç.

### –†—ñ—à–µ–Ω–Ω—è: Granular Selection (Factory Pattern)

–ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –≤–∏–±–∏—Ä–∞—Ç–∏ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫—É –ø–æ–≤–∏–Ω–µ–Ω –≤–∏–±–∏—Ä–∞—Ç–∏ **—Ç—ñ–ª—å–∫–∏ ID**, –∞ –¥–æ—á—ñ—Ä–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ ‚Äî **—Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –¥–∞–Ω—ñ**.

```javascript
// Father Component
function FavoritesList() {
    // ‚úÖ –¶–µ–π –º–∞—Å–∏–≤ –∑–º—ñ–Ω—é—î—Ç—å—Å—è —Ä—ñ–¥–∫–æ (—Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ —é–∑–µ—Ä –¥–æ–¥–∞—î/–≤–∏–¥–∞–ª—è—î –∑—ñ—Ä–æ–∫)
    const favoriteIds = useSelector((state) => state.market.favorites)

    return (
        <div>
            {favoriteIds.map((id) => (
                <MemoizedTickerRow key={id} symbol={id} />
            ))}
        </div>
    )
}

// Child Component
const makeSelectTickerData = () => {
    return createSelector(
        [(state) => state.market.tickers, (state, symbol) => symbol],
        (tickers, symbol) => tickers[symbol],
    )
}

const TickerRow = ({ symbol }) => {
    // ‚úÖ Factory pattern: –∫–æ–∂–µ–Ω —Ä—è–¥–æ–∫ –º–∞—î —Å–≤—ñ–π —Å–µ–ª–µ–∫—Ç–æ—Ä
    const selectTickerData = useMemo(makeSelectTickerData, [])
    const data = useSelector((state) => selectTickerData(state, symbol))

    return (
        <div>
            {symbol}: {data.price}
        </div>
    )
}

// –ù–µ –∑–∞–±—É–≤–∞—î–º–æ React.memo, —â–æ–± –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π —Ä–µ–Ω–¥–µ—Ä –Ω–µ —á—ñ–ø–ª—è–≤ –¥—ñ—Ç–µ–π
const MemoizedTickerRow = React.memo(TickerRow)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

1.  –ü—Ä–∏—Ö–æ–¥–∏—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `XRP`.
2.  `state.market.tickers` –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è.
3.  `FavoritesList` –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ `state.market.favorites`. –í—ñ–Ω –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è. –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫—É –Ω–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è.
4.  –í—Å—ñ `TickerRow` (BTC, DOGE) –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å —Å–≤–æ—ó —Å–µ–ª–µ–∫—Ç–æ—Ä–∏.
5.  `selectTickerData` –¥–ª—è BTC –¥–∏–≤–∏—Ç—å—Å—è: `tickers` –∑–º—ñ–Ω–∏–ª–∏—Å—è? –¢–∞–∫. `symbol` –∑–º—ñ–Ω–∏–≤—Å—è? –ù—ñ.
6.  –í—ñ–Ω –ª—ñ–∑–µ –≤ `tickers['BTC-USDT']`. –ü–æ—Ä—ñ–≤–Ω—é—î –æ–±'—î–∫—Ç —Ü—ñ–Ω–∏ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º.
7.  –Ø–∫—â–æ –æ–±'—î–∫—Ç —Ü—ñ–Ω–∏ BTC —Ç–æ–π —Å–∞–º–∏–π (–ø–æ—Å–∏–ª–∞–ª—å–Ω–æ), —Å–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–≤–µ—Ä–Ω–µ —Å—Ç–∞—Ä–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è?
    **–°—Ç–æ–ø!** –¢—É—Ç –Ω—é–∞–Ω—Å. –Ø–∫—â–æ –º–∏ –º—É—Ç—É—î–º–æ `tickers` –ø—Ä–∞–≤–∏–ª—å–Ω–æ (—á–µ—Ä–µ–∑ Immer), —Ç–æ `tickers['BTC']` –∑–∞–ª–∏—à–∏—Ç—å—Å—è —Ç–∏–º —Å–∞–º–∏–º –æ–±'—î–∫—Ç–æ–º, —è–∫—â–æ –º–∏ –Ω–µ —á—ñ–ø–∞–ª–∏ –π–æ–≥–æ –ø–æ–ª—è.

    –û—Ç–∂–µ, —è–∫—â–æ –æ–Ω–æ–≤–∏–≤—Å—è —Ç—ñ–ª—å–∫–∏ XRP, —Ç–æ –æ–±'—î–∫—Ç BTC –∑–∞–ª–∏—à–∏–≤—Å—è —Å—Ç–∞—Ä–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º.

    `selectTickerData` –ø–æ–≤–µ—Ä–Ω–µ —Å—Ç–∞—Ä–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
    `useSelector` –Ω–µ –≤–∏–∫–ª–∏—á–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä `TickerRow(BTC)`.

–í—Å—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Å–ø–æ–∫—ñ–π–Ω–æ—é, –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ —à–∞–ª–µ–Ω–æ–º—É –ø–æ—Ç–æ—Ü—ñ –¥–∞–Ω–∏—Ö. –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è (—Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è) —Ç—ñ–ª—å–∫–∏ TickerRow(XRP), —è–∫—â–æ –≤—ñ–Ω —î –Ω–∞ –µ–∫—Ä–∞–Ω—ñ.

---

## –í–∏—Å–Ω–æ–≤–æ–∫

–°–µ–ª–µ–∫—Ç–æ—Ä–∏ ‚Äî —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ø–æ—Å—ñ–± –≤–∑—è—Ç–∏ –¥–∞–Ω—ñ. –¶–µ **—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ** React-Redux –¥–æ–¥–∞—Ç–∫—É.

1.  **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `useSelector` –∑ —Ä–æ–∑—É–º–æ–º**: –°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–Ω–æ—é —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—é.
2.  **–ú–µ–º–æ—ñ–∑—É–π—Ç–µ —Å–∫–ª–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó**: `createSelector` –≤–∞—à –Ω–∞–π–∫—Ä–∞—â–∏–π –¥—Ä—É–≥.
3.  **–ö–æ–º–ø–æ–Ω—É–π—Ç–µ**: –ë—É–¥—É–π—Ç–µ —Å–∫–ª–∞–¥–Ω—ñ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –∑ –ø—Ä–æ—Å—Ç–∏—Ö.
4.  **Factory Pattern**: –ù–µ –∑–∞–±—É–≤–∞–π—Ç–µ –ø—Ä–æ –Ω—å–æ–≥–æ, –∫–æ–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–æ–ø—Å–∏.
5.  **–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è**: –°–µ–ª–µ–∫—Ç–æ—Ä–∏ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞–π–∫—Ä–∞—â–µ –∑ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º —Å—Ç–µ–π—Ç–æ–º (Entity Adapter).

–û–ø–∞–Ω—É–≤–∞–≤—à–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –±—É–¥—É–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–∏, —è–∫—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è —à–≤–∏–¥–∫–∏–º–∏ –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ —Ç–∏—Å—è—á–∞—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —ñ —Å–∫–ª–∞–¥–Ω—ñ–π –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ—Ü—ñ.

::card-group
::card{title="Quiz: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–Ω—å" icon="i-lucide-check-circle"}
–ß–∏ –∑—Ä–æ–∑—É–º—ñ–ª–∏ –≤–∏ —Ä—ñ–∑–Ω–∏—Ü—é –º—ñ–∂ Input —Ç–∞ Output selectors? –ü—Ä–æ–π–¥—ñ—Ç—å —Ç–µ—Å—Ç!
::
::card{title="–ù–∞—Å—Ç—É–ø–Ω–∞ —Ç–µ–º–∞: RTK Query" icon="i-lucide-arrow-right" link="./02.rtk-query-intro.md"}
–Ø–∫ –∑–∞–±—É—Ç–∏ –ø—Ä–æ —Ä—É—á–Ω–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è thunks —ñ —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤ –¥–ª—è API –∑–∞–ø–∏—Ç—ñ–≤.
::
::
