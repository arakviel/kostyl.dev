# RTK Query: –ö—ñ–Ω–µ—Ü—å —Ä—É—á–Ω–æ–≥–æ Fetching

–ú–∏ –Ω–∞–≤—á–∏–ª–∏—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `createAsyncThunk`. –¶–µ –∫—Ä—É—Ç–æ, –∞–ª–µ –¥–∞–≤–∞–π—Ç–µ —á–µ—Å–Ω–æ: –º–∏ –≤—Å–µ —â–µ –ø–∏—à–µ–º–æ –±–∞–≥–∞—Ç–æ –æ–¥–Ω–æ—Ç–∏–ø–Ω–æ–≥–æ –∫–æ–¥—É.

–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ:
1.  –°—Ç–≤–æ—Ä–∏—Ç–∏ thunk.
2.  –î–æ–¥–∞—Ç–∏ 3 –∫–µ–π—Å–∏ –≤ `extraReducers`.
3.  –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –¥–ª—è `data`, `loading`, `error`.
4.  –°–ª—ñ–¥–∫—É–≤–∞—Ç–∏ –∑–∞ –¥–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—î—é –∑–∞–ø–∏—Ç—ñ–≤ (—â–æ–± –Ω–µ —Ä–æ–±–∏—Ç–∏ –¥–≤–∞ –æ–¥–Ω–∞–∫–æ–≤—ñ –∑–∞–ø–∏—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ).
5.  –î—É–º–∞—Ç–∏ –ø—Ä–æ –∫–µ—à—É–≤–∞–Ω–Ω—è.

**RTK Query** ‚Äî —Ü–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ (–≤–±—É–¥–æ–≤–∞–Ω–∞ –≤ Redux Toolkit), —è–∫–∞ –≤–∏—Ä—ñ—à—É—î –≤—Å—ñ —Ü—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –í–æ–Ω–∞ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω–∞ *React Query*, –∞–ª–µ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞ –≤ Redux.

## –°—Ç–≤–æ—Ä–µ–Ω–Ω—è API

–ó–∞–º—ñ—Å—Ç—å "—Å–ª–∞–π—Å—ñ–≤", –º–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ "API —Å–µ—Ä–≤—ñ—Å".

```javascript [services/pokemon.js]
import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';

export const pokemonApi = createApi({
  reducerPath: 'pokemonApi', // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–ª—é—á –≤ —Å—Ç–æ—Ä—ñ
  baseQuery: fetchBaseQuery({ baseUrl: 'https://pokeapi.co/api/v2/' }),
  endpoints: (builder) => ({
    // –í–∏–∑–Ω–∞—á–∞—î–º–æ –µ–Ω–¥–ø–æ—ñ–Ω—Ç "getPokemonByName"
    getPokemonByName: builder.query({
      query: (name) => `pokemon/${name}`,
    }),
  }),
});

// –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ö—É–∫!
// –ù–∞–∑–≤–∞ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —è–∫: use + EndpointName + Query
export const { useGetPokemonByNameQuery } = pokemonApi;
```

## –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Store

–ù–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ —Ä–µ–¥—é—Å–µ—Ä —Ü—å–æ–≥–æ API —Ç–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π middleware.

```javascript [store.js]
import { configureStore } from '@reduxjs/toolkit';
import { pokemonApi } from './services/pokemon';

export const store = configureStore({
  reducer: {
    // –î–æ–¥–∞—î–º–æ —Ä–µ–¥—é—Å–µ—Ä API
    [pokemonApi.reducerPath]: pokemonApi.reducer,
  },
  // –î–æ–¥–∞—î–º–æ middleware (–ø–æ—Ç—Ä—ñ–±–µ–Ω –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è, –ø–æ–ª–ª—ñ–Ω–≥—É —Ç–æ—â–æ)
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(pokemonApi.middleware),
});
```

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ

–ó–∞–±—É–¥—å—Ç–µ –ø—Ä–æ `useEffect`, `dispatch` —Ç–∞ `useSelector`. –í—Å–µ —Ü–µ —Ç–µ–ø–µ—Ä –≤ –æ–¥–Ω–æ–º—É —Ö—É–∫—É.

```jsx
import { useGetPokemonByNameQuery } from './services/pokemon';

export default function App() {
  // –•—É–∫ —Å–∞–º —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç –ø—Ä–∏ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—ñ!
  const { data, error, isLoading } = useGetPokemonByNameQuery('bulbasaur');

  if (isLoading) return <>Loading...</>;
  if (error) return <>Oh no, there was an error</>;

  return (
    <div>
      <h1>{data.species.name}</h1>
      <img src={data.sprites.front_shiny} alt={data.species.name} />
    </div>
  );
}
```

## –ß–æ–º—É —Ü–µ —Ä–µ–≤–æ–ª—é—Ü—ñ—è?

1.  **–ö–µ—à—É–≤–∞–Ω–Ω—è**: –Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î—Ç–µ —Ü–µ–π —Ö—É–∫ –≤ —ñ–Ω—à–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ –∑ —Ç–∏–º —Å–∞–º–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º ('bulbasaur'), RTK Query **–Ω–µ –±—É–¥–µ —Ä–æ–±–∏—Ç–∏ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç**, –∞ –ø–æ–≤–µ—Ä–Ω–µ –¥–∞–Ω—ñ –∑ –∫–µ—à—É.
2.  **–î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è**: –Ø–∫—â–æ –¥–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –ø–æ–ø—Ä–æ—Å—è—Ç—å 'bulbasaur', –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—ñ–¥–µ –ª–∏—à–µ –æ–¥–∏–Ω –∑–∞–ø–∏—Ç.
3.  **Auto-refetching**: –ú–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–∏ —Ñ–æ–∫—É—Å—ñ –≤—ñ–∫–Ω–∞ –∞–±–æ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
4.  **Mutations**: –î–ª—è POST/PUT/DELETE –∑–∞–ø–∏—Ç—ñ–≤ —î `builder.mutation`, —è–∫–∏–π –≤–º—ñ—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –∫–µ—à (Invalidation).

–Ø–∫—â–æ –≤–∏ –ø–æ—á–∏–Ω–∞—î—Ç–µ –Ω–æ–≤–∏–π –ø—Ä–æ—î–∫—Ç —ñ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–æ—Å—Ç–æ "—Ö–æ–¥–∏—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä", **–ø–æ—á–∏–Ω–∞–π—Ç–µ –∑ RTK Query**, –∞ –Ω–µ –∑ `createAsyncThunk`. Thunk –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –∫–æ—Ä–∏—Å–Ω–∏–º –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –ª–∞–Ω—Ü—é–∂–∫—ñ–≤, —è–∫—ñ –Ω–µ —î –ø—Ä–æ—Å—Ç–æ "–æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º –¥–∞–Ω–∏—Ö".

üëâ [–î–∞–ª—ñ: –ù–∞–π–∫—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ç–∞ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞](./03.architecture-best-practices.md)
