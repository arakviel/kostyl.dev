# –õ–æ–≥—ñ–∫–∞ Drag & Drop

–¶–µ "–º'—è—Å–æ" –Ω–∞—à–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É. –ú–∏ —Ä–µ–∞–ª—ñ–∑—É—î–º–æ —Å–∫–ª–∞–¥–Ω—É –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫, —è–∫–∞ –≤–∏–≥–ª—è–¥–∞—î –ø—Ä–æ—Å—Ç–æ—é –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

## React Beautiful DnD

–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –ø—Ä–∞—Ü—é—î –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç—Ä—å–æ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤:
1.  `<DragDropContext>`: –û–±–≥–æ—Ä—Ç–∫–∞ –≤—Å—å–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É. –ü—Ä–∏–π–º–∞—î `onDragEnd`.
2.  `<Droppable>`: –ó–æ–Ω–∞, –∫—É–¥–∏ –º–æ–∂–Ω–∞ –∫–∏–¥–∞—Ç–∏ (–Ω–∞—à–∞ –ö–æ–ª–æ–Ω–∫–∞).
3.  `<Draggable>`: –ï–ª–µ–º–µ–Ω—Ç, —è–∫–∏–π –º–æ–∂–Ω–∞ —Ç—è–≥–∞—Ç–∏ (–Ω–∞—à–µ –ó–∞–≤–¥–∞–Ω–Ω—è).

–ê–ª–µ –Ω–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å **Redux**. –Ø–∫ –º–∏ –±—É–¥–µ–º–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å—Ç–∞–Ω?

## Action Definition

–ù–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –ª–∏—à–µ –æ–¥–∏–Ω action, —è–∫–∏–π –æ–ø–∏—Å—É—î –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è.

```typescript
// Payload, —è–∫–∏–π –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤—ñ–¥ react-beautiful-dnd
interface MoveTaskPayload {
  source: {
    droppableId: string; // ID –∫–æ–ª–æ–Ω–∫–∏ "–∑–≤—ñ–¥–∫–∏"
    index: number;       // –Ü–Ω–¥–µ–∫—Å "–∑–≤—ñ–¥–∫–∏"
  };
  destination: {
    droppableId: string; // ID –∫–æ–ª–æ–Ω–∫–∏ "–∫—É–¥–∏"
    index: number;       // –Ü–Ω–¥–µ–∫—Å "–∫—É–¥–∏"
  };
  draggableId: string;   // ID –∑–∞–≤–¥–∞–Ω–Ω—è
}
```

## Reducer Implementation

–í—ñ–¥–∫—Ä–∏—î–º–æ `boardSlice.ts` —ñ –¥–æ–¥–∞–º–æ –ª–æ–≥—ñ–∫—É. –ó–∞–≤–¥—è–∫–∏ Immer, —Ü–µ –±—É–¥–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —è–∫ –º–∞–≥—ñ—è.

```typescript [src/features/board/boardSlice.ts]
// ... imports

export const boardSlice = createSlice({
  name: 'board',
  initialState,
  reducers: {
    moveTask: (state, action: PayloadAction<MoveTaskPayload>) => {
      const { source, destination, draggableId } = action.payload;

      // 1. –û—Ç—Ä–∏–º—É—î–º–æ –∫–æ–ª–æ–Ω–∫–∏ (Immer –¥–æ–∑–≤–æ–ª—è—î –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –Ω–∞–ø—Ä—è–º—É)
      const startColumn = state.columns[source.droppableId];
      const finishColumn = state.columns[destination.droppableId];

      // –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –≤ —Ç—ñ–π —Å–∞–º—ñ–π –∫–æ–ª–æ–Ω—Ü—ñ
      if (startColumn === finishColumn) {
        const newTaskIds = Array.from(startColumn.taskIds);
        
        // –í–∏–¥–∞–ª—è—î–º–æ –∑—ñ —Å—Ç–∞—Ä–æ—ó –ø–æ–∑–∏—Ü—ñ—ó
        newTaskIds.splice(source.index, 1);
        // –í—Å—Ç–∞–≤–ª—è—î–º–æ –≤ –Ω–æ–≤—É –ø–æ–∑–∏—Ü—ñ—é
        newTaskIds.splice(destination.index, 0, draggableId);

        // –ü—Ä–∏—Å–≤–æ—é—î–º–æ (Immer —Ü–µ –æ–±—Ä–æ–±–∏—Ç—å)
        startColumn.taskIds = newTaskIds;
        return;
      }

      // –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –º—ñ–∂ –∫–æ–ª–æ–Ω–∫–∞–º–∏
      // –í–∏–¥–∞–ª—è—î–º–æ –∑ –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó
      startColumn.taskIds.splice(source.index, 1);
      
      // –î–æ–¥–∞—î–º–æ –≤ –∫—ñ–Ω—Ü–µ–≤—É
      finishColumn.taskIds.splice(destination.index, 0, draggableId);
    },
  },
});

export const { moveTask } = boardSlice.actions;
```

## –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤ React

–¢–µ–ø–µ—Ä –Ω–∞–º —Ç—Ä–µ–±–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ü–µ–π action –≤ `onDragEnd`.

```tsx [src/features/board/Board.tsx]
import { DragDropContext, DropResult } from '@hello-pangea/dnd';
import { useAppDispatch } from '../../app/hooks';
import { moveTask } from './boardSlice';

export const Board: React.FC = () => {
  const dispatch = useAppDispatch();
  // ... selectors

  const onDragEnd = (result: DropResult) => {
    const { destination, source, draggableId } = result;

    // –Ø–∫—â–æ –∫–∏–Ω—É–ª–∏ "–≤ –Ω—ñ–∫—É–¥–∏"
    if (!destination) return;

    // –Ø–∫—â–æ –∫–∏–Ω—É–ª–∏ —Ç—É–¥–∏ –∂, –¥–µ –≤–∑—è–ª–∏
    if (
      destination.droppableId === source.droppableId &&
      destination.index === source.index
    ) {
      return;
    }

    // –î—ñ—Å–ø–∞—Ç—á–∏–º–æ action!
    dispatch(moveTask({
      source,
      destination,
      draggableId
    }));
  };

  return (
    <DragDropContext onDragEnd={onDragEnd}>
      {/* ... render columns */}
    </DragDropContext>
  );
};
```

::note
–ú–∏ –æ–ø—É—Å—Ç–∏–ª–∏ –¥–µ—Ç–∞–ª—ñ —Ä–æ–∑–º—ñ—Ç–∫–∏ `<Droppable>` —Ç–∞ `<Draggable>` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö `Column` —Ç–∞ `Task`, —â–æ–± —Å—Ñ–æ–∫—É—Å—É–≤–∞—Ç–∏—Å—è –Ω–∞ –ª–æ–≥—ñ—Ü—ñ –¥–∞–Ω–∏—Ö. –í —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–æ–¥—ñ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±–≥–æ—Ä–Ω—É—Ç–∏ —Å–ø–∏—Å–∫–∏ –≤ —Ü—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏.
::

## –ß–æ–º—É —Ü–µ –∫—Ä—É—Ç–æ?

–ú–∏ —â–æ–π–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ —Å–∫–ª–∞–¥–Ω—É –ª–æ–≥—ñ–∫—É –∑–º—ñ–Ω–∏ –ø–æ—Ä—è–¥–∫—É –≤ –º–∞—Å–∏–≤–∞—Ö –∑–∞ 10 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É –∑–∞–≤–¥—è–∫–∏ Immer (`splice`). –í –∫–ª–∞—Å–∏—á–Ω–æ–º—É Redux –Ω–∞–º –¥–æ–≤–µ–ª–æ—Å—è –± —Ä–æ–±–∏—Ç–∏ –≥–ª–∏–±–æ–∫–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –º–∞—Å–∏–≤—ñ–≤ `taskIds`, —â–æ –∑–∞–π–Ω—è–ª–æ –± —Ä–∞–∑—ñ–≤ —É 3 –±—ñ–ª—å—à–µ –∫–æ–¥—É.

–ê–ª–µ —Ü–µ –ª–∏—à–µ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω. –Ø–∫—â–æ –º–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É, –∑–º—ñ–Ω–∏ –∑–Ω–∏–∫–Ω—É—Ç—å. –ù–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ü–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.

üëâ [–î–∞–ª—ñ: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ RTK Query](./05.rtk-query-integration.md)
