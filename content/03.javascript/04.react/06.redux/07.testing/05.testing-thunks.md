# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Async Thunks

–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –≤–∏–º–∞–≥–∞—î –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ –º–µ—Ä–µ–∂–µ–≤–∏–º–∏ –∑–∞–ø–∏—Ç–∞–º–∏. –ú–∏ –Ω–µ —Ö–æ—á–µ–º–æ —Ä–æ–±–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏ –Ω–∞ –±–µ–∫–µ–Ω–¥ –ø—ñ–¥ —á–∞—Å —Ç–µ—Å—Ç—ñ–≤.

## –ü—ñ–¥—Ö—ñ–¥ 1: Mocking API Module

–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–± ‚Äî –∑–∞–º–æ–∫–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é, —è–∫–∞ —Ä–æ–±–∏—Ç—å –∑–∞–ø–∏—Ç.

```javascript [features/users/usersSlice.test.js]
import { configureStore } from '@reduxjs/toolkit';
import usersReducer, { fetchUserById } from './usersSlice';
import * as api from '../../api/client'; // –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —É –Ω–∞—Å —î –º–æ–¥—É–ª—å API

// –ú–æ–∫–∞—î–º–æ –º–æ–¥—É–ª—å
jest.mock('../../api/client');

describe('fetchUserById thunk', () => {
  it('should fetch user successfully', async () => {
    // 1. –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –º–æ–∫
    const mockUser = { id: 1, name: 'Ivan' };
    api.getUser.mockResolvedValue(mockUser);

    // 2. –°—Ç–≤–æ—Ä—é—î–º–æ store
    const store = configureStore({ reducer: { users: usersReducer } });

    // 3. –î—ñ—Å–ø–∞—Ç—á–∏–º–æ thunk
    await store.dispatch(fetchUserById(1));

    // 4. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Å—Ç–∞–Ω
    const state = store.getState().users;
    expect(state.entities).toContainEqual(mockUser);
    expect(state.loading).toBe('succeeded');
  });

  it('should handle errors', async () => {
    // 1. –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –º–æ–∫ –Ω–∞ –ø–æ–º–∏–ª–∫—É
    api.getUser.mockRejectedValue(new Error('Network Error'));

    const store = configureStore({ reducer: { users: usersReducer } });

    await store.dispatch(fetchUserById(1));

    const state = store.getState().users;
    expect(state.loading).toBe('failed');
    expect(state.error).toBe('Network Error');
  });
});
```

## –ü—ñ–¥—Ö—ñ–¥ 2: MSW (Mock Service Worker)

–¶–µ –±—ñ–ª—å—à —Å—É—á–∞—Å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥. –ú–∏ –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î–º–æ –∑–∞–ø–∏—Ç–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ –º–µ—Ä–µ–∂—ñ. –¶–µ –¥–æ–∑–≤–æ–ª—è—î —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –∫–æ–¥ —Ç–∞–∫, —è–∫ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—ñ (—á–µ—Ä–µ–∑ `fetch`).

```javascript
import { setupServer } from 'msw/node';
import { rest } from 'msw';

// –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–∞
const server = setupServer(
  rest.get('/api/users/1', (req, res, ctx) => {
    return res(ctx.json({ id: 1, name: 'Ivan' }));
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

test('fetches user with MSW', async () => {
  const store = configureStore({ reducer: { users: usersReducer } });
  
  await store.dispatch(fetchUserById(1));
  
  expect(store.getState().users.entities[0].name).toBe('Ivan');
});
```

## –í–∏—Å–Ω–æ–≤–æ–∫

–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Redux ‚Äî —Ü–µ –Ω–µ "–¥–æ–¥–∞—Ç–∫–æ–≤–∞ —Ä–æ–±–æ—Ç–∞", –∞ —Å–ø–æ—Å—ñ–± —Å–ø–∞—Ç–∏ —Å–ø–æ–∫—ñ–π–Ω–æ. –ü–æ—á–Ω—ñ—Ç—å –∑ Unit —Ç–µ—Å—Ç—ñ–≤ –¥–ª—è —Ä—ñ–¥—é—Å–µ—Ä—ñ–≤ (—Ü–µ –Ω–∞–π–ª–µ–≥—à–µ), –∞ –ø–æ—Ç—ñ–º –¥–æ–¥–∞–≤–∞–π—Ç–µ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤.

üëâ [–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é](../index.md)
