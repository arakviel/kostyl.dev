---
title: –°–∏—Å—Ç–µ–º–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö MS SQL Server
description: –û–≥–ª—è–¥ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö SQL Server - master, model, msdb, tempdb —Ç–∞ —Å–∏—Å—Ç–µ–º–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ
---

# –°–∏—Å—Ç–µ–º–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö MS SQL Server

## –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö?

–ö–æ–ª–∏ –≤–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ SQL Server, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è **4 —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö**, —è–∫—ñ –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Ä–æ–±–æ—Ç—É –≤—Å—å–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞. –ë–µ–∑ –Ω–∏—Ö SQL Server –ø—Ä–æ—Å—Ç–æ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è!

::note
**–°–∏—Å—Ç–µ–º–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (System Databases)** ‚Äî —Ü–µ —Å–ª—É–∂–±–æ–≤—ñ –ë–î, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å –º–µ—Ç–∞–¥–∞–Ω—ñ, –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Ç–∞ —Ç–∏–º—á–∞—Å–æ–≤—ñ –æ–±'—î–∫—Ç–∏. –í–æ–Ω–∏ —î "–æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é" –¥–ª—è SQL Server.
::

---

##–û–≥–ª—è–¥ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö

### –°–ø–∏—Å–æ–∫ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ë–î

–£ –ø–∞–ø—Ü—ñ **System Databases** –≤ Object Explorer –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ:

::mermaid

```mermaid
graph TD
    SQLServer[SQL Server Instance] --> Master[master<br/>–ú–µ—Ç–∞–¥–∞–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞]
    SQLServer --> Model[model<br/>–®–∞–±–ª–æ–Ω –ë–î]
    SQLServer --> MSDB[msdb<br/>–ó–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ –±–µ–∫–∞–ø–∏]
    SQLServer --> TempDB[tempdb<br/>–¢–∏–º—á–∞—Å–æ–≤—ñ –æ–±'—î–∫—Ç–∏]

    style Master fill:#ef4444,color:#fff
    style Model fill:#f59e0b,color:#333
    style MSDB fill:#3b82f6,color:#fff
    style TempDB fill:#10b981,color:#fff
```

::

---

## 1. Master ‚Äî "–ú–æ–∑–æ–∫" SQL Server

::note
**master** ‚Äî –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∞ —Å–∏—Å—Ç–µ–º–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å **–≤—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–µ—Ä–≤–µ—Ä** —Ç–∞ –≤—Å—ñ —ñ–Ω—à—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.
::

### –©–æ –∑–±–µ—Ä—ñ–≥–∞—î master?

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è                | –©–æ –º—ñ—Å—Ç–∏—Ç—å                  | –ü—Ä–∏–∫–ª–∞–¥                                  |
| :----------------------- | :-------------------------- | :--------------------------------------- |
| **–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å–µ—Ä–≤–µ—Ä–∞** | –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è SQL Server     | Collation, memory limits, network config |
| **–õ–æ–≥—ñ–Ω–∏**               | –£—Å—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞ | `sa`, `DOMAIN\User`                      |
| **–ë–∞–∑–∏ –¥–∞–Ω–∏—Ö**           | –ú–µ—Ç–∞–¥–∞–Ω—ñ –≤—Å—ñ—Ö –ë–î            | –ù–∞–∑–≤–∏, —à–ª—è—Ö–∏ –¥–æ —Ñ–∞–π–ª—ñ–≤, —Å—Ç–∞—Ç—É—Å           |
| **–°–∏—Å—Ç–µ–º–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏**   | –í–±—É–¥–æ–≤–∞–Ω—ñ stored procedures | `sp_configure`, `sp_who`                 |

### –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥

```sql
-- –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
SELECT name, database_id, create_date, state_desc
FROM master.sys.databases;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

```
name         database_id  create_date              state_desc
------------ ------------ ----------------------- ----------
master       1            2003-04-08 09:13:36     ONLINE
tempdb       2            2024-02-06 08:00:00     ONLINE
model        3            2003-04-08 09:13:36     ONLINE
msdb         4            2005-10-14 17:21:38     ONLINE
University   5            2024-02-06 10:30:00     ONLINE
```

### –ö—Ä–∏—Ç–∏—á–Ω–∞ –≤–∞–∂–ª–∏–≤—ñ—Å—Ç—å

::warning
**–ë–ï–ó master SQL Server –ù–ï –ó–ê–ü–£–°–¢–ò–¢–¨–°–Ø!**

–Ø–∫—â–æ –±–∞–∑–∞ master –ø–æ—à–∫–æ–¥–∂–µ–Ω–∞ –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–∞:

- SQL Server –Ω–µ —Å—Ç–∞—Ä—Ç—É—î
- –í—Ç—Ä–∞—á–µ–Ω–æ –≤—Å—ñ –º–µ—Ç–∞–¥–∞–Ω—ñ –ø—Ä–æ —ñ–Ω—à—ñ –ë–î
- –ü–æ—Ç—Ä—ñ–±–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ –±–µ–∫–∞–ø—É –∞–±–æ –ø–æ–≤–Ω–µ –ø–µ—Ä–µ—ñ–Ω—Å—Ç–∞–ª—é–≤–∞–Ω–Ω—è

::

**Best Practice**: –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ–±—ñ—Ç—å –±–µ–∫–∞–ø master!

```sql
BACKUP DATABASE master
TO DISK = 'C:\Backups\master_backup.bak'
WITH FORMAT, INIT;
```

---

## 2. Model ‚Äî –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤–∏—Ö –ë–î

::note
**model** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–∏—Ö-—à–∞–±–ª–æ–Ω, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫ **–∑—Ä–∞–∑–æ–∫** –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –±—É–¥—å-—è–∫–æ—ó –Ω–æ–≤–æ—ó –ë–î.
::

### –Ø–∫ –ø—Ä–∞—Ü—é—î model?

–ö–æ–ª–∏ –≤–∏ –≤–∏–∫–æ–Ω—É—î—Ç–µ `CREATE DATABASE`, SQL Server:

1. **–ö–æ–ø—ñ—é—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É model** ‚Üí –Ω–æ–≤–∞ –ë–î
2. **–ó–∞—Å—Ç–æ—Å–æ–≤—É—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è model** ‚Üí –¥–æ –Ω–æ–≤–æ—ó –ë–î

::mermaid

```mermaid
graph LR
    Model[model<br/>–ë–∞–∑–∞-—à–∞–±–ª–æ–Ω] -->|–∫–æ–ø—ñ—é—î| NewDB1[–ù–æ–≤–∞ –ë–î #1]
    Model -->|–∫–æ–ø—ñ—é—î| NewDB2[–ù–æ–≤–∞ –ë–î #2]
    Model -->|–∫–æ–ø—ñ—é—î| NewDB3[–ù–æ–≤–∞ –ë–î #3]

    style Model fill:#f59e0b,color:#333
    style NewDB1 fill:#3b82f6,color:#fff
    style NewDB2 fill:#3b82f6,color:#fff
    style NewDB3 fill:#3b82f6,color:#fff
```

::

### –ü—Ä–∞–∫—Ç–∏—á–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

**–°—Ü–µ–Ω–∞—Ä—ñ–π**: –í—Å—ñ –≤–∞—à—ñ –ë–î –ø–æ–≤–∏–Ω–Ω—ñ –º–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é `AuditLog`.

```sql
-- –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é –≤ model
USE model;
GO

CREATE TABLE AuditLog (
    log_id INT IDENTITY(1,1) PRIMARY KEY,
    event_type NVARCHAR(50),
    event_time DATETIME2 DEFAULT SYSDATETIME(),
    username NVARCHAR(100)
);
GO
```

–¢–µ–ø–µ—Ä **–∫–æ–∂–Ω–∞ –Ω–æ–≤–∞ –ë–î** –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –º–∞—Ç–∏–º–µ —Ü—é —Ç–∞–±–ª–∏—Ü—é!

```sql
-- –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤—É –ë–î
CREATE DATABASE TestDB;
GO

-- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ
USE TestDB;
SELECT * FROM AuditLog;  -- ‚úÖ –¢–∞–±–ª–∏—Ü—è –≤–∂–µ —ñ—Å–Ω—É—î!
```

::tip
**–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ model –¥–ª—è:

- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å (audit, logging)
- –¢–∏–ø–æ–≤–∏—Ö stored procedures
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (recovery model, compatibility level)

::

---

## 3. MSDB ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è —Ç–∞ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è

::note
**msdb** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ **–∑–∞–≤–¥–∞–Ω–Ω—è**, **–±–µ–∫–∞–ø–∏**, **–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** —Ç–∞ **—Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—é**.
::

### –©–æ –∑–±–µ—Ä—ñ–≥–∞—î msdb?

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç                 | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è              | –¢–∞–±–ª–∏—Ü—ñ                                     |
| :------------------------ | :----------------------- | :------------------------------------------ |
| **SQL Server Agent Jobs** | –†–æ–∑–∫–ª–∞–¥ –∑–∞–≤–¥–∞–Ω—å          | `sysjobs`, `sysjobsteps`, `sysjobhistory`   |
| **Backups**               | –Ü—Å—Ç–æ—Ä—ñ—è –±–µ–∫–∞–ø—ñ–≤          | `backupset`, `backupfile`, `restorehistory` |
| **Alerts**                | –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–¥—ñ—ó     | `sysalerts`                                 |
| **Operators**             | –ö–æ–Ω—Ç–∞–∫—Ç–∏ –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å | `sysoperators`                              |
| **Database Mail**         | Email –∑ SQL Server       | `sysmail_mailitems`                         |

### –ü—Ä–∏–∫–ª–∞–¥: –Ü—Å—Ç–æ—Ä—ñ—è –±–µ–∫–∞–ø—ñ–≤

```sql
-- –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –≤—Å—ñ—Ö –±–µ–∫–∞–ø—ñ–≤ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ–π –º—ñ—Å—è—Ü—å
SELECT
    database_name,
    backup_start_date,
    backup_finish_date,
    CASE type
        WHEN 'D' THEN 'Full'
        WHEN 'I' THEN 'Differential'
        WHEN 'L' THEN 'Log'
    END AS backup_type,
    backup_size / 1024 / 1024 AS size_mb,
    physical_device_name
FROM msdb.dbo.backupset bs
INNER JOIN msdb.dbo.backupmediafamily bmf
    ON bs.media_set_id = bmf.media_set_id
WHERE backup_start_date >= DATEADD(MONTH, -1, GETDATE())
ORDER BY backup_start_date DESC;
```

### SQL Server Agent Jobs

**–ü—Ä–∏–∫–ª–∞–¥**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –±–µ–∫–∞–ø —â–æ–Ω–æ—á—ñ –æ 2:00

```sql
USE msdb;
GO

-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è
EXEC sp_add_job
    @job_name = 'Nightly Backup',
    @enabled = 1;

-- –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫—Ä–æ–∫—É
EXEC sp_add_jobstep
    @job_name = 'Nightly Backup',
    @step_name = 'Backup University DB',
    @subsystem = 'TSQL',
    @command = N'
        BACKUP DATABASE University
        TO DISK = N''C:\Backups\University_backup.bak''
        WITH INIT, COMPRESSION;
    ';

-- –†–æ–∑–∫–ª–∞–¥: —â–æ–¥–Ω—è –æ 02:00
EXEC sp_add_schedule
    @schedule_name = 'Daily at 2 AM',
    @freq_type = 4,  -- Daily
    @active_start_time = 020000;  -- 02:00:00

-- –ü—Ä–∏–≤'—è–∑–∫–∞ —Ä–æ–∑–∫–ª–∞–¥—É –¥–æ –∑–∞–≤–¥–∞–Ω–Ω—è
EXEC sp_attach_schedule
    @job_name = 'Nightly Backup',
    @schedule_name = 'Daily at 2 AM';

-- –ü—Ä–∏–≤'—è–∑–∫–∞ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
EXEC sp_add_jobserver
    @job_name = 'Nightly Backup';
```

---

## 4. TempDB ‚Äî –¢–∏–º—á–∞—Å–æ–≤—ñ –æ–±'—î–∫—Ç–∏

::note
**tempdb** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è **—Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å**, **–∑–º—ñ–Ω–Ω–∏—Ö table**, **—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è** —Ç–∞ —ñ–Ω—à–∏—Ö –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –¥–∞–Ω–∏—Ö.
::

### –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ tempdb

1. **–ü–µ—Ä–µ—Å–æ–∑–¥–∞—î—Ç—å—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É** SQL Server
2. **–°–ø—ñ–ª—å–Ω–∞ –¥–ª—è –í–°–Ü–• –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** —Ç–∞ –≤—Å—ñ—Ö –ë–î
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—á–∏—â—É—î—Ç—å—Å—è**

::warning
**–ö–†–ò–¢–ò–ß–ù–û**: tempdb ‚Äî —Ü–µ –≤—É–∑—å–∫–µ –º—ñ—Å—Ü–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ! –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤–∞–∂–ª–∏–≤–∞.
::

### –©–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ tempdb?

::tabs
::tabs-item{label="–¢–∏–º—á–∞—Å–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ"}

```sql
-- –õ–æ–∫–∞–ª—å–Ω–∞ —Ç–∏–º—á–∞—Å–æ–≤–∞ —Ç–∞–±–ª–∏—Ü—è (#)
CREATE TABLE #TempProducts (
    product_id INT,
    name NVARCHAR(100)
);
-- –í–∏–¥–∞–ª—è—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å–µ—Å—ñ—ó

-- –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ç–∏–º—á–∞—Å–æ–≤–∞ —Ç–∞–±–ª–∏—Ü—è (##)
CREATE TABLE ##GlobalTemp (
    data NVARCHAR(50)
);
-- –î–æ—Å—Ç—É–ø–Ω–∞ –≤—Å—ñ–º —Å–µ—Å—ñ—è–º, –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Å–µ—Å—ñ—ó
```

::

::tabs-item{label="–ó–º—ñ–Ω–Ω—ñ TABLE"}

```sql
DECLARE @ProductsTable TABLE (
    product_id INT,
    name NVARCHAR(100)
);

INSERT INTO @ProductsTable VALUES (1, 'Laptop');
-- –í–∏–¥–∞–ª—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è batch
```

::

::tabs-item{label="–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó"}

- **–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö –Ω–∞–±–æ—Ä—ñ–≤** (`ORDER BY` –±–µ–∑ —ñ–Ω–¥–µ–∫—Å—ñ–≤)
- **–•–µ—à-—Ç–∞–±–ª–∏—Ü—ñ** –¥–ª—è JOIN
- **Spool –æ–ø–µ—Ä–∞—Ü—ñ—ó**
- **–í–µ—Ä—Å—ñ—ó —Ä—è–¥–∫—ñ–≤** (snapshot isolation)

::

::

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è tempdb

::code-group

```sql [–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è]
-- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è tempdb –ø–æ –æ–±'—î–∫—Ç–∞—Ö
SELECT
    OBJECT_NAME(object_id) AS object_name,
    SUM(user_object_reserved_page_count) * 8 / 1024 AS user_objects_mb,
    SUM(internal_object_reserved_page_count) * 8 / 1024 AS internal_objects_mb
FROM tempdb.sys.dm_db_session_space_usage
GROUP BY object_id
ORDER BY user_objects_mb DESC;
```

```sql [Best Practices]
-- 1. –ú–Ω–æ–∂–∏–Ω–Ω—ñ —Ñ–∞–π–ª–∏ (= –∫—ñ–ª—å–∫—ñ—Å—Ç—å CPU cores)
-- –ó–º–µ–Ω—à—É—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–Ω—ñ—Å—Ç—å PFS/GAM pages

-- 2. –û–¥–Ω–∞–∫–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—ñ–≤
-- –ó–∞–±–µ–∑–ø–µ—á—É—î –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è

-- 3. Pre-size tempdb
ALTER DATABASE tempdb
MODIFY FILE (NAME = tempdev, SIZE = 8192MB);

-- 4. –†–æ–∑–º—ñ—â–µ–Ω–Ω—è –Ω–∞ —à–≤–∏–¥–∫–æ–º—É –¥–∏—Å–∫—É (SSD)
```

::

---

## –°–∏—Å—Ç–µ–º–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ

–ö–æ–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–∞ –ë–î –º—ñ—Å—Ç–∏—Ç—å —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏.

### –í–∞–∂–ª–∏–≤—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ –≤ msdb

```sql
-- –¢–∞–±–ª–∏—Ü—ñ –±–µ–∫–∞–ø—ñ–≤
USE msdb;
GO

SELECT TABLE_NAME
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_NAME LIKE '%backup%'
ORDER BY TABLE_NAME;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

- `backupfile` ‚Äî —Ñ–∞–π–ª–∏ –±–µ–∫–∞–ø—ñ–≤
- `backupfilegroup` ‚Äî filegroups –≤ –±–µ–∫–∞–ø–∞—Ö
- `backupmediafamily` ‚Äî –º–µ–¥—ñ–∞-—Å—ñ–º'—ó –±–µ–∫–∞–ø—ñ–≤
- `backupmediaset` ‚Äî –º–µ–¥—ñ–∞-–Ω–∞–±–æ—Ä–∏
- `backupset` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –±–µ–∫–∞–ø–∏
- `restorefile` ‚Äî –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏
- `restorefilegroup` ‚Äî –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω—ñ filegroups
- `restorehistory` ‚Äî —ñ—Å—Ç–æ—Ä—ñ—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω—å

### –°–∏—Å—Ç–µ–º–Ω—ñ views (sys.\*)

SQL Server –Ω–∞–¥–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ **system views** –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö:

```sql
-- –í—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ –≤ –ø–æ—Ç–æ—á–Ω—ñ–π –ë–î
SELECT name, object_id, create_date
FROM sys.tables
ORDER BY name;

-- –í—Å—ñ —Å—Ç–æ–≤–ø—Ü—ñ —Ç–∞–±–ª–∏—Ü—ñ
SELECT
    c.name AS column_name,
    t.name AS data_type,
    c.max_length,
    c.is_nullable
FROM sys.columns c
INNER JOIN sys.types t ON c.user_type_id = t.user_type_id
WHERE object_id = OBJECT_ID('Students')
ORDER BY c.column_id;

-- –í—Å—ñ —ñ–Ω–¥–µ–∫—Å–∏
SELECT
    OBJECT_NAME(object_id) AS table_name,
    name AS index_name,
    type_desc,
    is_unique,
    is_primary_key
FROM sys.indexes
WHERE object_id = OBJECT_ID('Students');
```

---

## DMVs (Dynamic Management Views)

**DMV** ‚Äî —Ü–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ views, —è–∫—ñ –ø–æ–∫–∞–∑—É—é—Ç—å **–ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω** SQL Server.

### –ü–æ–ø—É–ª—è—Ä–Ω—ñ DMVs

::code-group

```sql [–ê–∫—Ç–∏–≤–Ω—ñ –∑–∞–ø–∏—Ç–∏]
-- –©–æ –∑–∞—Ä–∞–∑ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ?
SELECT
    session_id,
    status,
    command,
    cpu_time,
    total_elapsed_time,
    reads,
    writes,
    TEXT
FROM sys.dm_exec_requests
CROSS APPLY sys.dm_exec_sql_text(sql_handle);
```

```sql [–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á—ñ–∫—É–≤–∞–Ω—å]
-- –ù–∞ —â–æ —á–µ–∫–∞—î SQL Server?
SELECT
    wait_type,
    waiting_tasks_count,
    wait_time_ms / 1000.0 AS wait_time_sec,
    max_wait_time_ms / 1000.0 AS max_wait_sec
FROM sys.dm_os_wait_stats
WHERE wait_time_ms > 0
ORDER BY wait_time_ms DESC;
```

```sql [–ö–µ—à –∑–∞–ø–∏—Ç—ñ–≤]
-- –ù–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à—ñ –∑–∞–ø–∏—Ç–∏
SELECT TOP 10
    creation_time,
    last_execution_time,
    execution_count,
    total_worker_time / execution_count AS avg_cpu_time,
    TEXT
FROM sys.dm_exec_query_stats
CROSS APPLY sys.dm_exec_sql_text(sql_handle)
ORDER BY total_worker_time DESC;
```

::

---

## Best Practices –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ë–î

::tip
**–ó–æ–ª–æ—Ç—ñ –ø—Ä–∞–≤–∏–ª–∞**:

1. **.–ù–Ü–ö–û–õ–ò –Ω–µ –≤–∏–¥–∞–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ñ –ë–î**
2. **–ù–ï —Å—Ç–≤–æ—Ä—é–π—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –æ–±'—î–∫—Ç–∏** –≤ master, model, msdb
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ–±—ñ—Ç—å –±–µ–∫–∞–ø–∏**:
    - `master` ‚Äî –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –∑–º—ñ–Ω–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
    - `msdb` ‚Äî —â–æ—Ç–∏–∂–Ω—è (–∑–∞–≤–¥–∞–Ω–Ω—è, —ñ—Å—Ç–æ—Ä—ñ—è –±–µ–∫–∞–ø—ñ–≤)
    - `model` ‚Äî –ø—ñ—Å–ª—è –∑–º—ñ–Ω —à–∞–±–ª–æ–Ω—É
4. **–ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ tempdb** ‚Äî —á–∞—Å—Ç–æ —Å—Ç–∞—î –≤—É–∑—å–∫–∏–º –º—ñ—Å—Ü–µ–º
5. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É —ñ—Å—Ç–æ—Ä—ñ—ó** –≤ msdb

::

### –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —ñ—Å—Ç–æ—Ä—ñ—ó –±–µ–∫–∞–ø—ñ–≤

```sql
-- –û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é —Å—Ç–∞—Ä—à–µ 30 –¥–Ω—ñ–≤
EXEC msdb.dbo.sp_delete_backuphistory
    @oldest_date = DATEADD(DAY, -30, GETDATE());

-- –û—á–∏—Å—Ç–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –∑–∞–≤–¥–∞–Ω—å —Å—Ç–∞—Ä—à–µ 90 –¥–Ω—ñ–≤
EXEC msdb.dbo.sp_purge_jobhistory
    @oldest_date = DATEADD(DAY, -90, GETDATE());
```

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –±–µ–∫–∞–ø—ñ–≤

–°—Ç–≤–æ—Ä—ñ—Ç—å –∑–∞–ø–∏—Ç, —è–∫–∏–π –ø–æ–∫–∞–∑—É—î:

- –Ø–∫—ñ –ë–î –Ω–µ –º–∞–ª–∏ full backup –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤
- –ö–æ–ª–∏ –±—É–≤ –æ—Å—Ç–∞–Ω–Ω—ñ–π –±–µ–∫–∞–ø –¥–ª—è –∫–æ–∂–Ω–æ—ó –ë–î

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
SELECT
    d.name AS database_name,
    MAX(bs.backup_finish_date) AS last_backup,
    DATEDIFF(DAY, MAX(bs.backup_finish_date), GETDATE()) AS days_since_backup
FROM master.sys.databases d
LEFT JOIN msdb.dbo.backupset bs
    ON d.name = bs.database_name
    AND bs.type = 'D'  -- Full backup
WHERE d.database_id > 4  -- Exclude system databases
GROUP BY d.name
HAVING MAX(bs.backup_finish_date) < DATEADD(DAY, -7, GETDATE())
    OR MAX(bs.backup_finish_date) IS NULL
ORDER BY days_since_backup DESC;
```

</details>

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è tempdb

–ó–Ω–∞–π–¥—ñ—Ç—å —Ç–æ–ø-5 —Å–µ—Å—ñ–π, —è–∫—ñ –Ω–∞–π–±—ñ–ª—å—à–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å tempdb.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
SELECT TOP 5
    session_id,
    DB_NAME(database_id) AS database_name,
    user_objects_alloc_page_count * 8 / 1024 AS user_objects_mb,
    internal_objects_alloc_page_count * 8 / 1024 AS internal_objects_mb,
    (user_objects_alloc_page_count + internal_objects_alloc_page_count) * 8 / 1024 AS total_mb
FROM tempdb.sys.dm_db_session_space_usage
WHERE session_id > 50  -- Exclude system sessions
ORDER BY total_mb DESC;
```

</details>

---

## –†–µ–∑—é–º–µ

::tip
**–ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏**:

1. **master** ‚Äî –º–µ—Ç–∞–¥–∞–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞, –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è —Ä–æ–±–æ—Ç–∏
2. **model** ‚Äî —à–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤–∏—Ö –ë–î, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—ó
3. **msdb** ‚Äî –∑–∞–≤–¥–∞–Ω–Ω—è, –±–µ–∫–∞–ø–∏, —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
4. **tempdb** ‚Äî —Ç–∏–º—á–∞—Å–æ–≤—ñ –æ–±'—î–∫—Ç–∏, –ø–æ—Ç—Ä–µ–±—É—î –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
5. **–°–∏—Å—Ç–µ–º–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ç–∞ DMVs** ‚Äî –¥–∂–µ—Ä–µ–ª–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Å—Ç–∞–Ω —Å–µ—Ä–≤–µ—Ä–∞

::

**–ù–∞—Å—Ç—É–ø–Ω–∞ —Ç–µ–º–∞**: [–û–≥–ª—è–¥ –º–æ–≤–∏ SQL —Ç–∞ –∑–∞–ø–∏—Ç—ñ–≤](./05.sql-queries-overview.md)
