---
title: –Ü–Ω–¥–µ–∫—Å–∏ —É MS SQL Server
description: –ü–æ–≤–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∑ —ñ–Ω–¥–µ–∫—Å—ñ–≤ SQL Server - B-Tree —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ —Ç–∞ –Ω–µ–∫–ª–∞—Å—Ç–µ—Ä–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏, –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
---

# –Ü–Ω–¥–µ–∫—Å–∏ —É MS SQL Server

## –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–≤—ñ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏

–£—è–≤—ñ—Ç—å –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –∑ **–º—ñ–ª—å–π–æ–Ω–æ–º –∫–Ω–∏–≥**, —Ä–æ–∑—Å—Ç–∞–≤–ª–µ–Ω–∏—Ö —É –≤–∏–ø–∞–¥–∫–æ–≤–æ–º—É –ø–æ—Ä—è–¥–∫—É. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞–π—Ç–∏ –∫–Ω–∏–≥—É "–ö–æ–±–∑–∞—Ä" –¢–∞—Ä–∞—Å–∞ –®–µ–≤—á–µ–Ω–∫–∞. –°–∫—ñ–ª—å–∫–∏ —á–∞—Å—É —Ü–µ –∑–∞–π–º–µ?

**–ë–µ–∑ –∫–∞—Ç–∞–ª–æ–≥—É (—ñ–Ω–¥–µ–∫—Å—É)**: –í–∏ –ø–µ—Ä–µ–≥–ª—è–¥–∞—î—Ç–µ –ö–û–ñ–ù–£ –∫–Ω–∏–≥—É –ø–æ —á–µ—Ä–∑—ñ. –£ –≥—ñ—Ä—à–æ–º—É –≤–∏–ø–∞–¥–∫—É ‚Äî –≤—Å—ñ –º—ñ–ª—å–π–æ–Ω –∫–Ω–∏–≥.  
**–ó –∫–∞—Ç–∞–ª–æ–≥–æ–º (—ñ–Ω–¥–µ–∫—Å–æ–º)**: –í–∏ —à—É–∫–∞—î—Ç–µ –≤ –∞–ª—Ñ–∞–≤—ñ—Ç–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–∑—ñ "–®–µ–≤—á–µ–Ω–∫–æ" ‚Üí –æ—Ç—Ä–∏–º—É—î—Ç–µ –Ω–æ–º–µ—Ä –ø–æ–ª–∏—Ü—ñ ‚Üí –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ –∫–Ω–∏–≥—É –∑–∞ —Ö–≤–∏–ª–∏–Ω–∏.

–¢–∞–∫ —Å–∞–º–æ –ø—Ä–∞—Ü—é—é—Ç—å —ñ–Ω–¥–µ–∫—Å–∏ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö!

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ–±–ª–µ–º–∏

```sql
-- –¢–∞–±–ª–∏—Ü—è –∑ 10 –º—ñ–ª—å–π–æ–Ω–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ë–ï–ó —ñ–Ω–¥–µ–∫—Å—É
CREATE TABLE Users (
    user_id INT PRIMARY KEY,
    email NVARCHAR(100),
    first_name NVARCHAR(50),
    last_name NVARCHAR(50),
    registration_date DATE
);

-- –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ email
SELECT * FROM Users WHERE email = 'ivan@example.com';
-- ‚è±Ô∏è –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: ~15 —Å–µ–∫—É–Ω–¥
-- üîç –ú–µ—Ç–æ–¥: TABLE SCAN (–ø–µ—Ä–µ–≥–ª—è–¥ –í–°–Ü–• 10 –º–ª–Ω —Ä—è–¥–∫—ñ–≤)
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º?**  
SQL Server **–ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ö–û–ñ–ï–ù —Ä—è–¥–æ–∫** —Ç–∞–±–ª–∏—Ü—ñ, –ø–æ–∫–∏ –Ω–µ –∑–Ω–∞–π–¥–µ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π email. –¶–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è **Table Scan** (–ø–æ–≤–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ).

::warning
**Critical Performance Problem**: Table Scan –Ω–∞ –≤–µ–ª–∏–∫–∏—Ö —Ç–∞–±–ª–∏—Ü—è—Ö ‚Äî —Ü–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ!
::

–¢–µ–ø–µ—Ä –¥–æ–¥–∞–º–æ —ñ–Ω–¥–µ–∫—Å:

```sql
-- –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–Ω–¥–µ–∫—Å –Ω–∞ —Å—Ç–æ–≤–ø–µ—Ü—å email
CREATE INDEX IX_Users_Email ON Users(email);

-- –¢–æ–π —Å–∞–º–∏–π –∑–∞–ø–∏—Ç
SELECT * FROM Users WHERE email = 'ivan@example.com';
-- ‚è±Ô∏è –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: ~0.001 —Å–µ–∫—É–Ω–¥–∏ (—É —Ç–∏—Å—è—á—ñ —Ä–∞–∑—ñ–≤ —à–≤–∏–¥—à–µ!)
-- üîç –ú–µ—Ç–æ–¥: INDEX SEEK (–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—É)
```

::tip
**–ü—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è —É 15,000 —Ä–∞–∑—ñ–≤** ‚Äî —Ü–µ –Ω–µ –º–∞–≥—ñ—è, —Ü–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤!
::

---

## –©–æ —Ç–∞–∫–µ —ñ–Ω–¥–µ–∫—Å?

::note
**–Ü–Ω–¥–µ–∫—Å (Index)** ‚Äî —Ü–µ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –∫–æ–ø—ñ—é –ø–µ–≤–Ω–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤ —Ç–∞–±–ª–∏—Ü—ñ, –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—É –æ—Å–æ–±–ª–∏–≤–∏–º —á–∏–Ω–æ–º –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É.
::

### –ê–Ω–∞–ª–æ–≥—ñ—è –∑ –∫–Ω–∏–≥–æ—é

| –ï–ª–µ–º–µ–Ω—Ç –∫–Ω–∏–≥–∏       | –ï–ª–µ–º–µ–Ω—Ç –ë–î           | –ü–æ—è—Å–Ω–µ–Ω–Ω—è                                           |
| :------------------ | :------------------- | :-------------------------------------------------- |
| –ó–º—ñ—Å—Ç               | –Ü–Ω–¥–µ–∫—Å               | –í–∫–∞–∑—É—î, –¥–µ –∑–Ω–∞–π—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é               |
| –ù–æ–º–µ—Ä–∏ —Å—Ç–æ—Ä—ñ–Ω–æ–∫     | –ü–æ–∫–∞–∂—á–∏–∫–∏ (Pointers) | –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ                           |
| –°—Ç–æ—Ä—ñ–Ω–∫–∏ –∑ —Ç–µ–∫—Å—Ç–æ–º  | –î–∞–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ         | –†–µ–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è                                  |
| –ê–ª—Ñ–∞–≤—ñ—Ç–Ω–∏–π –ø–æ–∫–∞–∂—á–∏–∫ | Non-Clustered Index  | –î–æ–¥–∞—Ç–∫–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø–æ—à—É–∫—É –∑–∞ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ |

### –ö–ª—é—á–æ–≤—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —ñ–Ω–¥–µ–∫—Å—É

::mermaid

```mermaid
graph TD
    A[–Ü–Ω–¥–µ–∫—Å] --> B[–ö–ª—é—á–æ–≤—ñ —Å—Ç–æ–≤–ø—Ü—ñ]
    A --> C[–ü–æ–∫–∞–∂—á–∏–∫–∏]
    A --> D[–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è]

    B --> B1[–í—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è]
    C --> C1[RID –∞–±–æ Clustered Key]
    D --> D1[B-Tree]

    style A fill:#f59e0b,color:#333
    style B fill:#3b82f6,color:#fff
    style C fill:#10b981,color:#fff
    style D fill:#8b5cf6,color:#fff
```

::

---

## –í–Ω—É—Ç—Ä—ñ—à–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: Pages —Ç–∞ Extents

### –ù–∞–≤—ñ—â–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—É –∑–Ω–∞—Ç–∏ –ø—Ä–æ Pages?

**–ü–∏—Ç–∞–Ω–Ω—è**: "–ß–æ–º—É SQL Server —á–∏—Ç–∞—î 8 KB –¥–∞–Ω–∏—Ö, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –º–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–µ–Ω –ª–∏—à–µ 1 —Ä—è–¥–æ–∫ —Ä–æ–∑–º—ñ—Ä–æ–º 100 –±–∞–π—Ç?"

**–í—ñ–¥–ø–æ–≤—ñ–¥—å**: –ë–æ SQL Server —á–∏—Ç–∞—î –¥–∞–Ω—ñ **—Ü—ñ–ª–∏–º–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º–∏ (pages)**, –∞ –Ω–µ –æ–∫—Ä–µ–º–∏–º–∏ —Ä—è–¥–∫–∞–º–∏!

::warning
**–¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ!** –†–æ–∑—É–º—ñ–Ω–Ω—è pages –ø–æ—è—Å–Ω—é—î:

- –ß–æ–º—É —à–∏—Ä–æ–∫—ñ —Ä—è–¥–∫–∏ —Å–ø–æ–≤—ñ–ª—å–Ω—é—é—Ç—å –∑–∞–ø–∏—Ç–∏
- –ß–æ–º—É `SELECT *` –ø–æ–≥–∞–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞
- –Ø–∫ —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ –¥–∏—Å–∫—É
- –ß–æ–º—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è ‚Äî —Ü–µ –ø—Ä–æ–±–ª–µ–º–∞

::

---

### –©–æ —Ç–∞–∫–µ Page (–°—Ç–æ—Ä—ñ–Ω–∫–∞)?

::note
**Page** ‚Äî —Ü–µ **–∞—Ç–æ–º–∞—Ä–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è –≤–≤–æ–¥—É/–≤–∏–≤–æ–¥—É (I/O)** —É SQL Server.  
–†–æ–∑–º—ñ—Ä: **8 KB (8192 –±–∞–π—Ç–∏)**.  
SQL Server **–ó–ê–í–ñ–î–ò** —á–∏—Ç–∞—î —Ç–∞ –ø–∏—à–µ –¥–∞–Ω—ñ —Ü—ñ–ª–∏–º–∏ pages, –Ω–∞–≤—ñ—Ç—å –¥–ª—è 1 —Ä—è–¥–∫–∞!
::

#### –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è Page –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏

–£—è–≤—ñ–º–æ —Ç–∞–±–ª–∏—Ü—é `Employees`:

```sql
CREATE TABLE Employees (
    employee_id INT,          -- 4 –±–∞–π—Ç–∏
    first_name NVARCHAR(50),  -- –¥–æ 100 –±–∞–π—Ç (Unicode)
    last_name NVARCHAR(50),   -- –¥–æ 100 –±–∞–π—Ç
    salary DECIMAL(10,2),     -- 5 –±–∞–π—Ç
    hire_date DATE            -- 3 –±–∞–π—Ç–∏
);
-- –ü—Ä–∏–±–ª–∏–∑–Ω–æ 212 –±–∞–π—Ç –Ω–∞ —Ä—è–¥–æ–∫
```

**–°–∫—ñ–ª—å–∫–∏ —Ä—è–¥–∫—ñ–≤ –≤–ª—ñ–∑–µ –≤ –æ–¥–Ω—É page?**

```
Page size = 8192 –±–∞–π—Ç–∏
- Header = 96 –±–∞–π—Ç
- Row Offset Array = 36 –±–∞–π—Ç
= 8060 –±–∞–π—Ç –¥–ª—è –¥–∞–Ω–∏—Ö

–†—è–¥–∫—ñ–≤ –Ω–∞ page: 8060 / 212 ‚âà 38 —Ä—è–¥–∫—ñ–≤
```

::mermaid

```mermaid
graph TB
    subgraph "Page - 8 KB"
        Header[Header - 96 bytes<br/>üìã –ú–µ—Ç–∞–¥–∞–Ω—ñ page]

        Data[Data - 8060 bytes<br/>üë• 38 —Ä—è–¥–∫—ñ–≤ Employees]

        Offset[Row Offset Array - 36 bytes<br/>üìç –ü–æ–∫–∞–∂—á–∏–∫–∏ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ —Ä—è–¥–∫—ñ–≤]
    end

    Header --> Data
    Data --> Offset

    style Header fill:#ef4444,color:#fff
    style Data fill:#10b981,color:#fff
    style Offset fill:#3b82f6,color:#fff
```

::

#### –©–æ –∑–±–µ—Ä—ñ–≥–∞—î Header (96 –±–∞–π—Ç)?

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PAGE HEADER (96 bytes)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ Page Type (data/index)         ‚îÇ ‚Üê –¢–∏–ø —Å—Ç–æ—Ä—ñ–Ω–∫–∏
‚îÇ ‚Ä¢ Object ID                      ‚îÇ ‚Üê –Ø–∫—ñ–π —Ç–∞–±–ª–∏—Ü—ñ –Ω–∞–ª–µ–∂–∏—Ç—å
‚îÇ ‚Ä¢ Free Space (bytes)             ‚îÇ ‚Üê –°–∫—ñ–ª—å–∫–∏ –≤—ñ–ª—å–Ω–æ–≥–æ –º—ñ—Å—Ü—è
‚îÇ ‚Ä¢ Previous Page ID               ‚îÇ ‚Üê –ü–æ–¥–≤—ñ–π–Ω–æ –∑–≤'—è–∑–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫
‚îÇ ‚Ä¢ Next Page ID                   ‚îÇ ‚Üê –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è
‚îÇ ‚Ä¢ Slot Count                     ‚îÇ ‚Üê –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### –†–µ–∞–ª—å–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥: –í–ø–ª–∏–≤ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

::tabs
::tabs-item{label="–ü—Ä–æ–±–ª–µ–º–∞: SELECT \*"}

```sql
-- ‚ùå –ü–û–ì–ê–ù–û: –ß–∏—Ç–∞—î –≤—Å—ñ 212 –±–∞–π—Ç * 38 —Ä—è–¥–∫—ñ–≤ = 8060 –±–∞–π—Ç
SELECT * FROM Employees WHERE employee_id = 123;

-- SQL Server:
-- 1. –ß–∏—Ç–∞—î –ü–û–í–ù–£ page (8 KB) –∑ –¥–∏—Å–∫–∞
-- 2. –®—É–∫–∞—î –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —Ä—è–¥–æ–∫
-- 3. –ü–æ–≤–µ—Ä—Ç–∞—î –í–°–Ü —Å—Ç–æ–≤–ø—Ü—ñ (–Ω–∞–≤—ñ—Ç—å —Ç—ñ, —â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ)

-- –ß–∞—Å: ~15ms (–≤–∫–ª—é—á–∞—é—á–∏ I/O –∑ –¥–∏—Å–∫–∞)
```

::

::tabs-item{label="‚úÖ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ"}

```sql
-- ‚úÖ –î–û–ë–†–ï: –ß–∏—Ç–∞—î –ª–∏—à–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å—Ç–æ–≤–ø—Ü—ñ
SELECT employee_id, first_name, last_name
FROM Employees
WHERE employee_id = 123;

-- SQL Server:
-- 1. –í—Å–µ –æ–¥–Ω–æ —á–∏—Ç–∞—î –ø–æ–≤–Ω—É page (8 KB) - —Ü–µ —Ñ—ñ–∑–∏—á–Ω–µ –æ–±–º–µ–∂–µ–Ω–Ω—è
-- 2. –ê–ª–µ –ù–ï –ø–µ—Ä–µ–¥–∞—î –∑–∞–π–≤—ñ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ –º–µ—Ä–µ–∂—É
-- 3. –Ø–∫—â–æ —î covering index - –º–æ–∂–µ –≤–∑–∞–≥–∞–ª—ñ –Ω–µ —á–∏—Ç–∞—Ç–∏ data page!

-- –ß–∞—Å: ~5ms (—è–∫—â–æ data page –≤–∂–µ –≤ –ø–∞–º'—è—Ç—ñ)
--       ~0.1ms (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î covering index)
```

::
::

::tip
**–ß–æ–º—É covering index —à–≤–∏–¥—à–∏–π?**  
Index page –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ **–±—ñ–ª—å—à–µ —Ä—è–¥–∫—ñ–≤**, –±–æ –∑–±–µ—Ä—ñ–≥–∞—î –ª–∏—à–µ –∫–ª—é—á–æ–≤—ñ —Å—Ç–æ–≤–ø—Ü—ñ:

Data page: 38 —Ä—è–¥–∫—ñ–≤ (212 –±–∞–π—Ç –∫–æ–∂–µ–Ω)  
Index page: ~200 —Ä—è–¥–∫—ñ–≤ (40 –±–∞–π—Ç –∫–æ–∂–µ–Ω, –ª–∏—à–µ email + ID)

**–£ 5 —Ä–∞–∑—ñ–≤ –º–µ–Ω—à–µ I/O –æ–ø–µ—Ä–∞—Ü—ñ–π!**
::

---

### –©–æ —Ç–∞–∫–µ Extent (–ï–∫—Å—Ç–µ–Ω—Ç)?

::note
**Extent** ‚Äî —Ü–µ **–≥—Ä—É–ø–∞ –∑ 8 —Å—É—Å—ñ–¥–Ω—ñ—Ö pages** = **64 KB**.  
SQL Server –≤–∏–¥—ñ–ª—è—î –¥–∏—Å–∫–æ–≤–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä **–µ–∫—Å—Ç–µ–Ω—Ç–∞–º–∏**, –∞ –Ω–µ –æ–∫—Ä–µ–º–∏–º–∏ pages.
::

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  EXTENT = 64 KB                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Page ‚îÇ Page ‚îÇ Page ‚îÇ Page ‚îÇ Page ‚îÇ Page ‚îÇ Page ‚îÇ
‚îÇ  1   ‚îÇ  2   ‚îÇ  3   ‚îÇ  4   ‚îÇ  5   ‚îÇ  6   ‚îÇ  7   ‚îÇ
‚îÇ 8KB  ‚îÇ 8KB  ‚îÇ 8KB  ‚îÇ 8KB  ‚îÇ 8KB  ‚îÇ 8KB  ‚îÇ 8KB  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ Extents?

**–®–≤–∏–¥—à–µ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ**: –ó–∞–º—ñ—Å—Ç—å –≤–∏–¥—ñ–ª—è—Ç–∏ 8 KB ‚Üí 8 KB ‚Üí 8 KB, SQL Server –≤–∏–¥—ñ–ª—è—î –æ–¥—Ä–∞–∑—É 64 KB –±–ª–æ–∫–æ–º.

---

### Mixed vs Uniform Extents: –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π

::tabs
::tabs-item{label="Mixed Extent (–º–∞–ª—ñ —Ç–∞–±–ª–∏—Ü—ñ)"}
**–ö–æ–ª–∏**: –¢–∞–±–ª–∏—Ü—è –∑–∞–π–º–∞—î **–º–µ–Ω—à–µ 64 KB** (–º–µ–Ω—à–µ 8 pages).

```sql
-- –ù–µ–≤–µ–ª–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—è –Ω–∞—Å—Ç—Ä–æ–π–æ–∫
CREATE TABLE AppSettings (
    setting_name NVARCHAR(50),
    setting_value NVARCHAR(200)
);

-- –í—Å—Ç–∞–≤–ª–µ–Ω–æ 10 —Ä—è–¥–∫—ñ–≤ ‚âà 2 KB
INSERT INTO AppSettings VALUES ...;
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MIXED EXTENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Page 1: AppSettings (—á–∞—Å—Ç–∏–Ω–∞)             ‚îÇ
‚îÇ Page 2: UserSettings (—ñ–Ω—à–∞ —Ç–∞–±–ª–∏—Ü—è)       ‚îÇ
‚îÇ Page 3: LogSettings (—â–µ –æ–¥–Ω–∞)             ‚îÇ
‚îÇ Page 4: AppSettings (–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è)         ‚îÇ
‚îÇ ...                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**: –ï–∫–æ–Ω–æ–º—ñ—è –º—ñ—Å—Ü—è (–±–∞–≥–∞—Ç–æ –º–∞–ª–∏—Ö —Ç–∞–±–ª–∏—Ü—å –Ω–µ –º–∞—Ä–Ω—É—é—Ç—å –ø—Ä–æ—Å—Ç—ñ—Ä).  
**–ù–µ–¥–æ–ª—ñ–∫–∏**: –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è (–ø–æ—Ç—Ä—ñ–±–Ω–æ —á–∏—Ç–∞—Ç–∏ pages –∑ —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—å –¥–∏—Å–∫–∞).
::

::tabs-item{label="Uniform Extent (–≤–µ–ª–∏–∫—ñ —Ç–∞–±–ª–∏—Ü—ñ)"}
**–ö–æ–ª–∏**: –¢–∞–±–ª–∏—Ü—è –∑–∞–π–º–∞—î **–±—ñ–ª—å—à–µ 64 KB** (–±—ñ–ª—å—à–µ 8 pages).

```sql
-- –í–µ–ª–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
CREATE TABLE Users (
    user_id INT PRIMARY KEY,
    email NVARCHAR(100),
    ...
);

-- –í—Å—Ç–∞–≤–ª–µ–Ω–æ 1,000,000 —Ä—è–¥–∫—ñ–≤
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ UNIFORM EXTENT #1 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Page 1: Users row 1-38                     ‚îÇ
‚îÇ Page 2: Users row 39-76                    ‚îÇ
‚îÇ Page 3: Users row 77-114                   ‚îÇ
‚îÇ ... –í–°–Ü 8 pages –ª–∏—à–µ –¥–ª—è Users             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ UNIFORM EXTENT #2 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Page 9:  Users row 305-342                 ‚îÇ
‚îÇ Page 10: Users row 343-380                 ‚îÇ
‚îÇ ...                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**: –®–≤–∏–¥–∫–µ —á–∏—Ç–∞–Ω–Ω—è (—Å—É—Å—ñ–¥–Ω—ñ pages –Ω–∞ –¥–∏—Å–∫—É).  
**–ù–µ–¥–æ–ª—ñ–∫–∏**: –ù–∞–≤—ñ—Ç—å –¥–ª—è 65 KB –¥–∞–Ω–∏—Ö –≤–∏–¥—ñ–ª–∏—Ç—å—Å—è –ø–æ–≤–Ω–∏—Ö 128 KB (2 extents).
::
::

---

### –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –∫–µ–π—Å: –ß–æ–º—É —à–∏—Ä–æ–∫—ñ —Ä—è–¥–∫–∏ ‚Äî —Ü–µ –ø–æ–≥–∞–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞**: –£ –≤–∞—Å —î —Ç–∞–±–ª–∏—Ü—è –∑ –≤–µ–ª–∏–∫–∏–º–∏ —Å—Ç–æ–≤–ø—Ü—è–º–∏.

```sql
CREATE TABLE Products (
    product_id INT,
    name NVARCHAR(100),
    description NVARCHAR(MAX),  -- ‚ö†Ô∏è –î–æ 2 –ì–ë!
    specs NVARCHAR(MAX),        -- ‚ö†Ô∏è –î–æ 2 –ì–ë!
    price DECIMAL(10,2)
);
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è**:

```
–†—è–¥–æ–∫ –∑ NVARCHAR(MAX):
- –ú–∞–ª–µ–Ω—å–∫–∞ description (500 –±–∞–π—Ç) ‚Üí –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è IN-ROW (–≤ page)
- –í–µ–ª–∏–∫–∞ description (10 KB)      ‚Üí –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è OFF-ROW (–æ–∫—Ä–µ–º–æ)

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DATA PAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ LOB PAGES ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ product_id: 1             ‚îÇ    ‚îÇ description:     ‚îÇ
‚îÇ name: "Laptop"            ‚îÇ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ (10 KB —Ç–µ–∫—Å—Ç)    ‚îÇ
‚îÇ description: [pointer]    ‚îÇ    ‚îÇ                  ‚îÇ
‚îÇ price: 1299.99            ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–æ–±–ª–µ–º–∏**:

1. **–§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è**: –î–∞–Ω—ñ —Ä–æ–∑–∫–∏–¥–∞–Ω—ñ –ø–æ —Ä—ñ–∑–Ω–∏—Ö pages
2. **–ü–æ–≤—ñ–ª—å–Ω–∏–π –ø–æ—à—É–∫**: –ü–æ—Ç—Ä—ñ–±–Ω–æ —á–∏—Ç–∞—Ç–∏ data page + LOB pages
3. **Index –Ω–µ –¥–æ–ø–æ–º–æ–∂–µ**: Covering index –ù–ï –º–æ–∂–µ –≤–∫–ª—é—á–∏—Ç–∏ NVARCHAR(MAX)

::warning
**Best Practice**: –í–∏–Ω–µ—Å—ñ—Ç—å –≤–µ–ª–∏–∫—ñ —Å—Ç–æ–≤–ø—Ü—ñ –≤ –æ–∫—Ä–µ–º—É —Ç–∞–±–ª–∏—Ü—é!

```sql
-- ‚úÖ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
CREATE TABLE Products (
    product_id INT PRIMARY KEY,
    name NVARCHAR(100),
    price DECIMAL(10,2)
);

CREATE TABLE ProductDetails (
    product_id INT PRIMARY KEY,
    description NVARCHAR(MAX),
    specs NVARCHAR(MAX),
    FOREIGN KEY (product_id) REFERENCES Products(product_id)
);

-- –¢–µ–ø–µ—Ä —à–≤–∏–¥–∫–∏–π –∑–∞–ø–∏—Ç –ù–ï —á–∏—Ç–∞—î LOB pages:
SELECT product_id, name, price
FROM Products
WHERE price > 1000;  -- ‚ö° –®–≤–∏–¥–∫–æ!
```

::

---

### –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Pages?

```sql
-- –°–∫—ñ–ª—å–∫–∏ pages –∑–∞–π–º–∞—î —Ç–∞–±–ª–∏—Ü—è?
SELECT
    t.name AS TableName,
    p.rows AS RowCount,
    SUM(a.used_pages) AS UsedPages,
    SUM(a.used_pages) * 8 / 1024.0 AS UsedMB,
    SUM(a.used_pages) / 8.0 AS UsedExtents
FROM sys.tables t
INNER JOIN sys.partitions p ON t.object_id = p.object_id
INNER JOIN sys.allocation_units a ON p.partition_id = a.container_id
WHERE t.name = 'Users'
GROUP BY t.name, p.rows;
```

**–ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É**:

```
TableName  RowCount  UsedPages  UsedMB   UsedExtents
Users      1,000,000 26,316     205.28   3,289
```

**–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫**:

- 1,000,000 —Ä—è–¥–∫—ñ–≤ / 38 —Ä—è–¥–∫—ñ–≤ –Ω–∞ page ‚âà 26,316 pages ‚úÖ
- 26,316 pages √ó 8 KB = 205 MB ‚úÖ
- 26,316 pages / 8 pages –Ω–∞ extent ‚âà 3,289 extents ‚úÖ

---

### –ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞: –†–µ–∑—é–º–µ

::tip
**5 –ø—Ä–∞–∫—Ç–∏—á–Ω–∏—Ö –≤–∏—Å–Ω–æ–≤–∫—ñ–≤**:

1. **SELECT \* ‚Äî –ø–æ–≤—ñ–ª—å–Ω–æ**: –ù–∞–≤—ñ—Ç—å —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω 1 —Å—Ç–æ–≤–ø–µ—Ü—å, SQL Server —á–∏—Ç–∞—î –≤—Å—é page (8 KB)
2. **–®–∏—Ä–æ–∫—ñ —Ä—è–¥–∫–∏ ‚Äî –ø–æ–≥–∞–Ω–æ**: –ú–µ–Ω—à–µ —Ä—è–¥–∫—ñ–≤ –Ω–∞ page = –±—ñ–ª—å—à–µ I/O = –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ
3. **Covering indexes ‚Äî —à–≤–∏–¥–∫–æ**: –ú–µ–Ω—à—ñ —Ä—è–¥–∫–∏ –≤ index pages = –±—ñ–ª—å—à–µ —Ä—è–¥–∫—ñ–≤ = –º–µ–Ω—à–µ I/O
4. **–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ–ø–æ–º–∞–≥–∞—î**: NVARCHAR(MAX) —É –æ–∫—Ä–µ–º—ñ–π —Ç–∞–±–ª–∏—Ü—ñ = —à–≤–∏–¥—à—ñ –æ—Å–Ω–æ–≤–Ω—ñ –∑–∞–ø–∏—Ç–∏
5. **–§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è = –ø—Ä–æ–±–ª–µ–º–∞**: –†–æ–∑–∫–∏–¥–∞–Ω—ñ pages –ø–æ –¥–∏—Å–∫—É = –ø–æ–≤—ñ–ª—å–Ω–µ —á–∏—Ç–∞–Ω–Ω—è

**–ó–∞–ø–∞–º'—è—Ç–∞–π—Ç–µ**: SQL Server –ø—Ä–∞—Ü—é—î –∑ pages (8 KB), –Ω–µ –∑ —Ä—è–¥–∫–∞–º–∏!
::

---

## B-Tree: –°–µ—Ä—Ü–µ —ñ–Ω–¥–µ–∫—Å—ñ–≤

**B-Tree (Balanced Tree)** ‚Äî —Ü–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö —É –≤–∏–≥–ª—è–¥—ñ **–∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞**, —è–∫–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î —à–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫, –≤—Å—Ç–∞–≤–∫—É —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è.

### –í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ B-Tree

1. **–ó–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω—ñ—Å—Ç—å**: –í—Å—ñ –ª–∏—Å—Ç–æ–≤—ñ –≤—É–∑–ª–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –Ω–∞ –æ–¥–Ω—ñ–π –≤—ñ–¥—Å—Ç–∞–Ω—ñ –≤—ñ–¥ –∫–æ—Ä–µ–Ω—è
2. **–í—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å**: –ö–ª—é—á—ñ –≤ –∫–æ–∂–Ω–æ–º—É –≤—É–∑–ª—ñ –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ
3. **Logarithmic Search**: –ü–æ—à—É–∫ –∑–∞–π–º–∞—î O(log N) —á–∞—Å—É

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ B-Tree –≤ SQL Server

::mermaid

```mermaid
graph TD
    Root[Root Page<br/>Level 2<br/>Values: 50, 100]

    Root -->|< 50| L1A[Intermediate Page<br/>Level 1<br/>Values: 10, 25, 40]
    Root -->|50-100| L1B[Intermediate Page<br/>Level 1<br/>Values: 60, 75, 85]
    Root -->|> 100| L1C[Intermediate Page<br/>Level 1<br/>Values: 110, 130, 150]

    L1A -->|< 10| Leaf1[Leaf Page<br/>Level 0<br/>1,2,3,4,5]
    L1A -->|10-25| Leaf2[Leaf Page<br/>Level 0<br/>11,15,20,23]
    L1A -->|25-40| Leaf3[Leaf Page<br/>Level 0<br/>26,30,35,38]

    L1B -->|50-60| Leaf4[Leaf Page<br/>Level 0<br/>51,55,58]
    L1B -->|60-75| Leaf5[Leaf Page<br/>Level 0<br/>65,70,72]

    L1C -->|> 150| Leaf6[Leaf Page<br/>Level 0<br/>160,170,180]

    style Root fill:#ef4444,color:#fff
    style L1A fill:#f59e0b,color:#333
    style L1B fill:#f59e0b,color:#333
    style L1C fill:#f59e0b,color:#333
    style Leaf1 fill:#10b981,color:#fff
    style Leaf2 fill:#10b981,color:#fff
    style Leaf3 fill:#10b981,color:#fff
    style Leaf4 fill:#10b981,color:#fff
    style Leaf5 fill:#10b981,color:#fff
    style Leaf6 fill:#10b981,color:#fff
```

::

**–†—ñ–≤–Ω—ñ –¥–µ—Ä–µ–≤–∞**:

- **Root Level (Level 2)**: –ö–æ—Ä—ñ–Ω—å –¥–µ—Ä–µ–≤–∞, —Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É
- **Intermediate Levels (Level 1)**: –ü—Ä–æ–º—ñ–∂–Ω—ñ –≤—É–∑–ª–∏ –¥–ª—è –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó
- **Leaf Level (Level 0)**: –õ–∏—Å—Ç–æ–≤—ñ –≤—É–∑–ª–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∞–±–æ –ø–æ–∫–∞–∂—á–∏–∫–∞–º–∏

### –ü—Ä–∏–∫–ª–∞–¥ –ø–æ—à—É–∫—É: –ó–Ω–∞–π—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è 72

```
–ö—Ä–æ–∫ 1: Root Page
        ‚Üí 72 > 50 AND 72 < 100
        ‚Üí –Ü–¥–µ middle child (L1B)

–ö—Ä–æ–∫ 2: Intermediate Page (L1B)
        ‚Üí 72 > 60 AND 72 < 75
        ‚Üí –Ü–¥–µ right child (Leaf5)

–ö—Ä–æ–∫ 3: Leaf Page (Leaf5)
        ‚Üí –ó–Ω–∞–π–¥–µ–Ω–æ: 72 ‚úÖ

–í—Å—å–æ–≥–æ –æ–ø–µ—Ä–∞—Ü—ñ–π —á–∏—Ç–∞–Ω–Ω—è: 3 pages (–∑–∞–º—ñ—Å—Ç—å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö pages!)
```

::tip
**–ì–ª–∏–±–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞**: –î–ª—è **1 –º—ñ–ª—å—è—Ä–¥–∞ —Ä—è–¥–∫—ñ–≤** B-Tree –º–∞—î –≥–ª–∏–±–∏–Ω—É –ª–∏—à–µ **4-5 —Ä—ñ–≤–Ω—ñ–≤**!  
–¶–µ –æ–∑–Ω–∞—á–∞—î **–º–∞–∫—Å–∏–º—É–º 5 –æ–ø–µ—Ä–∞—Ü—ñ–π —á–∏—Ç–∞–Ω–Ω—è** –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –±—É–¥—å-—è–∫–æ–≥–æ —Ä—è–¥–∫–∞.
::

---

## –ö–ª–∞—Å—Ç–µ—Ä–Ω–∏–π —ñ–Ω–¥–µ–∫—Å (Clustered Index)

### –ê–Ω–∞–ª–æ–≥—ñ—è –∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∂–∏—Ç—Ç—è: –ï–Ω—Ü–∏–∫–ª–æ–ø–µ–¥—ñ—è

::note
**–£—è–≤—ñ—Ç—å –µ–Ω—Ü–∏–∫–ª–æ–ø–µ–¥—ñ—é** –∑ 1000 —Å—Ç–∞—Ç–µ–π:

- –°—Ç–∞—Ç—Ç—ñ **—Ñ—ñ–∑–∏—á–Ω–æ –≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω—ñ** –∑–∞ –∞–ª—Ñ–∞–≤—ñ—Ç–æ–º (–ê ‚Üí –Ø)
- –©–æ–± –∑–Ω–∞–π—Ç–∏ "–ö–∏—ó–≤", –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç–µ —Ä–æ–∑–¥—ñ–ª "–ö" ‚Äî —Å—Ç–∞—Ç—Ç—è **—Ä–µ–∞–ª—å–Ω–æ —Ç–∞–º**
- –ù–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω –æ–∫—Ä–µ–º–∏–π –ø–æ–∫–∞–∂—á–∏–∫ ‚Äî **—Å–∞–º–∞ –∫–Ω–∏–≥–∞ –≤–∂–µ –≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞**
- –í–∏ **–ù–ï –º–æ–∂–µ—Ç–µ** –º–∞—Ç–∏ —Ç—É —Å–∞–º—É –µ–Ω—Ü–∏–∫–ª–æ–ø–µ–¥—ñ—é –≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω—É —ñ –∑–∞ –∞–ª—Ñ–∞–≤—ñ—Ç–æ–º, —ñ –∑–∞ –¥–∞—Ç–∞–º–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ

**–¢–∞–∫ —Å–∞–º–æ –ø—Ä–∞—Ü—é—î Clustered Index!**
::

### –©–æ —Ç–∞–∫–µ Clustered Index?

::note
**Clustered Index** ‚Äî —Ü–µ —Å–ø–æ—Å—ñ–± **—Ñ—ñ–∑–∏—á–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—ñ** —É –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É.  
Leaf level B-Tree –º—ñ—Å—Ç–∏—Ç—å **—Ä–µ–∞–ª—å–Ω—ñ —Ä—è–¥–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ**, –∞ –Ω–µ –ø–æ–∫–∞–∂—á–∏–∫–∏ –Ω–∞ –Ω–∏—Ö.
::

### –ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ

1. **–û–¥–∏–Ω –Ω–∞ —Ç–∞–±–ª–∏—Ü—é**: –ú–æ–∂–µ –±—É—Ç–∏ –ª–∏—à–µ –û–î–ò–ù clustered index (–¥–∞–Ω—ñ –º–æ–∂–Ω–∞ —Ñ—ñ–∑–∏—á–Ω–æ –≤–ø–æ—Ä—è–¥–∫—É–≤–∞—Ç–∏ –ª–∏—à–µ –æ–¥–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º)
2. **–¢–∞–±–ª–∏—Ü—è = –Ü–Ω–¥–µ–∫—Å**: –î–∞–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ **–Ü –Ñ** clustered index (–Ω–µ –æ–∫—Ä–µ–º–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞!)
3. **–§—ñ–∑–∏—á–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫**: –†—è–¥–∫–∏ —Ñ—ñ–∑–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –ø–æ—Ä—è–¥–∫—É –∫–ª—é—á–∞ —ñ–Ω–¥–µ–∫—Å—É
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è**: –ù–∞ PRIMARY KEY (—è–∫—â–æ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ —ñ–Ω–∞–∫—à–µ)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Clustered Index

::mermaid

```mermaid
graph TD
    Root[Root Page<br/>ID: 1000, 2000, 3000]

    Root --> Int1[Intermediate Page<br/>ID: 100, 500, 900]
    Root --> Int2[Intermediate Page<br/>ID: 1100, 1500, 1900]
    Root --> Int3[Intermediate Page<br/>ID: 2100, 2500, 2900]

    Int1 --> Data1[Leaf Page<br/>–†–ï–ê–õ–¨–ù–Ü –î–ê–ù–Ü:<br/>ID=1: John, Doe<br/>ID=2: Jane, Smith]
    Int1 --> Data2[Leaf Page<br/>–†–ï–ê–õ–¨–ù–Ü –î–ê–ù–Ü:<br/>ID=501: Bob, Wilson<br/>ID=502: Alice, Brown]

    Int2 --> Data3[Leaf Page<br/>–†–ï–ê–õ–¨–ù–Ü –î–ê–ù–Ü:<br/>ID=1101: Mike, Davis<br/>ID=1102: Emma, Taylor]

    style Root fill:#ef4444,color:#fff
    style Int1 fill:#f59e0b,color:#333
    style Int2 fill:#f59e0b,color:#333
    style Int3 fill:#f59e0b,color:#333
    style Data1 fill:#10b981,color:#fff
    style Data2 fill:#10b981,color:#fff
    style Data3 fill:#10b981,color:#fff
```

::

**–ö–ª—é—á–æ–≤–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å**: Leaf pages –º—ñ—Å—Ç—è—Ç—å **–í–°–Ü —Å—Ç–æ–≤–ø—Ü—ñ —Ç–∞–±–ª–∏—Ü—ñ** (ID, —ñ–º'—è, –ø—Ä—ñ–∑–≤–∏—â–µ, –∑–∞—Ä–ø–ª–∞—Ç–∞), –∞ –Ω–µ –ª–∏—à–µ –∫–ª—é—á —ñ–Ω–¥–µ–∫—Å—É!

---

### –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥: –¢–∞–±–ª–∏—Ü—è –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤

::tabs
::tabs-item{label="HEAP (–±–µ–∑ —ñ–Ω–¥–µ–∫—Å—É)"}

```sql
-- –¢–∞–±–ª–∏—Ü—è –±–µ–∑ Clustered Index = HEAP (–∫—É–ø–∞)
CREATE TABLE Employees (
    employee_id INT,
    first_name NVARCHAR(50),
    last_name NVARCHAR(50),
    salary DECIMAL(10,2)
);

INSERT INTO Employees VALUES
    (105, 'Alice', 'Brown', 75000),
    (12, 'Bob', 'Smith', 65000),
    (501, 'Charlie', 'Davis', 85000),
    (7, 'Diana', 'Wilson', 70000);
```

**–Ø–∫ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –Ω–∞ –¥–∏—Å–∫—É** (–≤–∏–ø–∞–¥–∫–æ–≤–∏–π –ø–æ—Ä—è–¥–æ–∫):

```
Page 1: [ID=105: Alice Brown]  [ID=12: Bob Smith]
Page 2: [ID=501: Charlie Davis]  [ID=7: Diana Wilson]
```

**–ü–æ—à—É–∫ `WHERE employee_id = 501`**:

```
‚ùå TABLE SCAN: –°–∫–∞–Ω—É—î –í–°–Ü pages –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ
Page 1: ID=105? ‚ùå  ID=12? ‚ùå
Page 2: ID=501? ‚úÖ –ó–ù–ê–ô–î–ï–ù–û!

–ß–∏—Ç–∞–Ω–Ω—è: 2 pages
```

::

::tabs-item{label="‚úÖ –ó Clustered Index"}

```sql
-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Clustered Index
CREATE CLUSTERED INDEX IX_Employees_ID
ON Employees(employee_id);

-- SQL Server –†–ï–û–†–ì–ê–ù–Ü–ó–£–Ñ –¥–∞–Ω—ñ!
```

**–Ø–∫ —Ç–µ–ø–µ—Ä –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è** (–≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ –∑–∞ employee_id):

```
Page 1: [ID=7: Diana Wilson]  [ID=12: Bob Smith]
Page 2: [ID=105: Alice Brown]  [ID=501: Charlie Davis]
```

**–¢–æ–π —Å–∞–º–∏–π –ø–æ—à—É–∫ `WHERE employee_id = 501`**:

```
‚úÖ INDEX SEEK: B-Tree –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è
Root: 501 > 100? ‚Üí –π–¥–µ –≤–ø—Ä–∞–≤–æ
Leaf: –ü—Ä—è–º–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å Page 2, Slot 2

–ß–∏—Ç–∞–Ω–Ω—è: 2-3 pages (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≥–ª–∏–±–∏–Ω–∏ –¥–µ—Ä–µ–≤–∞)
–®–≤–∏–¥–∫—ñ—Å—Ç—å: O(log N) –∑–∞–º—ñ—Å—Ç—å O(N)
```

::
::

::warning
**–ö–†–ò–¢–ò–ß–ù–û**: –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è clustered index —Ç–∞–±–ª–∏—Ü—è **–±—ñ–ª—å—à–µ –Ω–µ HEAP**.  
SQL Server **—Ñ—ñ–∑–∏—á–Ω–æ –ø–µ—Ä–µ–º—ñ—â—É—î –≤—Å—ñ —Ä—è–¥–∫–∏** –Ω–∞ –¥–∏—Å–∫—É –¥–ª—è –≤–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è!  
–¶–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –≥–æ–¥–∏–Ω–∏ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ç–∞–±–ª–∏—Ü—å (> 100 –º–ª–Ω —Ä—è–¥–∫—ñ–≤).
::

---

### –ß–æ–º—É ¬´–∫–ª–∞—Å—Ç–µ—Ä–Ω–∏–π¬ª?

**–ù–∞–∑–≤–∞ –ø–æ—è—Å–Ω—é—î –ø–æ–≤–µ–¥—ñ–Ω–∫—É**: –†—è–¥–∫–∏ –∑ –±–ª–∏–∑—å–∫–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –∫–ª—é—á–∞ **—Ñ—ñ–∑–∏—á–Ω–æ –∑–≥—Ä—É–ø–æ–≤–∞–Ω—ñ (clustered) —Ä–∞–∑–æ–º**.

```sql
-- –ü—Ä–∏–∫–ª–∞–¥: –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞ –¥–∞—Ç–∞–º–∏
CREATE CLUSTERED INDEX IX_Orders_Date ON Orders(order_date);

-- –î–∞–Ω—ñ –Ω–∞ –¥–∏—Å–∫—É:
Page 1: [2024-01-01] [2024-01-01] [2024-01-02]  ‚Üê —Å—ñ—á–Ω–µ–≤—ñ —Ä–∞–∑–æ–º
Page 2: [2024-01-15] [2024-01-16] [2024-01-20]
Page 3: [2024-02-01] [2024-02-02] [2024-02-05]  ‚Üê –ª—é—Ç–Ω–µ–≤—ñ —Ä–∞–∑–æ–º
```

**Range queries –Ω–∞–¥—à–≤–∏–¥–∫—ñ**:

```sql
SELECT * FROM Orders
WHERE order_date BETWEEN '2024-01-01' AND '2024-01-31';

-- SQL Server:
-- 1. –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –ø–µ—Ä—à—É —Å—ñ—á–Ω–µ–≤—É page (B-Tree)
-- 2. –ß–∏—Ç–∞—î pages –ü–û–°–õ–Ü–î–û–í–ù–û –¥–æ–∫–∏ order_date <= '2024-01-31'
-- 3. –ó—É–ø–∏–Ω—è—î—Ç—å—Å—è –Ω–∞ –ª—é—Ç–Ω–µ–≤—ñ–π page

-- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ß–∏—Ç–∞—î–º–æ –ª–∏—à–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ pages! ‚ö°
```

### Heap vs Clustered Table

::tabs
::tabs-item{label="HEAP (–±–µ–∑ clustered index)"}
**–ü–µ—Ä–µ–≤–∞–≥–∏**:

- –®–≤–∏–¥–∫–∞ –≤—Å—Ç–∞–≤–∫–∞ (INSERT) ‚Äî –¥–æ–¥–∞—î –≤ –∫—ñ–Ω–µ—Ü—å
- –ù–µ –ø–æ—Ç—Ä–µ–±—É—î –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —ñ–Ω–¥–µ–∫—Å—É

**–ù–µ–¥–æ–ª—ñ–∫–∏**:

- –ü–æ–≤—ñ–ª—å–Ω–∏–π –ø–æ—à—É–∫ (Table Scan)
- –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è –∑ —á–∞—Å–æ–º

::

::tabs-item{label="Clustered Table"}
**–ü–µ—Ä–µ–≤–∞–≥–∏**:

- –®–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫ –∑–∞ –∫–ª—é—á–µ–º (Index Seek)
- Range queries –¥—É–∂–µ —à–≤–∏–¥–∫—ñ
- –§—ñ–∑–∏—á–Ω–∞ –≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω—ñ—Å—Ç—å

**–ù–µ–¥–æ–ª—ñ–∫–∏**:

- –í—Å—Ç–∞–≤–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–æ—é (–ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–æ—Ä—è–¥–æ–∫)
- –ú–æ–∂–ª–∏–≤–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è –ø—Ä–∏ —á–∞—Å—Ç–∏—Ö INSERT/UPDATE

::

::

---

## –ù–µ–∫–ª–∞—Å—Ç–µ—Ä–Ω–∏–π —ñ–Ω–¥–µ–∫—Å (Non-Clustered Index)

### –ê–Ω–∞–ª–æ–≥—ñ—è –∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∂–∏—Ç—Ç—è: –ë—ñ–±–ª—ñ–æ—Ç–µ—á–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥

::note
**–£—è–≤—ñ—Ç—å –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É** –∑ –∫–Ω–∏–≥–∞–º–∏:

- **–ö–Ω–∏–≥–∏** –≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω—ñ –∑–∞ —ñ–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º (Clustered Index)
- –ê–ª–µ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∫–Ω–∏–≥–∞ –∑–∞ –∞–≤—Ç–æ—Ä–æ–º "–®–µ–≤—á–µ–Ω–∫–æ"
- –í–∏ –π–¥–µ—Ç–µ –¥–æ **–∞–ª—Ñ–∞–≤—ñ—Ç–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É** (–∫–∞—Ä—Ç–∫–∏ –∑ —ñ–º–µ–Ω–∞–º–∏ –∞–≤—Ç–æ—Ä—ñ–≤)
- –ó–Ω–∞—Ö–æ–¥–∏—Ç–µ –∫–∞—Ä—Ç–∫—É "–®–µ–≤—á–µ–Ω–∫–æ" ‚Üí –Ω–∞ –Ω—ñ–π –Ω–∞–ø–∏—Å–∞–Ω–æ **–Ω–æ–º–µ—Ä –ø–æ–ª–∏—Ü—ñ: 5-B-12**
- –ó –Ω–æ–º–µ—Ä–æ–º –π–¥–µ—Ç–µ –¥–æ –ø–æ–ª–∏—Ü—ñ —ñ **–±–µ—Ä–µ—Ç—î —Å–∞–º—É –∫–Ω–∏–≥—É**

**–ö–∞—Ä—Ç–∫–æ–≤–∏–π –∫–∞—Ç–∞–ª–æ–≥ = Non-Clustered Index!**  
–í—ñ–Ω –Ω–µ –º—ñ—Å—Ç–∏—Ç—å —Å–∞–º–∏—Ö –∫–Ω–∏–≥, –ª–∏—à–µ **–ø–æ–∫–∞–∂—á–∏–∫–∏** (–Ω–æ–º–µ—Ä–∏ –ø–æ–ª–∏—Ü—å).
::

### –©–æ —Ç–∞–∫–µ Non-Clustered Index?

::note
**Non-Clustered Index** ‚Äî —Ü–µ **–æ–∫—Ä–µ–º–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö**, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å:

1. –í—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å–æ–≤–∞–Ω–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, email)
2. **–ü–æ–∫–∞–∂—á–∏–∫–∏** –Ω–∞ —Ä–µ–∞–ª—å–Ω—ñ —Ä—è–¥–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ (RID –∞–±–æ Clustered Key)

Leaf level –º—ñ—Å—Ç–∏—Ç—å **–ù–ï —Å–∞–º—ñ –¥–∞–Ω—ñ**, –∞ –ª–∏—à–µ –∞–¥—Ä–µ—Å–∏, –¥–µ —ó—Ö –∑–Ω–∞–π—Ç–∏!
::

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Non-Clustered Index

::mermaid

```mermaid
graph TD
    Root[Root Page<br/>Email Index<br/>Keys: m..., s..., z...]

    Root --> Int1["Intermediate<br/>a...@, j...@, m...@"]
    Root --> Int2["Intermediate<br/>n...@, r...@, s...@"]

    Int1 --> Leaf1["Leaf Page<br/>alice@...: ‚Üí RID 1:500:2<br/>bob@...: ‚Üí RID 1:500:5"]
    Int1 --> Leaf2["Leaf Page<br/>john@...: ‚Üí RID 1:501:0<br/>mary@...: ‚Üí RID 1:501:3"]

    Int2 --> Leaf3["Leaf Page<br/>steve@...: ‚Üí RID 1:502:1<br/>zoe@...: ‚Üí RID 1:503:7"]

    Leaf1 -.–ü–æ–∫–∞–∂—á–∏–∫.-> Data["Data Pages<br/>–†–ï–ê–õ–¨–ù–Ü –î–ê–ù–Ü<br/>–≤ —Ç–∞–±–ª–∏—Ü—ñ"]
    Leaf2 -.–ü–æ–∫–∞–∂—á–∏–∫.-> Data
    Leaf3 -.–ü–æ–∫–∞–∂—á–∏–∫.-> Data

    style Root fill:#ef4444,color:#fff
    style Int1 fill:#f59e0b,color:#333
    style Int2 fill:#f59e0b,color:#333
    style Leaf1 fill:#3b82f6,color:#fff
    style Leaf2 fill:#3b82f6,color:#fff
    style Leaf3 fill:#3b82f6,color:#fff
    style Data fill:#10b981,color:#fff
```

::

---

### –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥: –ü–æ—à—É–∫ –∑–∞ Email

::tabs
::tabs-item{label="–ë–µ–∑ Non-Clustered Index"}

```sql
CREATE TABLE Users (
    user_id INT PRIMARY KEY CLUSTERED,  -- –í–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–æ –∑–∞ ID
    email NVARCHAR(100),
    name NVARCHAR(50)
);

-- –ü–æ—à—É–∫ –∑–∞ email
SELECT * FROM Users WHERE email = 'alice@example.com';
```

**–©–æ —Ä–æ–±–∏—Ç—å SQL Server**:

```
‚ùå CLUSTERED INDEX SCAN (TABLE SCAN)
–°–∫–∞–Ω—É—î –í–°–Ü —Ä—è–¥–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ (–≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω—ñ –∑–∞ user_id):
ID=1: john@...   ‚ùå
ID=2: bob@...    ‚ùå
ID=3: alice@...  ‚úÖ –ó–ù–ê–ô–î–ï–ù–û!
ID=4: mary@...   (–ø—Ä–æ–¥–æ–≤–∂—É—î –¥–æ –∫—ñ–Ω—Ü—è)

–ß–∏—Ç–∞–Ω–Ω—è: –í–°–Ü pages —Ç–∞–±–ª–∏—Ü—ñ
```

::

::tabs-item{label="‚úÖ –ó Non-Clustered Index"}

```sql
-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—É –Ω–∞ email
CREATE NONCLUSTERED INDEX IX_Users_Email ON Users(email);
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ñ–Ω–¥–µ–∫—Å—É** (–æ–∫—Ä–µ–º–∞ B-Tree):

```
Leaf Level (–≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ –∑–∞ email):
alice@example.com  ‚Üí user_id: 3  ‚Üê –ø–æ–∫–∞–∂—á–∏–∫!
bob@example.com    ‚Üí user_id: 2
john@example.com   ‚Üí user_id: 1
mary@example.com   ‚Üí user_id: 4
```

**–¢–æ–π —Å–∞–º–∏–π –∑–∞–ø–∏—Ç**:

```
‚úÖ INDEX SEEK + KEY LOOKUP

–ö—Ä–æ–∫ 1: INDEX SEEK –≤ IX_Users_Email
  alice@example.com ‚Üí user_id = 3 ‚úÖ (—à–≤–∏–¥–∫–æ!)

–ö—Ä–æ–∫ 2: KEY LOOKUP –≤ Clustered Index
  user_id = 3 ‚Üí [3, alice@..., Alice Smith] ‚úÖ

–ß–∏—Ç–∞–Ω–Ω—è: 2-3 pages (—ñ–Ω–¥–µ–∫—Å) + 1 page (–¥–∞–Ω—ñ)
–®–≤–∏–¥–∫—ñ—Å—Ç—å: O(log N) –∑–∞–º—ñ—Å—Ç—å O(N)
```

::
::

::tip
**–ß–æ–º—É –¥–≤–∞ –∫—Ä–æ–∫–∏?**

Non-Clustered Index –º—ñ—Å—Ç–∏—Ç—å –ª–∏—à–µ `email` + `user_id`.  
–ê–ª–µ –∑–∞–ø–∏—Ç —Ö–æ—á–µ `SELECT *` (–≤—Å—ñ —Å—Ç–æ–≤–ø—Ü—ñ: email, name).  
`name` –Ω–µ–º–∞—î –≤ —ñ–Ω–¥–µ–∫—Å—ñ ‚Üí –ø–æ—Ç—Ä—ñ–±–µ–Ω **Key Lookup** –¥–æ —Ç–∞–±–ª–∏—Ü—ñ.

**–†—ñ—à–µ–Ω–Ω—è**: Covering Index! (–¥–∏–≤. –Ω–∏–∂—á–µ)
::

---

### RID vs Clustered Key: –©–æ –∑–±–µ—Ä—ñ–≥–∞—î –ø–æ–∫–∞–∂—á–∏–∫?

::tabs
::tabs-item{label="HEAP —Ç–∞–±–ª–∏—Ü—è ‚Üí RID"}

```sql
-- –¢–∞–±–ª–∏—Ü—è –ë–ï–ó Clustered Index
CREATE TABLE Products (
    product_id INT,
    name NVARCHAR(100)
);

CREATE NONCLUSTERED INDEX IX_Products_Name ON Products(name);
```

**Leaf level —ñ–Ω–¥–µ–∫—Å—É –º—ñ—Å—Ç–∏—Ç—å RID** (Row Identifier):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ IX_Products_Name (Non-Clust)  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ name            RID            ‚îÇ
‚îÇ "Laptop"     ‚Üí 1:500:2         ‚îÇ  FileID:PageID:SlotID
‚îÇ "Mouse"      ‚Üí 1:500:5         ‚îÇ
‚îÇ "Keyboard"   ‚Üí 1:501:0         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**RID = –§—ñ–∑–∏—á–Ω–∞ –∞–¥—Ä–µ—Å–∞**:

```
RID = 1 : 500 : 2
      ‚Üì   ‚Üì     ‚Üì
  File  Page  Slot (–ø–æ–∑–∏—Ü—ñ—è –Ω–∞ page)
```

::

::tabs-item{label="Clustered —Ç–∞–±–ª–∏—Ü—è ‚Üí Clustered Key"}

```sql
-- –¢–∞–±–ª–∏—Ü—è –ó Clustered Index
CREATE TABLE Products (
    product_id INT PRIMARY KEY CLUSTERED,
    name NVARCHAR(100)
);

CREATE NONCLUSTERED INDEX IX_Products_Name ON Products(name);
```

**Leaf level —ñ–Ω–¥–µ–∫—Å—É –º—ñ—Å—Ç–∏—Ç—å Clustered Key**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ IX_Products_Name (Non-Clust)  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ name            product_id     ‚îÇ  ‚Üê Clustered Key!
‚îÇ "Laptop"     ‚Üí 101             ‚îÇ
‚îÇ "Mouse"      ‚Üí 205             ‚îÇ
‚îÇ "Keyboard"   ‚Üí 89              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–æ—Ü–µ—Å Key Lookup**:

```
1. Non-Clustered Index: name="Laptop" ‚Üí product_id=101
2. Clustered Index B-Tree: —à—É–∫–∞—î–º–æ product_id=101
3. –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ–≤–Ω–∏–π —Ä—è–¥–æ–∫: [101, "Laptop", 1299.99, ...]
```

::
::

::warning
**–ß–æ–º—É Clustered Key –∫—Ä–∞—â–µ –∑–∞ RID?**

- **RID**: –§—ñ–∑–∏—á–Ω–∞ –∞–¥—Ä–µ—Å–∞ –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏—Å—è (page split, reorganize)
- **Clustered Key**: –õ–æ–≥—ñ—á–Ω–∏–π –∫–ª—é—á, –∑–∞–≤–∂–¥–∏ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π

**–ê–ª–µ**: Clustered Key –∑–∞–π–º–∞—î –±—ñ–ª—å—à–µ –º—ñ—Å—Ü—è –≤ —ñ–Ω–¥–µ–∫—Å—ñ!  
–Ø–∫—â–æ Clustered Index –Ω–∞ UNIQUEIDENTIFIER (16 –±–∞–π—Ç) ‚Üí –≤—Å—ñ Non-Clustered —ñ–Ω–¥–µ–∫—Å–∏ ¬´—Ä–æ–∑–¥—É–≤–∞—é—Ç—å—Å—è¬ª.
::

---

### –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è: –û–¥–∏–Ω –∑–∞–ø–∏—Ç, –¥–≤–∞ —ñ–Ω–¥–µ–∫—Å–∏

```sql
SELECT user_id, name FROM Users WHERE email = 'alice@example.com';
```

::mermaid

```mermaid
sequenceDiagram
    participant Q as –ó–∞–ø–∏—Ç
    participant NC as Non-Clustered Index<br/>(IX_Users_Email)
    participant C as Clustered Index<br/>(PRIMARY KEY)

    Q->>NC: 1. WHERE email = 'alice@...'?
    NC->>NC: INDEX SEEK (B-Tree)
    NC-->>Q: –ó–Ω–∞–π–¥–µ–Ω–æ! user_id = 3

    Q->>C: 2. –î–∞–π –º–µ–Ω—ñ name –¥–ª—è user_id=3
    C->>C: KEY LOOKUP (B-Tree)
    C-->>Q: [3, alice@..., Alice Smith]

    Q->>Q: 3. –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ: user_id=3, name=Alice Smith
```

::

::caution
**Key Lookup = Performance Hit!**

–î–ª—è **–∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞** —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø–æ—Ç—Ä—ñ–±–µ–Ω –æ–∫—Ä–µ–º–∏–π Key Lookup.  
–Ø–∫—â–æ –∑–∞–ø–∏—Ç –ø–æ–≤–µ—Ä—Ç–∞—î 10,000 —Ä—è–¥–∫—ñ–≤ ‚Üí 10,000 Key Lookups! üò±

**–†—ñ—à–µ–Ω–Ω—è**: Covering Index (–≤–∫–ª—é—á–∏—Ç–∏ `name` –≤ —ñ–Ω–¥–µ–∫—Å —á–µ—Ä–µ–∑ `INCLUDE`).
::

---

## –ú–Ω–æ–∂–∏–Ω–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞ –æ–¥–Ω—ñ–π —Ç–∞–±–ª–∏—Ü—ñ

```sql
CREATE TABLE Products (
    product_id INT PRIMARY KEY CLUSTERED,         -- Clustered Index #1
    category_id INT,
    name NVARCHAR(200),
    price DECIMAL(10,2),
    stock_quantity INT
);

-- Non-Clustered Indexes
CREATE NONCLUSTERED INDEX IX_Products_Category
    ON Products(category_id);                     -- Index #2

CREATE NONCLUSTERED INDEX IX_Products_Name
    ON Products(name);                            -- Index #3

CREATE NONCLUSTERED INDEX IX_Products_Price
    ON Products(price);                           -- Index #4
```

**–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è**:

::mermaid

```mermaid
graph TD
    Table[Products Table<br/>Clustered Index:<br/>product_id]

    Table --> NC1[Non-Clustered Index<br/>category_id]
    Table --> NC2[Non-Clustered Index<br/>name]
    Table --> NC3[Non-Clustered Index<br/>price]

    NC1 -.Key Lookup.-> Table
    NC2 -.Key Lookup.-> Table
    NC3 -.Key Lookup.-> Table

    style Table fill:#10b981,color:#fff
    style NC1 fill:#3b82f6,color:#fff
    style NC2 fill:#3b82f6,color:#fff
    style NC3 fill:#3b82f6,color:#fff
```

::

---

## Composite Indexes (–°–∫–ª–∞–¥–µ–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏)

**Composite Index** ‚Äî —Ü–µ —ñ–Ω–¥–µ–∫—Å –Ω–∞ **–¥–µ–∫—ñ–ª—å–∫–∞ —Å—Ç–æ–≤–ø—Ü—ñ–≤** –æ–¥–Ω–æ—á–∞—Å–Ω–æ.

```sql
CREATE INDEX IX_Users_LastName_FirstName
ON Users(last_name, first_name);
```

### –ü–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–≤–ø—Ü—ñ–≤ –º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è!

::tabs
::tabs-item{label="last_name, first_name"}

```sql
-- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î —ñ–Ω–¥–µ–∫—Å
SELECT * FROM Users
WHERE last_name = 'Smith';

-- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î —ñ–Ω–¥–µ–∫—Å
SELECT * FROM Users
WHERE last_name = 'Smith' AND first_name = 'John';

-- ‚ùå –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î —ñ–Ω–¥–µ–∫—Å (first_name –Ω–µ –ø–µ—Ä—à–∏–π!)
SELECT * FROM Users
WHERE first_name = 'John';
```

::

::tabs-item{label="first_name, last_name"}

```sql
-- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î —ñ–Ω–¥–µ–∫—Å
SELECT * FROM Users
WHERE first_name = 'John';

-- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î —ñ–Ω–¥–µ–∫—Å
SELECT * FROM Users
WHERE first_name = 'John' AND last_name = 'Smith';

-- ‚ùå –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î —ñ–Ω–¥–µ–∫—Å
SELECT * FROM Users
WHERE last_name = 'Smith';
```

::
::

**–ü—Ä–∞–≤–∏–ª–æ –ª—ñ–≤–æ—ó —Ä—É–∫–∏** (Leftmost Prefix Rule):  
–Ü–Ω–¥–µ–∫—Å –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏, —è–∫—â–æ –∑–∞–ø–∏—Ç —Ñ—ñ–ª—å—Ç—Ä—É—î –∑–∞ **–ø–µ—Ä—à–∏–º —Å—Ç–æ–≤–ø—Ü–µ–º** –≤ —ñ–Ω–¥–µ–∫—Å—ñ (–∞–±–æ –ø–µ—Ä—à–∏–º + –¥—Ä—É–≥–∏–º, –∞–±–æ –≤—Å—ñ–º–∞).

---

## Covering Index (–í–∫–ª—é—á–µ–Ω–∏–π —ñ–Ω–¥–µ–∫—Å)

**–ü—Ä–æ–±–ª–µ–º–∞**: Key Lookup –ø–æ–≤—ñ–ª—å–Ω–∏–π, –±–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ 2 –æ–ø–µ—Ä–∞—Ü—ñ—ó (non-clustered index ‚Üí clustered index).

**–†—ñ—à–µ–Ω–Ω—è**: –í–∫–ª—é—á–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–æ–≤–ø—Ü—ñ –≤ —ñ–Ω–¥–µ–∫—Å —á–µ—Ä–µ–∑ `INCLUDE`.

```sql
-- –ó–∞–ø–∏—Ç, —è–∫–∏–π —á–∞—Å—Ç–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è
SELECT email, first_name, last_name
FROM Users
WHERE email = 'ivan@example.com';

-- ‚ùå –ë–µ–∑ INCLUDE
CREATE INDEX IX_Users_Email ON Users(email);
-- –ü—Ä–æ—Ü–µ—Å: Index Seek (email) ‚Üí Key Lookup (first_name, last_name) üí• –ü–û–í–Ü–õ–¨–ù–û
```

```sql
-- ‚úÖ –ó INCLUDE (Covering Index)
CREATE INDEX IX_Users_Email_Covering
ON Users(email)
INCLUDE (first_name, last_name);

-- –ü—Ä–æ—Ü–µ—Å: Index Seek (email) ‚Üí –í–°–Ü –î–ê–ù–Ü –≤ —ñ–Ω–¥–µ–∫—Å—ñ! ‚ö° –®–í–ò–î–ö–û
-- –ù–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω Key Lookup!
```

::tip
**Covering Index**: –Ü–Ω–¥–µ–∫—Å –º—ñ—Å—Ç–∏—Ç—å **–í–°–Ü** —Å—Ç–æ–≤–ø—Ü—ñ, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∑–∞–ø–∏—Ç—É. Query Optimizer –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç **–ª–∏—à–µ –∑ —ñ–Ω–¥–µ–∫—Å—É**, –Ω–µ –∑–≤–µ—Ä—Ç–∞—é—á–∏—Å—å –¥–æ —Ç–∞–±–ª–∏—Ü—ñ.
::

---

## Unique Index

**Unique Index** –≥–∞—Ä–∞–Ω—Ç—É—î —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å –∑–Ω–∞—á–µ–Ω—å —É —Å—Ç–æ–≤–ø—Ü—ñ.

```sql
CREATE UNIQUE INDEX IX_Users_Email_Unique
ON Users(email);

-- –¢–µ–ø–µ—Ä –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤—Å—Ç–∞–≤–∏—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç
INSERT INTO Users (email) VALUES ('test@example.com');  -- ‚úÖ OK
INSERT INTO Users (email) VALUES ('test@example.com');  -- ‚ùå ERROR!
```

::note
**PRIMARY KEY –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î UNIQUE CLUSTERED INDEX**.  
**UNIQUE constraint –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î UNIQUE INDEX**.
::

---

## Filtered Index

**Filtered Index** ‚Äî —Ü–µ —ñ–Ω–¥–µ–∫—Å –∑ `WHERE` —É–º–æ–≤–æ—é, —è–∫–∏–π —ñ–Ω–¥–µ–∫—Å—É—î –ª–∏—à–µ **—á–∞—Å—Ç–∏–Ω—É —Ä—è–¥–∫—ñ–≤**.

```sql
-- –ü—Ä–æ–±–ª–µ–º–∞: —Ç—ñ–ª—å–∫–∏ 1% –∑–∞–º–æ–≤–ª–µ–Ω—å –∞–∫—Ç–∏–≤–Ω—ñ, –∞–ª–µ –º–∏ —á–∞—Å—Ç–æ —ó—Ö —à—É–∫–∞—î–º–æ
CREATE TABLE Orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    status NVARCHAR(20),  -- 'Active', 'Completed', 'Cancelled'
    order_date DATE
);

-- ‚ùå –ó–≤–∏—á–∞–π–Ω–∏–π —ñ–Ω–¥–µ–∫—Å (—ñ–Ω–¥–µ–∫—Å—É—î –í–°–Ü 10 –º–ª–Ω —Ä—è–¥–∫—ñ–≤)
CREATE INDEX IX_Orders_Status ON Orders(status);
```

```sql
-- ‚úÖ Filtered Index (—ñ–Ω–¥–µ–∫—Å—É—î –ª–∏—à–µ –∞–∫—Ç–∏–≤–Ω—ñ ~ 100K —Ä—è–¥–∫—ñ–≤)
CREATE INDEX IX_Orders_Active
ON Orders(customer_id, order_date)
WHERE status = 'Active';

-- –í–∏–≥—Ä–∞—à: –º–µ–Ω—à–∏–π —Ä–æ–∑–º—ñ—Ä —ñ–Ω–¥–µ–∫—Å—É, —à–≤–∏–¥—à–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
```

::tip
**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Filtered Index**:

- –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø—ñ–¥–º–Ω–æ–∂–∏–Ω–∞ —Ä—è–¥–∫—ñ–≤ (–Ω–∞–ø—Ä., `is_deleted = 0`)
- –î–ª—è —á–∞—Å—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö (–Ω–∞–ø—Ä., `created_date >= '2024-01-01'`)
- –ï–∫–æ–Ω–æ–º—ñ—è –º—ñ—Å—Ü—è —Ç–∞ —à–≤–∏–¥—à–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è

::

---

## Index Fragmentation (–§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è)

### –©–æ —Ç–∞–∫–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è?

–ó —á–∞—Å–æ–º, —á–µ—Ä–µ–∑ INSERT/UPDATE/DELETE, —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —ñ–Ω–¥–µ–∫—Å—É —Å—Ç–∞—é—Ç—å **–Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–º–∏** –∞–±–æ **—Ä–æ–∑–∫–∏–¥–∞–Ω–∏–º–∏** –ø–æ –¥–∏—Å–∫—É.

::mermaid

```mermaid
graph LR
    subgraph –Ü–¥–µ–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
    P1[Page 1<br/>100% full] --> P2[Page 2<br/>100% full] --> P3[Page 3<br/>100% full]
    end

    subgraph –§—Ä–∞–≥–º–µ–Ω—Ç–æ–≤–∞–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
    F1[Page 1<br/>40% full] -.-> F5[Page 5<br/>60% full] -.-> F2[Page 2<br/>30% full]
    end

    style P1 fill:#10b981,color:#fff
    style P2 fill:#10b981,color:#fff
    style P3 fill:#10b981,color:#fff
    style F1 fill:#ef4444,color:#fff
    style F5 fill:#ef4444,color:#fff
    style F2 fill:#ef4444,color:#fff
```

::

**–ü—Ä–æ–±–ª–µ–º–∏**:

- –ë—ñ–ª—å—à–µ –æ–ø–µ—Ä–∞—Ü—ñ–π —á–∏—Ç–∞–Ω–Ω—è (–ø–æ—Ç—Ä—ñ–±–Ω–æ –±—ñ–ª—å—à–µ pages)
- –ü–æ–≤—ñ–ª—å–Ω—ñ—à—ñ range queries
- –ú–∞—Ä–Ω—É–≤–∞–Ω–Ω—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó

```sql
SELECT
    OBJECT_NAME(ips.object_id) AS TableName,
    i.name AS IndexName,
    ips.avg_fragmentation_in_percent,
    ips.page_count
FROM sys.dm_db_index_physical_stats(
    DB_ID(), NULL, NULL, NULL, 'DETAILED'
) AS ips
INNER JOIN sys.indexes AS i
    ON ips.object_id = i.object_id
    AND ips.index_id = i.index_id
WHERE ips.avg_fragmentation_in_percent > 10  -- –ë—ñ–ª—å—à–µ 10% —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó
ORDER BY ips.avg_fragmentation_in_percent DESC;
```

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—ó

::tabs
::tabs-item{label="REORGANIZE (5-30%)"}

```sql
-- –î–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è online (–Ω–µ –±–ª–æ–∫—É—î —Ç–∞–±–ª–∏—Ü—é)
ALTER INDEX IX_Users_Email ON Users REORGANIZE;
```

**–ö–æ–ª–∏**: –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è 5-30%  
**–ü–µ—Ä–µ–≤–∞–≥–∏**: Online, –Ω–µ –±–ª–æ–∫—É—î  
**–ù–µ–¥–æ–ª—ñ–∫–∏**: –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ, –Ω–µ –∑–∞–≤–∂–¥–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
::

::tabs-item{label="REBUILD (>30%)"}

```sql
-- –ü–æ–≤–Ω–∞ –ø–µ—Ä–µ–±—É–¥–æ–≤–∞ —ñ–Ω–¥–µ–∫—Å—É
ALTER INDEX IX_Users_Email ON Users REBUILD;
```

**–ö–æ–ª–∏**: –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è >30%  
**–ü–µ—Ä–µ–≤–∞–≥–∏**: –ü–æ–≤–Ω—ñ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è, –æ–Ω–æ–≤–ª—é—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É  
**–ù–µ–¥–æ–ª—ñ–∫–∏**: –ë–ª–æ–∫—É—î —Ç–∞–±–ª–∏—Ü—é (—è–∫—â–æ –Ω–µ ONLINE)
::

::tabs-item{label="REBUILD ONLINE"}

```sql
-- –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ –±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (Enterprise Edition)
ALTER INDEX IX_Users_Email ON Users
REBUILD WITH (ONLINE = ON);
```

**Enterprise Edition only**  
–î–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–±—É–¥–æ–≤—É –±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
::
::

---

## Best Practices: –ö–æ–ª–∏ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏

### ‚úÖ –°—Ç–≤–æ—Ä—é–π—Ç–µ —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞:

1. **Primary Keys** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
2. **Foreign Keys** (–¥–ª—è JOIN queries)
3. **WHERE clauses** (—á–∞—Å—Ç—ñ —Ñ—ñ–ª—å—Ç—Ä–∏)
4. **ORDER BY** (—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è)
5. **GROUP BY** (–∞–≥—Ä–µ–≥–∞—Ü—ñ—è)

### ‚ùå –ù–ï —Å—Ç–≤–æ—Ä—é–π—Ç–µ —ñ–Ω–¥–µ–∫—Å–∏ –Ω–∞:

1. **–ú–∞–ª—ñ —Ç–∞–±–ª–∏—Ü—ñ** (<1000 —Ä—è–¥–∫—ñ–≤) ‚Äî table scan —à–≤–∏–¥—à–µ
2. **–°—Ç–æ–≤–ø—Ü—ñ –∑ –º–∞–ª–æ—é —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é** (–Ω–∞–ø—Ä., `gender` –∑ 2 –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏)
3. **–ß–∞—Å—Ç—ñ UPDATE/INSERT —Ç–∞–±–ª–∏—Ü—ñ** ‚Äî —ñ–Ω–¥–µ–∫—Å–∏ —É–ø–æ–≤—ñ–ª—å–Ω—é—é—Ç—å –∑–º—ñ–Ω–∏
4. **–®–∏—Ä–æ–∫—ñ —Å—Ç–æ–≤–ø—Ü—ñ** (`NVARCHAR(MAX)`, `XML`) ‚Äî —ñ–Ω–¥–µ–∫—Å –±—É–¥–µ –≤–µ–ª–∏—á–µ–∑–Ω–∏–º

### –ü—Ä–∏–∫–ª–∞–¥: –ê–Ω–∞–ª—ñ–∑ –∑–∞–ø–∏—Ç—É

```sql
-- –ß–∞—Å—Ç–æ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–π –∑–∞–ø–∏—Ç
SELECT product_id, name, price
FROM Products
WHERE category_id = 5
  AND price > 100
ORDER BY price DESC;

-- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å
CREATE INDEX IX_Products_Category_Price
ON Products(category_id, price DESC)
INCLUDE (name);
```

**–ß–æ–º—É —Å–∞–º–µ —Ç–∞–∫–∏–π —ñ–Ω–¥–µ–∫—Å?**

- `category_id` ‚Äî –ø–µ—Ä—à–∏–π, –±–æ —Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ –∑–∞ –Ω–∏–º (`WHERE`)
- `price DESC` ‚Äî –¥—Ä—É–≥–∏–π, –±–æ —Å–æ—Ä—Ç—É—î–º–æ (`ORDER BY DESC`)
- `INCLUDE (name)` ‚Äî covering index (–Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω key lookup)

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É

```sql
-- –¢–∞–±–ª–∏—Ü—è
CREATE TABLE Orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    total_amount DECIMAL(10,2),
    status NVARCHAR(20)
);

-- –ü–æ–≤—ñ–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç (10 —Å–µ–∫—É–Ω–¥ –Ω–∞ 10 –º–ª–Ω —Ä—è–¥–∫—ñ–≤)
SELECT order_id, customer_id, total_amount
FROM Orders
WHERE customer_id = 12345
  AND order_date >= '2024-01-01'
  AND status = 'Completed';
```

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π —ñ–Ω–¥–µ–∫—Å –¥–ª—è —Ü—å–æ–≥–æ –∑–∞–ø–∏—Ç—É.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
CREATE INDEX IX_Orders_Customer_Date_Status
ON Orders(customer_id, order_date, status)
INCLUDE (total_amount);
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:

- `customer_id` ‚Äî –ø–µ—Ä—à–∏–π (–Ω–∞–π—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–π —Ñ—ñ–ª—å—Ç—Ä)
- `order_date` ‚Äî –¥—Ä—É–≥–∏–π (range filter)
- `status` ‚Äî —Ç—Ä–µ—Ç—ñ–π (equality filter)
- `INCLUDE (total_amount)` ‚Äî covering index
      </details>

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—é —ñ–Ω–¥–µ–∫—Å—ñ–≤ –≤–∞—à–æ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –≤–∏–∫–æ–Ω–∞–π—Ç–µ reorganize/rebuild –¥–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

---

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–Ω—å

::tally-embed{id="mLQBJY" title="–¢–µ—Å—Ç: –Ü–Ω–¥–µ–∫—Å–∏ MS SQL Server"}
::

::note
**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –Ø–∫—â–æ —Ç–µ—Å—Ç –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è, –ø–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ [–ø—Ä—è–º–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º](https://tally.so/r/mLQBJY).
::

---

## –†–µ–∑—é–º–µ

::tip
**–ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏**:

1. **–Ü–Ω–¥–µ–∫—Å–∏ == –®–≤–∏–¥–∫—ñ—Å—Ç—å**: –ü—Ä–∞–≤–∏–ª—å–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏ –º–æ–∂—É—Ç—å –ø—Ä–∏—Å–∫–æ—Ä–∏—Ç–∏ –∑–∞–ø–∏—Ç–∏ –≤ —Ç–∏—Å—è—á—ñ —Ä–∞–∑—ñ–≤
2. **B-Tree —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –ó–∞–±–µ–∑–ø–µ—á—É—î O(log N) –ø–æ—à—É–∫
3. **Clustered Index**: –û–¥–∏–Ω –Ω–∞ —Ç–∞–±–ª–∏—Ü—é, –º—ñ—Å—Ç–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
4. **Non-Clustered Index**: –ú–Ω–æ–∂–∏–Ω–Ω—ñ, –º—ñ—Å—Ç—è—Ç—å –ø–æ–∫–∞–∂—á–∏–∫–∏
5. **Composite Indexes**: –ü–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–≤–ø—Ü—ñ–≤ –∫—Ä–∏—Ç–∏—á–Ω–∏–π
6. **Covering Index**: –í–∫–ª—é—á–∞—î –≤—Å—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å—Ç–æ–≤–ø—Ü—ñ (INCLUDE)
7. **–§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü—ñ—è**: –†–µ–≥—É–ª—è—Ä–Ω–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤ –Ω–µ–æ–±—Ö—ñ–¥–Ω–µ

::

**–ù–∞—Å—Ç—É–ø–Ω–∞ —Ç–µ–º–∞**: [–°–∏—Å—Ç–µ–º–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö MS SQL Server](./04.system-databases.md)
