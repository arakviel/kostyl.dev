---
title: –ê–≥—Ä–µ–≥–∞—Ü—ñ—ó –∑ JOIN
description: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è COUNT, SUM, AVG, MIN, MAX –∑ JOIN, GROUP BY –∑ –º–Ω–æ–∂–∏–Ω–Ω–∏–º–∏ —Ç–∞–±–ª–∏—Ü—è–º–∏, —Å–∫–ª–∞–¥–Ω—ñ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –∑–∞–ø–∏—Ç–∏
---

# –ê–≥—Ä–µ–≥–∞—Ü—ñ—ó –∑ JOIN

## –ü—Ä–æ–±–ª–µ–º–∞: –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ –º–Ω–æ–∂–∏–Ω–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ

**–ó–∞–¥–∞—á–∞**: –ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ **—É –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ** —ñ –ø–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞–∑–≤—É —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É.

–ü–æ—Ç—Ä—ñ–±–Ω–æ –∑'—î–¥–Ω–∞—Ç–∏ 3 —Ç–∞–±–ª–∏—Ü—ñ + –∞–≥—Ä–µ–≥–∞—Ü—ñ—è:

```sql
Faculties ‚Üí Groups ‚Üí Students
          ‚Üì
    COUNT(Students)
```

**–†—ñ—à–µ–Ω–Ω—è**: –ö–æ–º–±—ñ–Ω–∞—Ü—ñ—è JOIN + GROUP BY!

---

## 1. –ê–≥—Ä–µ–≥–∞—Ç–∏–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó: –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è

| –§—É–Ω–∫—Ü—ñ—è           | –û–ø–∏—Å                          | NULL handling     |
| :---------------- | :---------------------------- | :---------------- |
| **COUNT(column)** | –ö—ñ–ª—å–∫—ñ—Å—Ç—å **–Ω–µ-NULL** –∑–Ω–∞—á–µ–Ω—å | ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞—î NULL |
| **COUNT(\*)**     | –ö—ñ–ª—å–∫—ñ—Å—Ç—å **–≤—Å—ñ—Ö** —Ä—è–¥–∫—ñ–≤     | ‚úÖ –í—Ä–∞—Ö–æ–≤—É—î NULL  |
| **SUM(column)**   | –°—É–º–∞ –∑–Ω–∞—á–µ–Ω—å                  | ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞—î NULL |
| **AVG(column)**   | –°–µ—Ä–µ–¥–Ω—î                       | ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞—î NULL |
| **MIN(column)**   | –ú—ñ–Ω—ñ–º—É–º                       | ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞—î NULL |
| **MAX(column)**   | –ú–∞–∫—Å–∏–º—É–º                      | ‚ùå –ü—Ä–æ–ø—É—Å–∫–∞—î NULL |

::note
**–í–∞–∂–ª–∏–≤–æ**: `COUNT(column)` —Ç–∞ `COUNT(*)` **—Ä—ñ–∑–Ω—ñ**!
::

---

## 2. COUNT –∑ JOIN

### 2.1. –ë–∞–∑–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥

```sql
-- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —É –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ
SELECT
    G.Name AS GroupName,
    COUNT(S.Id) AS StudentsCount  -- COUNT(S.Id) - –≤—Ä–∞—Ö–æ–≤—É—î NULL!
FROM Groups AS G
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name
ORDER BY StudentsCount DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | StudentsCount |
| :-------- | :------------ |
| 31PR11    | 5             |
| 32PR31    | 3             |
| 33PR51    | 0             |

::tip
**LEFT JOIN** –≤–∞–∂–ª–∏–≤–∏–π - —ñ–Ω–∞–∫—à–µ –≥—Ä—É–ø–∏ –±–µ–∑ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç—å—Å—è!
::

### 2.2. COUNT(\*) vs COUNT(column)

::code-group

```sql [COUNT(*) - –í–°–Ü —Ä—è–¥–∫–∏]
SELECT
    G.Name,
    COUNT(*) AS TotalRows  -- –í—Å—ñ —Ä—è–¥–∫–∏ –ø—ñ—Å–ª—è JOIN
FROM Groups AS G
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name;

-- –ì—Ä—É–ø–∞ –±–µ–∑ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤: COUNT(*) = 1 (—Å–∞–º —Ä—è–¥–æ–∫ –≥—Ä—É–ø–∏)
```

```sql [COUNT(S.Id) - —Ç—ñ–ª—å–∫–∏ –Ω–µ-NULL]
SELECT
    G.Name,
    COUNT(S.Id) AS StudentsCount  -- –¢—ñ–ª—å–∫–∏ –¥–µ S.Id NOT NULL
FROM Groups AS G
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name;

-- –ì—Ä—É–ø–∞ –±–µ–∑ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤: COUNT(S.Id) = 0 ‚úÖ
```

::

::warning
**–ó LEFT JOIN –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ** `COUNT(RightTable.Column)`, **–ù–ï** `COUNT(*)`!
::

---

## 3. GROUP BY –∑ –º–Ω–æ–∂–∏–Ω–Ω–∏–º–∏ —Ç–∞–±–ª–∏—Ü—è–º–∏

### 3.1. –î–≤–∞ —Ä—ñ–≤–Ω—ñ (Groups + Faculties)

```sql
-- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ø–æ –≥—Ä—É–ø–∞—Ö + —Ñ–∞–∫—É–ª—å—Ç–µ—Ç
SELECT
    F.Name AS Faculty,
    G.Name AS GroupName,
    COUNT(S.Id) AS StudentsCount
FROM Faculties AS F
INNER JOIN Groups AS G
    ON F.Id = G.FacultyId
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY F.Name, G.Name  -- –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ –æ–±–æ—Ö!
ORDER BY F.Name, StudentsCount DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| Faculty          | GroupName | StudentsCount |
| :--------------- | :-------- | :------------ |
| Computer Science | 31PR11    | 5             |
| Computer Science | 32PR31    | 3             |
| Computer Science | 33PR51    | 0             |
| Mathematics      | 41MA11    | 4             |

### 3.2. –ê–≥—Ä–µ–≥–∞—Ü—ñ—è –ø–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É (–æ–¥–∏–Ω —Ä—ñ–≤–µ–Ω—å)

```sql
-- –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ù–ê –§–ê–ö–£–õ–¨–¢–ï–¢–Ü
SELECT
    F.Name AS Faculty,
    COUNT(S.Id) AS TotalStudents
FROM Faculties AS F
LEFT JOIN Groups AS G
    ON F.Id = G.FacultyId
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY F.Name  -- –¢—ñ–ª—å–∫–∏ –ø–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É
ORDER BY TotalStudents DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| Faculty          | TotalStudents |
| :--------------- | :------------ |
| Computer Science | 8             |
| Mathematics      | 4             |
| Physics          | 0             |

---

## 4. SUM, AVG –∑ JOIN

### 4.1. –°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª –ø–æ –≥—Ä—É–ø–∞—Ö

```sql
-- –°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –≤ –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ
SELECT
    G.Name AS GroupName,
    AVG(S.Grade) AS AvgGrade,
    COUNT(S.Id) AS StudentsCount
FROM Groups AS G
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name
ORDER BY AvgGrade DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | AvgGrade | StudentsCount |
| :-------- | :------- | :------------ |
| 32PR31    | 85.3     | 3             |
| 31PR11    | 78.2     | 5             |
| 33PR51    | NULL     | 0             |

::note
`AVG(NULL)` –ø–æ–≤–µ—Ä—Ç–∞—î `NULL` - –≥—Ä—É–ø–∞ –±–µ–∑ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤.
::

### 4.2. –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –±–∞–ª—ñ–≤ –ø–æ –∫–∞—Ñ–µ–¥—Ä–∞—Ö

```sql
-- –°—É–º–∞ –≤—Å—ñ—Ö –±–∞–ª—ñ–≤ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤ –∫–æ–∂–Ω–æ—ó –∫–∞—Ñ–µ–¥—Ä–∏
SELECT
    D.Name AS Department,
    SUM(A.Grade) AS TotalGrade,
    COUNT(A.Id) AS AssessmentsCount
FROM Departments AS D
LEFT JOIN Teachers AS T
    ON D.Id = T.DepartmentId
LEFT JOIN Assessments AS A
    ON T.Id = A.TeacherId
GROUP BY D.Name
ORDER BY TotalGrade DESC;
```

---

## 5. MIN, MAX –∑ JOIN

### 5.1. –ù–∞–π–∫—Ä–∞—â–∏–π —Ç–∞ –Ω–∞–π–≥—ñ—Ä—à–∏–π –±–∞–ª

```sql
-- –ù–∞–π–≤–∏—â–∏–π —Ç–∞ –Ω–∞–π–Ω–∏–∂—á–∏–π –±–∞–ª –≤ –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ
SELECT
    G.Name AS GroupName,
    MAX(S.Grade) AS MaxGrade,
    MIN(S.Grade) AS MinGrade,
    AVG(S.Grade) AS AvgGrade
FROM Groups AS G
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name
HAVING MAX(S.Grade) IS NOT NULL  -- –í–∏–∫–ª—é—á–∏—Ç–∏ –≥—Ä—É–ø–∏ –±–µ–∑ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
ORDER BY AvgGrade DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | MaxGrade | MinGrade | AvgGrade |
| :-------- | :------- | :------- | :------- |
| 32PR31    | 95       | 75       | 85.3     |
| 31PR11    | 90       | 65       | 78.2     |

---

## 6. HAVING –∑ JOIN

### 6.1. –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø—ñ—Å–ª—è –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó

```sql
-- –ì—Ä—É–ø–∏, –¥–µ —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª > 80
SELECT
    G.Name AS GroupName,
    AVG(S.Grade) AS AvgGrade,
    COUNT(S.Id) AS StudentsCount
FROM Groups AS G
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name
HAVING AVG(S.Grade) > 80  -- HAVING - –ø—ñ—Å–ª—è GROUP BY!
ORDER BY AvgGrade DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | AvgGrade | StudentsCount |
| :-------- | :------- | :------------ |
| 32PR31    | 85.3     | 3             |

::note
**WHERE vs HAVING**:

- `WHERE` - —Ñ—ñ–ª—å—Ç—Ä **–î–û** GROUP BY (–æ–∫—Ä–µ–º—ñ —Ä—è–¥–∫–∏)
- `HAVING` - —Ñ—ñ–ª—å—Ç—Ä **–ü–Ü–°–õ–Ø** GROUP BY (–≥—Ä—É–ø–∏)

::

### 6.2. –ö–æ–º–±—ñ–Ω–∞—Ü—ñ—è WHERE + HAVING

```sql
-- –§–∞–∫—É–ª—å—Ç–µ—Ç–∏ "Computer Science" –∑ >5 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
SELECT
    F.Name AS Faculty,
    COUNT(S.Id) AS StudentsCount
FROM Faculties AS F
INNER JOIN Groups AS G
    ON F.Id = G.FacultyId
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
WHERE F.Name = 'Computer Science'  -- WHERE: –¥–æ GROUP BY
GROUP BY F.Name
HAVING COUNT(S.Id) > 5;  -- HAVING: –ø—ñ—Å–ª—è GROUP BY
```

---

## 7. –ü—Ä–æ–±–ª–µ–º–∏ duplicate rows –ø—Ä–∏ JOIN

### 7.1. –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ COUNT

```sql
-- ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ü–æ–¥–≤–æ—î–Ω–Ω—è —Ä—è–¥–∫—ñ–≤!
SELECT
    G.Name,
    COUNT(S.Id) AS StudentsCount,
    COUNT(T.Id) AS TeachersCount  -- –ü–æ–º–∏–ª–∫–∞!
FROM Groups AS G
LEFT JOIN Students AS S ON G.Id = S.GroupId
LEFT JOIN TeachersGroups AS TG ON G.Id = TG.GroupId
LEFT JOIN Teachers AS T ON TG.TeacherId = T.Id
GROUP BY G.Name;
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫—â–æ —É –≥—Ä—É–ø—ñ 3 —Å—Ç—É–¥–µ–Ω—Ç–∏ —Ç–∞ 2 –≤–∏–∫–ª–∞–¥–∞—á—ñ, –ø—ñ—Å–ª—è JOIN –±—É–¥–µ **6 —Ä—è–¥–∫—ñ–≤** (3√ó2)!

```
–ì—Ä—É–ø–∞ ‚Üí 3 —Å—Ç—É–¥–µ–Ω—Ç–∏
–ì—Ä—É–ø–∞ ‚Üí 2 –≤–∏–∫–ª–∞–¥–∞—á—ñ
      ‚Üì CROSS JOIN effect
   6 —Ä—è–¥–∫—ñ–≤!
```

### 7.2. –†—ñ—à–µ–Ω–Ω—è 1: DISTINCT COUNT

```sql
-- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ COUNT(DISTINCT)
SELECT
    G.Name,
    COUNT(DISTINCT S.Id) AS StudentsCount,
    COUNT(DISTINCT T.Id) AS TeachersCount
FROM Groups AS G
LEFT JOIN Students AS S ON G.Id = S.GroupId
LEFT JOIN TeachersGroups AS TG ON G.Id = TG.GroupId
LEFT JOIN Teachers AS T ON TG.TeacherId = T.Id
GROUP BY G.Name;
```

### 7.3. –†—ñ—à–µ–Ω–Ω—è 2: –û–∫—Ä–µ–º—ñ –ø—ñ–¥–∑–∞–ø–∏—Ç–∏

```sql
-- ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –û–∫—Ä–µ–º—ñ –ø—ñ–¥–∑–∞–ø–∏—Ç–∏
SELECT
    G.Name,
    (SELECT COUNT(*) FROM Students WHERE GroupId = G.Id) AS StudentsCount,
    (SELECT COUNT(*) FROM TeachersGroups WHERE GroupId = G.Id) AS TeachersCount
FROM Groups AS G;
```

---

## 8. –°–∫–ª–∞–¥–Ω—ñ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –∑–∞–ø–∏—Ç–∏

### 8.1. –¢–æ–ø-3 –≥—Ä—É–ø–∏ –ø–æ —Å–µ—Ä–µ–¥–Ω—å–æ–º—É –±–∞–ª—É

```sql
SELECT TOP 3
    G.Name AS GroupName,
    F.Name AS Faculty,
    AVG(S.Grade) AS AvgGrade,
    COUNT(S.Id) AS StudentsCount
FROM Groups AS G
INNER JOIN Faculties AS F
    ON G.FacultyId = F.Id
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name, F.Name
HAVING COUNT(S.Id) > 0  -- –í–∏–∫–ª—é—á–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ –≥—Ä—É–ø–∏
ORDER BY AvgGrade DESC;
```

### 8.2. –ö–∞—Ñ–µ–¥—Ä–∏ –∑ –Ω–∞–π–±—ñ–ª—å—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø—Ä–µ–¥–º–µ—Ç—ñ–≤

```sql
SELECT
    D.Name AS Department,
    COUNT(DISTINCT TS.SubjectId) AS SubjectsCount,
    COUNT(DISTINCT T.Id) AS TeachersCount
FROM Departments AS D
LEFT JOIN Teachers AS T
    ON D.Id = T.DepartmentId
LEFT JOIN TeachersSubjects AS TS
    ON T.Id = TS.TeacherId
GROUP BY D.Name
ORDER BY SubjectsCount DESC;
```

### 8.3. –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ (percentiles)

```sql
-- –ì—Ä—É–ø–∏ –∑ avg –±—ñ–ª—å—à–µ –∑–∞ –∑–∞–≥–∞–ª—å–Ω–∏–π —Å–µ—Ä–µ–¥–Ω—ñ–π
SELECT
    G.Name,
    AVG(S.Grade) AS GroupAvg,
    (SELECT AVG(Grade) FROM Students) AS OverallAvg,
    AVG(S.Grade) - (SELECT AVG(Grade) FROM Students) AS Difference
FROM Groups AS G
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name
HAVING AVG(S.Grade) > (SELECT AVG(Grade) FROM Students)
ORDER BY Difference DESC;
```

---

## 9. Performance Optimization

### 9.1. –Ü–Ω–¥–µ–∫—Å–∏ –¥–ª—è JOIN + GROUP BY

```sql
-- –Ü–Ω–¥–µ–∫—Å–∏ –Ω–∞ FK (–¥–ª—è JOIN)
CREATE INDEX IX_Students_GroupId ON Students(GroupId);
CREATE INDEX IX_Groups_FacultyId ON Groups(FacultyId);

-- –Ü–Ω–¥–µ–∫—Å –Ω–∞ GROUP BY column
CREATE INDEX IX_Students_Grade ON Students(Grade);
```

### 9.2. Covering Index

```sql
-- –í–∫–ª—é—á–∏—Ç–∏ –≤—Å—ñ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å—Ç–æ–≤–ø—Ü—ñ –≤ —ñ–Ω–¥–µ–∫—Å
CREATE INDEX IX_Students_Covering
ON Students(GroupId, Grade)
INCLUDE (FirstName, LastName);
```

### 9.3. –£–Ω–∏–∫–∞–π—Ç–µ SELECT \*

```sql
-- ‚ùå –ü–æ–≤—ñ–ª—å–Ω–æ
SELECT *, COUNT(S.Id)
FROM Groups G
LEFT JOIN Students S ON G.Id = S.GroupId
GROUP BY G.Id, G.Name, ...;  -- –í—Å—ñ —Å—Ç–æ–≤–ø—Ü—ñ!

-- ‚úÖ –®–≤–∏–¥—à–µ
SELECT G.Name, COUNT(S.Id)
FROM Groups G
LEFT JOIN Students S ON G.Id = S.GroupId
GROUP BY G.Name;
```

---

## 10. –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

### 10.1. –ó–≤—ñ—Ç –ø–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞—Ö

```sql
-- –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞—Ö
SELECT
    F.Name AS Faculty,
    COUNT(DISTINCT G.Id) AS GroupsCount,
    COUNT(DISTINCT S.Id) AS StudentsCount,
    AVG(S.Grade) AS AvgGrade,
    MAX(S.Grade) AS MaxGrade,
    MIN(S.Grade) AS MinGrade
FROM Faculties AS F
LEFT JOIN Groups AS G ON F.Id = G.FacultyId
LEFT JOIN Students AS S ON G.Id = S.GroupId
GROUP BY F.Name
ORDER BY StudentsCount DESC;
```

### 10.2. –ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤

```sql
-- –í–∏–∫–ª–∞–¥–∞—á—ñ –∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —Ç–∞ –≥—Ä—É–ø
SELECT
    T.FirstName + ' ' + T.LastName AS Teacher,
    D.Name AS Department,
    COUNT(DISTINCT TS.SubjectId) AS SubjectsCount,
    COUNT(DISTINCT TS.GroupId) AS GroupsCount
FROM Teachers AS T
INNER JOIN Departments AS D
    ON T.DepartmentId = D.Id
LEFT JOIN TeachersSubjects AS TS
    ON T.Id = TS.TeacherId
GROUP BY T.FirstName, T.LastName, D.Name
ORDER BY SubjectsCount DESC, GroupsCount DESC;
```

### 10.3. –û—Ü—ñ–Ω–∫–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞—Ö

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ü—ñ–Ω–æ–∫ –ø–æ –∫–æ–∂–Ω–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É
SELECT
    S.Name AS Subject,
    COUNT(A.Id) AS AssessmentsCount,
    AVG(A.Grade) AS AvgGrade,
    MAX(A.Grade) AS MaxGrade,
    MIN(A.Grade) AS MinGrade,
    COUNT(DISTINCT A.StudentId) AS UniqueStudents
FROM Subjects AS S
LEFT JOIN Assessments AS A
    ON S.Id = A.SubjectId
GROUP BY S.Name
HAVING COUNT(A.Id) > 0  -- –¢—ñ–ª—å–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∏ –∑ –æ—Ü—ñ–Ω–∫–∞–º–∏
ORDER BY AvgGrade DESC;
```

---

## 11. Best Practices

::card-group

::card{title="1. LEFT JOIN –¥–ª—è COUNT" icon="i-lucide-arrow-left"}

```sql
-- ‚úÖ –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –≥—Ä—É–ø–∏
FROM Groups G
LEFT JOIN Students S
    ON G.Id = S.GroupId

-- COUNT(S.Id) –ø–æ–≤–µ—Ä–Ω–µ 0 –¥–ª—è –ø–æ—Ä–æ–∂–Ω—ñ—Ö
```

::

::card{title="2. COUNT(column) vs COUNT(\*)" icon="i-lucide-hash"}

```sql
-- ‚úÖ –ó LEFT JOIN
COUNT(RightTable.Column)

-- ‚ùå –ó LEFT JOIN
COUNT(*)  -- –ü–æ–≤–µ—Ä–Ω–µ >= 1 –∑–∞–≤–∂–¥–∏!
```

::

::card{title="3. DISTINCT –¥–ª—è multiple JOINs" icon="i-lucide-layers"}

```sql
-- –ü—Ä–∏ –∫—ñ–ª—å–∫–æ—Ö JOIN
COUNT(DISTINCT S.Id)
COUNT(DISTINCT T.Id)
```

::

::card{title="4. HAVING –¥–ª—è –≥—Ä—É–ø" icon="i-lucide-filter"}

```sql
-- –§—ñ–ª—å—Ç—Ä –ø—ñ—Å–ª—è –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó
GROUP BY ...
HAVING COUNT(*) > 5
```

::

::

---

## 12. –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

::accordion

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 1: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø" icon="i-lucide-bar-chart"}

–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –≥—Ä—É–ø–∏ –∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —Ç–∞ —Å–µ—Ä–µ–¥–Ω—ñ–º –±–∞–ª–æ–º.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
SELECT
    G.Name AS GroupName,
    COUNT(S.Id) AS StudentsCount,
    AVG(S.Grade) AS AvgGrade
FROM Groups AS G
LEFT JOIN Students AS S
    ON G.Id = S.GroupId
GROUP BY G.Name
ORDER BY AvgGrade DESC;
```

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 2: –¢–æ–ø –∫–∞—Ñ–µ–¥—Ä–∏" icon="i-lucide-trophy"}

–ó–Ω–∞–π—Ç–∏ –∫–∞—Ñ–µ–¥—Ä–∏ –∑ >3 –≤–∏–∫–ª–∞–¥–∞—á–∞–º–∏, –≤—ñ–¥—Å–æ—Ä—Ç—É–≤–∞—Ç–∏ –ø–æ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
SELECT
    D.Name AS Department,
    COUNT(T.Id) AS TeachersCount
FROM Departments AS D
LEFT JOIN Teachers AS T
    ON D.Id = T.DepartmentId
GROUP BY D.Name
HAVING COUNT(T.Id) > 3
ORDER BY TeachersCount DESC;
```

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 3: –§–∞–∫—É–ª—å—Ç–µ—Ç–∏ –≤–∏—â–µ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ" icon="i-lucide-trending-up"}

–§–∞–∫—É–ª—å—Ç–µ—Ç–∏, –¥–µ —Å–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –≤–∏—â–µ –∑–∞ –∑–∞–≥–∞–ª—å–Ω–∏–π —Å–µ—Ä–µ–¥–Ω—ñ–π.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
SELECT
    F.Name AS Faculty,
    AVG(S.Grade) AS FacultyAvg,
    (SELECT AVG(Grade) FROM Students) AS OverallAvg
FROM Faculties AS F
LEFT JOIN Groups AS G ON F.Id = G.FacultyId
LEFT JOIN Students AS S ON G.Id = S.GroupId
GROUP BY F.Name
HAVING AVG(S.Grade) > (SELECT AVG(Grade) FROM Students);
```

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 4: –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" icon="i-lucide-layers"}

–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç—É: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤, –≥—Ä—É–ø, —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ (DISTINCT!).

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
SELECT
    Sub.Name AS Subject,
    COUNT(DISTINCT TS.TeacherId) AS TeachersCount,
    COUNT(DISTINCT TS.GroupId) AS GroupsCount,
    COUNT(DISTINCT S.Id) AS StudentsCount
FROM Subjects AS Sub
LEFT JOIN TeachersSubjects AS TS
    ON Sub.Id = TS.SubjectId
LEFT JOIN Students AS S
    ON TS.GroupId = S.GroupId
GROUP BY Sub.Name
ORDER BY StudentsCount DESC;
```

</details>

::

::

---

## –†–µ–∑—é–º–µ

::tip
**–ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏ –∞–≥—Ä–µ–≥–∞—Ü—ñ–π –∑ JOIN**:

1. **COUNT –∑ LEFT JOIN**:
    - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `COUNT(RightTable.Column)`, –ù–ï `COUNT(*)`
    - –ü–æ–≤–µ—Ä–Ω–µ 0 –¥–ª—è —Ä—è–¥–∫—ñ–≤ –±–µ–∑ –∑–±—ñ–≥—ñ–≤

2. **GROUP BY –∑ JOIN**:
    - –ì—Ä—É–ø—É–π—Ç–µ –ø–æ –≤—Å—ñ–º –Ω–µ-–∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏–º —Å—Ç–æ–≤–ø—Ü—è–º
    - –ú–æ–∂–Ω–∞ –≥—Ä—É–ø—É–≤–∞—Ç–∏ –ø–æ –∫—ñ–ª—å–∫–æ–º —Ç–∞–±–ª–∏—Ü—è–º

3. **HAVING**:
    - –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è **–ø—ñ—Å–ª—è** –∞–≥—Ä–µ–≥–∞—Ü—ñ—ó
    - WHERE - –¥–æ, HAVING - –ø—ñ—Å–ª—è GROUP BY

4. **Duplicate rows –ø—Ä–æ–±–ª–µ–º–∞**:
    - –ü—Ä–∏ –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö JOIN –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `COUNT(DISTINCT)`
    - –ê–±–æ –æ–∫—Ä–µ–º—ñ –ø—ñ–¥–∑–∞–ø–∏—Ç–∏

5. **Performance**:
    - –Ü–Ω–¥–µ–∫—Å–∏ –Ω–∞ FK —Ç–∞ GROUP BY columns
    - SELECT —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å—Ç–æ–≤–ø—Ü—ñ
    - –£–Ω–∏–∫–∞–π—Ç–µ SELECT \*

**–¢–∏–ø–æ–≤—ñ –∑–∞–ø–∏—Ç–∏**:

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥—Ä—É–ø–∞—Ö/—Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞—Ö
- –¢–æ–ø-N –≥—Ä—É–ø/—Å—Ç—É–¥–µ–Ω—Ç—ñ–≤/–≤–∏–∫–ª–∞–¥–∞—á—ñ–≤
- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ —Å–µ—Ä–µ–¥–Ω—ñ–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏
- –ó–Ω–∞–π—Ç–∏ –∞–Ω–æ–º–∞–ª—ñ—ó (–≥—Ä—É–ø–∏ –±–µ–∑ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, –ø—Ä–µ–¥–º–µ—Ç–∏ –±–µ–∑ –æ—Ü—ñ–Ω–æ–∫)

::

---

**–ü–æ–ø–µ—Ä–µ–¥–Ω—è —Ç–µ–º–∞**: [–ü—ñ–¥–∑–∞–ø–∏—Ç–∏ (Subqueries)](./04.subqueries.md)  
**–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–¥—ñ–ª**: [–ë–∞–∑–æ–≤—ñ SELECT –∑–∞–ø–∏—Ç–∏](../03.sql/03.select-queries-fundamentals.md)
