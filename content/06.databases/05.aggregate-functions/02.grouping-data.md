---
title: –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤ MS SQL Server
description: –ì–ª–∏–±–æ–∫–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è GROUP BY, HAVING, ROLLUP, CUBE —ñ GROUPING SETS –¥–ª—è –±–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –¥–∞–Ω–∏—Ö
---

# –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤ MS SQL Server

## –ü—Ä–æ–±–ª–µ–º–∞: –ß–æ–º—É –Ω–µ –º–æ–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—Ç–∏ —Å—Ç–æ–≤–ø–µ—Ü—å –¥–æ –∞–≥—Ä–µ–≥–∞—Ç—É?

–ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, –º–∏ —Ö–æ—á–µ–º–æ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è —Å–∫—ñ–ª—å–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –Ω–∞–≤—á–∞—î—Ç—å—Å—è –≤ **–∫–æ–∂–Ω—ñ–π** –≥—Ä—É–ø—ñ. –°–ø—Ä–æ–±—É—î–º–æ –Ω–∞–ø–∏—Å–∞—Ç–∏ —Ç–∞–∫–∏–π –∑–∞–ø–∏—Ç:

```sql
-- ‚ùå –¶–ï –ù–ï –°–ü–†–ê–¶–Æ–Ñ!
SELECT
    GroupName,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id;
```

**–ü–æ–º–∏–ª–∫–∞**:

```
Column 'Groups.GroupName' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.
```

### –ß–æ–º—É –≤–∏–Ω–∏–∫–∞—î –ø–æ–º–∏–ª–∫–∞?

::mermaid

```mermaid
graph LR
    subgraph –©–æ —Ö–æ—á–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ GroupName
        A1[30PR11]
        A2[30PR12]
        A3[32SS11]
        A4[32SS12]
    end

    subgraph –©–æ –ø–æ–≤–µ—Ä—Ç–∞—î COUNT
        B[–û–¥–Ω–µ —á–∏—Å–ª–æ: 10]
    end

    subgraph –ü—Ä–æ–±–ª–µ–º–∞
        C[‚ùå 4 –∑–Ω–∞—á–µ–Ω–Ω—è ‚â† 1 –∑–Ω–∞—á–µ–Ω–Ω—è]
    end

    A1 --> C
    A2 --> C
    A3 --> C
    A4 --> C
    B --> C

    style C fill:#ef4444,color:#fff
```

::

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**: `COUNT(*)` –ø–æ–≤–µ—Ä—Ç–∞—î **–æ–¥–Ω–µ** —á–∏—Å–ª–æ (–∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤), –∞ `GroupName` —Ö–æ—á–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ **–±–∞–≥–∞—Ç–æ** –∑–Ω–∞—á–µ–Ω—å (–Ω–∞–∑–≤–∏ –≤—Å—ñ—Ö –≥—Ä—É–ø). SQL –Ω–µ –∑–Ω–∞—î, —è–∫ –ø–æ—î–¥–Ω–∞—Ç–∏ –±–∞–≥–∞—Ç–æ –∑ –æ–¥–Ω–∏–º.

**–£—è–≤–Ω–∏–π –Ω–µ–º–æ–∂–ª–∏–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName                            | student_count |
| :----------------------------------- | ------------: |
| 30PR11<br>30PR12<br>32SS11<br>32SS12 |            10 |

::warning
**–ö–æ–Ω—Ñ–ª—ñ–∫—Ç –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ**: –ê–≥—Ä–µ–≥–∞—Ç–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∑–≥–æ—Ä—Ç–∞—î N —Ä—è–¥–∫—ñ–≤ —É 1, –∞ –Ω–µ–∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏–π —Å—Ç–æ–≤–ø–µ—Ü—å –∑–∞–ª–∏—à–∞—î N —Ä—è–¥–∫—ñ–≤. –¶–µ –ª–æ–≥—ñ—á–Ω–∞ —Å—É–ø–µ—Ä–µ—á–Ω—ñ—Å—Ç—å!
::

---

## –†—ñ—à–µ–Ω–Ω—è: GROUP BY

`GROUP BY` –≤–∏—Ä—ñ—à—É—î —Ü—é –ø—Ä–æ–±–ª–µ–º—É, –¥–æ–∑–≤–æ–ª—è—é—á–∏ **—Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ –¥–∞–Ω—ñ –Ω–∞ –≥—Ä—É–ø–∏** —Ç–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –∞–≥—Ä–µ–≥–∞—Ç–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é **–¥–æ –∫–æ–∂–Ω–æ—ó –≥—Ä—É–ø–∏ –æ–∫—Ä–µ–º–æ**.

### –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è

::mermaid

```mermaid
graph TD
    A[–í—Å—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏<br/>10 –∑–∞–ø–∏—Å—ñ–≤] --> B{GROUP BY GroupName}

    B --> C[–ì—Ä—É–ø–∞: 30PR11<br/>3 —Å—Ç—É–¥–µ–Ω—Ç–∏]
    B --> D[–ì—Ä—É–ø–∞: 30PR12<br/>3 —Å—Ç—É–¥–µ–Ω—Ç–∏]
    B --> E[–ì—Ä—É–ø–∞: 32SS11<br/>2 —Å—Ç—É–¥–µ–Ω—Ç–∏]
    B --> F[–ì—Ä—É–ø–∞: 32SS12<br/>2 —Å—Ç—É–¥–µ–Ω—Ç–∏]

    C --> G[COUNT = 3]
    D --> H[COUNT = 3]
    E --> I[COUNT = 2]
    F --> J[COUNT = 2]

    style B fill:#3b82f6,color:#fff
    style G fill:#10b981,color:#fff
    style H fill:#10b981,color:#fff
    style I fill:#10b981,color:#fff
    style J fill:#10b981,color:#fff
```

::

### –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç –∑ GROUP BY

```sql {4}
-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
SELECT
    GroupName,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY GroupName;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | student_count |
| :-------- | ------------: |
| 30PR11    |             3 |
| 30PR12    |             3 |
| 32SS11    |             2 |
| 32SS12    |             2 |

**–ê–Ω–∞—Ç–æ–º—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**:

1. `JOIN` –∑'—î–¥–Ω—É—î —Ç–∞–±–ª–∏—Ü—ñ Students —ñ Groups
2. `GROUP BY GroupName` **—Ä–æ–∑–¥—ñ–ª—è—î** —Ä—è–¥–∫–∏ –Ω–∞ –≥—Ä—É–ø–∏ –ø–æ –Ω–∞–∑–≤—ñ –≥—Ä—É–ø–∏
3. `COUNT(*)` —Ä–∞—Ö—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ **—É –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ –æ–∫—Ä–µ–º–æ**
4. –ö–æ–∂–Ω–∞ –≥—Ä—É–ø–∞ —Å—Ç–∞—î **–æ–¥–Ω–∏–º —Ä—è–¥–∫–æ–º** —É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ

---

## –Ø–∫ SQL Server –≤–∏–∫–æ–Ω—É—î GROUP BY –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º?

### –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Ü–µ—Å—É

::plant-uml

```plantuml
@startuml
skinparam backgroundColor #1e1e2e
skinparam defaultFontColor #cdd6f4
skinparam sequenceMessageAlign center

participant "SQL Query" as Q #89b4fa
participant "Scan Table" as S #a6e3a1
participant "Group Data" as G #f9e2af
participant "Aggregate" as A #f38ba8
participant "Result" as R #cba6f7

Q -> S: 1. –ß–∏—Ç–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤
activate S
S -> S: –°—Ç—É–¥–µ–Ω—Ç 1: GroupId=1
S -> S: –°—Ç—É–¥–µ–Ω—Ç 2: GroupId=1
S -> S: –°—Ç—É–¥–µ–Ω—Ç 3: GroupId=2
deactivate S

S -> G: 2. –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –≥—Ä—É–ø
activate G
G -> G: –ì—Ä—É–ø–∞ 1: [–°—Ç—É–¥–µ–Ω—Ç 1, –°—Ç—É–¥–µ–Ω—Ç 2]
G -> G: –ì—Ä—É–ø–∞ 2: [–°—Ç—É–¥–µ–Ω—Ç 3]
deactivate G

G -> A: 3. –ê–≥—Ä–µ–≥—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω–æ—ó –≥—Ä—É–ø–∏
activate A
A -> A: –ì—Ä—É–ø–∞ 1: COUNT(*) = 2
A -> A: –ì—Ä—É–ø–∞ 2: COUNT(*) = 1
deactivate A

A -> R: 4. –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
activate R
R -> R: Row 1: GroupName='30PR11', Count=2
R -> R: Row 2: GroupName='30PR12', Count=1
deactivate R

@enduml
```

::

### –î–≤–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è

SQL Server –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ —Ñ—ñ–∑–∏—á–Ω—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –¥–ª—è `GROUP BY`:

::tabs

::tab{label="Stream Aggregate"}

**–£–º–æ–≤–∞**: –î–∞–Ω—ñ **–≤–∂–µ –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ** –ø–æ —Å—Ç–æ–≤–ø—Ü—é –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —î —ñ–Ω–¥–µ–∫—Å)

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏**:

```
–í—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ:
GroupName    | student_id
-------------|------------
30PR11       | 1          ‚Üê –ì—Ä—É–ø–∞ 1 –ø–æ—á–∞–ª–∞—Å—è
30PR11       | 2          ‚îÇ
30PR11       | 3          ‚Üê –ì—Ä—É–ø–∞ 1 –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å, COUNT=3
30PR12       | 4          ‚Üê –ì—Ä—É–ø–∞ 2 –ø–æ—á–∞–ª–∞—Å—è
30PR12       | 5          ‚îÇ
30PR12       | 6          ‚Üê –ì—Ä—É–ø–∞ 2 –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å, COUNT=3
```

**–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**:

- ‚ö° O(n) ‚Äî –¥—É–∂–µ —à–≤–∏–¥–∫–æ
- üíæ –ú–∞–ª–æ –ø–∞–º'—è—Ç—ñ (–æ–±—Ä–æ–±–∫–∞ "–Ω–∞ –ª—å–æ—Ç—É")

::

::tab{label="Hash Aggregate"}

**–£–º–æ–≤–∞**: –î–∞–Ω—ñ **–ù–ï** –≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏**:

```
–ù–µ–≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ:
GroupName    | student_id
-------------|------------
30PR12       | 4
30PR11       | 1
32SS11       | 7
30PR11       | 2
...

‚Üì –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Hash Table

Hash Table:
{
  "30PR11": [1, 2, 3],      ‚Üí COUNT = 3
  "30PR12": [4, 5, 6],      ‚Üí COUNT = 3
  "32SS11": [7, 8]          ‚Üí COUNT = 2
}
```

**–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**:

- üêå O(n) –∞–ª–µ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ –∑–∞ Stream
- üíæ –ü–æ—Ç—Ä–µ–±—É—î –ø–∞–º'—è—Ç—ñ –¥–ª—è hash-—Ç–∞–±–ª–∏—Ü—ñ

::

::

::tip
**–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è**: –°—Ç–≤–æ—Ä—ñ—Ç—å —ñ–Ω–¥–µ–∫—Å –Ω–∞ —Å—Ç–æ–≤–ø—Ü—ñ, –ø–æ —è–∫–æ–º—É –≥—Ä—É–ø—É—î—Ç–µ:

```sql
CREATE INDEX IX_Students_GroupId ON Students(GroupId);
-- –¢–µ–ø–µ—Ä SQL Server –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î Stream Aggregate ‚ö°
```

::

---

## –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ –∫—ñ–ª—å–∫–æ—Ö —Å—Ç–æ–≤–ø—Ü—è—Ö

–í–∏ –º–æ–∂–µ—Ç–µ –≥—Ä—É–ø—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –æ–¥—Ä–∞–∑—É –ø–æ **–∫—ñ–ª—å–∫–æ—Ö** —Å—Ç–æ–≤–ø—Ü—è—Ö. –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É –≥—Ä—É–ø–∞ —Ñ–æ—Ä–º—É—î—Ç—å—Å—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ **—É–Ω—ñ–∫–∞–ª—å–Ω–æ—ó –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó** –∑–Ω–∞—á–µ–Ω—å.

### –ü—Ä–∏–∫–ª–∞–¥: –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑ –æ–¥–Ω–∞–∫–æ–≤–æ—é —Å—Ç–∏–ø–µ–Ω–¥—ñ—î—é –≤ –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ

```sql
SELECT
    GroupName,
    Grants,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY GroupName, Grants;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | Grants | student_count |
| :-------- | -----: | ------------: |
| 30PR11    |   NULL |             2 |
| 30PR11    |   1200 |             1 |
| 30PR12    |   1100 |             1 |
| 30PR12    |   1256 |             2 |
| 32SS11    |   1000 |             1 |
| 32SS11    |   1300 |             1 |

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:

- –£ –≥—Ä—É–ø—ñ **30PR11** —î 2 —Å—Ç—É–¥–µ–Ω—Ç–∏ –∑ `Grants = NULL` (–æ–±–∏–¥–≤–∞ –±–µ–∑ —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó)
- –£ –≥—Ä—É–ø—ñ **30PR12** —î 2 —Å—Ç—É–¥–µ–Ω—Ç–∏ –∑ `Grants = 1256`
- –Ü–Ω—à—ñ –≥—Ä—É–ø–∏: –≤—Å—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏ –º–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó ‚Üí –∫–æ–∂–µ–Ω —É—Ç–≤–æ—Ä—é—î –æ–∫—Ä–µ–º—É –≥—Ä—É–ø—É

::note
**–í–∞–∂–ª–∏–≤–æ**: `GROUP BY` —Ç—Ä–∞–∫—Ç—É—î –≤—Å—ñ `NULL` —è–∫ **–æ–¥–Ω–∞–∫–æ–≤—ñ** –∑–Ω–∞—á–µ–Ω–Ω—è. –¢–æ–º—É –¥–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–∏ –∑ `Grants = NULL` –ø–æ—Ç—Ä–∞–ø–ª—è—Ç—å –≤ –æ–¥–Ω—É –≥—Ä—É–ø—É.
::

### –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ –¥–≤–æ—Ö —Å—Ç–æ–≤–ø—Ü—è—Ö

::mermaid

```mermaid
graph TD
    A[10 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤] --> B{GROUP BY GroupName, Grants}

    B --> C["–ì—Ä—É–ø–∞: (30PR11, NULL)<br/>2 —Å—Ç—É–¥–µ–Ω—Ç–∏"]
    B --> D["–ì—Ä—É–ø–∞: (30PR11, 1200)<br/>1 —Å—Ç—É–¥–µ–Ω—Ç"]
    B --> E["–ì—Ä—É–ø–∞: (30PR12, 1100)<br/>1 —Å—Ç—É–¥–µ–Ω—Ç"]
    B --> F["–ì—Ä—É–ø–∞: (30PR12, 1256)<br/>2 —Å—Ç—É–¥–µ–Ω—Ç–∏"]
    B --> G["–ì—Ä—É–ø–∞: (32SS11, 1000)<br/>1 —Å—Ç—É–¥–µ–Ω—Ç"]
    B --> H["..."]

    C --> I[COUNT = 2]
    D --> J[COUNT = 1]
    E --> K[COUNT = 1]
    F --> L[COUNT = 2]

    style B fill:#f59e0b,color:#000
    style I fill:#10b981,color:#fff
    style L fill:#10b981,color:#fff
```

::

---

## WHERE vs HAVING: –ü–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

–ù–∞–π—á–∞—Å—Ç—ñ—à–∞ –ø–ª—É—Ç–∞–Ω–∏–Ω–∞ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ `GROUP BY` ‚Äî **–∫–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ WHERE, –∞ –∫–æ–ª–∏ HAVING?**

### –ó–æ–ª–æ—Ç–µ –ø—Ä–∞–≤–∏–ª–æ

::note
**–ö–ª—é—á–æ–≤–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å**:

- `WHERE` —Ñ—ñ–ª—å—Ç—Ä—É—î **–æ–∫—Ä–µ–º—ñ —Ä—è–¥–∫–∏** –î–û –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è
- `HAVING` —Ñ—ñ–ª—å—Ç—Ä—É—î **–≥—Ä—É–ø–∏** –ü–Ü–°–õ–Ø –∞–≥—Ä–µ–≥—É–≤–∞–Ω–Ω—è
  ::

### –ü–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è SQL –∑–∞–ø–∏—Ç—É

SQL –≤–∏–∫–æ–Ω—É—î –∑–∞–ø–∏—Ç –Ω–µ –≤ —Ç–æ–º—É –ø–æ—Ä—è–¥–∫—É, –≤ —è–∫–æ–º—É –≤–∏ –π–æ–≥–æ –ø–∏—à–µ—Ç–µ!

::mermaid

```mermaid
sequenceDiagram
    participant Code as SQL –ö–æ–¥ (–ø–æ—Ä—è–¥–æ–∫ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è)
    participant Exec as SQL Engine (–ø–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è)

    Code->>Exec: 1. SELECT
    Code->>Exec: 2. FROM
    Code->>Exec: 3. WHERE
    Code->>Exec: 4. GROUP BY
    Code->>Exec: 5. HAVING
    Code->>Exec: 6. ORDER BY

    Note over Exec: –†–µ–∞–ª—å–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è:
    Exec->>Exec: 1. FROM - –∑'—î–¥–Ω–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å
    Exec->>Exec: 2. WHERE - —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ä—è–¥–∫—ñ–≤
    Exec->>Exec: 3. GROUP BY - –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è
    Exec->>Exec: 4. HAVING - —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –≥—Ä—É–ø
    Exec->>Exec: 5. SELECT - –≤–∏–±—ñ—Ä–∫–∞ —Å—Ç–æ–≤–ø—Ü—ñ–≤
    Exec->>Exec: 6. ORDER BY - —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
```

::

### –ü—Ä–∏–∫–ª–∞–¥ 1: WHERE ‚Äî —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –î–û –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –ó–Ω–∞–π—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —É –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ, –∞–ª–µ **—Ç—ñ–ª—å–∫–∏ —Ç–∏—Ö, —Ö—Ç–æ –º–∞—î —Å—Ç–∏–ø–µ–Ω–¥—ñ—é**.

```sql {5}
SELECT
    GroupName,
    COUNT(*) AS students_with_grants
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
WHERE S.Grants IS NOT NULL  -- –§—ñ–ª—å—Ç—Ä—É—î–º–æ –†–Ø–î–ö–ò (–æ–∫—Ä–µ–º–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤)
GROUP BY GroupName;
```

**–ü–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**:

1. `FROM` + `JOIN` ‚Äî –∑'—î–¥–Ω—É—î–º–æ —Ç–∞–±–ª–∏—Ü—ñ (10 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤)
2. **WHERE** ‚Äî –∑–∞–ª–∏—à–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑—ñ —Å—Ç–∏–ø–µ–Ω–¥—ñ—î—é (8 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤)
3. `GROUP BY` ‚Äî –≥—Ä—É–ø—É—î–º–æ 8 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ø–æ –≥—Ä—É–ø–∞—Ö
4. `COUNT(*)` ‚Äî —Ä–∞—Ö—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | students_with_grants |
| :-------- | -------------------: |
| 30PR11    |                    1 |
| 30PR12    |                    3 |
| 32SS11    |                    2 |
| 32SS12    |                    2 |

---

### –ü—Ä–∏–∫–ª–∞–¥ 2: HAVING ‚Äî —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ü–Ü–°–õ–Ø –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –ó–Ω–∞–π—Ç–∏ –≥—Ä—É–ø–∏, –≤ —è–∫–∏—Ö **–±—ñ–ª—å—à–µ 2 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤**.

```sql {6}
SELECT
    GroupName,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY GroupName
HAVING COUNT(*) > 2;  -- –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ì–†–£–ü–ò (–Ω–µ –æ–∫—Ä–µ–º–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤!)
```

**–ü–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**:

1. `FROM` + `JOIN` ‚Äî –∑'—î–¥–Ω—É—î–º–æ —Ç–∞–±–ª–∏—Ü—ñ (10 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤)
2. `GROUP BY` ‚Äî –≥—Ä—É–ø—É—î–º–æ –≤—Å—ñ—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ø–æ –≥—Ä—É–ø–∞—Ö
3. `COUNT(*)` ‚Äî —Ä–∞—Ö—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —É –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ
4. **HAVING** ‚Äî –∑–∞–ª–∏—à–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –≥—Ä—É–ø–∏, –¥–µ `COUNT(*) > 2`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | student_count |
| :-------- | ------------: |
| 30PR11    |             3 |
| 30PR12    |             3 |

---

### –ü—Ä–∏–∫–ª–∞–¥ 3: WHERE –Ü HAVING —Ä–∞–∑–æ–º

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –ó–Ω–∞–π—Ç–∏ –≥—Ä—É–ø–∏, –≤ —è–∫–∏—Ö **–±—ñ–ª—å—à–µ 1 —Å—Ç—É–¥–µ–Ω—Ç–∞** –º–∞—î **—Å—Ç–∏–ø–µ–Ω–¥—ñ—é –±—ñ–ª—å—à–µ 1100 –≥—Ä–Ω**.

```sql {5,7}
SELECT
    GroupName,
    COUNT(*) AS high_grant_students
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
WHERE S.Grants > 1100           -- 1. –§—ñ–ª—å—Ç—Ä—É—î–º–æ –†–Ø–î–ö–ò
GROUP BY GroupName
HAVING COUNT(*) > 1;             -- 2. –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ì–†–£–ü–ò
```

**–ü–æ–∫—Ä–æ–∫–æ–≤–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**:

::steps

### –ö—Ä–æ–∫ 1: FROM + JOIN

```
10 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑'—î–¥–Ω–∞–Ω–æ –∑ —ó—Ö –≥—Ä—É–ø–∞–º–∏
```

### –ö—Ä–æ–∫ 2: WHERE S.Grants > 1100

```
–ó–∞–ª–∏—à–∏–ª–æ—Å—å 6 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤:
- 30PR11: 1200
- 30PR12: 1256, 1256
- 32SS11: 1300
- 32SS12: 1300, 1300
```

### –ö—Ä–æ–∫ 3: GROUP BY GroupName

```
–ì—Ä—É–ø–∏:
- 30PR11: 1 —Å—Ç—É–¥–µ–Ω—Ç
- 30PR12: 2 —Å—Ç—É–¥–µ–Ω—Ç–∏
- 32SS11: 1 —Å—Ç—É–¥–µ–Ω—Ç
- 32SS12: 2 —Å—Ç—É–¥–µ–Ω—Ç–∏
```

### –ö—Ä–æ–∫ 4: HAVING COUNT(\*) > 1

```
–ó–∞–ª–∏—à–∏–ª–∏—Å—å —Ç—ñ–ª—å–∫–∏ –≥—Ä—É–ø–∏ –∑ COUNT > 1:
- 30PR12: 2 —Å—Ç—É–¥–µ–Ω—Ç–∏
- 32SS12: 2 —Å—Ç—É–¥–µ–Ω—Ç–∏
```

::

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | high_grant_students |
| :-------- | ------------------: |
| 30PR12    |                   2 |
| 32SS12    |                   2 |

---

## –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ –æ–±—á–∏—Å–ª–µ–Ω–∏–º –≤–∏—Ä–∞–∑–∞–º

–í–∏ –º–æ–∂–µ—Ç–µ –≥—Ä—É–ø—É–≤–∞—Ç–∏ –Ω–µ —Ç—ñ–ª—å–∫–∏ –ø–æ —Å—Ç–æ–≤–ø—Ü—è—Ö, –∞–ª–µ –π –ø–æ **–æ–±—á–∏—Å–ª–µ–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º**.

### –ü—Ä–∏–∫–ª–∞–¥: –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –ø–æ –≤—ñ–∫–æ–≤—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó

```sql
SELECT
    CASE
        WHEN DATEDIFF(YEAR, BirthDate, GETDATE()) < 20 THEN '–î–æ 20 —Ä–æ–∫—ñ–≤'
        WHEN DATEDIFF(YEAR, BirthDate, GETDATE()) BETWEEN 20 AND 25 THEN '20-25 —Ä–æ–∫—ñ–≤'
        ELSE '–ü–æ–Ω–∞–¥ 25 —Ä–æ–∫—ñ–≤'
    END AS age_category,
    COUNT(*) AS student_count,
    AVG(Grants) AS avg_grant
FROM Students
GROUP BY
    CASE
        WHEN DATEDIFF(YEAR, BirthDate, GETDATE()) < 20 THEN '–î–æ 20 —Ä–æ–∫—ñ–≤'
        WHEN DATEDIFF(YEAR, BirthDate, GETDATE()) BETWEEN 20 AND 25 THEN '20-25 —Ä–æ–∫—ñ–≤'
        ELSE '–ü–æ–Ω–∞–¥ 25 —Ä–æ–∫—ñ–≤'
    END;
```

::warning
**–í–∞–∂–ª–∏–≤–æ**: –í–∏—Ä–∞–∑ —É `GROUP BY` –º–∞—î **—Ç–æ—á–Ω–æ –∑–±—ñ–≥–∞—Ç–∏—Å—è** –∑ –≤–∏—Ä–∞–∑–æ–º —É `SELECT`! –Ü–Ω–∞–∫—à–µ –±—É–¥–µ –ø–æ–º–∏–ª–∫–∞.
::

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∑ CTE** (Common Table Expression) ‚Äî –±—ñ–ª—å—à —á–∏—Ç–∞–±–µ–ª—å–Ω–æ:

```sql
WITH StudentAges AS (
    SELECT
        *,
        CASE
            WHEN DATEDIFF(YEAR, BirthDate, GETDATE()) < 20 THEN '–î–æ 20 —Ä–æ–∫—ñ–≤'
            WHEN DATEDIFF(YEAR, BirthDate, GETDATE()) BETWEEN 20 AND 25 THEN '20-25 —Ä–æ–∫—ñ–≤'
            ELSE '–ü–æ–Ω–∞–¥ 25 —Ä–æ–∫—ñ–≤'
        END AS age_category
    FROM Students
)
SELECT
    age_category,
    COUNT(*) AS student_count,
    AVG(Grants) AS avg_grant
FROM StudentAges
GROUP BY age_category;
```

---

## ROLLUP: –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤—ñ –ø—ñ–¥—Å—É–º–∫–∏

`ROLLUP` –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ **—ñ—î—Ä–∞—Ä—Ö—ñ—á–Ω—ñ –ø—ñ–¥—Å—É–º–∫–∏** ‚Äî –≤—ñ–¥ –¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–æ –∑–∞–≥–∞–ª—å–Ω–∏—Ö.

### –ë–∞–∑–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥

```sql
SELECT
    GroupName,
    Grants,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY ROLLUP(GroupName, Grants);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | Grants | student_count | –†—ñ–≤–µ–Ω—å –ø—ñ–¥—Å—É–º–∫—É                |
| :-------- | -----: | ------------: | :----------------------------- |
| 30PR11    |   NULL |             2 | –î–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è: –≥—Ä—É–ø–∞ + —Å—Ç–∏–ø–µ–Ω–¥—ñ—è |
| 30PR11    |   1200 |             1 | ‚Üë                              |
| 30PR11    |   NULL |             3 | **–ü—ñ–¥—Å—É–º–æ–∫ –ø–æ –≥—Ä—É–ø—ñ 30PR11**   |
| 30PR12    |   1100 |             1 | –î–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è: –≥—Ä—É–ø–∞ + —Å—Ç–∏–ø–µ–Ω–¥—ñ—è |
| 30PR12    |   1256 |             2 | ‚Üë                              |
| 30PR12    |   NULL |             3 | **–ü—ñ–¥—Å—É–º–æ–∫ –ø–æ –≥—Ä—É–ø—ñ 30PR12**   |
| NULL      |   NULL |            10 | **–ó–ê–ì–ê–õ–¨–ù–ò–ô –ü–Ü–î–°–£–ú–û–ö –ü–û –í–°–Ü–•** |

### –Ø–∫ –ø—Ä–∞—Ü—é—î ROLLUP?

`ROLLUP(A, B, C)` —Å—Ç–≤–æ—Ä—é—î –ø—ñ–¥—Å—É–º–∫–∏ –¥–ª—è:

1. `GROUP BY A, B, C` (–Ω–∞–π–¥–µ—Ç–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ—à–∏–π —Ä—ñ–≤–µ–Ω—å)
2. `GROUP BY A, B` (–±–µ–∑ C)
3. `GROUP BY A` (–±–µ–∑ B —ñ C)
4. `GROUP BY ()` (–∑–∞–≥–∞–ª—å–Ω–∏–π –ø—ñ–¥—Å—É–º–æ–∫, A=B=C=NULL)

::mermaid

```mermaid
graph TD
    A[ROLLUP GroupName, Grants] --> B[–†—ñ–≤–µ–Ω—å 1: GROUP BY GroupName, Grants]
    A --> C[–†—ñ–≤–µ–Ω—å 2: GROUP BY GroupName]
    A --> D[–†—ñ–≤–µ–Ω—å 3: GRAND TOTAL]

    B --> B1[30PR11 + 1200 = 1 —Å—Ç—É–¥–µ–Ω—Ç]
    B --> B2[30PR11 + NULL = 2 —Å—Ç—É–¥–µ–Ω—Ç–∏]

    C --> C1[30PR11 = 3 —Å—Ç—É–¥–µ–Ω—Ç–∏]
    C --> C2[30PR12 = 3 —Å—Ç—É–¥–µ–Ω—Ç–∏]

    D --> D1[–í—Å—å–æ–≥–æ = 10 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤]

    style A fill:#3b82f6,color:#fff
    style D fill:#ef4444,color:#fff
```

::

---

## CUBE: –í—Å—ñ –º–æ–∂–ª–∏–≤—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –ø—ñ–¥—Å—É–º–∫—ñ–≤

`CUBE` —Å—Ö–æ–∂–∏–π –Ω–∞ `ROLLUP`, –∞–ª–µ —Å—Ç–≤–æ—Ä—é—î –ø—ñ–¥—Å—É–º–∫–∏ –¥–ª—è **–í–°–Ü–• –º–æ–∂–ª–∏–≤–∏—Ö –∫–æ–º–±—ñ–Ω–∞—Ü—ñ–π** —Å—Ç–æ–≤–ø—Ü—ñ–≤.

### –†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ ROLLUP —ñ CUBE

::tabs

::tab{label="ROLLUP"}

```sql
GROUP BY ROLLUP(A, B)
```

**–°—Ç–≤–æ—Ä—é—î 3 —Ä—ñ–≤–Ω—ñ**:

1. `GROUP BY A, B`
2. `GROUP BY A`
3. `GROUP BY ()` (–∑–∞–≥–∞–ª—å–Ω–∏–π –ø—ñ–¥—Å—É–º–æ–∫)

**–ü—Ä–∏–∫–ª–∞–¥**: –ó–≤—ñ—Ç –ø—Ä–æ –ø—Ä–æ–¥–∞–∂—ñ –∑ –ø—ñ–¥—Å—É–º–∫–∞–º–∏ –ø–æ —Ä–µ–≥—ñ–æ–Ω–∞—Ö

::

::tab{label="CUBE"}

```sql
GROUP BY CUBE(A, B)
```

**–°—Ç–≤–æ—Ä—é—î 4 —Ä—ñ–≤–Ω—ñ**:

1. `GROUP BY A, B`
2. `GROUP BY A`
3. **`GROUP BY B`** ‚Üê –î–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å!
4. `GROUP BY ()` (–∑–∞–≥–∞–ª—å–Ω–∏–π –ø—ñ–¥—Å—É–º–æ–∫)

**–ü—Ä–∏–∫–ª–∞–¥**: –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑ –ø—ñ–¥—Å—É–º–∫–∞–º–∏ –ø–æ —Ä–µ–≥—ñ–æ–Ω–∞—Ö –¢–ê –æ–∫—Ä–µ–º–æ –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö

::

::

### –ü—Ä–∏–∫–ª–∞–¥ CUBE

```sql
SELECT
    GroupName,
    CASE WHEN Grants IS NULL THEN '–ë–µ–∑ —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó' ELSE '–ó—ñ —Å—Ç–∏–ø–µ–Ω–¥—ñ—î—é' END AS has_grant,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY CUBE(GroupName, has_grant);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∫–ª—é—á–∞—î**:

- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —É –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ –∑—ñ —Å—Ç–∏–ø–µ–Ω–¥—ñ—î—é / –±–µ–∑
- **–ü—ñ–¥—Å—É–º–æ–∫ –ø–æ –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ** (–Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó)
- **–ü—ñ–¥—Å—É–º–æ–∫ –ø–æ —Å—Ç–∏–ø–µ–Ω–¥—ñ—è—Ö** (–Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≥—Ä—É–ø–∏) ‚Üê –¶–µ –¥–æ–¥–∞—î CUBE!
- –ó–∞–≥–∞–ª—å–Ω–∏–π –ø—ñ–¥—Å—É–º–æ–∫

---

## GROUPING SETS: –ì–Ω—É—á–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—ñ–¥—Å—É–º–∫—ñ–≤

`GROUPING SETS` –¥–æ–∑–≤–æ–ª—è—î **–≤—Ä—É—á–Ω—É –≤–∫–∞–∑–∞—Ç–∏**, —è–∫—ñ —Å–∞–º–µ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –ø—ñ–¥—Å—É–º–∫—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω—ñ.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```sql
GROUP BY GROUPING SETS (
    (A, B),    -- –ì—Ä—É–ø–∞ 1
    (A),       -- –ì—Ä—É–ø–∞ 2
    ()         -- –ó–∞–≥–∞–ª—å–Ω–∏–π –ø—ñ–¥—Å—É–º–æ–∫
)
```

### –ü—Ä–∏–∫–ª–∞–¥: –í–∏–±—ñ—Ä–∫–æ–≤—ñ –ø—ñ–¥—Å—É–º–∫–∏

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –û—Ç—Ä–∏–º–∞—Ç–∏:

- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —É –∫–æ–∂–Ω—ñ–π –≥—Ä—É–ø—ñ
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∑ –∫–æ–∂–Ω–∏–º —Ä–æ–∑–º—ñ—Ä–æ–º —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó
- –ë–µ–∑ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –ø—ñ–¥—Å—É–º–∫—É

```sql
SELECT
    GroupName,
    Grants,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY GROUPING SETS (
    (GroupName),  -- –¢—ñ–ª—å–∫–∏ –ø–æ –≥—Ä—É–ø–∞—Ö
    (Grants)      -- –¢—ñ–ª—å–∫–∏ –ø–æ —Å—Ç–∏–ø–µ–Ω–¥—ñ—è—Ö
);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | Grants | student_count |
| :-------- | -----: | ------------: |
| 30PR11    |   NULL |             3 |
| 30PR12    |   NULL |             3 |
| 32SS11    |   NULL |             2 |
| NULL      |   NULL |             2 |
| NULL      |   1000 |             1 |
| NULL      |   1100 |             1 |
| NULL      |   1200 |             2 |

::tip
**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏**:

- `ROLLUP` ‚Äî —ñ—î—Ä–∞—Ä—Ö—ñ—á–Ω—ñ –¥–∞–Ω—ñ (–†—ñ–∫ ‚Üí –ö–≤–∞—Ä—Ç–∞–ª ‚Üí –ú—ñ—Å—è—Ü—å)
- `CUBE` ‚Äî –±–∞–≥–∞—Ç–æ–≤–∏–º—ñ—Ä–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ (–≤—Å—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó)
- `GROUPING SETS` ‚Äî –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ª–∏—à–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó
  ::

---

## GROUPING(): –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –ø—ñ–¥—Å—É–º–∫—É

–§—É–Ω–∫—Ü—ñ—è `GROUPING()` –¥–æ–ø–æ–º–∞–≥–∞—î **–≤—ñ–¥—Ä—ñ–∑–Ω–∏—Ç–∏** —Ä–µ–∞–ª—å–Ω—ñ `NULL` –≤—ñ–¥ `NULL`, —è–∫—ñ –∑'—è–≤–∏–ª–∏—Å—å —á–µ—Ä–µ–∑ `ROLLUP`/`CUBE`.

### –ü—Ä–æ–±–ª–µ–º–∞

```sql
SELECT
    GroupName,
    Grants,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY ROLLUP(GroupName, Grants);
```

**–£ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ —î –¥–≤–∞ –≤–∏–¥–∏ NULL**:

1. **–†–µ–∞–ª—å–Ω–∏–π NULL** ‚Äî —Å—Ç—É–¥–µ–Ω—Ç –¥—ñ–π—Å–Ω–æ –Ω–µ –º–∞—î —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó
2. **NULL –≤—ñ–¥ ROLLUP** ‚Äî —Ü–µ –ø—ñ–¥—Å—É–º–∫–æ–≤–∏–π —Ä—è–¥–æ–∫

–Ø–∫ —ó—Ö –≤—ñ–¥—Ä—ñ–∑–Ω–∏—Ç–∏?

### –†—ñ—à–µ–Ω–Ω—è: GROUPING()

```sql
SELECT
    GroupName,
    Grants,
    COUNT(*) AS student_count,
    GROUPING(GroupName) AS is_group_subtotal,
    GROUPING(Grants) AS is_grant_subtotal
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY ROLLUP(GroupName, Grants);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

| GroupName | Grants | student_count | is_group_subtotal | is_grant_subtotal | –©–æ —Ü–µ –æ–∑–Ω–∞—á–∞—î?           |
| :-------- | -----: | ------------: | ----------------: | ----------------: | :----------------------- |
| 30PR11    |   NULL |             2 |                 0 |                 0 | –†–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ             |
| 30PR11    |   1200 |             1 |                 0 |                 0 | –†–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ             |
| 30PR11    |   NULL |             3 |                 0 |                 1 | –ü—ñ–¥—Å—É–º–æ–∫ –ø–æ –≥—Ä—É–ø—ñ 30PR11 |
| NULL      |   NULL |            10 |                 1 |                 1 | –ó–∞–≥–∞–ª—å–Ω–∏–π –ø—ñ–¥—Å—É–º–æ–∫       |

**GROUPING() –ø–æ–≤–µ—Ä—Ç–∞—î**:

- `0` ‚Äî —Ü–µ —Ä–µ–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç–æ–≤–ø—Ü—è
- `1` ‚Äî —Ü–µ NULL –≤—ñ–¥ –ø—ñ–¥—Å—É–º–∫—É (–∞–≥—Ä–µ–≥–∞—Ü—ñ—ó)

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ

```sql
SELECT
    CASE WHEN GROUPING(GroupName) = 1 THEN '=== –í–°–¨–û–ì–û ===' ELSE GroupName END AS GroupName,
    CASE WHEN GROUPING(Grants) = 1 THEN '–í—Å—ñ —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó' ELSE CAST(Grants AS NVARCHAR) END AS Grants,
    COUNT(*) AS student_count
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY ROLLUP(GroupName, Grants);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ–ø–µ—Ä –ª–µ–≥—à–µ —á–∏—Ç–∞—Ç–∏**:

| GroupName      | Grants        | student_count |
| :------------- | :------------ | ------------: |
| 30PR11         | NULL          |             2 |
| 30PR11         | 1200          |             1 |
| 30PR11         | –í—Å—ñ —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó |             3 |
| 30PR12         | 1100          |             1 |
| === –í–°–¨–û–ì–û === | –í—Å—ñ —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó |            10 |

---

## –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è: Execution Plans

### Benchmark: Stream vs Hash Aggregate

::code-group

```sql [–ë–µ–∑ —ñ–Ω–¥–µ–∫—Å—É (Hash Aggregate)]
-- –ù–µ –º–∞—î —ñ–Ω–¥–µ–∫—Å—É –Ω–∞ GroupId
SELECT
    GroupId,
    COUNT(*) AS student_count
FROM Students
GROUP BY GroupId;

-- Execution Plan:
-- Hash Aggregate (Cost: 0.50)
--   ‚îî‚îÄ Table Scan (Cost: 0.50)
```

```sql [–ó —ñ–Ω–¥–µ–∫—Å–æ–º (Stream Aggregate)]
CREATE INDEX IX_Students_GroupId ON Students(GroupId);

SELECT
    GroupId,
    COUNT(*) AS student_count
FROM Students
GROUP BY GroupId;

-- Execution Plan:
-- Stream Aggregate (Cost: 0.30) ‚Üê –®–≤–∏–¥—à–µ!
--   ‚îî‚îÄ Index Scan IX_Students_GroupId (Cost: 0.20)
```

::

::tip
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó**:

1. –°—Ç–≤–æ—Ä—ñ—Ç—å —ñ–Ω–¥–µ–∫—Å –Ω–∞ —Å—Ç–æ–≤–ø—Ü—ñ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è
2. –î–ª—è –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ –∫—ñ–ª—å–∫–æ—Ö —Å—Ç–æ–≤–ø—Ü—è—Ö ‚Äî composite index
3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `WHERE` –∑–∞–º—ñ—Å—Ç—å `HAVING` –¥–µ –º–æ–∂–ª–∏–≤–æ (—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ä–∞–Ω—ñ—à–µ = –º–µ–Ω—à–µ –¥–∞–Ω–∏—Ö –¥–ª—è –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è)
   ::

---

## –¢–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ Anti-Patterns

### ‚ùå –ü–æ–º–∏–ª–∫–∞ 1: –ù–µ–∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏–π —Å—Ç–æ–≤–ø–µ—Ü—å –Ω–µ –≤ GROUP BY

```sql
-- ‚ùå –ü–û–ú–ò–õ–ö–ê
SELECT
    GroupName,
    FirstName,      -- –¶–µ–π —Å—Ç–æ–≤–ø–µ—Ü—å –ù–ï –≤ GROUP BY —ñ –ù–ï –≤ –∞–≥—Ä–µ–≥–∞—Ç—ñ!
    COUNT(*)
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY GroupName;
```

**–ü–æ–º–∏–ª–∫–∞**:

```
Column 'Students.FirstName' is invalid in the select list
because it is not contained in either an aggregate function
or the GROUP BY clause.
```

**–†—ñ—à–µ–Ω–Ω—è**:

```sql
-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –î–æ–¥–∞—Ç–∏ FirstName –≤ GROUP BY
GROUP BY GroupName, FirstName;

-- –ê–ë–û –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∞–≥—Ä–µ–≥–∞—Ç, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ STRING_AGG (SQL Server 2017+)
SELECT
    GroupName,
    STRING_AGG(FirstName, ', ') AS all_names,
    COUNT(*)
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY GroupName;
```

---

### ‚ùå –ü–æ–º–∏–ª–∫–∞ 2: –ê–≥—Ä–µ–≥–∞—Ç —É WHERE –∑–∞–º—ñ—Å—Ç—å HAVING

```sql
-- ‚ùå –ù–ï –ü–†–ê–¶–Æ–Ñ
SELECT GroupName, COUNT(*) AS cnt
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY GroupName
WHERE COUNT(*) > 2;  -- –ü–æ–º–∏–ª–∫–∞: –∞–≥—Ä–µ–≥–∞—Ç–∏ –Ω–µ –º–æ–∂–Ω–∞ —É WHERE!
```

**–†—ñ—à–µ–Ω–Ω—è**:

```sql
-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
HAVING COUNT(*) > 2;
```

---

### ‚ùå Anti-Pattern: –ó–∞–π–≤–µ GROUP BY

```sql
-- ‚ùå –ù–ï–û–ü–¢–ò–ú–ê–õ–¨–ù–û: –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –¥–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ
SELECT
    product_id,
    product_name,
    price
FROM Products
GROUP BY product_id, product_name, price;
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫—â–æ `product_id` ‚Äî PRIMARY KEY, —Ç–æ –∫–æ–∂–µ–Ω —Ä—è–¥–æ–∫ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π. `GROUP BY` —Ç—É—Ç –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç—å, –∞–ª–µ **—Å–ø–æ–≤—ñ–ª—å–Ω—é—î –∑–∞–ø–∏—Ç**!

**–†—ñ—à–µ–Ω–Ω—è**:

```sql
-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä–æ—Å—Ç–æ SELECT
SELECT product_id, product_name, price
FROM Products;
```

---

## Best Practices

::steps

### 1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø—Å–µ–≤–¥–æ–Ω—ñ–º–∏ –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ

```sql
-- ‚úÖ –î–æ–±—Ä–µ
SELECT
    G.GroupName,
    COUNT(*) AS student_count,
    AVG(S.Grants) AS avg_grant
FROM Students AS S
JOIN Groups AS G ON S.GroupId = G.Id
GROUP BY G.GroupName;
```

### 2. WHERE –ø–µ—Ä–µ–¥ GROUP BY –¥–µ –º–æ–∂–ª–∏–≤–æ

```sql
-- ‚úÖ –®–≤–∏–¥—à–µ: —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è 10000 ‚Üí 5000 —Ä—è–¥–∫—ñ–≤ –î–û –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è
SELECT category, COUNT(*)
FROM Products
WHERE price > 1000  -- –í—ñ–¥—Å—ñ–∫–∞—î–º–æ –ø–æ–ª–æ–≤–∏–Ω—É –ü–ï–†–ï–î –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è–º
GROUP BY category;

-- ‚ùå –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ: –≥—Ä—É–ø—É—î–º–æ –≤—Å—ñ 10000, –ø–æ—Ç—ñ–º —Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ
SELECT category, COUNT(*)
FROM Products
GROUP BY category
HAVING AVG(price) > 1000;  -- –Ø–∫—â–æ –º–æ–∂–Ω–∞ —É WHERE, –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ HAVING
```

### 3. –Ü–Ω–¥–µ–∫—Å–∏ –Ω–∞ —Å—Ç–æ–≤–ø—Ü—ñ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è

```sql
CREATE INDEX IX_Products_Category ON Products(category);
-- –ü—Ä–∏—Å–∫–æ—Ä—é—î GROUP BY category –≤ 5-10 —Ä–∞–∑—ñ–≤
```

### 4. ROLLUP/CUBE —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ

```sql
-- –Ø–∫—â–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–æ–º—ñ–∂–Ω—ñ –ø—ñ–¥—Å—É–º–∫–∏:
GROUP BY category, region  -- –®–≤–∏–¥—à–µ

-- –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø—ñ–¥—Å—É–º–∫–∏:
GROUP BY ROLLUP(category, region)  -- –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ, –∞–ª–µ –∫–æ—Ä–∏—Å–Ω–æ
```

::

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

::steps

### –ë–∞–∑–æ–≤–µ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –£ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö `Orders` –∑–Ω–∞–π–¥—ñ—Ç—å:

1. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω—å –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞
2. –ó–∞–≥–∞–ª—å–Ω—É —Å—É–º—É –∑–∞–º–æ–≤–ª–µ–Ω—å –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞
3. –°–µ—Ä–µ–¥–Ω—ñ–π —á–µ–∫ –∫–æ–∂–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞

::collapsible{label="–ü–æ–∫–∞–∑–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è"}

```sql
SELECT
    customer_id,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_spent,
    AVG(total_amount) AS avg_order_amount
FROM Orders
GROUP BY customer_id
ORDER BY total_spent DESC;
```

::

### WHERE + HAVING

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –ó–Ω–∞–π–¥—ñ—Ç—å –∫–ª—ñ—î–Ω—Ç—ñ–≤, —è–∫—ñ –∑—Ä–æ–±–∏–ª–∏ –±—ñ–ª—å—à–µ 5 –∑–∞–º–æ–≤–ª–µ–Ω—å —É 2024 —Ä–æ—Ü—ñ –∑ —Å–µ—Ä–µ–¥–Ω—ñ–º —á–µ–∫–æ–º > 1000 –≥—Ä–Ω

::collapsible{label="–ü–æ–∫–∞–∑–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è"}

```sql
SELECT
    customer_id,
    COUNT(*) AS order_count,
    AVG(total_amount) AS avg_amount
FROM Orders
WHERE YEAR(order_date) = 2024          -- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –î–û –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è
GROUP BY customer_id
HAVING COUNT(*) > 5                    -- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ü–Ü–°–õ–Ø –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è
   AND AVG(total_amount) > 1000
ORDER BY order_count DESC;
```

::

### ROLLUP –¥–ª—è –∑–≤—ñ—Ç–Ω–æ—Å—Ç—ñ

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –°—Ç–≤–æ—Ä—ñ—Ç—å –∑–≤—ñ—Ç –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑ –ø—ñ–¥—Å—É–º–∫–∞–º–∏ –ø–æ —Ä–µ–≥—ñ–æ–Ω–∞—Ö —Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö

::collapsible{label="–ü–æ–∫–∞–∑–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è"}

```sql
SELECT
    ISNULL(region, '=== –í–°–¨–û–ì–û ===') AS region,
    ISNULL(category, '–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó') AS category,
    SUM(sales_amount) AS total_sales,
    COUNT(*) AS transaction_count
FROM Sales
GROUP BY ROLLUP(region, category)
ORDER BY
    GROUPING(region),
    region,
    GROUPING(category),
    category;
```

::

::

---

## –†–µ–∑—é–º–µ

::note
**–ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏**:

1. **GROUP BY** —Ä–æ–∑–¥—ñ–ª—è—î –¥–∞–Ω—ñ –Ω–∞ –≥—Ä—É–ø–∏ —Ç–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î –∞–≥—Ä–µ–≥–∞—Ç–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–æ –∫–æ–∂–Ω–æ—ó –≥—Ä—É–ø–∏
2. **WHERE** —Ñ—ñ–ª—å—Ç—Ä—É—î —Ä—è–¥–∫–∏ –î–û –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è, **HAVING** ‚Äî –≥—Ä—É–ø–∏ –ü–Ü–°–õ–Ø
3. **–ü–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**: FROM ‚Üí WHERE ‚Üí GROUP BY ‚Üí HAVING ‚Üí SELECT ‚Üí ORDER BY
4. **ROLLUP** —Å—Ç–≤–æ—Ä—é—î —ñ—î—Ä–∞—Ä—Ö—ñ—á–Ω—ñ –ø—ñ–¥—Å—É–º–∫–∏
5. **CUBE** —Å—Ç–≤–æ—Ä—é—î –≤—Å—ñ –º–æ–∂–ª–∏–≤—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –ø—ñ–¥—Å—É–º–∫—ñ–≤
6. **GROUPING SETS** –¥–æ–∑–≤–æ–ª—è—î –≤–∏–±—Ä–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó
7. **GROUPING()** –≤—ñ–¥—Ä—ñ–∑–Ω—è—î —Ä–µ–∞–ª—å–Ω—ñ NULL –≤—ñ–¥ NULL –ø—ñ–¥—Å—É–º–∫—ñ–≤
8. **–Ü–Ω–¥–µ–∫—Å–∏** –ø—Ä–∏—Å–∫–æ—Ä—é—é—Ç—å –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è —É 5-10 —Ä–∞–∑—ñ–≤

::

::tip
**–©–æ –¥–∞–ª—ñ?**

–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –º–∏ –≤–∏–≤—á–∏–º–æ:

- –ü—ñ–¥–∑–∞–ø–∏—Ç–∏ –∑ –∞–≥—Ä–µ–≥–∞—Ç–Ω–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏
- Correlated subqueries
- Common Table Expressions (CTE)
- Window Functions —è–∫ —Å—É—á–∞—Å–Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞

[–ü–µ—Ä–µ–π—Ç–∏ –¥–æ —Ä–æ–∑–¥—ñ–ª—É "–ü—ñ–¥–∑–∞–ø–∏—Ç–∏ –∑ –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏" ‚Üí](./03.subqueries-aggregates.md)
::

---

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [–û—Ñ—ñ—Ü—ñ–π–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è: GROUP BY](https://learn.microsoft.com/en-us/sql/t-sql/queries/select-group-by-transact-sql)
- [ROLLUP, CUBE —ñ GROUPING SETS](https://learn.microsoft.com/en-us/sql/t-sql/queries/select-group-by-transact-sql#group-by-rollup)
- [Execution Plans –¥–ª—è GROUP BY](https://learn.microsoft.com/en-us/sql/relational-databases/performance/execution-plans)
