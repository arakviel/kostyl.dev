---
title: DML-—Ç—Ä–∏–≥–µ—Ä–∏
description: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–µ–∞–≥—É–≤–∞–Ω–Ω—è –Ω–∞ –∑–º—ñ–Ω–∏ –¥–∞–Ω–∏—Ö - INSERT, UPDATE, DELETE
---

# DML-—Ç—Ä–∏–≥–µ—Ä–∏

## –ü—Ä–æ–±–ª–µ–º–∞: –Ø–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É–≤–∞—Ç–∏ —Ä–µ–∞–∫—Ü—ñ—é –Ω–∞ –∑–º—ñ–Ω–∏ –¥–∞–Ω–∏—Ö?

–£—è–≤—ñ—Ç—å —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –∫–Ω–∏–≥. –ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É –ø—Ä–æ–¥–∞–∂—É –ø–æ—Ç—Ä—ñ–±–Ω–æ:
- –ó–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–Ω–∏–≥ –Ω–∞ —Å–∫–ª–∞–¥—ñ
- –ó–∞–ø–∏—Å–∞—Ç–∏ –≤ –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç—É
- –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –Ω–µ –ø—Ä–æ–¥–∞—î—Ç—å—Å—è –æ—Å—Ç–∞–Ω–Ω—ñ–π –µ–∫–∑–µ–º–ø–ª—è—Ä –±–µ—Å—Ç—Å–µ–ª–µ—Ä–∞
- –û–±–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–¥–∞–∂—ñ–≤

–ú–æ–∂–Ω–∞ —Ä–æ–±–∏—Ç–∏ —Ü–µ –≤—Ä—É—á–Ω—É –≤ –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ INSERT/UPDATE/DELETE... –ê–ª–µ —â–æ, —è–∫—â–æ **–±–∞–∑–∞ –¥–∞–Ω–∏—Ö —Å–∞–º–∞ –º–æ–≥–ª–∞ –± –≤—ñ–¥—Ä–µ–∞–≥—É–≤–∞—Ç–∏** –Ω–∞ –∑–º—ñ–Ω—É –¥–∞–Ω–∏—Ö?

::mermaid

```mermaid
flowchart LR
    User[–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á] -->|INSERT INTO Sales| DB[(–ë–∞–∑–∞ –î–∞–Ω–∏—Ö)]
    DB -->|1. –°–ø—Ä–∞—Ü—å–æ–≤—É—î —Ç—Ä–∏–≥–µ—Ä| Trigger[Trigger Logic]
    Trigger -->|2. –ó–º–µ–Ω—à—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å| Books[Table: Books]
    Trigger -->|3. –ó–∞–ø–∏—Å—É—î –≤ –∂—É—Ä–Ω–∞–ª| AuditLog[Table: AuditLog]
    Trigger -->|4. –ü–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç| User
    
    style DB fill:#3b82f6,color:#fff
    style Trigger fill:#f59e0b,color:#fff
    style Books fill:#10b981,color:#fff
    style AuditLog fill:#10b981,color:#fff
```

::

**DML-—Ç—Ä–∏–≥–µ—Ä (Trigger)** ‚Äî —Ü–µ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞, —è–∫–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è** –ø—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø–æ–¥—ñ–π –∑–º—ñ–Ω–∏ –¥–∞–Ω–∏—Ö (INSERT, UPDATE, DELETE) –≤ —Ç–∞–±–ª–∏—Ü—ñ –∞–±–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ñ.

::note
**DML** ‚Äî Data Manipulation Language (–ú–æ–≤–∞ –ú–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –î–∞–Ω–∏–º–∏). DML-—Ç—Ä–∏–≥–µ—Ä–∏ —Ä–µ–∞–≥—É—é—Ç—å —Å–∞–º–µ –Ω–∞ –∫–æ–º–∞–Ω–¥–∏ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏–º–∏, –∞ –Ω–µ –Ω–∞ –∑–º—ñ–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ë–î (–¥–ª—è —Ü—å–æ–≥–æ —î DDL-—Ç—Ä–∏–≥–µ—Ä–∏).
::

---

## –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏?

### Use Cases (–°—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)

::card-group
::card{icon="i-lucide-shield-check" title="–ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö"}
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª, —è–∫—ñ –Ω–µ–º–æ–∂–ª–∏–≤–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ FOREIGN KEY –∞–±–æ CHECK constraints.

**–ü—Ä–∏–∫–ª–∞–¥**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–Ω–∏–≥–∏-–±–µ—Å—Ç—Å–µ–ª–µ—Ä–∞.
::

::card{icon="i-lucide-file-text" title="–ê—É–¥–∏—Ç –∑–º—ñ–Ω"}
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–º—ñ–Ω –¥–∞–Ω–∏—Ö (—Ö—Ç–æ, –∫–æ–ª–∏, —â–æ –∑–º—ñ–Ω–∏–≤).

**–ü—Ä–∏–∫–ª–∞–¥**: –ó–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤ –æ–∫—Ä–µ–º—É —Ç–∞–±–ª–∏—Ü—é –≤—Å—ñ –≤–∏–¥–∞–ª–µ–Ω—ñ –∫–Ω–∏–≥–∏.
::

::card{icon="i-lucide-refresh-cw" title="–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö"}
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–∏—Ö –¥–∞–Ω–∏—Ö –≤ —ñ–Ω—à–∏—Ö —Ç–∞–±–ª–∏—Ü—è—Ö.

**–ü—Ä–∏–∫–ª–∞–¥**: –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂—É –∑–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–Ω–∏–≥ –Ω–∞ —Å–∫–ª–∞–¥—ñ.
::

::card{icon="i-lucide-calculator" title="–û–±—á–∏—Å–ª–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å"}
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å.

**–ü—Ä–∏–∫–ª–∞–¥**: –û–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å–µ—Ä–µ–¥–Ω—é —Ü—ñ–Ω—É –∫–Ω–∏–≥ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ü—ñ–Ω–∏.
::
::

::warning
**–í–∞–∂–ª–∏–≤–æ**: –¢—Ä–∏–≥–µ—Ä–∏ **–ù–ï** –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–º—ñ–Ω—é–≤–∞—Ç–∏ constraints (–æ–±–º–µ–∂–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ)!

- **FOREIGN KEY, CHECK, UNIQUE** ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—ó —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ
- **–¢—Ä–∏–≥–µ—Ä–∏** ‚Äî –¥–ª—è —Å–∫–ª–∞–¥–Ω–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏, —è–∫—É –Ω–µ–º–æ–∂–ª–∏–≤–æ –≤–∏—Ä–∞–∑–∏—Ç–∏ —á–µ—Ä–µ–∑ constraints

–ß–æ–º—É? Constraints —à–≤–∏–¥—à—ñ —ñ —è–≤–Ω–æ –ø–æ–∫–∞–∑—É—é—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î.
::

---

## –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

–¢—Ä–∏–≥–µ—Ä–∏ **–ù–ï** –≤–∏–∫–ª–∏–∫–∞—é—Ç—å—Å—è —è–≤–Ω–æ. –í–æ–Ω–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É—é—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó.

::code-group

```sql [–ë–µ–∑ —Ç—Ä–∏–≥–µ—Ä–∞ - –≤—Ä—É—á–Ω—É]
-- –ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É INSERT –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä—É—á–Ω—É:
BEGIN TRANSACTION;

INSERT INTO Sales (BookId, Quantity, Price)
VALUES (1, 2, 250.00);

-- –ó–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥—ñ
UPDATE Books
SET QuantityInStock = QuantityInStock - 2
WHERE Id = 1;

-- –ó–∞–ø–∏—Å–∞—Ç–∏ –≤ –∂—É—Ä–Ω–∞–ª
INSERT INTO AuditLog (ActionType, TableName, ActionDate)
VALUES ('INSERT', 'Sales', GETDATE());

COMMIT;
```

```sql [–ó —Ç—Ä–∏–≥–µ—Ä–æ–º - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ]
-- –°—Ç–≤–æ—Ä—é—î–º–æ —Ç—Ä–∏–≥–µ—Ä –æ–¥–∏–Ω —Ä–∞–∑
CREATE TRIGGER trg_AfterSaleInsert
ON Sales
AFTER INSERT
AS
BEGIN
    -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–º–µ–Ω—à—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å
    UPDATE Books
    SET QuantityInStock = QuantityInStock - inserted.Quantity
    FROM Books b
    INNER JOIN inserted i ON b.Id = i.BookId;
    
    -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ª–æ–≥—É—î–º–æ
    INSERT INTO AuditLog (ActionType, TableName, ActionDate)
    VALUES ('INSERT', 'Sales', GETDATE());
END;

-- –¢–µ–ø–µ—Ä –ø—Ä–æ—Å—Ç–∏–π INSERT ‚Äî —Ä–µ—à—Ç–∞ –∑—Ä–æ–±–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ!
INSERT INTO Sales (BookId, Quantity, Price)
VALUES (1, 2, 250.00);
```

::

### –¢–∞–±–ª–∏—Ü—ñ INSERTED —Ç–∞ DELETED

MS SQL Server –Ω–∞–¥–∞—î –¥–≤—ñ **–ª–æ–≥—ñ—á–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ** –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö, —è–∫—ñ –∑–º—ñ–Ω—é—é—Ç—å—Å—è:

| –¢–∞–±–ª–∏—Ü—è    | –ö–æ–ª–∏ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è     | –©–æ –º—ñ—Å—Ç–∏—Ç—å                          |
| :--------- | :-------------------- | :---------------------------------- |
| `INSERTED` | INSERT, UPDATE        | **–ù–æ–≤—ñ** –∑–Ω–∞—á–µ–Ω–Ω—è —Ä—è–¥–∫—ñ–≤            |
| `DELETED`  | DELETE, UPDATE        | **–°—Ç–∞—Ä—ñ** –∑–Ω–∞—á–µ–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ (–¥–æ –∑–º—ñ–Ω–∏) |

::plant-uml

```plantuml
@startuml
skinparam style plain
skinparam defaultFontName "Segoe UI"

rectangle "–ë–∞–∑–æ–≤–∞ —Ç–∞–±–ª–∏—Ü—è\nBooks" as Books #LightBlue

rectangle "INSERTED\n(–≤ –ø–∞–º'—è—Ç—ñ)" as INS #LightGreen
rectangle "DELETED\n(–≤ –ø–∞–º'—è—Ç—ñ)" as DEL #LightCoral

note right of INS
  –ú—ñ—Å—Ç–∏—Ç—å –Ω–æ–≤—ñ –¥–∞–Ω—ñ
  –ø—Ä–∏ INSERT —Ç–∞ UPDATE
end note

note right of DEL
  –ú—ñ—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ
  –ø—Ä–∏ DELETE —Ç–∞ UPDATE
end note

Books --> INS : INSERT:\n–î–∞–Ω—ñ —Å–ø–æ—á–∞—Ç–∫—É\n–π–¥—É—Ç—å –≤ INSERTED
Books --> DEL : DELETE:\n–î–∞–Ω—ñ —Å–ø–æ—á–∞—Ç–∫—É\n–π–¥—É—Ç—å –≤ DELETED

INS -[hidden]down- DEL

@enduml
```

::

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

::tabs

::tabs-item{label="INSERT"}
1. **–ü–µ—Ä–µ–¥** –≤—Å—Ç–∞–≤–∫–æ—é –≤ –±–∞–∑–æ–≤—É —Ç–∞–±–ª–∏—Ü—é –¥–∞–Ω—ñ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å –≤ `INSERTED`
2. –°–ø—Ä–∞—Ü—å–æ–≤—É—î —Ç—Ä–∏–≥–µ—Ä ‚Üí –º–æ–∂–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –¥–∞–Ω—ñ –∑ `INSERTED`
3. –î–∞–Ω—ñ –≤—Å—Ç–∞–≤–ª—è—é—Ç—å—Å—è –≤ –±–∞–∑–æ–≤—É —Ç–∞–±–ª–∏—Ü—é

```sql
-- –ü—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ:
INSERT INTO Books (Title, Price) VALUES ('SQL –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤', 299.99);

-- –¢–∞–±–ª–∏—Ü—è INSERTED –º—ñ—Å—Ç–∏—Ç—å:
-- Title                  | Price
-- 'SQL –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤'  | 299.99

-- –¢–∞–±–ª–∏—Ü—è DELETED ‚Äî –ø–æ—Ä–æ–∂–Ω—è
```

::

::tabs-item{label="DELETE"}
1. –î–∞–Ω—ñ –∑ –±–∞–∑–æ–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –∫–æ–ø—ñ—é—é—Ç—å—Å—è –≤ `DELETED`
2. –°–ø—Ä–∞—Ü—å–æ–≤—É—î —Ç—Ä–∏–≥–µ—Ä ‚Üí –º–æ–∂–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –≤–∏–¥–∞–ª—è—î–º—ñ –¥–∞–Ω—ñ –∑ `DELETED`
3. –î–∞–Ω—ñ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –∑ –±–∞–∑–æ–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ

```sql
-- –ü—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ:
DELETE FROM Books WHERE Id = 5;

-- –¢–∞–±–ª–∏—Ü—è DELETED –º—ñ—Å—Ç–∏—Ç—å:
-- Id | Title        | Price
-- 5  | '–°—Ç–∞—Ä–∞—á–æ–∫'   | 150.00

-- –¢–∞–±–ª–∏—Ü—è INSERTED ‚Äî –ø–æ—Ä–æ–∂–Ω—è
```

::

::tabs-item{label="UPDATE"}
UPDATE ‚Äî —Ü–µ **DELETE + INSERT**!

1. –°—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Üí `DELETED`
2. –ù–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Üí `INSERTED`
3. –°–ø—Ä–∞—Ü—å–æ–≤—É—î —Ç—Ä–∏–≥–µ—Ä ‚Üí –º–æ–∂–µ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ —Å—Ç–∞—Ä—ñ –π –Ω–æ–≤—ñ –¥–∞–Ω—ñ

```sql
-- –ü—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ:
UPDATE Books SET Price = 350.00 WHERE Id = 10;

-- –¢–∞–±–ª–∏—Ü—è DELETED (—Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è):
-- Id | Title               | Price
-- 10 | '–ß–∏—Å—Ç–∏–π –∫–æ–¥'        | 320.00

-- –¢–∞–±–ª–∏—Ü—è INSERTED (–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è):
-- Id | Title               | Price
-- 10 | '–ß–∏—Å—Ç–∏–π –∫–æ–¥'        | 350.00
```

::

::

::tip
**–ö–ª—é—á–æ–≤–∞ –ø–µ—Ä–µ–≤–∞–≥–∞**: –î–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –ë–î. –¢—Ä–∏–≥–µ—Ä –º–æ–∂–µ –≤—ñ–¥—Ä–∞–∑—É –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —â–æ —Å–∞–º–µ –≤—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è/–≤–∏–¥–∞–ª—è—î—Ç—å—Å—è/–∑–º—ñ–Ω—é—î—Ç—å—Å—è.
::

---

## –¢–∏–ø–∏ DML-—Ç—Ä–∏–≥–µ—Ä—ñ–≤: AFTER vs INSTEAD OF

MS SQL Server –ø—ñ–¥—Ç—Ä–∏–º—É—î –¥–≤–∞ —Ä–µ–∂–∏–º–∏ DML-—Ç—Ä–∏–≥–µ—Ä—ñ–≤:

::tabs

::tabs-item{label="AFTER (–ü—ñ—Å–ª—è)"}
**–í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ü–Ü–°–õ–Ø** –∑–º—ñ–Ω–∏ –¥–∞–Ω–∏—Ö –≤ –±–∞–∑–æ–≤—ñ–π —Ç–∞–±–ª–∏—Ü—ñ.

```sql
CREATE TRIGGER trg_AfterInsert
ON Books
AFTER INSERT  -- –∞–±–æ FOR INSERT (—Å–∏–Ω–æ–Ω—ñ–º–∏)
AS
BEGIN
    PRINT '–ö–Ω–∏–≥–∞ –≤–∂–µ –¥–æ–¥–∞–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—é!';
END;
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- ‚úÖ –î–∞–Ω—ñ –≤–∂–µ –≤ —Ç–∞–±–ª–∏—Ü—ñ
- ‚úÖ –ú–æ–∂–Ω–∞ –≤—ñ–¥–º—ñ–Ω–∏—Ç–∏ –∑–º—ñ–Ω–∏ —á–µ—Ä–µ–∑ `ROLLBACK TRANSACTION`
- ‚úÖ **–¢—ñ–ª—å–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—å** (–Ω–µ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å)
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: –∞—É–¥–∏—Ç, —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è, –ª–æ–≥—É–≤–∞–Ω–Ω—è

::

::tabs-item{label="INSTEAD OF (–ó–∞–º—ñ—Å—Ç—å)"}
**–í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ó–ê–ú–Ü–°–¢–¨** –∫–æ–º–∞–Ω–¥–∏ INSERT/UPDATE/DELETE.

```sql
CREATE TRIGGER trg_InsteadOfDelete
ON Books
INSTEAD OF DELETE
AS
BEGIN
    -- –ö–æ–º–∞–Ω–¥–∞ DELETE –ù–ï –≤–∏–∫–æ–Ω–∞–ª–∞—Å—å!
    -- –ú–∏ –º–æ–∂–µ–º–æ –∑—Ä–æ–±–∏—Ç–∏ –≤–ª–∞—Å–Ω—É –ª–æ–≥—ñ–∫—É
    PRINT '–í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–Ω–∏–≥ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ! –ü–µ—Ä–µ–Ω–æ—Å–∏–º–æ –≤ –∞—Ä—Ö—ñ–≤...';
    
    -- –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞–º—ñ—Å—Ç—å –≤–∏–¥–∞–ª–µ–Ω–Ω—è ‚Äî –ø–æ–∑–Ω–∞—á–∏—Ç–∏ IsDeleted = 1
    UPDATE Books
    SET IsDeleted = 1
    WHERE Id IN (SELECT Id FROM deleted);
END;
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**:
- ‚úÖ –î–∞–Ω—ñ **–ù–ï** –∑–º—ñ–Ω–µ–Ω—ñ –≤ —Ç–∞–±–ª–∏—Ü—ñ (–∫–æ–º–∞–Ω–¥–∞ –Ω–µ –≤–∏–∫–æ–Ω–∞–ª–∞—Å—å)
- ‚úÖ –¢—Ä–∏–≥–µ—Ä —Å–∞–º –≤–∏—Ä—ñ—à—É—î —â–æ —Ä–æ–±–∏—Ç–∏
- ‚úÖ –ú–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—å –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥, —Å–∫–ª–∞–¥–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è, soft delete

::

::

::plant-uml

```plantuml
@startuml
skinparam style plain
skinparam defaultFontName "Segoe UI"

start

:–ö–æ–º–∞–Ω–¥–∞ INSERT/UPDATE/DELETE;

if (–¢–∏–ø —Ç—Ä–∏–≥–µ—Ä–∞?) then (INSTEAD OF)
  :–¢—Ä–∏–≥–µ—Ä INSTEAD OF –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è;
  note right
    –ö–æ–º–∞–Ω–¥–∞ –ù–ï –≤–∏–∫–æ–Ω–∞–ª–∞—Å—å!
    –¢—Ä–∏–≥–µ—Ä –≤–∏—Ä—ñ—à—É—î —â–æ —Ä–æ–±–∏—Ç–∏
  end note
  
  if (–¢—Ä–∏–≥–µ—Ä –≤–∏–∫–æ–Ω–∞–≤ –∫–æ–º–∞–Ω–¥—É?) then (–¢–∞–∫)
    :–î–∞–Ω—ñ –∑–º—ñ–Ω–µ–Ω—ñ –≤ —Ç–∞–±–ª–∏—Ü—ñ;
  else (–ù—ñ)
    :–î–∞–Ω—ñ –ù–ï –∑–º—ñ–Ω–µ–Ω—ñ;
  endif
  
else (AFTER / FOR)
  :–ö–æ–º–∞–Ω–¥–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è;
  :–î–∞–Ω—ñ –∑–º—ñ–Ω–µ–Ω—ñ –≤ —Ç–∞–±–ª–∏—Ü—ñ;
  
  :–¢—Ä–∏–≥–µ—Ä AFTER –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è;
  note right
    –ú–æ–∂–µ –≤—ñ–¥–º—ñ–Ω–∏—Ç–∏ –∑–º—ñ–Ω–∏
    —á–µ—Ä–µ–∑ ROLLBACK
  end note
  
  if (ROLLBACK –≤ —Ç—Ä–∏–≥–µ—Ä—ñ?) then (–¢–∞–∫)
    :–ó–º—ñ–Ω–∏ –≤—ñ–¥–º—ñ–Ω–µ–Ω—ñ;
  else (–ù—ñ)
    :–ó–º—ñ–Ω–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ;
  endif
endif

stop

@enduml
```

::

---

## –ë–∞–∑–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å CREATE TRIGGER

```sql
CREATE TRIGGER [schema.]trigger_name
    ON {table_name | view_name}
    [WITH ENCRYPTION]  -- —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–¥—É —Ç—Ä–∏–≥–µ—Ä–∞
    {FOR | AFTER | INSTEAD OF}
    {[INSERT] [,] [UPDATE] [,] [DELETE]}
    [NOT FOR REPLICATION]  -- –Ω–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –ø—Ä–∏ —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—ó
AS
BEGIN
    -- –¢—ñ–ª–æ —Ç—Ä–∏–≥–µ—Ä–∞ (T-SQL –∫–æ–¥)
END;
```

**–ê–Ω–∞—Ç–æ–º—ñ—è**:

- `trigger_name` ‚Äî —ñ–º'—è —Ç—Ä–∏–≥–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: `trg_<Table>_<Action>_<Operation>`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `trg_Books_After_Insert`)
- `ON table_name` ‚Äî –¥–ª—è —è–∫–æ—ó —Ç–∞–±–ª–∏—Ü—ñ/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —Ç—Ä–∏–≥–µ—Ä
- `FOR | AFTER | INSTEAD OF` ‚Äî —Ä–µ–∂–∏–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
  - `FOR` —Ç–∞ `AFTER` ‚Äî —Å–∏–Ω–æ–Ω—ñ–º–∏ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º AFTER)
- `INSERT, UPDATE, DELETE` ‚Äî –Ω–∞ —è–∫—ñ –ø–æ–¥—ñ—ó —Ä–µ–∞–≥—É–≤–∞—Ç–∏ (–º–æ–∂–Ω–∞ –∫–æ–º–±—ñ–Ω—É–≤–∞—Ç–∏)
- `NOT FOR REPLICATION` ‚Äî —Ç—Ä–∏–≥–µ—Ä –Ω–µ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è –ø—Ä–∏ —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

### –ü—Ä–∏–∫–ª–∞–¥ 1: –õ–æ–≥—É–≤–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–º—ñ–Ω–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤

**–ó–∞–¥–∞—á–∞**: –ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∞–±–æ –∑–º—ñ–Ω—ñ –∞–≤—Ç–æ—Ä—ñ–≤ –≤–∏–≤–æ–¥–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–±—Ä–æ–±–ª–µ–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤.

```sql
CREATE TRIGGER trg_Authors_AfterInsertUpdate
ON book.Authors
FOR INSERT, UPDATE  -- –°–ø—Ä–∞—Ü—é—î —ñ –Ω–∞ INSERT, —ñ –Ω–∞ UPDATE
AS
BEGIN
    DECLARE @rowCount INT = @@ROWCOUNT;
    
    RAISERROR('%d —Ä—è–¥–∫—ñ–≤ –±—É–ª–æ –¥–æ–¥–∞–Ω–æ –∞–±–æ –º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ', 0, 1, @rowCount);
END;
GO

-- –¢–µ—Å—Ç—É—î–º–æ:
INSERT INTO book.Authors (FirstName, LastName, CountryId)
VALUES ('–ê—Ä—Ç—É—Ä', '–ö–æ–Ω–∞–Ω –î–æ–π–ª', 2);

-- –†–µ–∑—É–ª—å—Ç–∞—Ç: "1 —Ä—è–¥–∫—ñ–≤ –±—É–ª–æ –¥–æ–¥–∞–Ω–æ –∞–±–æ –º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ"
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- `@@ROWCOUNT` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞, —è–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤, —â–æ –æ–±—Ä–æ–±–ª–µ–Ω—ñ –æ—Å—Ç–∞–Ω–Ω—å–æ—é –∫–æ–º–∞–Ω–¥–æ—é
- `RAISERROR` ‚Äî –≤–∏–≤–æ–¥–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (0 ‚Äî —Ä—ñ–≤–µ–Ω—å –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–ª—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å)

---

### –ü—Ä–∏–∫–ª–∞–¥ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞—Ç–∏ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó

**–ó–∞–¥–∞—á–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–Ω–∏–≥, –¥–∞—Ç–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó —è–∫–∏—Ö —Å—Ç–∞—Ä—à–µ 30 –¥–Ω—ñ–≤.

```sql
CREATE TRIGGER trg_Books_CheckPublishDate
ON book.Books
FOR INSERT
AS
BEGIN
    DECLARE @publishDate SMALLDATETIME;
    
    -- –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞—Ç—É –∑ —Ç–∞–±–ª–∏—Ü—ñ INSERTED
    SELECT @publishDate = DateOfPublish
    FROM inserted;
    
    -- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –¥–∞—Ç–∞ –Ω–µ —Å—Ç–∞—Ä—à–∞ 30 –¥–Ω—ñ–≤
    IF @publishDate <= DATEADD(DAY, -30, GETDATE())
    BEGIN
        RAISERROR('–¶–µ —Å—Ç–∞—Ä–∞ –∫–Ω–∏–≥–∞, –¥–∞–Ω—ñ –ø—Ä–æ –Ω–µ—ó –¥–æ–¥–∞–Ω—ñ –Ω–µ –±—É–¥—É—Ç—å', 16, 1);
        ROLLBACK TRANSACTION;  -- –í—ñ–¥–º—ñ–Ω—è—î–º–æ INSERT
    END
    ELSE
    BEGIN
        PRINT '–î–∞–Ω—ñ –¥–æ–¥–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ';
    END
END;
GO

-- –¢–µ—Å—Ç—É—î–º–æ:
INSERT INTO book.Books (NameBook, ThemeId, AuthorId, Price, DateOfPublish, Pages)
VALUES ('–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è MS SQL Server 2005', 21, 1, 125.0, '2007-09-01', 726);

-- –†–µ–∑—É–ª—å—Ç–∞—Ç: "–¶–µ —Å—Ç–∞—Ä–∞ –∫–Ω–∏–≥–∞, –¥–∞–Ω—ñ –ø—Ä–æ –Ω–µ—ó –¥–æ–¥–∞–Ω—ñ –Ω–µ –±—É–¥—É—Ç—å"
-- INSERT –≤—ñ–¥–º—ñ–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ ROLLBACK
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é `inserted` –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö, —è–∫—ñ –≤—Å—Ç–∞–≤–ª—è—é—Ç—å—Å—è
- `DATEADD(DAY, -30, GETDATE())` ‚Äî –¥–∞—Ç–∞ 30 –¥–Ω—ñ–≤ —Ç–æ–º—É –≤—ñ–¥ —Å—å–æ–≥–æ–¥–Ω—ñ
- `ROLLBACK TRANSACTION` ‚Äî –≤—ñ–¥–º—ñ–Ω—è—î –≤—Å—ñ –∑–º—ñ–Ω–∏ –ø–æ—Ç–æ—á–Ω–æ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó (–≤ —Ç–æ–º—É —á–∏—Å–ª—ñ INSERT)
- `RAISERROR` –∑ —Ä—ñ–≤–Ω–µ–º 16 ‚Äî –ø–æ–º–∏–ª–∫–∞ —Ä—ñ–≤–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

::tip
**Best Practice**: –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `IF EXISTS` –∞–±–æ –∑–º—ñ–Ω–Ω—ñ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ `inserted`/`deleted`, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü—ñ —Ç–∞–±–ª–∏—Ü—ñ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ **–∫—ñ–ª—å–∫–∞ —Ä—è–¥–∫—ñ–≤** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–∏ –º–∞—Å–æ–≤–æ–º—É INSERT).
::

---

### –ü—Ä–∏–∫–ª–∞–¥ 3: –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –±–µ—Å—Ç—Å–µ–ª–µ—Ä–∞

**–ó–∞–¥–∞—á–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–Ω–∏–≥–∏, —è–∫–∞ —î –ª—ñ–¥–µ—Ä–æ–º –ø—Ä–æ–¥–∞–∂—ñ–≤.

```sql
CREATE TRIGGER trg_Books_PreventBestsellerDelete
ON book.Books
FOR DELETE
AS
BEGIN
    DECLARE @deletedBookName NVARCHAR(100);
    DECLARE @bestsellerName NVARCHAR(100);
    
    -- –û—Ç—Ä–∏–º—É—î–º–æ –Ω–∞–∑–≤—É –∫–Ω–∏–≥–∏, —è–∫—É –≤–∏–¥–∞–ª—è—é—Ç—å
    SELECT @deletedBookName = NameBook
    FROM deleted;
    
    -- –ó–Ω–∞—Ö–æ–¥–∏–º–æ –±–µ—Å—Ç—Å–µ–ª–µ—Ä (–∫–Ω–∏–≥–∞ –∑ –Ω–∞–π–±—ñ–ª—å—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø—Ä–æ–¥–∞–∂—ñ–≤)
    SELECT TOP 1 @bestsellerName = b.NameBook
    FROM book.Books b
    INNER JOIN sale.Sales s ON b.Id = s.BookId
    GROUP BY b.NameBook
    ORDER BY COUNT(s.Id) DESC;
    
    -- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–±—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞–∑–≤–∏
    IF @bestsellerName = @deletedBookName
    BEGIN
        RAISERROR('–í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –¥–∞–Ω—É –∫–Ω–∏–≥—É - —Ü–µ –±–µ—Å—Ç—Å–µ–ª–µ—Ä!', 16, 1);
        ROLLBACK TRANSACTION;
    END
    ELSE
    BEGIN
        PRINT '–ö–Ω–∏–≥–∞ –≤–∏–¥–∞–ª–µ–Ω–∞ —É—Å–ø—ñ—à–Ω–æ';
    END
END;
GO
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é `deleted` –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–∏–¥–∞–ª—è—î–º–∏—Ö –¥–∞–Ω–∏—Ö
- –ü—ñ–¥–∑–∞–ø–∏—Ç –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –∫–Ω–∏–≥—É –∑ –Ω–∞–π–±—ñ–ª—å—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø—Ä–æ–¥–∞–∂—ñ–≤
- –Ø–∫—â–æ –∫–Ω–∏–≥–∞ —Å–ø—ñ–≤–ø–∞–¥–∞—î –∑ –±–µ—Å—Ç—Å–µ–ª–µ—Ä–æ–º ‚Äî –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ

---

### –ü—Ä–∏–∫–ª–∞–¥ 4: INSTEAD OF –¥–ª—è "–º'—è–∫–æ–≥–æ" –≤–∏–¥–∞–ª–µ–Ω–Ω—è

**–ó–∞–¥–∞—á–∞**: –ó–∞–º—ñ—Å—Ç—å —Ñ—ñ–∑–∏—á–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–Ω–∏–≥–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è ‚Äî –ø–æ–∑–Ω–∞—á–∞—Ç–∏ —è–∫ –≤–∏–¥–∞–ª–µ–Ω—É (soft delete).

```sql
-- –°–ø–æ—á–∞—Ç–∫—É –¥–æ–¥–∞–º–æ –∫–æ–ª–æ–Ω–∫—É IsDeleted –¥–æ —Ç–∞–±–ª–∏—Ü—ñ Books
ALTER TABLE book.Books
ADD IsDeleted BIT NOT NULL DEFAULT 0;
GO

CREATE TRIGGER trg_Books_InsteadOfDelete
ON book.Books
INSTEAD OF DELETE
AS
BEGIN
    DECLARE @programmingThemeId INT;
    
    -- –û—Ç—Ä–∏–º—É—î–º–æ ID —Ç–µ–º–∞—Ç–∏–∫–∏ "–ü—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è"
    SELECT @programmingThemeId = Id
    FROM book.Themes
    WHERE NameTheme = '–ü—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è';
    
    -- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î –≤ deleted –∫–Ω–∏–≥–∏ —Ü—ñ—î—ó —Ç–µ–º–∞—Ç–∏–∫–∏
    IF EXISTS (
        SELECT 1
        FROM deleted
        WHERE ThemeId = @programmingThemeId
    )
    BEGIN
        -- –ó–∞–º—ñ—Å—Ç—å –≤–∏–¥–∞–ª–µ–Ω–Ω—è ‚Äî –ø–æ–∑–Ω–∞—á–∞—î–º–æ IsDeleted = 1
        UPDATE book.Books
        SET IsDeleted = 1
        WHERE Id IN (SELECT Id FROM deleted WHERE ThemeId = @programmingThemeId);
        
        RAISERROR('–ö–Ω–∏–≥–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è –Ω–µ –≤–∏–¥–∞–ª–µ–Ω–æ —Ñ—ñ–∑–∏—á–Ω–æ, –∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ –∞—Ä—Ö—ñ–≤', 10, 1);
    END
    ELSE
    BEGIN
        -- –î–ª—è —ñ–Ω—à–∏—Ö —Ç–µ–º–∞—Ç–∏–∫ ‚Äî –≤–∏–∫–æ–Ω—É—î–º–æ —Ä–µ–∞–ª—å–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
        DELETE FROM book.Books
        WHERE Id IN (SELECT Id FROM deleted);
        
        PRINT '–ö–Ω–∏–≥–∏ –≤–∏–¥–∞–ª–µ–Ω–æ';
    END
END;
GO
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- `INSTEAD OF DELETE` ‚Äî –∫–æ–º–∞–Ω–¥–∞ DELETE –ù–ï –≤–∏–∫–æ–Ω–∞–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- –¢—Ä–∏–≥–µ—Ä —Å–∞–º –≤–∏—Ä—ñ—à—É—î: –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è ‚Äî soft delete, –¥–ª—è —ñ–Ω—à–∏—Ö ‚Äî —Ä–µ–∞–ª—å–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
- **–í–∞–∂–ª–∏–≤–æ**: –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ —Ä–µ–∞–ª—å–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è, —Ç—Ä–∏–≥–µ—Ä –ø–æ–≤–∏–Ω–µ–Ω —Å–∞–º –≤–∏–∫–æ–Ω–∞—Ç–∏ `DELETE`

---

## –ü—Ä–∞–≤–∏–ª–∞ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è

::warning
**–ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ** –≤ —Ç—ñ–ª—ñ DML-—Ç—Ä–∏–≥–µ—Ä—ñ–≤:

- ‚ùå –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ë–î: `CREATE/ALTER/DROP DATABASE`
- ‚ùå `TRUNCATE TABLE` (—Å–ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ DELETE)
- ‚ùå `RECONFIGURE`, `BACKUP`, `RESTORE`
- ‚ùå `GRANT`, `REVOKE` (–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É)
- ‚ùå `SELECT INTO` (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ)
- ‚ùå `UPDATE STATISTICS`

**–î–æ–∑–≤–æ–ª–µ–Ω–æ**:

- ‚úÖ INSERT, UPDATE, DELETE –≤ —ñ–Ω—à–∏—Ö —Ç–∞–±–ª–∏—Ü—è—Ö
- ‚úÖ SELECT –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- ‚úÖ –í–∏–∫–ª–∏–∫ –∑–±–µ—Ä—ñ–≥–∞—î–º–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä
- ‚úÖ –†–æ–±–æ—Ç–∞ –∑ —Ç–∏–º—á–∞—Å–æ–≤–∏–º–∏ —Ç–∞–±–ª–∏—Ü—è–º–∏
- ‚úÖ ROLLBACK TRANSACTION
::

::note
**–í–∞–∂–ª–∏–≤—ñ –ø—Ä–∞–≤–∏–ª–∞**:

1. **–¢–∏–º—á–∞—Å–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ**: –ù–ï –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å, –∞–ª–µ —Ç—Ä–∏–≥–µ—Ä –º–æ–∂–µ –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –¥–æ –Ω–∏—Ö
2. **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è**: INSTEAD OF —Ç—Ä–∏–≥–µ—Ä–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å
3. **AFTER —Ç—Ä–∏–≥–µ—Ä–∏**: –¢—ñ–ª—å–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—å
4. **–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤**: –¢—Ä–∏–≥–µ—Ä–∏ –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ result sets (—É–Ω–∏–∫–∞–π—Ç–µ SELECT –±–µ–∑ INTO/INSERT)
5. **–†–µ–∫—É—Ä—Å—ñ—è**: –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –¥–æ 32 —Ä—ñ–≤–Ω—ñ–≤ (–ø–æ—Ç—Ä—ñ–±–Ω–æ —É–≤—ñ–º–∫–Ω—É—Ç–∏ `RECURSIVE_TRIGGERS`)
::

---

## –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞–º–∏

### –ó–º—ñ–Ω–∞ —Ç—Ä–∏–≥–µ—Ä–∞ (ALTER TRIGGER)

```sql
ALTER TRIGGER trg_Books_AfterInsert
ON book.Books
AFTER INSERT
AS
BEGIN
    -- –ù–æ–≤–∏–π –∫–æ–¥ —Ç—Ä–∏–≥–µ—Ä–∞
    PRINT '–û–Ω–æ–≤–ª–µ–Ω–∏–π —Ç—Ä–∏–≥–µ—Ä!';
END;
```

### –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞

```sql
-- –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç—Ä–∏–≥–µ—Ä
DISABLE TRIGGER trg_Books_AfterInsert ON book.Books;

-- –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –í–°–Ü —Ç—Ä–∏–≥–µ—Ä–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ
DISABLE TRIGGER ALL ON book.Books;
```

### –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞

```sql
-- –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç—Ä–∏–≥–µ—Ä
ENABLE TRIGGER trg_Books_AfterInsert ON book.Books;

-- –£–≤—ñ–º–∫–Ω—É—Ç–∏ –í–°–Ü —Ç—Ä–∏–≥–µ—Ä–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ
ENABLE TRIGGER ALL ON book.Books;
```

### –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞

```sql
DROP TRIGGER trg_Books_AfterInsert;

-- –í–∏–¥–∞–ª–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –≤—ñ–¥—Ä–∞–∑—É
DROP TRIGGER trg_Books_AfterInsert, trg_Authors_AfterUpdate;
```

---

## –ú–µ—Ç–∞–¥–∞–Ω—ñ —Ç—Ä–∏–≥–µ—Ä—ñ–≤

–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ç—Ä–∏–≥–µ—Ä–∏ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è—Ö:

```sql
-- –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
SELECT 
    name AS TriggerName,
    OBJECT_NAME(parent_id) AS TableName,
    is_disabled AS IsDisabled,
    is_instead_of_trigger AS IsInsteadOf
FROM sys.triggers
WHERE parent_class_desc = 'OBJECT_OR_COLUMN';

-- –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–¥ —Ç—Ä–∏–≥–µ—Ä–∞
SELECT m.definition
FROM sys.sql_modules m
INNER JOIN sys.triggers t ON m.object_id = t.object_id
WHERE t.name = 'trg_Books_AfterInsert';

-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —á–µ—Ä–µ–∑ sp_helptext
EXEC sp_helptext 'trg_Books_AfterInsert';
```

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

::accordion

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 1: –¢—Ä–∏–≥–µ—Ä –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ" icon="i-lucide-package"}

**–£–º–æ–≤–∞**: –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂—É –∫–Ω–∏–≥–∏ (INSERT –≤ —Ç–∞–±–ª–∏—Ü—é `Sales`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–º–µ–Ω—à—É–≤–∞—Ç–∏ `QuantityInStock` –≤ —Ç–∞–±–ª–∏—Ü—ñ `Books`.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
CREATE TRIGGER trg_Sales_UpdateStock
ON sale.Sales
AFTER INSERT
AS
BEGIN
    UPDATE book.Books
    SET QuantityInStock = QuantityInStock - i.Quantity
    FROM book.Books b
    INNER JOIN inserted i ON b.Id = i.BookId;
    
    PRINT '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–Ω–∏–≥ –Ω–∞ —Å–∫–ª–∞–¥—ñ –æ–Ω–æ–≤–ª–µ–Ω–æ';
END;
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- JOIN –∑ `inserted` –¥–æ–∑–≤–æ–ª—è—î –æ–±—Ä–æ–±–∏—Ç–∏ –≤—Å—ñ –≤—Å—Ç–∞–≤–ª–µ–Ω—ñ —Ä—è–¥–∫–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ
- `QuantityInStock - i.Quantity` ‚Äî –∑–º–µ–Ω—à—É—î–º–æ –Ω–∞ –∫—É–ø–ª–µ–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–Ω–æ—Å—Ç—ñ —Ç–æ–≤–∞—Ä—É" icon="i-lucide-alert-triangle"}

**–£–º–æ–≤–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –ø—Ä–æ–¥–∞–∂, —è–∫—â–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–Ω–∏–≥ –≤ `Sales.Quantity` –ø–µ—Ä–µ–≤–∏—â—É—î `Books.QuantityInStock`.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
CREATE TRIGGER trg_Sales_CheckStock
ON sale.Sales
FOR INSERT
AS
BEGIN
    IF EXISTS (
        SELECT 1
        FROM inserted i
        INNER JOIN book.Books b ON i.BookId = b.Id
        WHERE i.Quantity > b.QuantityInStock
    )
    BEGIN
        RAISERROR('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–Ω–∏–≥ –Ω–∞ —Å–∫–ª–∞–¥—ñ –¥–ª—è –ø—Ä–æ–¥–∞–∂—É', 16, 1);
        ROLLBACK TRANSACTION;
    END
END;
```

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 3: –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–∏—Ö –∫–Ω–∏–≥" icon="i-lucide-file-text"}

**–£–º–æ–≤–∞**: –ü—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–Ω–∏–≥–∏ ‚Äî –∫–æ–ø—ñ—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ –≤ —Ç–∞–±–ª–∏—Ü—é `DeletedBooks`.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
-- –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é –¥–ª—è –∞—Ä—Ö—ñ–≤—É
CREATE TABLE book.DeletedBooks (
    Id INT PRIMARY KEY IDENTITY,
    OriginalBookId INT,
    NameBook NVARCHAR(200),
    Price DECIMAL(10,2),
    DeletedAt DATETIME DEFAULT GETDATE()
);
GO

CREATE TRIGGER trg_Books_ArchiveDeleted
ON book.Books
FOR DELETE
AS
BEGIN
    INSERT INTO book.DeletedBooks (OriginalBookId, NameBook, Price)
    SELECT Id, NameBook, Price
    FROM deleted;
    
    PRINT '–í–∏–¥–∞–ª–µ–Ω—ñ –∫–Ω–∏–≥–∏ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –∞—Ä—Ö—ñ–≤';
END;
```

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 4: –ö–æ–Ω—Ç—Ä–æ–ª—å —Ü—ñ–Ω–∏ –ø—Ä–æ–¥–∞–∂—É" icon="i-lucide-dollar-sign"}

**–£–º–æ–≤–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –ø—Ä–æ–¥–∞–∂ –∫–Ω–∏–≥–∏ –∑–∞ —Ü—ñ–Ω–æ—é –Ω–∏–∂—á–æ—é, –Ω—ñ–∂ –±–∞–∑–æ–≤–∞ —Ü—ñ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—ñ `Books`.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
CREATE TRIGGER trg_Sales_CheckPrice
ON sale.Sales
FOR INSERT, UPDATE
AS
BEGIN
    IF EXISTS (
        SELECT 1
        FROM inserted i
        INNER JOIN book.Books b ON i.BookId = b.Id
        WHERE i.Price < b.Price
    )
    BEGIN
        RAISERROR('–¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –º–µ–Ω—à–æ—é –±–∞–∑–æ–≤–æ—ó —Ü—ñ–Ω–∏', 16, 1);
        ROLLBACK TRANSACTION;
    END
END;
```

</details>

::

::

---

## –†–µ–∑—é–º–µ

::tip
**–ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏ DML-—Ç—Ä–∏–≥–µ—Ä—ñ–≤**:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è** ‚Äî —Å–ø—Ä–∞—Ü—å–æ–≤—É—é—Ç—å –±–µ–∑ —è–≤–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É
2. **INSERTED —Ç–∞ DELETED** ‚Äî –ª–æ–≥—ñ—á–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö
3. **AFTER** ‚Äî –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ (—Ç—ñ–ª—å–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ)
4. **INSTEAD OF** ‚Äî –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞–º—ñ—Å—Ç—å –∫–æ–º–∞–Ω–¥–∏ (—Ç–∞–±–ª–∏—Ü—ñ + –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è)
5. **–ö–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –ø–æ–¥—ñ–π** ‚Äî –º–æ–∂–Ω–∞ —Ä–µ–∞–≥—É–≤–∞—Ç–∏ –Ω–∞ INSERT, UPDATE, DELETE –æ–¥–Ω–æ—á–∞—Å–Ω–æ
6. **ROLLBACK** ‚Äî –≤—ñ–¥–º—ñ–Ω–∞ –∑–º—ñ–Ω –ø—Ä–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
7. **–ù–µ –¥–ª—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ç–∞–±–ª–∏—Ü—å** ‚Äî —Ç—Ä–∏–≥–µ—Ä–∏ –ù–ï –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –¥–ª—è `#temp`
8. **sys.triggers** ‚Äî –º–µ—Ç–∞–¥–∞–Ω—ñ –ø—Ä–æ —Ç—Ä–∏–≥–µ—Ä–∏

**Best Practices**:
- –¢—Ä–∏–º–∞–π—Ç–µ —Ç—Ä–∏–≥–µ—Ä–∏ –ø—Ä–æ—Å—Ç–∏–º–∏ —Ç–∞ —à–≤–∏–¥–∫–∏–º–∏
- –£–Ω–∏–∫–∞–π—Ç–µ —Å–∫–ª–∞–¥–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –≤ —Ç—Ä–∏–≥–µ—Ä–∞—Ö (–∑–Ω–∏–∂—É—é—Ç—å performance)
- –õ–æ–≥—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–µ
- –ü–∞–º'—è—Ç–∞–π—Ç–µ –ø—Ä–æ –º–∞—Å–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó (`inserted`/`deleted` –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –±–∞–≥–∞—Ç–æ —Ä—è–¥–∫—ñ–≤)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ constraints –∑–∞–º—ñ—Å—Ç—å —Ç—Ä–∏–≥–µ—Ä—ñ–≤ –¥–µ –º–æ–∂–ª–∏–≤–æ

**–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫**: –í–∏–≤—á—ñ—Ç—å [DDL-—Ç—Ä–∏–≥–µ—Ä–∏](02.ddl-triggers.md) –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –∑–º—ñ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ë–î.
::
