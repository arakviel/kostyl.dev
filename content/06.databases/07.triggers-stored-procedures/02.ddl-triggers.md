---
title: DDL-—Ç—Ä–∏–≥–µ—Ä–∏
description: –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–º—ñ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –ø–æ–¥—ñ—ó —Ä—ñ–≤–Ω—è —Å–µ—Ä–≤–µ—Ä–∞
---

# DDL-—Ç—Ä–∏–≥–µ—Ä–∏

## –ü—Ä–æ–±–ª–µ–º–∞: –Ø–∫ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –∑–º—ñ–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ë–î?

–£—è–≤—ñ—Ç—å, —â–æ –≤–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –≤–µ–ª–∏–∫–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó. –†–∞–ø—Ç–æ–º —Ö—Ç–æ—Å—å (–Ω–∞–≤—ñ—Ç—å –≤–∏–ø–∞–¥–∫–æ–≤–æ!) –≤–∏–¥–∞–ª—è—î –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤—É —Ç–∞–±–ª–∏—Ü—é –∞–±–æ –∑–º—ñ–Ω—é—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```sql
DROP TABLE Customers;  -- –£–ø—Å... üò±
```

–ê–±–æ –º–æ–ª–æ–¥—à–∏–π —Ä–æ–∑—Ä–æ–±–Ω–∏–∫ —Å—Ç–≤–æ—Ä—é—î —Ç–∞–±–ª–∏—Ü—ñ –±–µ–∑ –¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:

```sql
CREATE TABLE tbl_temp_data (...);  -- –ü–æ–≥–∞–Ω–∞ –Ω–∞–∑–≤–∞!
```

**–ü–∏—Ç–∞–Ω–Ω—è**: –Ø–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —Ç–∞–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó? –Ø–∫ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤ –∂—É—Ä–Ω–∞–ª –≤—Å—ñ –∑–º—ñ–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ë–î?

::mermaid

```mermaid
flowchart LR
    Dev[–†–æ–∑—Ä–æ–±–Ω–∏–∫] -->|CREATE/ALTER/DROP TABLE| DB[(–ë–∞–∑–∞ –î–∞–Ω–∏—Ö)]
    DB -->|1. –°–ø—Ä–∞—Ü—å–æ–≤—É—î DDL-—Ç—Ä–∏–≥–µ—Ä| DDLTrigger[DDL Trigger]
    DDLTrigger -->|2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î —É–º–æ–≤–∏| Check{–î–æ–∑–≤–æ–ª–µ–Ω–æ?}
    Check -->|–¢–∞–∫| Allow[–í–∏–∫–æ–Ω–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é]
    Check -->|–ù—ñ| Deny[ROLLBACK + –ü–æ–º–∏–ª–∫–∞]
    DDLTrigger -->|3. –ó–∞–ø–∏—Å–∞—Ç–∏ –≤ –∂—É—Ä–Ω–∞–ª| AuditLog[Audit Log]
    
    style DB fill:#3b82f6,color:#fff
    style DDLTrigger fill:#f59e0b,color:#fff
    style Deny fill:#ef4444,color:#fff
    style Allow fill:#10b981,color:#fff
```

::

**DDL-—Ç—Ä–∏–≥–µ—Ä** ‚Äî —Ü–µ —Ç—Ä–∏–≥–µ—Ä, —è–∫–∏–π —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ **DDL-–æ–ø–µ—Ä–∞—Ü—ñ–π** (Data Definition Language): CREATE, ALTER, DROP –¥–ª—è —Ç–∞–±–ª–∏—Ü—å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—å, —ñ–Ω–¥–µ–∫—Å—ñ–≤, –ø—Ä–æ—Ü–µ–¥—É—Ä —Ç–æ—â–æ.

::note
**DDL** (Data Definition Language) ‚Äî –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é –ë–î:
- `CREATE TABLE`, `ALTER TABLE`, `DROP TABLE`
- `CREATE INDEX`, `DROP INDEX`
- `CREATE PROCEDURE`, `ALTER PROCEDURE`
- `GRANT`, `DENY`, `REVOKE` (–ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É)

–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ **DML-—Ç—Ä–∏–≥–µ—Ä—ñ–≤** (—è–∫—ñ —Ä–µ–∞–≥—É—é—Ç—å –Ω–∞ –∑–º—ñ–Ω–∏ **–¥–∞–Ω–∏—Ö**: INSERT/UPDATE/DELETE), DDL-—Ç—Ä–∏–≥–µ—Ä–∏ —Ä–µ–∞–≥—É—é—Ç—å –Ω–∞ –∑–º—ñ–Ω–∏ **—Å—Ç—Ä—É–∫—Ç—É—Ä–∏**.
::

---

## –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ DDL-—Ç—Ä–∏–≥–µ—Ä–∏?

::card-group
::card{icon="i-lucide-shield" title="–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –∑–º—ñ–Ω"}
–ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∞–±–æ –∑–º—ñ–Ω—É –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ –ë–î.

**–ü—Ä–∏–∫–ª–∞–¥**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ `DROP TABLE` –∞–±–æ `ALTER TABLE` –¥–ª—è –∑–≤–∏—á–∞–π–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
::

::card{icon="i-lucide-file-search" title="–ê—É–¥–∏—Ç –∑–º—ñ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–∏"}
–õ–æ–≥—É–≤–∞—Ç–∏ –≤—Å—ñ DDL-–æ–ø–µ—Ä–∞—Ü—ñ—ó: —Ö—Ç–æ, –∫–æ–ª–∏, —â–æ –∑–º—ñ–Ω–∏–≤.

**–ü—Ä–∏–∫–ª–∞–¥**: –ó–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—é –∞—É–¥–∏—Ç—É –≤—Å—ñ CREATE/ALTER/DROP –∫–æ–º–∞–Ω–¥–∏.
::

::card{icon="i-lucide-check-circle" title="–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤"}
–ö–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è naming conventions —Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ —Ä–æ–∑—Ä–æ–±–∫–∏.

**–ü—Ä–∏–∫–ª–∞–¥**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å –±–µ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å—É —Å—Ö–µ–º–∏.
::

::card{icon="i-lucide-git-branch" title="–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å—ñ–π –ë–î"}
–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —Å–∏—Å—Ç–µ–º–∞–º–∏ –≤–µ—Ä—Å—ñ–π–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω —Å—Ö–µ–º–∏.

**–ü—Ä–∏–∫–ª–∞–¥**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç –∑–º—ñ–Ω–∏ —ñ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤ git.
::
::

---

## –û–±–ª–∞—Å—Ç—ñ –¥—ñ—ó DDL-—Ç—Ä–∏–≥–µ—Ä—ñ–≤

DDL-—Ç—Ä–∏–≥–µ—Ä–∏ –º–æ–∂—É—Ç—å –¥—ñ—è—Ç–∏ –Ω–∞ –¥–≤–æ—Ö —Ä—ñ–≤–Ω—è—Ö:

::tabs

::tabs-item{label="DATABASE (–†—ñ–≤–µ–Ω—å –ë–î)"}
–¢—Ä–∏–≥–µ—Ä —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ø—Ä–∏ DDL-–æ–ø–µ—Ä–∞—Ü—ñ—è—Ö –≤ **–ø–æ—Ç–æ—á–Ω—ñ–π –±–∞–∑—ñ –¥–∞–Ω–∏—Ö**.

```sql
CREATE TRIGGER trg_AuditDatabaseChanges
ON DATABASE  -- ‚Üê –†—ñ–≤–µ–Ω—å –ø–æ—Ç–æ—á–Ω–æ—ó –ë–î
FOR CREATE_TABLE, ALTER_TABLE, DROP_TABLE
AS
BEGIN
    PRINT '–ó–º—ñ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ë–î –≤–∏—è–≤–ª–µ–Ω–∞!';
END;
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∑–º—ñ–Ω —Ç–∞–±–ª–∏—Ü—å, –ø—Ä–æ—Ü–µ–¥—É—Ä, —Ñ—É–Ω–∫—Ü—ñ–π –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ–π –û–ó
- –ê—É–¥–∏—Ç —Ä–æ–∑—Ä–æ–±–Ω–∏—Ü—å–∫–∏—Ö –∑–º—ñ–Ω
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è naming conventions

**–î–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è**: –í –ø–∞–ø—Ü—ñ **Programmability ‚Üí Database Triggers** –≤ SSMS.

::

::tabs-item{label="ALL SERVER (–†—ñ–≤–µ–Ω—å —Å–µ—Ä–≤–µ—Ä–∞)"}
–¢—Ä–∏–≥–µ—Ä —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ø—Ä–∏ DDL-–æ–ø–µ—Ä–∞—Ü—ñ—è—Ö –Ω–∞ **–≤—Å—å–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ** (–≤—Å—ñ –ë–î).

```sql
CREATE TRIGGER trg_PreventDatabaseDrop
ON ALL SERVER  -- ‚Üê –†—ñ–≤–µ–Ω—å –≤—Å—å–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
FOR DROP_DATABASE
AS
BEGIN
    PRINT '–í–∏–¥–∞–ª–µ–Ω–Ω—è –ë–î –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ!';
    ROLLBACK;
END;
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**:
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –±–∞–∑ –¥–∞–Ω–∏—Ö
- –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/–∑–º—ñ–Ω–∏ –ª–æ–≥—ñ–Ω—ñ–≤
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–º—ñ–Ω –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å–µ—Ä–≤–µ—Ä–∞

**–î–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è**: –í –ø–∞–ø—Ü—ñ **Server Objects ‚Üí Triggers** –≤ SSMS.

**–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Ç–∏–ø**: **LOGON —Ç—Ä–∏–≥–µ—Ä–∏** ‚Äî —Å–ø—Ä–∞—Ü—å–æ–≤—É—é—Ç—å –ø—Ä–∏ –≤—Ö–æ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

::

::

::plant-uml

```plantuml
@startuml
skinparam style plain
skinparam defaultFontName "Segoe UI"

package "SQL Server Instance" {
    
    database "Database 1" as DB1 {
        rectangle "DDL Trigger\n(DATABASE scope)" as DDL_DB1 #LightGreen
    }
    
    database "Database 2" as DB2 {
        rectangle "DDL Trigger\n(DATABASE scope)" as DDL_DB2 #LightGreen
    }
    
    rectangle "DDL Trigger\n(ALL SERVER scope)" as DDL_SERVER #LightCoral
    rectangle "LOGON Trigger\n(ALL SERVER)" as DDL_LOGON #LightBlue
}

note right of DDL_SERVER
  –°–ø—Ä–∞—Ü—å–æ–≤—É—î –Ω–∞ –±—É–¥—å-—è–∫—É DDL-–æ–ø–µ—Ä–∞—Ü—ñ—é
  –≤ –±—É–¥—å-—è–∫—ñ–π –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
end note

note right of DDL_LOGON
  –°–ø—Ä–∞—Ü—å–æ–≤—É—î –ø—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ
  –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞
end note

@enduml
```

::

---

## –ë–∞–∑–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å CREATE TRIGGER

### –î–ª—è —Ä—ñ–≤–Ω—è DATABASE

```sql
CREATE TRIGGER trigger_name
ON DATABASE  -- –û–±–ª–∞—Å—Ç—å –¥—ñ—ó: –ø–æ—Ç–æ—á–Ω–∞ –ë–î
[WITH ENCRYPTION]
{FOR | AFTER} {event_name | event_group} [, ...n]
AS
BEGIN
    -- –¢—ñ–ª–æ —Ç—Ä–∏–≥–µ—Ä–∞
END;
```

### –î–ª—è —Ä—ñ–≤–Ω—è ALL SERVER

```sql
CREATE TRIGGER trigger_name
ON ALL SERVER  -- –û–±–ª–∞—Å—Ç—å –¥—ñ—ó: –≤–µ—Å—å —Å–µ—Ä–≤–µ—Ä
[WITH ENCRYPTION]
{FOR | AFTER} {event_name | event_group} [, ...n]
AS
BEGIN
    -- –¢—ñ–ª–æ —Ç—Ä–∏–≥–µ—Ä–∞
END;
```

### –î–ª—è LOGON (–≤—Ö—ñ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä)

```sql
CREATE TRIGGER trigger_name
ON ALL SERVER
[WITH ENCRYPTION]
FOR LOGON  -- –ü–æ–¥—ñ—è –≤—Ö–æ–¥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
AS
BEGIN
    -- –¢—ñ–ª–æ —Ç—Ä–∏–≥–µ—Ä–∞
END;
```

**–ê–Ω–∞—Ç–æ–º—ñ—è**:
- `ON DATABASE | ALL SERVER` ‚Äî –æ–±–ª–∞—Å—Ç—å –¥—ñ—ó
- `FOR | AFTER` ‚Äî —Ä–µ–∂–∏–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ AFTER –¥–ª—è DDL, –Ω–µ–º–∞—î INSTEAD OF!)
- `event_name` ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –ø–æ–¥—ñ—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `CREATE_TABLE`, `DROP_TABLE`
- `event_group` ‚Äî –≥—Ä—É–ø–∞ –ø–æ–¥—ñ–π, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `DDL_TABLE_EVENTS` (–≤—Å—ñ –ø–æ–¥—ñ—ó —Ç–∞–±–ª–∏—Ü—å)

---

## –ü–æ–¥—ñ—ó —Ç–∞ –≥—Ä—É–ø–∏ –ø–æ–¥—ñ–π

### –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–¥—ñ—ó

| –ü–æ–¥—ñ—è               | –û–ø–∏—Å                      | –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–º–∞–Ω–¥–∏          |
| :------------------ | :------------------------ | :----------------------- |
| `CREATE_TABLE`      | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ         | `CREATE TABLE ...`       |
| `ALTER_TABLE`       | –ó–º—ñ–Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ             | `ALTER TABLE ...`        |
| `DROP_TABLE`        | –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ         | `DROP TABLE ...`         |
| `CREATE_INDEX`      | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—É         | `CREATE INDEX ...`       |
| `DROP_INDEX`        | –í–∏–¥–∞–ª–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—É         | `DROP INDEX ...`         |
| `CREATE_PROCEDURE`  | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏       | `CREATE PROCEDURE ...`   |
| `ALTER_PROCEDURE`   | –ó–º—ñ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏           | `ALTER PROCEDURE ...`    |
| `DROP_PROCEDURE`    | –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏       | `DROP PROCEDURE ...`     |
| `CREATE_DATABASE`   | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ë–î (SERVER!)    | `CREATE DATABASE ...`    |
| `DROP_DATABASE`     | –í–∏–¥–∞–ª–µ–Ω–Ω—è –ë–î (SERVER!)    | `DROP DATABASE ...`      |
| `GRANT_DATABASE`    | –ù–∞–¥–∞–Ω–Ω—è –ø—Ä–∞–≤ (–ë–î)         | `GRANT SELECT ...`       |
| `DENY_DATABASE`     | –ó–∞–±–æ—Ä–æ–Ω–∞ –ø—Ä–∞–≤ (–ë–î)        | `DENY DELETE ...`        |

### –ì—Ä—É–ø–∏ –ø–æ–¥—ñ–π

–ì—Ä—É–ø–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å —Ä–µ–∞–≥—É–≤–∞—Ç–∏ –Ω–∞ –∫—ñ–ª—å–∫–∞ —Å—Ö–æ–∂–∏—Ö –ø–æ–¥—ñ–π –æ–¥–Ω–æ—á–∞—Å–Ω–æ:

| –ì—Ä—É–ø–∞ –ø–æ–¥—ñ–π              | –í–∫–ª—é—á–∞—î –ø–æ–¥—ñ—ó                                |
| :----------------------- | :------------------------------------------- |
| `DDL_TABLE_EVENTS`       | CREATE/ALTER/DROP TABLE                      |
| `DDL_VIEW_EVENTS`        | CREATE/ALTER/DROP VIEW                       |
| `DDL_INDEX_EVENTS`       | CREATE/ALTER/DROP INDEX                      |
| `DDL_PROCEDURE_EVENTS`   | CREATE/ALTER/DROP PROCEDURE                  |
| `DDL_FUNCTION_EVENTS`    | CREATE/ALTER/DROP FUNCTION                   |
| `DDL_DATABASE_LEVEL_EVENTS` | **–í—Å—ñ** DDL-–ø–æ–¥—ñ—ó —Ä—ñ–≤–Ω—è –ë–î                |
| `DDL_SERVER_LEVEL_EVENTS`   | **–í—Å—ñ** DDL-–ø–æ–¥—ñ—ó —Ä—ñ–≤–Ω—è —Å–µ—Ä–≤–µ—Ä–∞           |

::tip
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –≥—Ä—É–ø–∏ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏ –∫–æ–¥—É.

–ó–∞–º—ñ—Å—Ç—å:
```sql
FOR CREATE_TABLE, ALTER_TABLE, DROP_TABLE
```

–ü–∏—à—ñ—Ç—å:
```sql
FOR DDL_TABLE_EVENTS
```
::

---

## –§—É–Ω–∫—Ü—ñ—è EVENTDATA(): –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø–æ–¥—ñ—é

DDL-—Ç—Ä–∏–≥–µ—Ä–∏ –Ω–µ –º–∞—é—Ç—å —Ç–∞–±–ª–∏—Ü—å `INSERTED`/`DELETED`. –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—è **EVENTDATA()**, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î **XML** –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –ø–æ–¥—ñ—é.

```sql
CREATE TRIGGER trg_LogDDLChanges
ON DATABASE
FOR DDL_DATABASE_LEVEL_EVENTS
AS
BEGIN
    DECLARE @eventData XML = EVENTDATA();
    
    SELECT 
        @eventData.value('(/EVENT_INSTANCE/EventType)[1]', 'NVARCHAR(100)') AS EventType,
        @eventData.value('(/EVENT_INSTANCE/ObjectName)[1]', 'NVARCHAR(256)') AS ObjectName,
        @eventData.value('(/EVENT_INSTANCE/LoginName)[1]', 'NVARCHAR(256)') AS LoginName,
        @eventData.value('(/EVENT_INSTANCE/TSQLCommand/CommandText)[1]', 'NVARCHAR(MAX)') AS CommandText;
END;
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ XML –≤—ñ–¥ EVENTDATA()**:

```xml
<EVENT_INSTANCE>
  <EventType>CREATE_TABLE</EventType>
  <PostTime>2026-02-13T14:30:00.123</PostTime>
  <SPID>52</SPID>
  <ServerName>SQL-SERVER-01</ServerName>
  <LoginName>sa</LoginName>
  <UserName>dbo</UserName>
  <DatabaseName>BookStore</DatabaseName>
  <SchemaName>dbo</SchemaName>
  <ObjectName>NewTable</ObjectName>
  <ObjectType>TABLE</ObjectType>
  <TSQLCommand>
    <SetOptions .../>
    <CommandText>CREATE TABLE NewTable (Id INT);</CommandText>
  </TSQLCommand>
</EVENT_INSTANCE>
```

**–ö–æ—Ä–∏—Å–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ XML**:
- `EventType` ‚Äî —Ç–∏–ø –ø–æ–¥—ñ—ó (CREATE_TABLE, DROP_PROCEDURE —Ç–æ—â–æ)
- `ObjectName` ‚Äî –Ω–∞–∑–≤–∞ –æ–±'—î–∫—Ç–∞
- `LoginName` ‚Äî –ª–æ–≥—ñ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π –≤–∏–∫–æ–Ω–∞–≤ –∫–æ–º–∞–Ω–¥—É
- `CommandText` ‚Äî –ø–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç SQL-–∫–æ–º–∞–Ω–¥–∏
- `PostTime` ‚Äî —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

### –ü—Ä–∏–∫–ª–∞–¥ 1: –ó–∞–±–æ—Ä–æ–Ω–∞ –∑–º—ñ–Ω–∏ —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å

**–ó–∞–¥–∞—á–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤—Å—ñ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º (–∫—Ä—ñ–º –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞) –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∞–±–æ –≤–∏–¥–∞–ª—è—Ç–∏ —Ç–∞–±–ª–∏—Ü—ñ.

```sql
CREATE TRIGGER trg_PreventTableModification
ON DATABASE
FOR ALTER_TABLE, DROP_TABLE
AS
BEGIN
    DECLARE @eventData XML = EVENTDATA();
    DECLARE @loginName NVARCHAR(256);
    DECLARE @objectName NVARCHAR(256);
    DECLARE @eventType NVARCHAR(100);
    
    -- –í–∏—Ç—è–≥—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ XML
    SELECT 
        @loginName = @eventData.value('(/EVENT_INSTANCE/LoginName)[1]', 'NVARCHAR(256)'),
        @objectName = @eventData.value('(/EVENT_INSTANCE/ObjectName)[1]', 'NVARCHAR(256)'),
        @eventType = @eventData.value('(/EVENT_INSTANCE/EventType)[1]', 'NVARCHAR(100)');
    
    -- –î–æ–∑–≤–æ–ª—è—î–º–æ —Ç—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É
    IF @loginName != 'sa' AND @loginName != 'BUILTIN\Administrators'
    BEGIN
        DECLARE @errorMsg NVARCHAR(500) = 
            '–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å –∑–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.' +
            CHAR(13) + '–°–ø—Ä–æ–±–∞: ' + @eventType + ' –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ ' + @objectName;
        
        RAISERROR(@errorMsg, 16, 1);
        ROLLBACK;
    END
    ELSE
    BEGIN
        PRINT '–û–ø–µ—Ä–∞—Ü—ñ—è –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞';
    END
END;
GO

-- –¢–µ—Å—Ç—É—î–º–æ (—è–∫—â–æ –≤–∏ –Ω–µ sa):
ALTER TABLE book.Books ADD TestColumn INT;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å –∑–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ..."
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ª–æ–≥—ñ–Ω —á–µ—Ä–µ–∑ `EVENTDATA()`
- –Ø–∫—â–æ –Ω–µ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä ‚Äî –≤–∏–∫–∏–¥–∞—î–º–æ –ø–æ–º–∏–ª–∫—É —ñ –≤—ñ–¥–º—ñ–Ω—è—î–º–æ –æ–ø–µ—Ä–∞—Ü—ñ—é
- `ROLLBACK` –≤—ñ–¥–º—ñ–Ω—è—î DDL-–∫–æ–º–∞–Ω–¥—É

---

### –ü—Ä–∏–∫–ª–∞–¥ 2: –ê—É–¥–∏—Ç –≤—Å—ñ—Ö DDL-–∑–º—ñ–Ω

**–ó–∞–¥–∞—á–∞**: –ó–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ë–î –≤ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—É —Ç–∞–±–ª–∏—Ü—é –∞—É–¥–∏—Ç—É.

```sql
-- –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é –∞—É–¥–∏—Ç—É
CREATE TABLE dbo.DDLAuditLog (
    Id INT IDENTITY PRIMARY KEY,
    EventType NVARCHAR(100),
    ObjectName NVARCHAR(256),
    LoginName NVARCHAR(256),
    CommandText NVARCHAR(MAX),
    EventDate DATETIME DEFAULT GETDATE()
);
GO

-- –°—Ç–≤–æ—Ä—é—î–º–æ —Ç—Ä–∏–≥–µ—Ä –¥–ª—è –∞—É–¥–∏—Ç—É
CREATE TRIGGER trg_AuditDDLChanges
ON DATABASE
FOR DDL_DATABASE_LEVEL_EVENTS  -- –í—Å—ñ DDL-–ø–æ–¥—ñ—ó –≤ –ë–î
AS
BEGIN
    SET NOCOUNT ON;
    
    DECLARE @eventData XML = EVENTDATA();
    
    INSERT INTO dbo.DDLAuditLog (EventType, ObjectName, LoginName, CommandText)
    SELECT
        @eventData.value('(/EVENT_INSTANCE/EventType)[1]', 'NVARCHAR(100)'),
        @eventData.value('(/EVENT_INSTANCE/ObjectName)[1]', 'NVARCHAR(256)'),
        @eventData.value('(/EVENT_INSTANCE/LoginName)[1]', 'NVARCHAR(256)'),
        @eventData.value('(/EVENT_INSTANCE/TSQLCommand/CommandText)[1]', 'NVARCHAR(MAX)');
END;
GO

-- –¢–µ—Å—Ç—É—î–º–æ:
CREATE TABLE dbo.TestTable (Id INT);
DROP TABLE dbo.TestTable;

-- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∂—É—Ä–Ω–∞–ª:
SELECT * FROM dbo.DDLAuditLog ORDER BY EventDate DESC;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ DDLAuditLog**:

| EventType     | ObjectName | LoginName | CommandText                        | EventDate            |
| :------------ | :--------- | :-------- | :--------------------------------- | :------------------- |
| DROP_TABLE    | TestTable  | sa        | DROP TABLE dbo.TestTable;          | 2026-02-13 14:35:12  |
| CREATE_TABLE  | TestTable  | sa        | CREATE TABLE dbo.TestTable (...);  | 2026-02-13 14:35:10  |

---

### –ü—Ä–∏–∫–ª–∞–¥ 3: –ö–æ–Ω—Ç—Ä–æ–ª—å naming conventions

**–ó–∞–¥–∞—á–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å –∑ –Ω–∞–∑–≤–∞–º–∏, —è–∫—ñ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ `tbl_` –∞–±–æ `temp_`.

```sql
CREATE TRIGGER trg_EnforceNamingConventions
ON DATABASE
FOR CREATE_TABLE
AS
BEGIN
    DECLARE @eventData XML = EVENTDATA();
    DECLARE @tableName NVARCHAR(256);
    
    SELECT @tableName = @eventData.value('(/EVENT_INSTANCE/ObjectName)[1]', 'NVARCHAR(256)');
    
    -- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ naming convention
    IF @tableName LIKE 'tbl[_]%' OR @tableName LIKE 'temp[_]%'
    BEGIN
        RAISERROR('–ù–∞–∑–≤–∏ —Ç–∞–±–ª–∏—Ü—å –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ—á–∏–Ω–∞—Ç–∏—Å—è –∑ "tbl_" –∞–±–æ "temp_". –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ—Å–º–∏—Å–ª–µ–Ω—ñ –Ω–∞–∑–≤–∏!', 16, 1);
        ROLLBACK;
    END
END;
GO

-- –¢–µ—Å—Ç—É—î–º–æ:
CREATE TABLE tbl_BadName (Id INT);
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ù–∞–∑–≤–∏ —Ç–∞–±–ª–∏—Ü—å –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ—á–∏–Ω–∞—Ç–∏—Å—è –∑ "tbl_"..."

CREATE TABLE Customers (Id INT);  -- ‚úÖ –î–æ–∑–≤–æ–ª–µ–Ω–æ
```

---

### –ü—Ä–∏–∫–ª–∞–¥ 4: –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ë–î (—Ä—ñ–≤–µ–Ω—å —Å–µ—Ä–≤–µ—Ä–∞)

**–ó–∞–¥–∞—á–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.

```sql
USE master;
GO

CREATE TRIGGER trg_PreventDatabaseDrop
ON ALL SERVER  -- –†—ñ–≤–µ–Ω—å —Å–µ—Ä–≤–µ—Ä–∞!
FOR DROP_DATABASE
AS
BEGIN
    DECLARE @eventData XML = EVENTDATA();
    DECLARE @dbName NVARCHAR(256);
    
    SELECT @dbName = @eventData.value('(/EVENT_INSTANCE/DatabaseName)[1]', 'NVARCHAR(256)');
    
    RAISERROR('–í–∏–¥–∞–ª–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö "%s" –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ –Ω–∞ —Ü—å–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ!', 16, 1, @dbName);
    ROLLBACK;
END;
GO

-- –¢–µ—Å—Ç—É—î–º–æ:
DROP DATABASE TestDB;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: "–í–∏–¥–∞–ª–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö "TestDB" –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ..."
```

::note
**–í–∞–∂–ª–∏–≤–æ**: DDL-—Ç—Ä–∏–≥–µ—Ä–∏ —Ä—ñ–≤–Ω—è —Å–µ—Ä–≤–µ—Ä–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –±–∞–∑—ñ `master` —ñ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –≤ **Server Objects ‚Üí Triggers** –≤ SSMS.
::

---

### –ü—Ä–∏–∫–ª–∞–¥ 5: LOGON —Ç—Ä–∏–≥–µ—Ä ‚Äî –æ–±–º–µ–∂–µ–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω—å

**–ó–∞–¥–∞—á–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É `guest_user` –≤ –Ω–µ—Ä–æ–±–æ—á–∏–π —á–∞—Å (18:00-08:00).

```sql
USE master;
GO

CREATE TRIGGER trg_RestrictLoginTime
ON ALL SERVER
FOR LOGON
AS
BEGIN
    DECLARE @loginName NVARCHAR(256) = ORIGINAL_LOGIN();
    DECLARE @currentHour INT = DATEPART(HOUR, GETDATE());
    
    -- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∞—Å —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    IF @loginName = 'guest_user' AND (@currentHour >= 18 OR @currentHour < 8)
    BEGIN
        RAISERROR('–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ "guest_user" –¥–æ–∑–≤–æ–ª–µ–Ω–æ —Ç—ñ–ª—å–∫–∏ –∑ 08:00 –¥–æ 18:00', 16, 1);
        ROLLBACK;
    END
END;
GO
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- `ORIGINAL_LOGIN()` ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î –ª–æ–≥—ñ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è
- `DATEPART(HOUR, GETDATE())` ‚Äî –ø–æ—Ç–æ—á–Ω–∞ –≥–æ–¥–∏–Ω–∞ (0-23)
- –Ø–∫—â–æ —É–º–æ–≤–∞ –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è ‚Äî –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ

::warning
**–û–±–µ—Ä–µ–∂–Ω–æ –∑ LOGON —Ç—Ä–∏–≥–µ—Ä–∞–º–∏!**

–Ø–∫—â–æ —Ç—Ä–∏–≥–µ—Ä –º—ñ—Å—Ç–∏—Ç—å –ø–æ–º–∏–ª–∫—É —ñ –∑–∞–±–æ—Ä–æ **–í–°–Ü** –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (–≤–∫–ª—é—á–Ω–æ –∑ –∞–¥–º—ñ–Ω–∞–º–∏), –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ —Å–µ–±–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ!

**–ü–æ—Ä—è—Ç—É–Ω–æ–∫**: –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è —á–µ—Ä–µ–∑ **Dedicated Administrator Connection (DAC)**:
```
sqlcmd -S .\SQLSERVER -A -U sa -P password
DROP TRIGGER trg_RestrictLoginTime ON ALL SERVER;
```
::

---

## –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è DDL-—Ç—Ä–∏–≥–µ—Ä–∞–º–∏

### –ó–º—ñ–Ω–∞ —Ç—Ä–∏–≥–µ—Ä–∞

```sql
-- –î–ª—è —Ä—ñ–≤–Ω—è DATABASE
ALTER TRIGGER trg_AuditDDLChanges
ON DATABASE
FOR DDL_DATABASE_LEVEL_EVENTS
AS
BEGIN
    -- –ù–æ–≤–∏–π –∫–æ–¥
END;

-- –î–ª—è —Ä—ñ–≤–Ω—è ALL SERVER
ALTER TRIGGER trg_PreventDatabaseDrop
ON ALL SERVER
FOR DROP_DATABASE
AS
BEGIN
    -- –ù–æ–≤–∏–π –∫–æ–¥
END;
```

### –í—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞

```sql
-- –î–ª—è —Ä—ñ–≤–Ω—è DATABASE
DISABLE TRIGGER trg_AuditDDLChanges ON DATABASE;

-- –î–ª—è —Ä—ñ–≤–Ω—è ALL SERVER
DISABLE TRIGGER trg_PreventDatabaseDrop ON ALL SERVER;

-- –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –í–°–Ü DDL-—Ç—Ä–∏–≥–µ—Ä–∏ –ë–î
DISABLE TRIGGER ALL ON DATABASE;
```

### –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞

```sql
ENABLE TRIGGER trg_AuditDDLChanges ON DATABASE;
ENABLE TRIGGER trg_PreventDatabaseDrop ON ALL SERVER;
```

### –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç—Ä–∏–≥–µ—Ä–∞

```sql
-- –î–ª—è —Ä—ñ–≤–Ω—è DATABASE
DROP TRIGGER trg_AuditDDLChanges ON DATABASE;

-- –î–ª—è —Ä—ñ–≤–Ω—è ALL SERVER
DROP TRIGGER trg_PreventDatabaseDrop ON ALL SERVER;
```

---

## –ú–µ—Ç–∞–¥–∞–Ω—ñ DDL-—Ç—Ä–∏–≥–µ—Ä—ñ–≤

```sql
-- –¢—Ä–∏–≥–µ—Ä–∏ —Ä—ñ–≤–Ω—è DATABASE
SELECT 
    name AS TriggerName,
    create_date AS CreatedDate,
    modify_date AS ModifiedDate,
    is_disabled AS IsDisabled
FROM sys.triggers
WHERE parent_class_desc = 'DATABASE';

-- –¢—Ä–∏–≥–µ—Ä–∏ —Ä—ñ–≤–Ω—è SERVER
SELECT 
    name AS TriggerName,
    create_date AS CreatedDate,
    modify_date AS ModifiedDate,
    is_disabled AS IsDisabled
FROM sys.server_triggers;

-- –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–¥ —Ç—Ä–∏–≥–µ—Ä–∞ —Ä—ñ–≤–Ω—è DATABASE
SELECT m.definition
FROM sys.sql_modules m
INNER JOIN sys.triggers t ON m.object_id = t.object_id
WHERE t.name = 'trg_AuditDDLChanges'
  AND t.parent_class_desc = 'DATABASE';

-- –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–¥ —Ç—Ä–∏–≥–µ—Ä–∞ —Ä—ñ–≤–Ω—è SERVER
SELECT m.definition
FROM sys.server_sql_modules m
INNER JOIN sys.server_triggers t ON m.object_id = t.object_id
WHERE t.name = 'trg_PreventDatabaseDrop';
```

---

## –†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ DML —Ç–∞ DDL —Ç—Ä–∏–≥–µ—Ä–∞–º–∏

::tabs

::tabs-item{label="–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è"}

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞       | DML-—Ç—Ä–∏–≥–µ—Ä–∏                    | DDL-—Ç—Ä–∏–≥–µ—Ä–∏                        |
| :------------------- | :----------------------------- | :--------------------------------- |
| **–ü–æ–¥—ñ—ó**            | INSERT, UPDATE, DELETE         | CREATE, ALTER, DROP, GRANT —Ç–æ—â–æ    |
| **–û–±'—î–∫—Ç**           | –î–∞–Ω—ñ –≤ —Ç–∞–±–ª–∏—Ü—è—Ö                | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î (—Ç–∞–±–ª–∏—Ü—ñ, —ñ–Ω–¥–µ–∫—Å–∏...) |
| **–û–±–ª–∞—Å—Ç—ñ –¥—ñ—ó**      | –¢—ñ–ª—å–∫–∏ —Ç–∞–±–ª–∏—Ü—è/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è   | DATABASE –∞–±–æ ALL SERVER            |
| **INSTEAD OF**       | ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è               | ‚ùå –ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è                |
| **INSERTED/DELETED** | ‚úÖ –¢–∞–±–ª–∏—Ü—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ            | ‚ùå –ù–µ–º–∞—î (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è EVENTDATA) |
| **EVENTDATA()**      | ‚ùå –ù–µ–º–∞—î                       | ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î XML –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é      |
| **Use Case**         | –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö, –∞—É–¥–∏—Ç DML     | –ó–∞—Ö–∏—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏, –∞—É–¥–∏—Ç DDL        |

::

::tabs-item{label="–ü—Ä–∏–∫–ª–∞–¥–∏"}

**DML-—Ç—Ä–∏–≥–µ—Ä**:
```sql
CREATE TRIGGER trg_Sales_AfterInsert
ON Sales
AFTER INSERT  -- –ü–æ–¥—ñ—è: INSERT –¥–∞–Ω–∏—Ö
AS
BEGIN
    -- –î–æ—Å—Ç—É–ø –¥–æ inserted/deleted
    UPDATE Books SET Stock = Stock - i.Quantity
    FROM inserted i;
END;
```

**DDL-—Ç—Ä–∏–≥–µ—Ä**:
```sql
CREATE TRIGGER trg_PreventTableDrop
ON DATABASE
FOR DROP_TABLE  -- –ü–æ–¥—ñ—è: DROP —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
AS
BEGIN
    -- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ EVENTDATA()
    DECLARE @data XML = EVENTDATA();
    ROLLBACK;
END;
```

::

::

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

::accordion

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 1: –õ–æ–≥—É–≤–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä" icon="i-lucide-file-plus"}

**–£–º–æ–≤–∞**: –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç—Ä–∏–≥–µ—Ä, —è–∫–∏–π –∑–∞–ø–∏—Å—É—î –≤ —Ç–∞–±–ª–∏—Ü—é –∞—É–¥–∏—Ç—É –≤—Å—ñ —Å—Ç–≤–æ—Ä–µ–Ω—ñ/–∑–º—ñ–Ω–µ–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—î–º—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
-- –¢–∞–±–ª–∏—Ü—è –∞—É–¥–∏—Ç—É
CREATE TABLE dbo.ProcedureAuditLog (
    Id INT IDENTITY PRIMARY KEY,
    EventType NVARCHAR(100),
    ProcedureName NVARCHAR(256),
    LoginName NVARCHAR(256),
    EventDate DATETIME DEFAULT GETDATE()
);
GO

-- –¢—Ä–∏–≥–µ—Ä
CREATE TRIGGER trg_AuditProcedures
ON DATABASE
FOR DDL_PROCEDURE_EVENTS  -- CREATE/ALTER/DROP PROCEDURE
AS
BEGIN
    DECLARE @data XML = EVENTDATA();
    
    INSERT INTO dbo.ProcedureAuditLog (EventType, ProcedureName, LoginName)
    SELECT
        @data.value('(/EVENT_INSTANCE/EventType)[1]', 'NVARCHAR(100)'),
        @data.value('(/EVENT_INSTANCE/ObjectName)[1]', 'NVARCHAR(256)'),
        @data.value('(/EVENT_INSTANCE/LoginName)[1]', 'NVARCHAR(256)');
END;
```

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 2: –ó–∞—Ö–∏—Å—Ç —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å" icon="i-lucide-shield-alert"}

**–£–º–æ–≤–∞**: –ó–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å –∑—ñ —Å—Ö–µ–º–∏ `sys` (—Å–∏—Å—Ç–µ–º–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ).

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
CREATE TRIGGER trg_ProtectSystemTables
ON DATABASE
FOR DROP_TABLE
AS
BEGIN
    DECLARE @data XML = EVENTDATA();
    DECLARE @schemaName NVARCHAR(256);
    
    SELECT @schemaName = @data.value('(/EVENT_INSTANCE/SchemaName)[1]', 'NVARCHAR(256)');
    
    IF @schemaName = 'sys'
    BEGIN
        RAISERROR('–í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—å –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ!', 16, 1);
        ROLLBACK;
    END
END;
```

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 3: –ö–æ–Ω—Ç—Ä–æ–ª—å –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω—å" icon="i-lucide-users"}

**–£–º–æ–≤–∞**: –û–±–º–µ–∂–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –ø—ñ–¥–∫–ª—é—á–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ `test_user` –¥–æ 3.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
CREATE TRIGGER trg_LimitUserConnections
ON ALL SERVER
FOR LOGON
AS
BEGIN
    DECLARE @loginName NVARCHAR(256) = ORIGINAL_LOGIN();
    DECLARE @connectionCount INT;
    
    IF @loginName = 'test_user'
    BEGIN
        -- –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è
        SELECT @connectionCount = COUNT(*)
        FROM sys.dm_exec_sessions
        WHERE login_name = @loginName;
        
        IF @connectionCount > 3
        BEGIN
            RAISERROR('–ü–µ—Ä–µ–≤–∏—â–µ–Ω–æ –ª—ñ–º—ñ—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω—å (–º–∞–∫—Å–∏–º—É–º 3)', 16, 1);
            ROLLBACK;
        END
    END
END;
```

</details>

::

::

---

## –†–µ–∑—é–º–µ

::tip
**–ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏ DDL-—Ç—Ä–∏–≥–µ—Ä—ñ–≤**:

1. **–û–±–ª–∞—Å—Ç—ñ –¥—ñ—ó**: DATABASE (–ø–æ—Ç–æ—á–Ω–∞ –ë–î) –∞–±–æ ALL SERVER (–≤–µ—Å—å —Å–µ—Ä–≤–µ—Ä)
2. **–ü–æ–¥—ñ—ó**: CREATE, ALTER, DROP –¥–ª—è —Ç–∞–±–ª–∏—Ü—å, –ø—Ä–æ—Ü–µ–¥—É—Ä, –ë–î —Ç–æ—â–æ
3. **–ì—Ä—É–ø–∏ –ø–æ–¥—ñ–π**: `DDL_TABLE_EVENTS`, `DDL_DATABASE_LEVEL_EVENTS` —Ç–æ—â–æ
4. **EVENTDATA()**: XML –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –ø–æ–¥—ñ—é (–∑–∞–º—ñ—Å—Ç—å INSERTED/DELETED)
5. **–¢—ñ–ª—å–∫–∏ AFTER**: INSTEAD OF –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –¥–ª—è DDL
6. **LOGON —Ç—Ä–∏–≥–µ—Ä–∏**: –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Ç–∏–ø –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –≤—Ö–æ–¥—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
7. **–ó–∞—Ö–∏—Å—Ç**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –∑–º—ñ–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
8. **–ê—É–¥–∏—Ç**: –õ–æ–≥—É–π—Ç–µ –≤—Å—ñ DDL-–æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è –±–µ–∑–ø–µ–∫–∏ —Ç–∞ compliance

**Best Practices**:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ë–î production
- –õ–æ–≥—É–π—Ç–µ DDL-–∑–º—ñ–Ω–∏ —á–µ—Ä–µ–∑ EVENTDATA()
- –û–±–µ—Ä–µ–∂–Ω–æ –∑ LOGON —Ç—Ä–∏–≥–µ—Ä–∞–º–∏ (–º–æ–∂–Ω–∞ –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ —Å–µ—Ä–≤–µ—Ä!)
- –¢–µ—Å—Ç—É–π—Ç–µ –≤ dev —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –ø–µ—Ä–µ–¥ production
- –î–æ–∫—É–º–µ–Ω—Ç—É–π—Ç–µ –≤—Å—ñ DDL-—Ç—Ä–∏–≥–µ—Ä–∏

**–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫**: –í–∏–≤—á—ñ—Ç—å [Transact-SQL —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è](03.transact-sql-extensions.md) –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω—ñ—à–æ—ó –ª–æ–≥—ñ–∫–∏ –≤ —Ç—Ä–∏–≥–µ—Ä–∞—Ö.
::
