---
title: –ó–±–µ—Ä—ñ–≥–∞—î–º—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏
description: –Ü–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
---

# –ó–±–µ—Ä—ñ–≥–∞—î–º—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏

## –ü—Ä–æ–±–ª–µ–º–∞: –Ø–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ SQL-–∫–æ–¥?

–£—è–≤—ñ—Ç—å, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –æ–¥–Ω—É —ñ —Ç—É –∂ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å SQL-–∫–æ–º–∞–Ω–¥ —É —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö –¥–æ–¥–∞—Ç–∫—É:

```sql
-- –í 10+ –º—ñ—Å—Ü—è—Ö –∫–æ–¥—É —Ç—Ä–µ–±–∞ –ø–∏—Å–∞—Ç–∏:
SELECT a.FirstName + ' ' + a.LastName AS AuthorName,
       COUNT(b.Id) AS BookCount
FROM book.Authors a
LEFT JOIN book.Books b ON a.Id = b.AuthorId
GROUP BY a.FirstName, a.LastName
HAVING COUNT(b.Id) > 5
ORDER BY BookCount DESC;
```

**–ü—Ä–æ–±–ª–µ–º–∏**:
- –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∫–æ–¥—É ‚Üí –≤–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏
- –ó–º—ñ–Ω–∞ –ª–æ–≥—ñ–∫–∏ ‚Üí —Ç—Ä–µ–±–∞ –º—ñ–Ω—è—Ç–∏ –≤ 10+ –º—ñ—Å—Ü—è—Ö
- –ü–æ–º–∏–ª–∫–∏ ‚Üí —Ä–æ–∑–º–Ω–æ–∂—É—é—Ç—å—Å—è —Å–∫—Ä—ñ–∑—å
- –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å ‚Üí –≤–∞–∂–∫–æ —á–∏—Ç–∞—Ç–∏

**–†–æ–∑–≤'—è–∑–æ–∫**: –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º—É –ø—Ä–æ—Ü–µ–¥—É—Ä—É!

```sql
-- –°—Ç–≤–æ—Ä—é—î–º–æ –û–î–ò–ù –†–ê–ó
CREATE PROCEDURE GetActiveAuthors
AS
BEGIN
    SELECT a.FirstName + ' ' + a.LastName AS AuthorName,
           COUNT(b.Id) AS BookCount
    FROM book.Authors a
    LEFT JOIN book.Books b ON a.Id = b.AuthorId
    GROUP BY a.FirstName, a.LastName
    HAVING COUNT(b.Id) > 5
    ORDER BY BookCount DESC;
END;
GO

-- –í–∏–∫–ª–∏–∫–∞—î–º–æ –°–ö–†–Ü–ó–¨ –æ–¥–Ω–∞–∫–æ–≤–æ
EXEC GetActiveAuthors;
```

::mermaid

```mermaid
flowchart TB
    App1[–î–æ–¥–∞—Ç–æ–∫ C#] --> SP[Stored Procedure\nGetActiveAuthors]
    App2[–î–æ–¥–∞—Ç–æ–∫ Java] --> SP
    Web[Web API] --> SP
    Report[–ó–≤—ñ—Ç–∏] --> SP
    
    SP --> DB[(–ë–∞–∑–∞ –î–∞–Ω–∏—Ö)]
    DB --> Cache[Plan Cache\n–í—ñ–¥–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–∏–π –∫–æ–¥]
    
    style SP fill:#f59e0b,color:#fff
    style DB fill:#3b82f6,color:#fff
    style Cache fill:#10b981,color:#fff
```

::

**–ó–±–µ—Ä—ñ–≥–∞—î–º–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ (Stored Procedure)** ‚Äî —Ü–µ —ñ–º–µ–Ω–æ–≤–∞–Ω–∏–π –Ω–∞–±—ñ—Ä SQL-–∫–æ–º–∞–Ω–¥, –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö —É –≤—ñ–¥–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ.

---

## –ü–µ—Ä–µ–≤–∞–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä

::card-group
::card{icon="i-lucide-zap" title="–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å"}
- –ö–æ–¥ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–ª–∏–∫—É
- –ü–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ **–∫–µ—à—ñ**
- –ù–∞—Å—Ç—É–ø–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –≥–æ—Ç–æ–≤–∏–π –ø–ª–∞–Ω

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –®–≤–∏–¥—à–µ –Ω—ñ–∂ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π SQL!
::

::card{icon="i-lucide-recycle" title="–ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è"}
- –ü–∏—à–µ–º–æ –ª–æ–≥—ñ–∫—É **–æ–¥–∏–Ω —Ä–∞–∑**
- –í–∏–∫–ª–∏–∫–∞—î–º–æ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –º—ñ—Å—Ü—è
- –ó–º—ñ–Ω–∏–ª–∏ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ ‚Üí –ø—Ä–∞—Ü—é—î —Å–∫—Ä—ñ–∑—å

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–µ–Ω—à–µ –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É!
::

::card{icon="i-lucide-shield" title="–ë–µ–∑–ø–µ–∫–∞"}
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É –±–µ–∑ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ —Ç–∞–±–ª–∏—Ü—å
- –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ SQL Injection
- –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ —á–µ—Ä–µ–∑ `GRANT EXECUTE`

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í–∏—â–∏–π —Ä—ñ–≤–µ–Ω—å –±–µ–∑–ø–µ–∫–∏!
::

::card{icon="i-lucide-package" title="–Ü–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—è"}
- –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –≤ –ë–î, –∞ –Ω–µ –≤ –¥–æ–¥–∞—Ç–∫—É
- –ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ –º–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è
- –Ñ–¥–∏–Ω–∞ —Ç–æ—á–∫–∞ –∑–º—ñ–Ω–∏ –ª–æ–≥—ñ–∫–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –õ–µ–≥—à–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏!
::
::

---

## –ë–∞–∑–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å CREATE PROCEDURE

```sql
CREATE PROCEDURE [schema.]procedure_name
    [;number]  -- –ù–æ–º–µ—Ä –≥—Ä—É–ø–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä
    [@parameter [schema.]data_type
        [ = default_value | DEFAULT ]
        [OUTPUT]
        [READONLY]
    ] [, ...n]
    [WITH {
        [ENCRYPTION]
        [RECOMPILE]
        [EXECUTE AS {CALLER | SELF | OWNER | 'user_name'}]
    }]
AS
BEGIN
    -- –¢—ñ–ª–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ (T-SQL –∫–æ–º–∞–Ω–¥–∏)
END;
GO
```

**–ê–Ω–∞—Ç–æ–º—ñ—è**:
- `procedure_name` ‚Äî —ñ–º'—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: `sp_<Domain>_<Action>`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `sp_Books_GetBestsellers`)
- `@parameter` ‚Äî –≤—Ö—ñ–¥–Ω—ñ/–≤–∏—Ö—ñ–¥–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
- `OUTPUT` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä, —è–∫–∏–π –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è
- `READONLY` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è (–¥–ª—è —Ç–∞–±–ª–∏—á–Ω–∏—Ö —Ç–∏–ø—ñ–≤)
- `WITH ENCRYPTION` ‚Äî —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–¥—É –ø—Ä–æ—Ü–µ–¥—É—Ä–∏
- `WITH RECOMPILE` ‚Äî –ø–µ—Ä–µ–∫–æ–º–ø –∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ —â–æ—Ä–∞–∑—É
- `EXECUTE AS` ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–ø–µ–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

---

## –í–∏–∫–ª–∏–∫ –ø—Ä–æ—Ü–µ–¥—É—Ä

::code-group

```sql [–ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤]
EXEC GetAllBooks;
-- –∞–±–æ
EXECUTE GetAllBooks;
```

```sql [–ó –≤—Ö—ñ–¥–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–ø–æ–∑–∏—Ü—ñ–π–Ω–æ)]
EXEC GetBooksByAuthor 1, 'Fiction';
-- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É
```

```sql [–ó –≤—Ö—ñ–¥–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (—ñ–º–µ–Ω–æ–≤–∞–Ω–æ)]
EXEC GetBooksByAuthor 
    @authorId = 1,
    @genre = 'Fiction';
-- –Ø–≤–Ω–∞ –≤–∫–∞–∑—ñ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (–ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≤–∞–∂–ª–∏–≤–∏–π)
```

```sql [–ó –≤–∏—Ö—ñ–¥–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏]
DECLARE @totalBooks INT;
EXEC CalculateTotalBooks 
    @authorId = 1,
    @total = @totalBooks OUTPUT;
    
SELECT @totalBooks AS TotalBooks;
```

```sql [–ß–µ—Ä–µ–∑ RETURN]
DECLARE @result INT;
EXEC @result = CalculateSum 5, 10;

SELECT @result AS Sum;  -- 15
```

::

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

### –ü—Ä–∏–∫–ª–∞–¥ 1: –ü—Ä–æ—Å—Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

**–ó–∞–¥–∞—á–∞**: –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä—ñ–≤ —Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —ó—Ö –∫–Ω–∏–≥.

```sql
CREATE PROCEDURE sp_Authors_GetStatistics
AS
BEGIN
    SELECT 
        a.FirstName + ' ' + a.LastName AS AuthorName,
        COUNT(b.Id) AS BookCount
    FROM book.Authors a
    LEFT JOIN book.Books b ON a.Id = b.AuthorId
    GROUP BY a.FirstName, a.LastName
    ORDER BY BookCount DESC;
END;
GO

-- –í–∏–∫–ª–∏–∫
EXEC sp_Authors_GetStatistics;
```

---

### –ü—Ä–∏–∫–ª–∞–¥ 2: –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∑ –≤—Ö—ñ–¥–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–ó–∞–¥–∞—á–∞**: –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–Ω–∏–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞ –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –∑–∞ —Ç–µ–º–∞—Ç–∏–∫–æ—é.

```sql
CREATE PROCEDURE sp_Books_GetByAuthorAndTheme
    @authorId INT,
    @themeName NVARCHAR(100) = NULL  -- –ó–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
AS
BEGIN
    SELECT 
        b.NameBook AS Title,
        b.Price,
        t.NameTheme AS Theme
    FROM book.Books b
    INNER JOIN book.Authors a ON b.AuthorId = a.Id
    LEFT JOIN book.Themes t ON b.ThemeId = t.Id
    WHERE a.Id = @authorId
      AND (@themeName IS NULL OR t.NameTheme = @themeName);
END;
GO

-- –í–∏–∫–ª–∏–∫ –±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞ –∑–∞ —Ç–µ–º–∞—Ç–∏–∫–æ—é
EXEC sp_Books_GetByAuthorAndTheme @authorId = 1;

-- –í–∏–∫–ª–∏–∫ –∑ —Ñ—ñ–ª—å—Ç—Ä–æ–º
EXEC sp_Books_GetByAuthorAndTheme 
    @authorId = 1,
    @themeName = '–ü—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è';
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- `@themeName = NULL` ‚Äî –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- `WHERE (@themeName IS NULL OR ...)` ‚Äî –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä

---

### –ü—Ä–∏–∫–ª–∞–¥ 3: –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∑ –≤–∏—Ö—ñ–¥–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (OUTPUT)

**–ó–∞–¥–∞—á–∞**: –û–±—á–∏—Å–ª–∏—Ç–∏ —Å—É–º—É –¥–≤–æ—Ö —á–∏—Å–µ–ª —ñ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ OUTPUT –ø–∞—Ä–∞–º–µ—Ç—Ä.

```sql
CREATE PROCEDURE sp_Math_Add
    @a INT,
    @b INT,
    @result INT OUTPUT  -- –í–∏—Ö—ñ–¥–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä
AS
BEGIN
    SET @result = @a + @b;
END;
GO

-- –í–∏–∫–ª–∏–∫
DECLARE @sum INT;
EXEC sp_Math_Add 
    @a = 15,
    @b = 25,
    @result = @sum OUTPUT;  -- –û–ë–û–í'–Ø–ó–ö–û–í–û –≤–∫–∞–∑–∞—Ç–∏ OUTPUT –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É!

SELECT @sum AS Total;  -- 40
```

::warning
**–í–∞–∂–ª–∏–≤–æ**: –ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –∑ OUTPUT –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ **–æ–±–æ–≤'—è–∑–∫–æ–≤–æ** –≤–∫–∞–∑—É–≤–∞—Ç–∏ –∫–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ `OUTPUT`! –Ü–Ω–∞–∫—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –±—É–¥–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π.
::

---

### –ü—Ä–∏–∫–ª–∞–¥ 4: –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ RETURN

`RETURN` –º–æ–∂–µ–ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ **—Ü—ñ–ª–æ—á–∏—Å–µ–ª—å–Ω–µ** (INT) –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∫–æ–¥—ñ–≤ –ø–æ–º–∏–ª–æ–∫ (0 = —É—Å–ø—ñ—Ö, —ñ–Ω—à–µ = –ø–æ–º–∏–ª–∫–∞).

```sql
CREATE PROCEDURE sp_Math_Multiply
    @a INT,
    @b INT
AS
BEGIN
    DECLARE @result INT;
    SET @result = @a * @b;
    RETURN @result;
END;
GO

-- –í–∏–∫–ª–∏–∫
DECLARE @product INT;
EXEC @product = sp_Math_Multiply 7, 6;

SELECT @product AS Product;  -- 42
```

::tip
**Best Practice**: 

- **RETURN** ‚Äî –¥–ª—è –∫–æ–¥—ñ–≤ —Å—Ç–∞—Ç—É—Å—É (0/1, –∫–æ–¥–∏ –ø–æ–º–∏–ª–æ–∫)
- **OUTPUT** ‚Äî –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö (—Ä—è–¥–∫–∏, —á–∏—Å–ª–∞, —Ç–∞–±–ª–∏—Ü—ñ)
- **SELECT** ‚Äî –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è result sets (—Ç–∞–±–ª–∏—Ü—å –¥–∞–Ω–∏—Ö)
::

---

### –ü—Ä–∏–∫–ª–∞–¥ 5: –°–∫–ª–∞–¥–Ω–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞

**–ó–∞–¥–∞—á–∞**: –ü—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –ø—Ä–æ–¥–∞–∂—É ‚Äî –∑–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–Ω–∏–≥ –Ω–∞ —Å–∫–ª–∞–¥—ñ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å.

```sql
CREATE PROCEDURE sp_Sales_Create
    @bookId INT,
    @quantity INT,
    @price DECIMAL(10,2),
    @statusMessage NVARCHAR(200) OUTPUT
AS
BEGIN
    SET NOCOUNT ON;  -- –ù–µ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ "N rows affected"
    
    DECLARE @availableStock INT;
    
    -- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥—ñ
    SELECT @availableStock = QuantityInStock
    FROM book.Books
    WHERE Id = @bookId;
    
    -- –í–∞–ª—ñ–¥–∞—Ü—ñ—è
    IF @availableStock IS NULL
    BEGIN
        SET @statusMessage = '–ö–Ω–∏–≥–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞';
        RETURN 1;  -- –ö–æ–¥ –ø–æ–º–∏–ª–∫–∏
    END
    
    IF @availableStock < @quantity
    BEGIN
        SET @statusMessage = '–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–Ω–∏–≥ –Ω–∞ —Å–∫–ª–∞–¥—ñ';
        RETURN 2;  -- –ö–æ–¥ –ø–æ–º–∏–ª–∫–∏
    END
    
    BEGIN TRY
        BEGIN TRANSACTION;
        
        -- –î–æ–¥–∞—î–º–æ –ø—Ä–æ–¥–∞–∂
        INSERT INTO sale.Sales (BookId, Quantity, Price, SaleDate)
        VALUES (@bookId, @quantity, @price, GETDATE());
        
        -- –ó–º–µ–Ω—à—É—î–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥—ñ
        UPDATE book.Books
        SET QuantityInStock = QuantityInStock - @quantity
        WHERE Id = @bookId;
        
        COMMIT TRANSACTION;
        
        SET @statusMessage = '–ü—Ä–æ–¥–∞–∂ —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ';
        RETURN 0;  -- –£—Å–ø—ñ—Ö
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;
        SET @statusMessage = '–ü–æ–º–∏–ª–∫–∞: ' + ERROR_MESSAGE();
        RETURN 99;  -- –ó–∞–≥–∞–ª—å–Ω–∞ –ø–æ–º–∏–ª–∫–∞
    END CATCH
END;
GO

-- –í–∏–∫–ª–∏–∫
DECLARE @message NVARCHAR(200);
DECLARE @resultCode INT;

EXEC @resultCode = sp_Sales_Create 
    @bookId = 1,
    @quantity = 2,
    @price = 499.99,
    @statusMessage = @message OUTPUT;

SELECT 
    @resultCode AS ResultCode,
    @message AS Message;
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è**:
- `SET NOCOUNT ON` ‚Äî –≤–∏–º–∏–∫–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "X rows affected" –¥–ª—è —á–∏—Å—Ç–æ—Ç–∏ –≤–∏–≤–æ–¥—É
- `BEGIN TRY...END TRY` ‚Äî –±–ª–æ–∫ –∑ –º–æ–∂–ª–∏–≤–æ—é –ø–æ–º–∏–ª–∫–æ—é
- `BEGIN CATCH...END CATCH` ‚Äî –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–∫–∏
- `RETURN` –∫–æ–¥–∏: 0 = —É—Å–ø—ñ—Ö, 1+ = —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫

---

## –ì—Ä—É–ø–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä (Numbering)

–ú–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ **–≥—Ä—É–ø–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä** –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º —ñ–º–µ–Ω–µ–º, –∞–ª–µ —Ä—ñ–∑–Ω–∏–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏. –í–æ–Ω–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —Ä–∞–∑–æ–º.

```sql
CREATE PROCEDURE sp_Authors_Get;1
AS
BEGIN
    -- –ü–µ—Ä—à–∞ –≤–µ—Ä—Å—ñ—è: –≤—Å—ñ –∞–≤—Ç–æ—Ä–∏
    SELECT * FROM book.Authors;
END;
GO

CREATE PROCEDURE sp_Authors_Get;2
AS
BEGIN
    -- –î—Ä—É–≥–∞ –≤–µ—Ä—Å—ñ—è: —Ç—ñ–ª—å–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    SELECT 
        FirstName + ' ' + LastName AS AuthorName,
        COUNT(b.Id) AS BookCount
    FROM book.Authors a
    LEFT JOIN book.Books b ON a.Id = b.AuthorId
    GROUP BY FirstName, LastName;
END;
GO

-- –í–∏–∫–ª–∏–∫
EXEC sp_Authors_Get;1;  -- –í–∏–∫–ª–∏–∫–∞—î –ø–µ—Ä—à—É
EXEC sp_Authors_Get;2;  -- –í–∏–∫–ª–∏–∫–∞—î –¥—Ä—É–≥—É
EXEC sp_Authors_Get;    -- –í–∏–∫–ª–∏–∫–∞—î –ø–µ—Ä—à—É (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)
```

::caution
**–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ**: –ù–æ–º–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä –∑–∞—Å—Ç–∞—Ä—ñ–ª–µ —ñ –±—É–¥–µ –≤–∏–ª—É—á–µ–Ω–æ –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö SQL Server. –ö—Ä–∞—â–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –æ–∫—Ä–µ–º—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ —ñ–º–µ–Ω–∞–º–∏.
::

---

## –û–ø—Ü—ñ—è RECOMPILE

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–ª–∏–∫—É, —ñ –ø–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –∫–µ—à—ñ. –û–ø—Ü—ñ—è `RECOMPILE` –∑–º—É—à—É—î SQL Server –ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—É.

::tabs

::tabs-item{label="WITH RECOMPILE (–ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ)"}
–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ **–∑–∞–≤–∂–¥–∏** –ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É.

```sql
CREATE PROCEDURE sp_Books_GetByDate
    @startDate DATE
WITH RECOMPILE  -- –ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏
AS
BEGIN
    SELECT * FROM book.Books
    WHERE PublishDate >= @startDate;
END;
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –ü—Ä–æ—Ü–µ–¥—É—Ä–∏ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —è–∫—ñ —Å–∏–ª—å–Ω–æ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –ø–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥—ñ–∞–ø–∞–∑–æ–Ω–∏ –¥–∞—Ç).

::

::tabs-item{label="WITH RECOMPILE (–ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É)"}
–ü–µ—Ä–µ–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ **—Ç—ñ–ª—å–∫–∏ —Ü–µ–π –≤–∏–∫–ª–∏–∫**.

```sql
EXEC sp_Books_GetByDate 
    @startDate = '2020-01-01'
WITH RECOMPILE;
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**: –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞ –ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—è—Ü—ñ—è –ø—Ä–∏ –Ω–µ—Ç–∏–ø–æ–≤–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö.

::

::

::note
**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ RECOMPILE**:
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–Ω–∞—á–Ω–æ –∑–º—ñ–Ω—é—é—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤ —É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ
- –î–æ–¥–∞–Ω–æ –Ω–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å, —è–∫–∏–π –ø–æ–∫—Ä–∞—â—É—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—å —Å—É—Ç—Ç—î–≤–æ –∑–º—ñ–Ω–∏–ª–∞—Å—è

**–ù–µ–¥–æ–ª—ñ–∫**: –ü–µ—Ä–µ–∫–æ–º–ø—ñ–ª—è—Ü—ñ—è –∑–∞–±–∏—Ä–∞—î —á–∞—Å CPU.
::

---

## –û–ø—Ü—ñ—è EXECUTE AS

–í–∏–∑–Ω–∞—á–∞—î –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–ø–µ–∫–∏, –≤ —è–∫–æ–º—É –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞.

| –û–ø—Ü—ñ—è         | –û–ø–∏—Å                                              |
| :------------ | :------------------------------------------------ |
| `CALLER`      | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –í–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ –≤–∏–∫–ª–∏–∫–∞—á–∞   |
| `SELF`        | –í–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ —Å—Ç–≤–æ—Ä—é–≤–∞—á–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏          |
| `OWNER`       | –í–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ –≤–ª–∞—Å–Ω–∏–∫–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏            |
| `'user_name'` | –í–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞       |

```sql
CREATE PROCEDURE sp_Admin_GetSensitiveData
WITH EXECUTE AS OWNER  -- –í–∏–∫–æ–Ω–∞—Ç–∏ –∑ –ø—Ä–∞–≤–∞–º–∏ –≤–ª–∞—Å–Ω–∏–∫–∞
AS
BEGIN
    SELECT * FROM SensitiveData;
END;
```

**Use Case**: –ù–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ–¥—É—Ä—É, –Ω–µ –¥–∞—é—á–∏ –ø—Ä—è–º–∏—Ö –ø—Ä–∞–≤ –Ω–∞ —Ç–∞–±–ª–∏—Ü—é.

---

## –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏

### –ó–º—ñ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ (ALTER PROCEDURE)

```sql
ALTER PROCEDURE sp_Authors_GetStatistics
AS
BEGIN
    -- –û–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–¥
    SELECT 
        FirstName + ' ' + LastName AS AuthorName,
        COUNT(b.Id) AS BookCount,
        AVG(b.Price) AS AvgPrice  -- –î–æ–¥–∞–ª–∏ –Ω–æ–≤–µ –ø–æ–ª–µ
    FROM book.Authors a
    LEFT JOIN book.Books b ON a.Id = b.AuthorId
    GROUP BY FirstName, LastName;
END;
```

::tip
**Best Practice**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `ALTER PROCEDURE` –∑–∞–º—ñ—Å—Ç—å `DROP + CREATE`:
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É (GRANT)
- –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —ñ—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω –≤ –∫–æ–Ω—Ç—Ä–æ–ª—ñ –≤–µ—Ä—Å—ñ–π
::

### –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∏

```sql
DROP PROCEDURE sp_Authors_GetStatistics;

-- –í–∏–¥–∞–ª–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ –≤—ñ–¥—Ä–∞–∑—É
DROP PROCEDURE sp_Proc1, sp_Proc2, sp_Proc3;
```

### –ü–µ—Ä–µ–≥–ª—è–¥ –∫–æ–¥—É –ø—Ä–æ—Ü–µ–¥—É—Ä–∏

```sql
-- –ß–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—É –ø—Ä–æ—Ü–µ–¥—É—Ä—É
EXEC sp_helptext 'sp_Authors_GetStatistics';

-- –ß–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è
SELECT m.definition
FROM sys.sql_modules m
INNER JOIN sys.procedures p ON m.object_id = p.object_id
WHERE p.name = 'sp_Authors_GetStatistics';
```

### –ü–µ—Ä–µ–≥–ª—è–¥ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```sql
EXEC sp_depends 'sp_Authors_GetStatistics';
```

---

## –°–∏—Å—Ç–µ–º–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏

SQL Server –º—ñ—Å—Ç–∏—Ç—å —Å–æ—Ç–Ω—ñ –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö **—Å–∏—Å—Ç–µ–º–Ω–∏—Ö –∑–±–µ—Ä—ñ–≥–∞—î–º–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä** (–∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º `sp_`):

| –ü—Ä–æ—Ü–µ–¥—É—Ä–∞           | –û–ø–∏—Å                                |
| :------------------ | :---------------------------------- |
| `sp_helptext`       | –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–¥ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏/—Ç—Ä–∏–≥–µ—Ä–∞      |
| `sp_depends`        | –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –æ–±'—î–∫—Ç–∞         |
| `sp_help`           | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –æ–±'—î–∫—Ç –ë–î            |
| `sp_who`            | –ê–∫—Ç–∏–≤–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è                   |
| `sp_recompile`      | –í—ñ–¥–º—ñ—Ç–∏—Ç–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—É –¥–ª—è –ø–µ—Ä–µ–∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó |
| `sp_addmessage`     | –î–æ–¥–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è   |
| `sp_dropmessage`    | –í–∏–¥–∞–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è |

::warning
**–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø—Ä–µ—Ñ—ñ–∫—Å `sp_` –¥–ª—è –≤–ª–∞—Å–Ω–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä**!

SQL Server —Å–ø–µ—Ä—à—É —à—É–∫–∞—î `sp_` –ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –≤ –±–∞–∑—ñ `master`, —â–æ —É–ø–æ–≤—ñ–ª—å–Ω—é—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—à—ñ –ø—Ä–µ—Ñ—ñ–∫—Å–∏: `usp_`, `proc_`, –∞–±–æ `sp<Domain>_`.
::

---

## –ú–µ—Ç–∞–¥–∞–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä

```sql
-- –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä
SELECT 
    name AS ProcedureName,
    create_date AS Created,
    modify_date AS Modified
FROM sys.procedures
ORDER BY name;

-- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏
SELECT 
    p.name AS ParameterName,
    TYPE_NAME(p.user_type_id) AS DataType,
    p.max_length AS MaxLength,
    p.is_output AS IsOutput
FROM sys.parameters p
INNER JOIN sys.procedures pr ON p.object_id = pr.object_id
WHERE pr.name = 'sp_Sales_Create'
ORDER BY p.parameter_id;
```

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

::accordion

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 1: –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–≤—Ç–æ—Ä–∞" icon="i-lucide-user-plus"}

**–£–º–æ–≤–∞**: –°—Ç–≤–æ—Ä—ñ—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∞–≤—Ç–æ—Ä–∞ –∑ –≤–∏—Ö—ñ–¥–Ω–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º ID.

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
CREATE PROCEDURE sp_Authors_Add
    @firstName NVARCHAR(50),
    @lastName NVARCHAR(50),
    @countryId INT,
    @newAuthorId INT OUTPUT
AS
BEGIN
    INSERT INTO book.Authors (FirstName, LastName, CountryId)
    VALUES (@firstName, @lastName, @countryId);
    
    SET @newAuthorId = SCOPE_IDENTITY();  -- ID —â–æ–π–Ω–æ –¥–æ–¥–∞–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É
    
    RETURN 0;
END;
GO

-- –í–∏–∫–ª–∏–∫
DECLARE @authorId INT;
EXEC sp_Authors_Add 
    @firstName = '–Ü–≤–∞–Ω',
    @lastName = '–§—Ä–∞–Ω–∫–æ',
    @countryId = 1,
    @newAuthorId = @authorId OUTPUT;

SELECT @authorId AS NewAuthorID;
```

</details>

::

::accordion-item{label="–ó–∞–≤–¥–∞–Ω–Ω—è 2: –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ–¥—ñ–≤ –ø–æ–º–∏–ª–æ–∫" icon="i-lucide-alert-circle"}

**–£–º–æ–≤–∞**: –°—Ç–≤–æ—Ä—ñ—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü—ñ–Ω–∏ –∫–Ω–∏–≥–∏ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é (—Ü—ñ–Ω–∞ > 0).

<details>
<summary>üí° –†–æ–∑–≤'—è–∑–æ–∫</summary>

```sql
CREATE PROCEDURE sp_Books_UpdatePrice
    @bookId INT,
    @newPrice DECIMAL(10,2)
AS
BEGIN
    -- –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
    IF @newPrice <= 0
    BEGIN
        RAISERROR('–¶—ñ–Ω–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –±—ñ–ª—å—à–∞ –∑–∞ 0', 16, 1);
        RETURN 1;
    END
    
    IF NOT EXISTS (SELECT 1 FROM book.Books WHERE Id = @bookId)
    BEGIN
        RAISERROR('–ö–Ω–∏–≥–∞ –∑ —Ç–∞–∫–∏–º ID –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞', 16, 1);
        RETURN 2;
    END
    
    -- –û–Ω–æ–≤–ª–µ–Ω–Ω—è
    UPDATE book.Books
    SET Price = @newPrice
    WHERE Id = @bookId;
    
    RETURN 0;  -- –£—Å–ø—ñ—Ö
END;
GO

-- –í–∏–∫–ª–∏–∫
DECLARE @result INT;
EXEC @result = sp_Books_UpdatePrice @bookId = 1, @newPrice = 299.99;

IF @result = 0
    PRINT '–¶—ñ–Ω—É –æ–Ω–æ–≤–ª–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ';
ELSE
    PRINT '–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü—ñ–Ω–∏';
```

</details>

::

::

---

## –†–µ–∑—é–º–µ

::tip
**–ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—î–º–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä**:

1. **–Ü–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—è**: –õ–æ–≥—ñ–∫–∞ –≤ –ë–î, –Ω–µ –≤ –¥–æ–¥–∞—Ç–∫—É
2. **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**: –ü–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–µ—à—É—î—Ç—å—Å—è
3. **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏**: –í—Ö—ñ–¥–Ω—ñ (INPUT) —Ç–∞ –≤–∏—Ö—ñ–¥–Ω—ñ (OUTPUT)
4. **RETURN**: –¶—ñ–ª–æ—á–∏—Å–µ–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è (–∫–æ–¥–∏ —Å—Ç–∞—Ç—É—Å—É)
5. **–ë–µ–∑–ø–µ–∫–∞**: EXECUTE AS –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –ø—Ä–∞–≤
6. **RECOMPILE**: –ü–µ—Ä–µ–∫–æ–º–ø—ñ–ª—è—Ü—ñ—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
7. **–ü—Ä–µ—Ñ—ñ–∫—Å**: –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `sp_` –¥–ª—è –≤–ª–∞—Å–Ω–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä
8. **ALTER vs DROP+CREATE**: ALTER –∑–±–µ—Ä—ñ–≥–∞—î –ø—Ä–∞–≤–∞

**Best Practices**:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ—Å–º–∏—Å–ª–µ–Ω—ñ –Ω–∞–∑–≤–∏
- –î–æ–¥–∞–≤–∞–π—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ —Å–∫–ª–∞–¥–Ω–æ—ó –ª–æ–≥—ñ–∫–∏
- –û–±—Ä–æ–±–ª—è–π—Ç–µ –ø–æ–º–∏–ª–∫–∏ —á–µ—Ä–µ–∑ TRY...CATCH
- –í–∞–ª—ñ–¥—É–π—Ç–µ –≤—Ö—ñ–¥–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
- –ü–æ–≤–µ—Ä—Ç–∞–π—Ç–µ —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ RETURN
- –î–æ–∫—É–º–µ–Ω—Ç—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

**–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫**: –í–∏–≤—á—ñ—Ç—å [–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó](04.transactions.md) –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –ø—Ä–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä.
::
