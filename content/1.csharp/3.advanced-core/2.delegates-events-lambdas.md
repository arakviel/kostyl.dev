---
title: '–î–µ–ª–µ–≥–∞—Ç–∏, –ü–æ–¥—ñ—ó —Ç–∞ –õ—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏'
description: '–†–æ–∑—É–º—ñ–Ω–Ω—è –¥–µ–ª–µ–≥–∞—Ç—ñ–≤, –ø–æ–¥—ñ–π —Ç–∞ –ª—è–º–±–¥–∞-–≤–∏—Ä–∞–∑—ñ–≤ —É C# ‚Äî –ø–æ—Ç—É–∂–Ω–∏—Ö –º–µ—Ö–∞–Ω—ñ–∑–º—ñ–≤ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥–Ω—É—á–∫–æ–≥–æ —Ç–∞ —Ä–æ–∑—à–∏—Ä—é–≤–∞–Ω–æ–≥–æ –∫–æ–¥—É'
---

# –î–µ–ª–µ–≥–∞—Ç–∏, –ü–æ–¥—ñ—ó —Ç–∞ –õ—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏

## –í—Å—Ç—É–ø —Ç–∞ –ö–æ–Ω—Ç–µ–∫—Å—Ç

–£—è–≤—ñ—Ç—å, —â–æ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–æ–±–∫–∏ —Ñ–∞–π–ª—ñ–≤. –ö–æ–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ñ–∞–π–ª, –≤–æ–Ω–∞ –º–∞—î –ø–æ–≤—ñ–¥–æ–º–∏—Ç–∏ —Ä—ñ–∑–Ω—ñ —á–∞—Å—Ç–∏–Ω–∏ –≤–∞—à–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É: –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–Ω–æ–≤–ª—é—î UI, —ñ–Ω—à–∏–π –ª–æ–≥—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ç—Ä–µ—Ç—ñ–π –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. –Ø–∫ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ, –Ω–µ —Å—Ç–≤–æ—Ä—é—é—á–∏ –∂–æ—Ä—Å—Ç–∫–∏—Ö –∑–≤'—è–∑–∫—ñ–≤ –º—ñ–∂ –∫–ª–∞—Å–∞–º–∏?

::note
**–ü—Ä–æ–±–ª–µ–º–∞**: –£ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –º–µ—Ç–æ–¥, –≤–∏ –º–∞—î—Ç–µ –∑–Ω–∞—Ç–∏ —Ç–æ—á–Ω–∏–π —Ç–∏–ø –æ–±'—î–∫—Ç–∞. –¶–µ —Å—Ç–≤–æ—Ä—é—î —Ç—ñ—Å–Ω–∏–π –∑–≤'—è–∑–æ–∫ (tight coupling) –º—ñ–∂ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.
::

**–î–µ–ª–µ–≥–∞—Ç–∏ (Delegates)** –≤–∏—Ä—ñ—à—É—é—Ç—å —Ü—é –ø—Ä–æ–±–ª–µ–º—É. –í–æ–Ω–∏ —î —Ç–∏–ø–æ–±–µ–∑–ø–µ—á–Ω–∏–º–∏ –ø–æ–∫–∞–∂—á–∏–∫–∞–º–∏ –Ω–∞ –º–µ—Ç–æ–¥–∏, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —ó—Ö —É –∫–æ–ª–µ–∫—Ü—ñ—è—Ö —Ç–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ.

### –ï–≤–æ–ª—é—Ü—ñ—è

–£ –º–æ–≤—ñ C —ñ—Å–Ω—É–≤–∞–ª–∏ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∏ –Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—ó ‚Äî –ø–æ—Ç—É–∂–Ω–∏–π, –∞–ª–µ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º. C# –≤–∑—è–≤ —Ü—é —ñ–¥–µ—é —Ç–∞ –∑—Ä–æ–±–∏–≤ —ó—ó —Ç–∏–ø–æ–±–µ–∑–ø–µ—á–Ω–æ—é:
::mermaid

```mermaid
graph LR
    A[C: Function Pointers] -->|–¢–∏–ø–æ–±–µ–∑–ø–µ–∫–∞| B[C#: Delegates]
    B -->|–°–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏–π —Ü—É–∫–æ—Ä| C[Anonymous Methods]
    C -->|–õ–∞–∫–æ–Ω—ñ—á–Ω—ñ—Å—Ç—å| D[Lambda Expressions]

    style A fill:#64748b,stroke:#334155,color:#ffffff
    style B fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style C fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style D fill:#f59e0b,stroke:#b45309,color:#ffffff
```

::

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

–ü–µ—Ä–µ–¥ –≤–∏–≤—á–µ–Ω–Ω—è–º —Ü—ñ—î—ó —Ç–µ–º–∏ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–∑—É–º—ñ—Ç–∏:

-   –ú–µ—Ç–æ–¥–∏ —Ç–∞ —ó—Ö —Å–∏–≥–Ω–∞—Ç—É—Ä–∏
-   –ö–ª–∞—Å–∏ —Ç–∞ –æ–±'—î–∫—Ç–∏
-   –û—Å–Ω–æ–≤–∏ –û–û–ü (—ñ–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—è, –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º)

## –î–µ–ª–µ–≥–∞—Ç–∏ (Delegates)

### –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è

**–î–µ–ª–µ–≥–∞—Ç (Delegate)** ‚Äî —Ü–µ —Ç–∏–ø, —â–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–µ—Ç–æ–¥–∏ –∑ –ø–µ–≤–Ω–æ—é —Å–∏–≥–Ω–∞—Ç—É—Ä–æ—é. –ü–æ —Å—É—Ç—ñ, —Ü–µ –∫–ª–∞—Å, –ø–æ—Ö—ñ–¥–Ω–∏–π –≤—ñ–¥ `System.MulticastDelegate`, —è–∫–∏–π –æ–ø–∏—Å—É—î –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ—Ç–æ–¥—É.

::tip
**–ê–Ω–∞–ª–æ–≥—ñ—è –∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–≤—ñ—Ç—É**: –î–µ–ª–µ–≥–∞—Ç ‚Äî —Ü–µ —è–∫ –±–ª–∞–Ω–∫ –¥–æ—Ä—É—á–µ–Ω–Ω—è —É –±–∞–Ω–∫—É. –ù–∞ –±–ª–∞–Ω–∫—É –≤–∫–∞–∑–∞–Ω–æ, —â–æ —Å–∞–º–µ –º–∞—î –±—É—Ç–∏ –∑—Ä–æ–±–ª–µ–Ω–æ (—Å–∏–≥–Ω–∞—Ç—É—Ä–∞), –∞–ª–µ —Ö—Ç–æ —Å–∞–º–µ —Ü–µ –≤–∏–∫–æ–Ω–∞—î (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –º–µ—Ç–æ–¥), –º–æ–∂–Ω–∞ –≤–∏—Ä—ñ—à–∏—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ.
::

### –ü—ñ–¥ –∫–∞–ø–æ—Ç–æ–º

–ù–∞ –Ω–∏–∑—å–∫–æ–º—É —Ä—ñ–≤–Ω—ñ –¥–µ–ª–µ–≥–∞—Ç ‚Äî —Ü–µ –æ–±'—î–∫—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–µ—Ç–æ–¥ —Ç–∞ –æ–±'—î–∫—Ç, –¥–æ —è–∫–æ–≥–æ —Ü–µ–π –º–µ—Ç–æ–¥ –Ω–∞–ª–µ–∂–∏—Ç—å.

-   `_target`: –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –æ–±'—î–∫—Ç (–¥–ª—è instance –º–µ—Ç–æ–¥—ñ–≤) –∞–±–æ `null` (–¥–ª—è static –º–µ—Ç–æ–¥—ñ–≤).
-   `_methodPtr`: –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—é –≤ –ø–∞–º'—è—Ç—ñ.

–ö–æ–ª–∏ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ `MulticastDelegate`, –≤—ñ–Ω –¥–æ–¥–∞—Ç–∫–æ–≤–æ –º—ñ—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ —ñ–Ω—à–∏—Ö –¥–µ–ª–µ–≥–∞—Ç—ñ–≤, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å

–û–≥–æ–ª–æ—à–µ–Ω–Ω—è –¥–µ–ª–µ–≥–∞—Ç–∞ —Å—Ö–æ–∂–µ –Ω–∞ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –º–µ—Ç–æ–¥—É, –∞–ª–µ –∑ –∫–ª—é—á–æ–≤–∏–º —Å–ª–æ–≤–æ–º `delegate`:

```csharp [DelegateDeclaration.cs] showLineNumbers
// –û–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ç–∏–ø—É –¥–µ–ª–µ–≥–∞—Ç–∞
public delegate void ProcessHandler(string message);
public delegate int CalculateHandler(int a, int b);
public delegate bool PredicateHandler<T>(T item);
```

–î–µ–ª–µ–≥–∞—Ç –≤–∏–∑–Ω–∞—á–∞—î:

-   –¢–∏–ø –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
-   –ù–∞–∑–≤—É –¥–µ–ª–µ–≥–∞—Ç–∞
-   –°–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

::code-group

```csharp [Classic Syntax] showLineNumbers
delegate void NotifyDelegate(string message);

class Program
{
    static void EmailNotification(string msg)
    {
        Console.WriteLine($"üìß Email: {msg}");
    }

    static void SmsNotification(string msg)
    {
        Console.WriteLine($"üì± SMS: {msg}");
    }

    static void Main()
    {
        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –¥–µ–ª–µ–≥–∞—Ç–∞
        NotifyDelegate notify = new NotifyDelegate(EmailNotification);

        // –í–∏–∫–ª–∏–∫ –¥–µ–ª–µ–≥–∞—Ç–∞
        notify("–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ"); // üìß Email: –í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ
    }
}
```

```csharp [Short Syntax (C# 2.0+)] showLineNumbers
delegate void NotifyDelegate(string message);

class Program
{
    static void EmailNotification(string msg)
        => Console.WriteLine($"üìß Email: {msg}");

    static void Main()
    {
        // –°–∫–æ—Ä–æ—á–µ–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
        NotifyDelegate notify = EmailNotification;

        notify("–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ");
    }
}
```

::

::note
**–í–∞–∂–ª–∏–≤–æ**: –ù–∞–≤—ñ—Ç—å —è–∫—â–æ –¥–≤–∞ –¥–µ–ª–µ–≥–∞—Ç–∏ –º–∞—é—Ç—å —ñ–¥–µ–Ω—Ç–∏—á–Ω—É —Å–∏–≥–Ω–∞—Ç—É—Ä—É, –≤–æ–Ω–∏ —î —Ä—ñ–∑–Ω–∏–º–∏ —Ç–∏–ø–∞–º–∏, —è–∫—â–æ –æ–≥–æ–ª–æ—à–µ–Ω—ñ –æ–∫—Ä–µ–º–æ. –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î —Ç–∏–ø–æ–±–µ–∑–ø–µ–∫—É.
::

### Multicast Delegates (–ë–∞–≥–∞—Ç–æ–∞–¥—Ä–µ—Å–Ω—ñ –î–µ–ª–µ–≥–∞—Ç–∏)

–î–µ–ª–µ–≥–∞—Ç–∏ –≤ C# –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å **Multicast** ‚Äî –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ –º–µ—Ç–æ–¥—ñ–≤ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ:

```csharp [MulticastExample.cs] showLineNumbers {14,17,20}
delegate void LogDelegate(string message);

class Logger
{
    static void ConsoleLog(string msg)
        => Console.WriteLine($"[CONSOLE] {msg}");

    static void FileLog(string msg)
        => Console.WriteLine($"[FILE] {msg}");

    static void Main()
    {
        LogDelegate log = ConsoleLog;
        log += FileLog; // –î–æ–¥–∞–≤–∞–Ω–Ω—è –º–µ—Ç–æ–¥—É

        log("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è");
        // –í–∏–≤–µ–¥–µ:
        // [CONSOLE] –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
        // [FILE] –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

        log -= ConsoleLog; // –í–∏–¥–∞–ª–µ–Ω–Ω—è –º–µ—Ç–æ–¥—É
        log("–ü–æ–≤—Ç–æ—Ä–Ω–∞ —Å–ø—Ä–æ–±–∞");
        // –í–∏–≤–µ–¥–µ —Ç—ñ–ª—å–∫–∏:
        // [FILE] –ü–æ–≤—Ç–æ—Ä–Ω–∞ —Å–ø—Ä–æ–±–∞
    }
}
```

::warning
**–ù–µ–±–µ–∑–ø–µ–∫–∞ NullReferenceException**: –Ø–∫—â–æ –≤–∏ –≤–∏–¥–∞–ª–∏—Ç–µ –≤—Å—ñ –º–µ—Ç–æ–¥–∏ –∑ –¥–µ–ª–µ–≥–∞—Ç–∞, –≤—ñ–Ω —Å—Ç–∞–Ω–µ `null`. –í–∏–∫–ª–∏–∫ `null` –¥–µ–ª–µ–≥–∞—Ç–∞ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç—å –≤–∏–Ω—è—Ç–æ–∫. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä `?.`:

```csharp
log?.Invoke("–ë–µ–∑–ø–µ—á–Ω–∏–π –≤–∏–∫–ª–∏–∫");
```

::

### –Ø–∫ –ü—Ä–∞—Ü—é—é—Ç—å Multicast Delegates

::mermaid

```mermaid
graph TD
    A[Delegate Instance] --> B{Invocation List}
    B --> C[Method 1]
    B --> D[Method 2]
    B --> E[Method 3]

    C --> F[Execute Method 1]
    F --> G[Execute Method 2]
    G --> H[Execute Method 3]
    H --> I[Return last result]

    style A fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style B fill:#f59e0b,stroke:#b45309,color:#ffffff
    style C fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style D fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style E fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style I fill:#64748b,stroke:#334155,color:#ffffff
```

::

::caution
**–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è**: –Ø–∫—â–æ –¥–µ–ª–µ–≥–∞—Ç –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è, multicast –¥–µ–ª–µ–≥–∞—Ç –ø–æ–≤–µ—Ä–Ω–µ —Ç—ñ–ª—å–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç **–æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ** –º–µ—Ç–æ–¥—É –≤ —Å–ø–∏—Å–∫—É. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –º–µ—Ç–æ–¥—ñ–≤ –±—É–¥—É—Ç—å –≤—Ç—Ä–∞—á–µ–Ω—ñ.
::

### –ö–æ–≤–∞—Ä—ñ–∞–Ω—Ç–Ω—ñ—Å—Ç—å —Ç–∞ –ö–æ–Ω—Ç—Ä–∞–≤–∞—Ä—ñ–∞–Ω—Ç–Ω—ñ—Å—Ç—å

–¶–µ –º–µ—Ö–∞–Ω—ñ–∑–º, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏, —á–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –Ω–µ –∑–æ–≤—Å—ñ–º –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ –¥–µ–ª–µ–≥–∞—Ç–æ–º, –∞–ª–µ —î —Å—É–º—ñ—Å–Ω–æ—é –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –Ω–∞—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è —Ç–∏–ø—ñ–≤.

#### 1. –ö–æ–≤–∞—Ä—ñ–∞–Ω—Ç–Ω—ñ—Å—Ç—å (Covariance) ‚Äî `out`

–î–æ–∑–≤–æ–ª—è—î –º–µ—Ç–æ–¥—É –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ **–±—ñ–ª—å—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π** —Ç–∏–ø (—Å–ø–∞–¥–∫–æ—î–º–µ—Ü—å), –Ω—ñ–∂ –æ–≥–æ–ª–æ—à–µ–Ω–æ –≤ –¥–µ–ª–µ–≥–∞—Ç—ñ.

> "–Ø–∫—â–æ –¥–µ–ª–µ–≥–∞—Ç –æ–±—ñ—Ü—è—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ `Person`, —Ç–æ –º–µ—Ç–æ–¥, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î `Employee`, —Ç–µ–∂ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å, –±–æ `Employee` ‚Äî —Ü–µ —Ç–µ–∂ `Person`."

#### 2. –ö–æ–Ω—Ç—Ä–∞–≤–∞—Ä—ñ–∞–Ω—Ç–Ω—ñ—Å—Ç—å (Contravariance) ‚Äî `in`

–î–æ–∑–≤–æ–ª—è—î –º–µ—Ç–æ–¥—É –ø—Ä–∏–π–º–∞—Ç–∏ **–±—ñ–ª—å—à –∑–∞–≥–∞–ª—å–Ω–∏–π** —Ç–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (–±–∞—Ç—å–∫–æ), –Ω—ñ–∂ –æ–≥–æ–ª–æ—à–µ–Ω–æ –≤ –¥–µ–ª–µ–≥–∞—Ç—ñ.

> "–Ø–∫—â–æ –¥–µ–ª–µ–≥–∞—Ç –ø–µ—Ä–µ–¥–∞—î `Employee`, —Ç–æ –º–µ—Ç–æ–¥, —è–∫–∏–π –≤–º—ñ—î –æ–±—Ä–æ–±–ª—è—Ç–∏ –±—É–¥—å-—è–∫–æ–≥–æ `Person`, —Ç–µ–∂ –≤–ø–æ—Ä–∞—î—Ç—å—Å—è, –±–æ `Employee` —î `Person`."

#### –ü—Ä–∏–∫–ª–∞–¥ —Ç–∞ Liskov Substitution Principle

–¶–µ –ø—Ä—è–º–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø—Ä–∏–Ω—Ü–∏–ø—É –ø—ñ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –õ—ñ—Å–∫–æ–≤ (LSP).

```csharp [VarianceDeepDive.cs] showLineNumbers
class Person { }
class Employee : Person { }
class Manager : Employee { }

delegate Person Factory();           // Covariant return
delegate void Handler(Employee e);   // Contravariant param

class Program
{
    // –ü–æ–≤–µ—Ä—Ç–∞—î Manager (—Å–ø–∞–¥–∫–æ—î–º–µ—Ü—å Person) -> OK
    static Manager CreateManager() => new Manager();

    // –ü—Ä–∏–π–º–∞—î Person (–±–∞—Ç—å–∫–æ Employee) -> OK
    static void LogPerson(Person p) { }

    static void Main()
    {
        // COVARIANCE: Factory –æ—á—ñ–∫—É—î Person, –º–∏ –¥–∞—î–º–æ Manager.
        // –¶–µ –±–µ–∑–ø–µ—á–Ω–æ, –±–æ —Ö—Ç–æ –æ—á—ñ–∫—É—î Person, –∑–º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ Manager.
        Factory factory = CreateManager;

        // CONTRAVARIANCE: Handler –∑–±–∏—Ä–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–¥–∞—Ç–∏ Employee.
        // –ú–∏ –¥–∞—î–º–æ –º–µ—Ç–æ–¥, —â–æ –ø—Ä–∏–π–º–∞—î Person.
        // –¶–µ –±–µ–∑–ø–µ—á–Ω–æ, –±–æ –º–µ—Ç–æ–¥ LogPerson —Ç–æ—á–Ω–æ –∑–º–æ–∂–µ –æ–±—Ä–æ–±–∏—Ç–∏ Employee.
        Handler handler = LogPerson;
    }
}
```

#### Generic Variance

–£–∑–∞–≥–∞–ª—å–Ω–µ–Ω—ñ –¥–µ–ª–µ–≥–∞—Ç–∏ `Func` —Ç–∞ `Action` –≤–∂–µ –º–∞—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –≤–∞—Ä—ñ–∞—Ç–∏–≤–Ω–æ—Å—Ç—ñ:

-   `Func<out TResult>`: –∫–æ–≤–∞—Ä—ñ–∞–Ω—Ç–Ω–∏–π –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.
-   `Action<in T>`: –∫–æ–Ω—Ç—Ä–∞–≤–∞—Ä—ñ–∞–Ω—Ç–Ω–∏–π –∑–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º.

::warning
**–û–±–º–µ–∂–µ–Ω–Ω—è Value Types**: –í–∞—Ä—ñ–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø—Ä–∞—Ü—é—î **—Ç—ñ–ª—å–∫–∏ –¥–ª—è Reference Types**. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–≤–µ—Å—Ç–∏ `Func<string>` –¥–æ `Func<object>`, —Ü–µ –ø—Ä–∞—Ü—é—î. –ê–ª–µ `Func<int>` –¥–æ `Func<object>` ‚Äî **–Ω—ñ**, —Ç–æ–º—É —â–æ `int` ‚Äî —Ü–µ value type, —ñ –ø–æ—Ç—Ä–µ–±—É—î boxing, —â–æ –∑–º—ñ–Ω—é—î –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –≤ –ø–∞–º'—è—Ç—ñ.
::

## –í–±—É–¥–æ–≤–∞–Ω—ñ –î–µ–ª–µ–≥–∞—Ç–∏

–ó–∞–º—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –¥–µ–ª–µ–≥–∞—Ç—ñ–≤ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤–∏–ø–∞–¥–∫—É, C# –Ω–∞–¥–∞—î —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ –≤–±—É–¥–æ–≤–∞–Ω—ñ –¥–µ–ª–µ–≥–∞—Ç–∏: `Action`, `Func` —Ç–∞ `Predicate`.

### Action<T>

`Action` ‚Äî –¥–µ–ª–µ–≥–∞—Ç, —è–∫–∏–π **–Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—î** –∑–Ω–∞—á–µ–Ω–Ω—è (`void`). –ú–æ–∂–µ –º–∞—Ç–∏ –≤—ñ–¥ 0 –¥–æ 16 –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤.

```csharp [ActionExample.cs] showLineNumbers
// –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
Action greet = () => Console.WriteLine("–ü—Ä–∏–≤—ñ—Ç!");

// –û–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä
Action<string> printMessage = msg => Console.WriteLine(msg);

// –î–µ–∫—ñ–ª—å–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
Action<string, int> printWithCode = (msg, code) =>
    Console.WriteLine($"[{code}] {msg}");

greet();                              // –ü—Ä–∏–≤—ñ—Ç!
printMessage("–ü–æ–º–∏–ª–∫–∞ —Å–∏—Å—Ç–µ–º–∏");     // –ü–æ–º–∏–ª–∫–∞ —Å–∏—Å—Ç–µ–º–∏
printWithCode("–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ", 404);   // [404] –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ
```

### Func<T, TResult>

`Func` ‚Äî –¥–µ–ª–µ–≥–∞—Ç, —è–∫–∏–π **–ø–æ–≤–µ—Ä—Ç–∞—î** –∑–Ω–∞—á–µ–Ω–Ω—è. –û—Å—Ç–∞–Ω–Ω—ñ–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∏–ø—É ‚Äî —Ü–µ —Ç–∏–ø –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è.

```csharp [FuncExample.cs] showLineNumbers
// –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, –ø–æ–≤–µ—Ä—Ç–∞—î int
Func<int> getRandomNumber = () => Random.Shared.Next(1, 101);

// –û–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä, –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç
Func<int, int> square = x => x * x;

// –î–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, –ø–æ–≤–µ—Ä—Ç–∞—î —Å—É–º—É
Func<int, int, int> add = (a, b) => a + b;

// –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∏–ø—ñ–≤
Func<string, int> parseToInt = s => int.Parse(s);

Console.WriteLine(getRandomNumber()); // –í–∏–ø–∞–¥–∫–æ–≤–µ —á–∏—Å–ª–æ
Console.WriteLine(square(5));         // 25
Console.WriteLine(add(10, 20));       // 30
Console.WriteLine(parseToInt("42"));  // 42
```

### Predicate<T>

`Predicate<T>` ‚Äî —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –¥–µ–ª–µ–≥–∞—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —É–º–æ–≤–∏. –ü—Ä–∏–π–º–∞—î –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∏–ø—É `T` —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î `bool`.

```csharp [PredicateExample.cs] showLineNumbers
Predicate<int> isEven = x => x % 2 == 0;
Predicate<string> isNullOrEmpty = string.IsNullOrEmpty;

Console.WriteLine(isEven(4));              // True
Console.WriteLine(isEven(7));              // False
Console.WriteLine(isNullOrEmpty(""));      // True
Console.WriteLine(isNullOrEmpty("text")); // False

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ List.FindAll
List<int> numbers = [1, 2, 3, 4, 5, 6];
List<int> evenNumbers = numbers.FindAll(isEven);
Console.WriteLine(string.Join(", ", evenNumbers)); // 2, 4, 6
```

### –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ –¢–∞–±–ª–∏—Ü—è

| –î–µ–ª–µ–≥–∞—Ç            | –°–∏–≥–Ω–∞—Ç—É—Ä–∞               | –ü–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è? | –¢–∏–ø–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è          |
| :----------------- | :---------------------- | :----------------- | :--------------------------- |
| `Action`           | `void Method()`         | ‚ùå –ù—ñ              | –í–∏–∫–æ–Ω–∞–Ω–Ω—è –¥—ñ–π –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É |
| `Action<T>`        | `void Method(T arg)`    | ‚ùå –ù—ñ              | –û–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö –±–µ–∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è |
| `Func<TResult>`    | `TResult Method()`      | ‚úÖ –¢–∞–∫             | –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑–Ω–∞—á–µ–Ω—å            |
| `Func<T, TResult>` | `TResult Method(T arg)` | ‚úÖ –¢–∞–∫             | –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö          |
| `Predicate<T>`     | `bool Method(T arg)`    | ‚úÖ –¢–∞–∫ (bool)      | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–º–æ–≤, —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è   |

::tip
**Best Practice**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `Action` —Ç–∞ `Func` –∑–∞–º—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –¥–µ–ª–µ–≥–∞—Ç—ñ–≤, —è–∫—â–æ —Ü–µ –º–æ–∂–ª–∏–≤–æ. –¶–µ —Ä–æ–±–∏—Ç—å –∫–æ–¥ –±—ñ–ª—å—à —á–∏—Ç–∞–±–µ–ª—å–Ω–∏–º —Ç–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–º.
::

## –ê–Ω–æ–Ω—ñ–º–Ω—ñ –ú–µ—Ç–æ–¥–∏

**–ê–Ω–æ–Ω—ñ–º–Ω—ñ –º–µ—Ç–æ–¥–∏ (Anonymous Methods)** ‚Äî —Ü–µ —Å–ø–æ—Å–æ–± —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–µ–ª–µ–≥–∞—Ç–∞ –±–µ–∑ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –æ–∫—Ä–µ–º–æ–≥–æ —ñ–º–µ–Ω–æ–≤–∞–Ω–æ–≥–æ –º–µ—Ç–æ–¥—É. –í–≤–µ–¥–µ–Ω—ñ –≤ C# 2.0.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å

```csharp [AnonymousMethodSyntax.cs] showLineNumbers
Func<int, int, int> sum = delegate(int a, int b)
{
    return a + b;
};

Console.WriteLine(sum(5, 3)); // 8
```

::code-group

```csharp [Named Method] showLineNumbers
class Calculator
{
    static int Add(int a, int b)
    {
        return a + b;
    }

    static void Main()
    {
        Func<int, int, int> operation = Add;
        Console.WriteLine(operation(10, 5)); // 15
    }
}
```

```csharp [Anonymous Method] showLineNumbers
class Calculator
{
    static void Main()
    {
        Func<int, int, int> operation = delegate(int a, int b)
        {
            return a + b;
        };

        Console.WriteLine(operation(10, 5)); // 15
    }
}
```

::

### –ù–∞–≤—ñ—â–æ —Ü–µ –±—É–ª–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ?

–ê–Ω–æ–Ω—ñ–º–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å:

-   –û–≥–æ–ª–æ—à—É–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É "–Ω–∞ –º—ñ—Å—Ü—ñ" –±–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–∫—Ä–µ–º–∏—Ö –º–µ—Ç–æ–¥—ñ–≤
-   –ó–º–µ–Ω—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ–¥—É –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
-   –û—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ª–æ–∫–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö (closure)

::note
**–Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞**: –ê–Ω–æ–Ω—ñ–º–Ω—ñ –º–µ—Ç–æ–¥–∏ –±—É–ª–∏ —Ä–µ–≤–æ–ª—é—Ü—ñ–π–Ω–∏–º–∏ –≤ C# 2.0, –∞–ª–µ –∑ –ø–æ—è–≤–æ—é **–ª—è–º–±–¥–∞-–≤–∏—Ä–∞–∑—ñ–≤** —É C# 3.0, –≤–æ–Ω–∏ —Å—Ç–∞–ª–∏ —Ä—ñ–¥—à–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è —á–µ—Ä–µ–∑ –±—ñ–ª—å—à –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ª—è–º–±–¥.
::

## –õ—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏ (Lambda Expressions)

**–õ—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏ (Lambda Expressions)** ‚Äî —Ü–µ —Å—É—á–∞—Å–Ω–∏–π —Ç–∞ –ª–∞–∫–æ–Ω—ñ—á–Ω–∏–π —Å–ø–æ—Å—ñ–± —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–Ω–æ–Ω—ñ–º–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π. –í–æ–Ω–∏ —î –µ–≤–æ–ª—é—Ü—ñ—î—é –∞–Ω–æ–Ω—ñ–º–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å

–ë–∞–∑–æ–≤–∞ —Ñ–æ—Ä–º–∞ –ª—è–º–±–¥–∞-–≤–∏—Ä–∞–∑—É:

```
(parameters) => expression-or-statement-block
```

::code-group

```csharp [Expression Lambda] showLineNumbers
// –û–¥–∏–Ω –≤–∏—Ä–∞–∑ —Å–ø—Ä–∞–≤–∞ –≤—ñ–¥ =>
Func<int, int> square = x => x * x;

// –ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ:
Func<int, int> squareLong = x => { return x * x; };
```

```csharp [Statement Lambda] showLineNumbers
// –ë–ª–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ–≤
Func<int, int, int> divide = (a, b) =>
{
    if (b == 0)
        throw new DivideByZeroException();
    return a / b;
};
```

::

### –í–∞—Ä—ñ–∞—Ü—ñ—ó –°–∏–Ω—Ç–∞–∫—Å–∏—Å—É

```csharp [LambdaSyntaxVariations.cs] showLineNumbers
// –ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
Action sayHello = () => Console.WriteLine("Hello!");

// –û–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä (–¥—É–∂–∫–∏ –Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤—ñ)
Func<int, int> double = x => x * 2;

// –î–≤–∞ —ñ –±—ñ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (–¥—É–∂–∫–∏ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ)
Func<int, int, int> multiply = (a, b) => a * b;

// –Ø–≤–Ω–∞ —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
Func<int, int> explicitType = (int x) => x + 1;

// –Ü–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (C# 9.0+)
Func<int, int, int> ignoreSecond = (x, _) => x * 2;
```

### Type Inference (–í–∏–≤–µ–¥–µ–Ω–Ω—è –¢–∏–ø—ñ–≤)

–ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –º–æ–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —Ç–∏–ø –¥–µ–ª–µ–≥–∞—Ç–∞:

```csharp [TypeInference.cs] showLineNumbers
// –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –≤–∏–≤–µ–¥–µ —Ç–∏–ø Func<string, int>
var parse = (string s) => int.Parse(s);

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
int number = parse("42");
Console.WriteLine(number); // 42
```

::warning
–¢–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `s` –º–∞—î –±—É—Ç–∏ —è–≤–Ω–æ –≤–∫–∞–∑–∞–Ω–∏–π, —ñ–Ω–∞–∫—à–µ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –Ω–µ –∑–º–æ–∂–µ –≤–∏–≤–µ—Å—Ç–∏ —Ç–∏–ø `parse`.
::

### Closures (–ó–∞–º–∏–∫–∞–Ω–Ω—è)

**–ó–∞–º–∏–∫–∞–Ω–Ω—è (Closure)** ‚Äî —Ü–µ –º–µ—Ö–∞–Ω—ñ–∑–º, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ª—è–º–±–¥–∞-–≤–∏—Ä–∞–∑—É "–∑–∞—Ö–æ–ø–ª—é–≤–∞—Ç–∏" –∑–º—ñ–Ω–Ω—ñ –∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Ç–∞ –ø–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏ —ó—Ö —á–∞—Å –∂–∏—Ç—Ç—è, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –º–µ—Ç–æ–¥ –≤–∂–µ –∑–∞–≤–µ—Ä—à–∏–≤ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

```csharp [ClosureExample.cs] showLineNumbers {3,7-8}
int multiplier = 5;

Func<int, int> multiplyByFive = x => x * multiplier;

Console.WriteLine(multiplyByFive(10)); // 50

multiplier = 10; // –ó–º—ñ–Ω—é—î–º–æ –∑–æ–≤–Ω—ñ—à–Ω—é –∑–º—ñ–Ω–Ω—É
Console.WriteLine(multiplyByFive(10)); // 100 ‚Äî –∑–∞—Ö–æ–ø–ª–µ–Ω–∞ –∑–º—ñ–Ω–Ω–∞!
```

#### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º?

–ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä —Å—Ç–≤–æ—Ä—é—î –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –∫–ª–∞—Å (display class) –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∑–∞—Ö–æ–ø–ª–µ–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö.

1.  **–õ–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ**: –ü–µ—Ä–µ–Ω–æ—Å—è—Ç—å—Å—è –≤ –ø–æ–ª—è generated –∫–ª–∞—Å—É.
2.  **`this`**: –Ø–∫—â–æ –ª—è–º–±–¥–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —á–ª–µ–Ω–∏ –∫–ª–∞—Å—É, –≤–æ–Ω–∞ –∑–∞—Ö–æ–ø–ª—é—î `this`, —â–æ –º–æ–∂–µ –ø–æ–¥–æ–≤–∂–∏—Ç–∏ –∂–∏—Ç—Ç—è –≤—Å—å–æ–≥–æ –æ–±'—î–∫—Ç–∞.

```csharp [CompilerGenerated.cs] showLineNumbers
// –í–∞—à –∫–æ–¥:
class Calculator
{
    int _base = 10;

    public Func<int, int> GetMultiplier(int factor)
    {
        return x => x * factor + _base;
    }
}

// –©–æ –≥–µ–Ω–µ—Ä—É—î –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä (—Å–ø—Ä–æ—â–µ–Ω–æ):
class Calculator
{
    int _base = 10;

    // Display Class –¥–ª—è –º–µ—Ç–æ–¥—É GetMultiplier
    sealed class <>c__DisplayClass0_0
    {
        public int factor;       // –ó–∞—Ö–æ–ø–ª–µ–Ω–∏–π –ª–æ–∫–∞–ª—å–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä
        public Calculator <>4__this; // –ó–∞—Ö–æ–ø–ª–µ–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–∏–π –æ–±'—î–∫—Ç

        public int <GetMultiplier>b__0(int x)
        {
            // –î–æ—Å—Ç—É–ø –¥–æ _base —á–µ—Ä–µ–∑ –∑–∞—Ö–æ–ø–ª–µ–Ω–∏–π this
            return x * factor + <>4__this._base;
        }
    }

    public Func<int, int> GetMultiplier(int factor)
    {
        var closure = new <>c__DisplayClass0_0();
        closure.factor = factor;
        closure.<>4__this = this; // –£–í–ê–ì–ê: Calculator –Ω–µ –±—É–¥–µ –∑—ñ–±—Ä–∞–Ω–∏–π GC, –ø–æ–∫–∏ –∂–∏–≤–µ –¥–µ–ª–µ–≥–∞—Ç!

        return new Func<int, int>(closure.<GetMultiplier>b__0);
    }
}
```

::warning
**Performance Impact**: –ö–æ–∂–Ω–µ –∑–∞–º–∏–∫–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç —É –∫—É—á—ñ (heap allocation). –£ –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏—Ö —Ü–∏–∫–ª–∞—Ö (hot paths) —Ü–µ —Å—Ç–≤–æ—Ä—é—î —Ç–∏—Å–∫ –Ω–∞ GC.
::

#### –ü–∞—Å—Ç–∫–∞ –∑–º—ñ–Ω–Ω–æ—ó —Ü–∏–∫–ª—É (The Loop Variable Trap)

–î–æ C# 5.0 –∑–º—ñ–Ω–Ω–∞ —Ü–∏–∫–ª—É `foreach` –æ–≥–æ–ª–æ—à—É–≤–∞–ª–∞—Å—è **–∑–æ–≤–Ω—ñ** —Ü–∏–∫–ª—É. –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏–ª–æ –¥–æ —Ç–æ–≥–æ, —â–æ –≤—Å—ñ –ª—è–º–±–¥–∏ –∑–∞—Ö–æ–ø–ª—é–≤–∞–ª–∏ **–æ–¥–Ω—É –π —Ç—É –∂ –∑–º—ñ–Ω–Ω—É**.

```csharp
var actions = new List<Action>();
for (int i = 0; i < 3; i++) // 'i' –æ–¥–Ω–∞ –Ω–∞ –≤–µ—Å—å —Ü–∏–∫–ª
{
    actions.Add(() => Console.WriteLine(i));
}

foreach (var a in actions) a();
// –í–∏–≤–µ–¥–µ: 3, 3, 3 (–∑–Ω–∞—á–µ–Ω–Ω—è i –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü–∏–∫–ª—É)
```

**–ß–æ–º—É —Ç–∞–∫?**
–ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä —Å—Ç–≤–æ—Ä—é—î **–æ–¥–∏–Ω** –µ–∫–∑–µ–º–ø–ª—è—Ä display class _–ø–µ—Ä–µ–¥_ —Ü–∏–∫–ª–æ–º, —ñ –≤ —Ü–∏–∫–ª—ñ –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–ª—é—î –π–æ–≥–æ –ø–æ–ª–µ. –í—Å—ñ –¥–µ–ª–µ–≥–∞—Ç–∏ –ø–æ—Å–∏–ª–∞—é—Ç—å—Å—è –Ω–∞ —Ü–µ–π —î–¥–∏–Ω–∏–π –æ–±'—î–∫—Ç.

**–†—ñ—à–µ–Ω–Ω—è**: –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—É –∫–æ–ø—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –±–ª–æ–∫—É —Ü–∏–∫–ª—É.

```csharp
for (int i = 0; i < 3; i++)
{
    int copy = i; // –ù–æ–≤–∞ –∑–º—ñ–Ω–Ω–∞ –Ω–∞ –∫–æ–∂–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó -> –Ω–æ–≤–∏–π display class
    actions.Add(() => Console.WriteLine(copy));
}
```

::note
–ü–æ—á–∏–Ω–∞—é—á–∏ –∑ C# 5.0, `foreach` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É –∑–º—ñ–Ω–Ω—É –Ω–∞ –∫–æ–∂–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó, —Ç–æ–º—É —Ç–∞–º —Ü—è –ø—Ä–æ–±–ª–µ–º–∞ –∑–Ω–∏–∫–ª–∞. –ê–ª–µ –¥–ª—è `for` –≤–æ–Ω–∞ –≤—Å–µ —â–µ –∞–∫—Ç—É–∞–ª—å–Ω–∞!
::

#### –û–±–º–µ–∂–µ–Ω–Ω—è (Limitations)

–õ—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏ **–Ω–µ –º–æ–∂—É—Ç—å** –∑–∞—Ö–æ–ø–ª—é–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ `ref`, `out` –∞–±–æ `in`.
**–ü—Ä–∏—á–∏–Ω–∞**: –¶—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∂–∏–≤—É—Ç—å –Ω–∞ —Å—Ç–µ–∫—É (–∞–±–æ —î –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –Ω–∞ —Å—Ç–µ–∫). Display class —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤ –∫—É—á—ñ (heap). –ü–æ—Å–∏–ª–∞–Ω–Ω—è –∑ –∫—É—á—ñ –Ω–∞ —Å—Ç–µ–∫ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ –≤ .NET –∑–∞—Ä–∞–¥–∏ –±–µ–∑–ø–µ–∫–∏ –ø–∞–º'—è—Ç—ñ (—â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ–≥–æ —Ñ—Ä–µ–π–º—É —Å—Ç–µ–∫—É).

```csharp
void TryCapture(ref int x)
{
    // –ü–æ–º–∏–ª–∫–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó CS1628: Cannot use ref, out, or in parameter inside an anonymous method
    Action act = () => Console.WriteLine(x);
}
```

### Attributes on Lambdas (C# 10+)

–ü–æ—á–∏–Ω–∞—é—á–∏ –∑ C# 10, –º–æ–∂–Ω–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç–∏ –¥–æ –ª—è–º–±–¥–∞-–≤–∏—Ä–∞–∑—ñ–≤:

```csharp [LambdaAttributes.cs] showLineNumbers
var parse = [return: NotNull] (string s) => int.Parse(s);

Func<string, int> parseWithAttribute =
    [Obsolete("Use TryParse instead")]
    (string s) => int.Parse(s);
```

### Expression Trees (–î–µ—Ä–µ–≤–∞ –í–∏—Ä–∞–∑—ñ–≤)

–õ—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω—ñ –Ω–∞ **–¥–µ—Ä–µ–≤–∞ –≤–∏—Ä–∞–∑—ñ–≤** (`Expression<TDelegate>`), —â–æ –¥–æ–∑–≤–æ–ª—è—î –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —ó—Ö —è–∫ –¥–∞–Ω—ñ:

```csharp [ExpressionTree.cs] showLineNumbers
Expression<Func<int, int>> expression = x => x * x;

Console.WriteLine(expression); // x => (x * x)
```

::note
**–î–µ —Ü–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è?**: LINQ to Entities, Entity Framework, Dapper —Ç–∞ —ñ–Ω—à—ñ ORM –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –¥–µ—Ä–µ–≤–∞ –≤–∏—Ä–∞–∑—ñ–≤ –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è C# –≤–∏—Ä–∞–∑—ñ–≤ —É SQL –∑–∞–ø–∏—Ç–∏.
::

## –ü–æ–¥—ñ—ó (Events)

**–ü–æ–¥—ñ—ó (Events)** ‚Äî —Ü–µ –º–µ—Ö–∞–Ω—ñ–∑–º, —â–æ –¥–æ–∑–≤–æ–ª—è—î –æ–±'—î–∫—Ç–∞–º –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ —ñ–Ω—à—ñ –æ–±'—î–∫—Ç–∏ –ø—Ä–æ –∑–º—ñ–Ω–∏ —Å—Ç–∞–Ω—É –∞–±–æ –≤–∞–∂–ª–∏–≤—ñ –ø–æ–¥—ñ—ó. –í–æ–Ω–∏ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ **Publisher-Subscriber pattern** (–ø–∞—Ç—Ç–µ—Ä–Ω "–í–∏–¥–∞–≤–µ—Ü—å-–ü—ñ–¥–ø–∏—Å–Ω–∏–∫").

### Publisher-Subscriber Pattern

::mermaid

```mermaid
sequenceDiagram
    participant P as Publisher (Button)
    participant S1 as Subscriber 1 (Logger)
    participant S2 as Subscriber 2 (UI Updater)

    S1->>P: Subscribe to Click event
    S2->>P: Subscribe to Click event

    Note over P: User clicks button
    P->>P: Raise Click event

    P->>S1: Invoke OnClick()
    S1-->>P: Log action

    P->>S2: Invoke OnClick()
    S2-->>P: Update UI

    Note over P,S2: Event processing complete
```

::

### –û–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ç–∞ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ü–æ–¥—ñ–π

```csharp [EventBasicExample.cs] showLineNumbers {5,11,17,22}
// 1. –û–≥–æ–ª–æ—Å–∏—Ç–∏ –¥–µ–ª–µ–≥–∞—Ç –¥–ª—è –ø–æ–¥—ñ—ó
public delegate void NotifyEventHandler(string message);

// –ö–ª–∞—Å-–≤–∏–¥–∞–≤–µ—Ü—å
public class FileProcessor
{
    // 2. –û–≥–æ–ª–æ—Å–∏—Ç–∏ –ø–æ–¥—ñ—é –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–ª—é—á–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞ event
    public event NotifyEventHandler? FileProcessed;

    public void ProcessFile(string filename)
    {
        Console.WriteLine($"–û–±—Ä–æ–±–∫–∞ —Ñ–∞–π–ª—É: {filename}");

        // –°–∏–º—É–ª—è—Ü—ñ—è –æ–±—Ä–æ–±–∫–∏...

        // 3. –í–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ–¥—ñ—é (raising event)
        FileProcessed?.Invoke($"–§–∞–π–ª {filename} –æ–±—Ä–æ–±–ª–µ–Ω–æ");
    }
}

// –ö–ª–∞—Å-–ø—ñ–¥–ø–∏—Å–Ω–∏–∫
public class Logger
{
    public void OnFileProcessed(string message)
    {
        Console.WriteLine($"[LOG] {message}");
    }
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
class Program
{
    static void Main()
    {
        var processor = new FileProcessor();
        var logger = new Logger();

        // 4. –ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –ø–æ–¥—ñ—é
        processor.FileProcessed += logger.OnFileProcessed;

        processor.ProcessFile("data.txt");
        // –í–∏–≤–µ–¥–µ:
        // –û–±—Ä–æ–±–∫–∞ —Ñ–∞–π–ª—É: data.txt
        // [LOG] –§–∞–π–ª data.txt –æ–±—Ä–æ–±–ª–µ–Ω–æ
    }
}
```

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π Event Pattern

.NET –º–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–æ–¥—ñ–π: –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `EventHandler` –¥–µ–ª–µ–≥–∞—Ç–∞ —Ç–∞ `EventArgs`:

```csharp [StandardEventPattern.cs] showLineNumbers
// –í–ª–∞—Å–Ω–∏–π –∫–ª–∞—Å –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ –ø–æ–¥—ñ—ó
public class FileProcessedEventArgs : EventArgs
{
    public string FileName { get; }
    public long FileSize { get; }

    public FileProcessedEventArgs(string fileName, long fileSize)
    {
        FileName = fileName;
        FileSize = fileSize;
    }
}

// –ö–ª–∞—Å-–≤–∏–¥–∞–≤–µ—Ü—å
public class FileProcessor
{
    // –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è EventHandler<T>
    public event EventHandler<FileProcessedEventArgs>? FileProcessed;

    public void ProcessFile(string filename)
    {
        Console.WriteLine($"–û–±—Ä–æ–±–∫–∞ —Ñ–∞–π–ª—É: {filename}");

        long fileSize = 1024; // –°–∏–º—É–ª—è—Ü—ñ—è

        // –í–∏–∫–ª–∏–∫ –ø–æ–¥—ñ—ó –∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
        OnFileProcessed(new FileProcessedEventArgs(filename, fileSize));
    }

    // Protected virtual –º–µ—Ç–æ–¥ –¥–ª—è –≤–∏–∫–ª–∏–∫—É –ø–æ–¥—ñ—ó (best practice)
    protected virtual void OnFileProcessed(FileProcessedEventArgs e)
    {
        FileProcessed?.Invoke(this, e);
    }
}

// –ü—ñ–¥–ø–∏—Å–Ω–∏–∫
class Program
{
    static void Main()
    {
        var processor = new FileProcessor();

        // –ü—ñ–¥–ø–∏—Å–∫–∞ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –ª—è–º–±–¥–∞-–≤–∏—Ä–∞–∑—É
        processor.FileProcessed += (sender, e) =>
        {
            Console.WriteLine($"–û–±—Ä–æ–±–ª–µ–Ω–æ: {e.FileName} ({e.FileSize} bytes)");
        };

        processor.ProcessFile("document.pdf");
        // –í–∏–≤–µ–¥–µ:
        // –û–±—Ä–æ–±–∫–∞ —Ñ–∞–π–ª—É: document.pdf
        // –û–±—Ä–æ–±–ª–µ–Ω–æ: document.pdf (1024 bytes)
    }
}
```

::tip
**Best Practice**: –ó–∞–≤–∂–¥–∏ —Å—Ç–≤–æ—Ä—é–π—Ç–µ `protected virtual` –º–µ—Ç–æ–¥ `OnEventName` –¥–ª—è –≤–∏–∫–ª–∏–∫—É –ø–æ–¥—ñ—ó. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –ø–æ—Ö—ñ–¥–Ω–∏–º –∫–ª–∞—Å–∞–º –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∞—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫—É –ø–æ–¥—ñ—ó.
::

::tip
**Best Practice**: –ó–∞–≤–∂–¥–∏ —Å—Ç–≤–æ—Ä—é–π—Ç–µ `protected virtual` –º–µ—Ç–æ–¥ `OnEventName` –¥–ª—è –≤–∏–∫–ª–∏–∫—É –ø–æ–¥—ñ—ó. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –ø–æ—Ö—ñ–¥–Ω–∏–º –∫–ª–∞—Å–∞–º –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∞—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫—É –ø–æ–¥—ñ—ó.
::

### Field-like vs Explicit Events

–£ C# —î –¥–≤–∞ —Å–ø–æ—Å–æ–±–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø–æ–¥—ñ–π:

1.  **Field-like events** (—Å–∫–æ—Ä–æ—á–µ–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å):

    ```csharp
    public event EventHandler Click;
    ```

    –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î –ø—Ä–∏–≤–∞—Ç–Ω–µ –ø–æ–ª–µ-–¥–µ–ª–µ–≥–∞—Ç —ñ –º–µ—Ç–æ–¥–∏ `add`/`remove`.

2.  **Explicit events** (—Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å):
    –í–∏ —Å–∞–º—ñ –∫–µ—Ä—É—î—Ç–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è–º –¥–µ–ª–µ–≥–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `EventHandlerList` –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –ø–∞–º'—è—Ç—ñ, —è–∫—â–æ –ø–æ–¥—ñ–π –¥—É–∂–µ –±–∞–≥–∞—Ç–æ, –∞ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –º–∞–ª–æ).

### –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å (Thread Safety)

Field-like –ø–æ–¥—ñ—ó —î –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –≥–µ–Ω–µ—Ä—É—î –º–µ—Ç–æ–¥–∏ `add` —Ç–∞ `remove` –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º `Interlocked.CompareExchange`.

–û—Å—å —è–∫ –≤–∏–≥–ª—è–¥–∞—î –∫–æ–¥, —è–∫–∏–π –≥–µ–Ω–µ—Ä—É—î –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –¥–ª—è `add`:

```csharp
public void add_Click(EventHandler value)
{
    EventHandler loop, current = this.Click;
    do
    {
        loop = current;
        // –û–±'—î–¥–Ω—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∑ –Ω–æ–≤–∏–º –¥–µ–ª–µ–≥–∞—Ç–æ–º
        EventHandler combined = (EventHandler)Delegate.Combine(loop, value);
        // –ê—Ç–æ–º–∞—Ä–Ω–æ –∑–∞–º—ñ–Ω—é—î–º–æ —Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–æ–≤–∏–º, —è–∫—â–æ –Ω—ñ—Ö—Ç–æ –Ω–µ –≤—Å—Ç–∏–≥ –∑–º—ñ–Ω–∏—Ç–∏ –π–æ–≥–æ
        current = Interlocked.CompareExchange(ref this.Click, combined, loop);
    }
    while (current != loop); // –Ø–∫—â–æ –ø—ñ–¥ —á–∞—Å –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø–æ–ª–µ –∑–º—ñ–Ω–∏–ª–æ—Å—è ‚Äî –ø–æ–≤—Ç–æ—Ä—é—î–º–æ
}
```

–¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ —è–∫—â–æ –¥–≤–∞ –ø–æ—Ç–æ–∫–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –ø—ñ–¥–ø–∏—Å—É—é—Ç—å—Å—è, –∂–æ–¥–Ω–∞ –ø—ñ–¥–ø–∏—Å–∫–∞ –Ω–µ –∑–∞–≥—É–±–∏—Ç—å—Å—è.

::warning
**–í–∞–∂–ª–∏–≤–æ**: –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å —Å—Ç–æ—Å—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ **–ø—ñ–¥–ø–∏—Å–∫–∏/–≤—ñ–¥–ø–∏—Å–∫–∏**. –°–∞–º **–≤–∏–∫–ª–∏–∫** –ø–æ–¥—ñ—ó –Ω–µ —î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±–µ–∑–ø–µ—á–Ω–∏–º.
–Ø–∫—â–æ –ø–æ—Ç—ñ–∫ –ê –ø–µ—Ä–µ–≤—ñ—Ä–∏–≤ `Click != null`, –∞ –ø–æ—Ç—ñ–∫ –ë –≤ —Ü–µ–π –º–æ–º–µ–Ω—Ç –≤—ñ–¥–ø–∏—Å–∞–≤ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫–∞ (–∑—Ä–æ–±–∏–≤—à–∏ `Click` null), —Ç–æ –ø–æ—Ç—ñ–∫ –ê –≤–ø–∞–¥–µ –∑ `NullReferenceException`.
**–†—ñ—à–µ–Ω–Ω—è**: `Click?.Invoke(...)` –∞–±–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤ –ª–æ–∫–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É `var handler = Click; handler(...)`.
::

### –í–∏—Ç–æ–∫–∏ –ø–∞–º'—è—Ç—ñ (Memory Leaks) —Ç–∞ Weak Events

–¢–∏–ø–æ–≤–∞ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–¥—ñ–π ‚Äî **Lapsed Listener Problem**.
–Ø–∫—â–æ –¥–æ–≤–≥–æ–∂–∏–≤—É—á–∏–π –æ–±'—î–∫—Ç (Publisher) –º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—á–∏–π –æ–±'—î–∫—Ç (Subscriber) —á–µ—Ä–µ–∑ –ø–æ–¥—ñ—é, —Ç–æ Subscriber **–Ω–µ –±—É–¥–µ –∑—ñ–±—Ä–∞–Ω–∏–π GC**, –ø–æ–∫–∏ –∂–∏–≤–µ Publisher.

**–†—ñ—à–µ–Ω–Ω—è**:

1.  –Ø–≤–Ω–∞ –≤—ñ–¥–ø–∏—Å–∫–∞ (`-=`) —É `Dispose()`.
2.  –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **Weak Events** (—Å–ª–∞–±–∫–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å). –¶–µ –¥–æ–∑–≤–æ–ª—è—î GC –∑–±–∏—Ä–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫–∞, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤—ñ–Ω –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –Ω–∞ –ø–æ–¥—ñ—é. –£ —Å—É—á–∞—Å–Ω–æ–º—É .NET —Ü–µ —á–∞—Å—Ç–æ —Ä–µ–∞–ª—ñ–∑—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `WeakReference` –∞–±–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `WeakEventManager` —É WPF).

### Custom Event Accessors

–Ü–Ω–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–µ–Ω –±—ñ–ª—å—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—ñ–¥–ø–∏—Å–∫–æ—é/–≤—ñ–¥–ø–∏—Å–∫–æ—é:

```csharp [CustomEventAccessors.cs] showLineNumbers
public class Button
{
    private EventHandler? _click;

    public event EventHandler Click
    {
        add
        {
            Console.WriteLine("–ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ Click");
            _click += value;
        }
        remove
        {
            Console.WriteLine("–í—ñ–¥–ø–∏—Å–∫–∞ –≤—ñ–¥ Click");
            _click -= value;
        }
    }

    public void SimulateClick()
    {
        _click?.Invoke(this, EventArgs.Empty);
    }
}
```

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ü—Ä–∏–∫–ª–∞–¥–∏

### –ü—Ä–∏–∫–ª–∞–¥ 1: –°–∏—Å—Ç–µ–º–∞ –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

::code-tree

```csharp [Program.cs] showLineNumbers
using System;

var logger = new Logger();

// –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ä—ñ–∑–Ω—ñ —Ä—ñ–≤–Ω—ñ –ª–æ–≥—É–≤–∞–Ω–Ω—è
logger.InfoLogged += msg => Console.WriteLine($"‚ÑπÔ∏è  {msg}");
logger.WarningLogged += msg => Console.WriteLine($"‚ö†Ô∏è  {msg}");
logger.ErrorLogged += msg => Console.WriteLine($"‚ùå {msg}");

logger.LogInfo("–î–æ–¥–∞—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω–æ");
logger.LogWarning("–ù–∏–∑—å–∫–∏–π —Ä—ñ–≤–µ–Ω—å –ø–∞–º'—è—Ç—ñ");
logger.LogError("–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –ë–î");
```

```csharp [Logger.cs] showLineNumbers
public class Logger
{
    public event Action<string>? InfoLogged;
    public event Action<string>? WarningLogged;
    public event Action<string>? ErrorLogged;

    public void LogInfo(string message)
    {
        InfoLogged?.Invoke(message);
    }

    public void LogWarning(string message)
    {
        WarningLogged?.Invoke(message);
    }

    public void LogError(string message)
    {
        ErrorLogged?.Invoke(message);
    }
}
```

::

### –ü—Ä–∏–∫–ª–∞–¥ 2: Calculator –∑ —Ä—ñ–∑–Ω–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏

```csharp [DelegateCalculator.cs] showLineNumbers
public class Calculator
{
    public int Execute(int a, int b, Func<int, int, int> operation)
    {
        return operation(a, b);
    }
}

class Program
{
    static void Main()
    {
        var calc = new Calculator();

        // –†—ñ–∑–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —è–∫ –¥–µ–ª–µ–≥–∞—Ç–∏
        Func<int, int, int> add = (x, y) => x + y;
        Func<int, int, int> subtract = (x, y) => x - y;
        Func<int, int, int> multiply = (x, y) => x * y;

        Console.WriteLine(calc.Execute(10, 5, add));      // 15
        Console.WriteLine(calc.Execute(10, 5, subtract)); // 5
        Console.WriteLine(calc.Execute(10, 5, multiply)); // 50

        // –í–ª–∞—Å–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è
        Console.WriteLine(calc.Execute(10, 5, (x, y) => x % y)); // 0
    }
}
```

### –ü—Ä–∏–∫–ª–∞–¥ 3: Observer Pattern –∑ Events

```csharp [ObserverPattern.cs] showLineNumbers
// Subject (Observable)
public class Stock
{
    private decimal _price;

    public string Symbol { get; }
    public decimal Price
    {
        get => _price;
        set
        {
            if (_price != value)
            {
                _price = value;
                OnPriceChanged(new PriceChangedEventArgs(_price));
            }
        }
    }

    public event EventHandler<PriceChangedEventArgs>? PriceChanged;

    public Stock(string symbol, decimal initialPrice)
    {
        Symbol = symbol;
        _price = initialPrice;
    }

    protected virtual void OnPriceChanged(PriceChangedEventArgs e)
    {
        PriceChanged?.Invoke(this, e);
    }
}

public class PriceChangedEventArgs : EventArgs
{
    public decimal NewPrice { get; }

    public PriceChangedEventArgs(decimal newPrice)
    {
        NewPrice = newPrice;
    }
}

// Observer
public class StockMonitor
{
    public void Subscribe(Stock stock)
    {
        stock.PriceChanged += OnPriceChanged;
    }

    private void OnPriceChanged(object? sender, PriceChangedEventArgs e)
    {
        if (sender is Stock stock)
        {
            Console.WriteLine($"{stock.Symbol}: {e.NewPrice:C}");
        }
    }
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
class Program
{
    static void Main()
    {
        var appleStock = new Stock("AAPL", 150.00m);
        var monitor = new StockMonitor();

        monitor.Subscribe(appleStock);

        appleStock.Price = 155.50m; // AAPL: $155.50
        appleStock.Price = 160.00m; // AAPL: $160.00
    }
}
```

## Troubleshooting (–¢–∏–ø–æ–≤—ñ –ü—Ä–æ–±–ª–µ–º–∏)

### 1. NullReferenceException –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É –¥–µ–ª–µ–≥–∞—Ç–∞

::warning
**–ü—Ä–æ–±–ª–µ–º–∞**:

```csharp
Action myAction = null;
myAction(); // ‚ùå NullReferenceException
```

**–†—ñ—à–µ–Ω–Ω—è**:

```csharp
// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è null-conditional operator
myAction?.Invoke();

// –ê–±–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º
if (myAction != null)
{
    myAction();
}
```

::

### 2. Memory Leak —á–µ—Ä–µ–∑ –ø–æ–¥—ñ—ó

::caution
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ–¥—ñ—ó —Å—Ç–≤–æ—Ä—é—î —Å–∏–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —â–æ –∑–∞–ø–æ–±—ñ–≥–∞—î –∑–±–æ—Ä—É –ø–∞–º'—è—Ç—ñ:

```csharp
public class LongLivedPublisher
{
    public event EventHandler? SomeEvent;
}

public class ShortLivedSubscriber
{
    public ShortLivedSubscriber(LongLivedPublisher publisher)
    {
        publisher.SomeEvent += OnSomeEvent;
        // ‚ùå –ü—ñ–¥–ø–∏—Å–Ω–∏–∫ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–≤—ñ–ª—å–Ω–∏—Ç—å—Å—è!
    }

    private void OnSomeEvent(object? sender, EventArgs e) { }
}
```

**–†—ñ—à–µ–Ω–Ω—è**: –ó–∞–≤–∂–¥–∏ –≤—ñ–¥–ø–∏—Å—É–π—Ç–µ—Å—å –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ weak events:

```csharp
public class ShortLivedSubscriber : IDisposable
{
    private readonly LongLivedPublisher _publisher;

    public ShortLivedSubscriber(LongLivedPublisher publisher)
    {
        _publisher = publisher;
        _publisher.SomeEvent += OnSomeEvent;
    }

    public void Dispose()
    {
        _publisher.SomeEvent -= OnSomeEvent;
    }

    private void OnSomeEvent(object? sender, EventArgs e) { }
}
```

::

### 3. –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –∑–º—ñ–Ω–Ω–æ—ó —Ü–∏–∫–ª—É (Loop Variable Capture)

::warning
**–ü—Ä–æ–±–ª–µ–º–∞**:

```csharp
var actions = new List<Action>();

for (int i = 0; i < 5; i++)
{
    actions.Add(() => Console.WriteLine(i));
}

actions[0](); // 5, –∞ –Ω–µ 0!
actions[4](); // 5
```

**–†—ñ—à–µ–Ω–Ω—è**:

```csharp
for (int i = 0; i < 5; i++)
{
    int localI = i; // –õ–æ–∫–∞–ª—å–Ω–∞ –∫–æ–ø—ñ—è
    actions.Add(() => Console.WriteLine(localI));
}

actions[0](); // 0
actions[4](); // 4
```

::

### 4. Multicast Delegate –∑ Return Value

::note
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ multicast –¥–µ–ª–µ–≥–∞—Ç—ñ —Ç—ñ–ª—å–∫–∏ **–æ—Å—Ç–∞–Ω–Ω—î** –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è:

```csharp
Func<int> getNumber = () => 1;
getNumber += () => 2;
getNumber += () => 3;

int result = getNumber(); // result = 3 (—Ç—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π!)
```

**–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –≤—Å—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏**:

```csharp
Func<int> getNumber = () => 1;
getNumber += () => 2;
getNumber += () => 3;

var results = new List<int>();
foreach (Func<int> func in getNumber.GetInvocationList())
{
    results.Add(func());
}

Console.WriteLine(string.Join(", ", results)); // 1, 2, 3
```

::

## –ü—Ä–∞–∫—Ç–∏–∫–∞ (Practice Tasks)

### –†—ñ–≤–µ–Ω—å 1: –ü–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å

::collapsible{title="–ó–∞–≤–¥–∞–Ω–Ω—è 1.1: –ë–∞–∑–æ–≤–∏–π –¥–µ–ª–µ–≥–∞—Ç"}

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –°—Ç–≤–æ—Ä—ñ—Ç—å –¥–µ–ª–µ–≥–∞—Ç `MathOperation`, —è–∫–∏–π –ø—Ä–∏–π–º–∞—î –¥–≤–∞ `int` —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î `int`. –ù–∞–ø–∏—à—ñ—Ç—å –º–µ—Ç–æ–¥–∏ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è, –≤—ñ–¥–Ω—ñ–º–∞–Ω–Ω—è —Ç–∞ –º–Ω–æ–∂–µ–Ω–Ω—è. –í–∏–∫–ª–∏—á—Ç–µ —ó—Ö —á–µ—Ä–µ–∑ –¥–µ–ª–µ–≥–∞—Ç.

**–†—ñ—à–µ–Ω–Ω—è**:

```csharp
delegate int MathOperation(int a, int b);

class Program
{
    static int Add(int a, int b) => a + b;
    static int Subtract(int a, int b) => a - b;
    static int Multiply(int a, int b) => a * b;

    static void Main()
    {
        MathOperation op;

        op = Add;
        Console.WriteLine($"10 + 5 = {op(10, 5)}"); // 15

        op = Subtract;
        Console.WriteLine($"10 - 5 = {op(10, 5)}"); // 5

        op = Multiply;
        Console.WriteLine($"10 * 5 = {op(10, 5)}"); // 50
    }
}
```

::

::collapsible{title="–ó–∞–≤–¥–∞–Ω–Ω—è 1.2: Action —Ç–∞ Func"}

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ `Action<string>` –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∞ `Func<int, int, int>` –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –º–∞–∫—Å–∏–º—É–º—É –¥–≤–æ—Ö —á–∏—Å–µ–ª.

**–†—ñ—à–µ–Ω–Ω—è**:

```csharp
class Program
{
    static void Main()
    {
        // Action –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è
        Action<string> print = msg => Console.WriteLine($">> {msg}");
        print("–ü—Ä–∏–≤—ñ—Ç, —Å–≤—ñ—Ç!");

        // Func –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –º–∞–∫—Å–∏–º—É–º—É
        Func<int, int, int> max = (a, b) => a > b ? a : b;
        Console.WriteLine($"–ú–∞–∫—Å–∏–º—É–º –∑ 10 —Ç–∞ 20: {max(10, 20)}"); // 20
    }
}
```

::

### –†—ñ–≤–µ–Ω—å 2: –°–µ—Ä–µ–¥–Ω—ñ–π

::collapsible{title="–ó–∞–≤–¥–∞–Ω–Ω—è 2.1: Temperature Monitor"}

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–ª–∞—Å `TemperatureMonitor` –∑ –ø–æ–¥—ñ—î—é `TemperatureChanged`. –ö–æ–ª–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–µ—Ä–µ–≤–∏—â—É—î 30¬∞C, –≤–∏–∫–ª–∏–∫–∞–π—Ç–µ –ø–æ–¥—ñ—é. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø—ñ–¥–ø–∏—Å–Ω–∏–∫–∞, —è–∫–∏–π –≤–∏–≤–æ–¥–∏—Ç—å –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è.

**–†—ñ—à–µ–Ω–Ω—è**:

```csharp
public class TemperatureChangedEventArgs : EventArgs
{
    public double Temperature { get; }

    public TemperatureChangedEventArgs(double temperature)
    {
        Temperature = temperature;
    }
}

public class TemperatureMonitor
{
    private double _temperature;

    public event EventHandler<TemperatureChangedEventArgs>? TemperatureChanged;

    public double Temperature
    {
        get => _temperature;
        set
        {
            _temperature = value;
            if (_temperature > 30)
            {
                OnTemperatureChanged(new TemperatureChangedEventArgs(_temperature));
            }
        }
    }

    protected virtual void OnTemperatureChanged(TemperatureChangedEventArgs e)
    {
        TemperatureChanged?.Invoke(this, e);
    }
}

class Program
{
    static void Main()
    {
        var monitor = new TemperatureMonitor();

        monitor.TemperatureChanged += (sender, e) =>
        {
            Console.WriteLine($"‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è! –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {e.Temperature}¬∞C");
        };

        monitor.Temperature = 25; // –ù—ñ—á–æ–≥–æ
        monitor.Temperature = 35; // ‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è! –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 35¬∞C
    }
}
```

::

::collapsible{title="–ó–∞–≤–¥–∞–Ω–Ω—è 2.2: Multicast Logger"}

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –°—Ç–≤–æ—Ä—ñ—Ç—å —Å–∏—Å—Ç–µ–º—É –ª–æ–≥—É–≤–∞–Ω–Ω—è, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î multicast –¥–µ–ª–µ–≥–∞—Ç –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –≤ –∫–æ–Ω—Å–æ–ª—å —Ç–∞ "—Ñ–∞–π–ª" (–ø—Ä–æ—Å—Ç–æ —ñ–Ω—à–∏–π Console.WriteLine –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º [FILE]).

**–†—ñ—à–µ–Ω–Ω—è**:

```csharp
delegate void LogHandler(string message);

class Program
{
    static void ConsoleLog(string msg)
        => Console.WriteLine($"[CONSOLE] {msg}");

    static void FileLog(string msg)
        => Console.WriteLine($"[FILE] {msg}");

    static void Main()
    {
        LogHandler logger = ConsoleLog;
        logger += FileLog;

        logger("–°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞");
        // –í–∏–≤–µ–¥–µ:
        // [CONSOLE] –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
        // [FILE] –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞

        logger -= ConsoleLog;
        logger("–¢—ñ–ª—å–∫–∏ —É —Ñ–∞–π–ª");
        // –í–∏–≤–µ–¥–µ:
        // [FILE] –¢—ñ–ª—å–∫–∏ —É —Ñ–∞–π–ª
    }
}
```

::

### –†—ñ–≤–µ–Ω—å 3: –ü—Ä–æ—Å—É–Ω—É—Ç–∏–π

::collapsible{title="–ó–∞–≤–¥–∞–Ω–Ω—è 3.1: Custom Event Accessors"}

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–ª–∞—Å `Button` –∑ –ø–æ–¥—ñ—î—é `Click`, —è–∫–∞ –º–∞—î custom accessors. –õ—ñ—á–∏–ª—å–Ω–∏–∫ –ø—ñ–¥–ø–∏—Å–æ–∫ –º–∞—î –æ–±–º–µ–∂—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –¥–æ 3. –ü—Ä–∏ —Å–ø—Ä–æ–±—ñ –ø—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è –≤—á–µ—Ç–≤–µ—Ä—Ç–µ ‚Äî –≤–∏–∫–∏–¥–∞—Ç–∏ –≤–∏–Ω—è—Ç–æ–∫.

**–†—ñ—à–µ–Ω–Ω—è**:

```csharp
public class Button
{
    private EventHandler? _click;
    private int _subscriberCount = 0;
    private const int MaxSubscribers = 3;

    public event EventHandler Click
    {
        add
        {
            if (_subscriberCount >= MaxSubscribers)
            {
                throw new InvalidOperationException(
                    $"–ú–∞–∫—Å–∏–º—É–º {MaxSubscribers} –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –¥–æ–∑–≤–æ–ª–µ–Ω–æ");
            }
            _click += value;
            _subscriberCount++;
            Console.WriteLine($"–ü—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤: {_subscriberCount}");
        }
        remove
        {
            _click -= value;
            _subscriberCount--;
            Console.WriteLine($"–ü—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤: {_subscriberCount}");
        }
    }

    public void SimulateClick()
    {
        _click?.Invoke(this, EventArgs.Empty);
    }
}

class Program
{
    static void Main()
    {
        var button = new Button();

        EventHandler handler1 = (s, e) => Console.WriteLine("Handler 1");
        EventHandler handler2 = (s, e) => Console.WriteLine("Handler 2");
        EventHandler handler3 = (s, e) => Console.WriteLine("Handler 3");
        EventHandler handler4 = (s, e) => Console.WriteLine("Handler 4");

        button.Click += handler1; // –ü—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤: 1
        button.Click += handler2; // –ü—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤: 2
        button.Click += handler3; // –ü—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤: 3

        try
        {
            button.Click += handler4; // ‚ùå Exception
        }
        catch (InvalidOperationException ex)
        {
            Console.WriteLine($"–ü–æ–º–∏–ª–∫–∞: {ex.Message}");
        }

        button.SimulateClick();
        // Handler 1
        // Handler 2
        // Handler 3
    }
}
```

::

::collapsible{title="–ó–∞–≤–¥–∞–Ω–Ω—è 3.2: LINQ-–ø–æ–¥—ñ–±–Ω–∏–π Filter –∑ Predicate"}

**–ó–∞–≤–¥–∞–Ω–Ω—è**: –°—Ç–≤–æ—Ä—ñ—Ç—å –º–µ—Ç–æ–¥ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è `Filter<T>` –¥–ª—è `IEnumerable<T>`, —è–∫–∏–π –ø—Ä–∏–π–º–∞—î `Predicate<T>` —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏.

**–†—ñ—à–µ–Ω–Ω—è**:

```csharp
public static class EnumerableExtensions
{
    public static IEnumerable<T> Filter<T>(this IEnumerable<T> source, Predicate<T> predicate)
    {
        foreach (var item in source)
        {
            if (predicate(item))
            {
                yield return item;
            }
        }
    }
}

class Program
{
    static void Main()
    {
        var numbers = new[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };

        // –§—ñ–ª—å—Ç—Ä –ø–∞—Ä–Ω–∏—Ö —á–∏—Å–µ–ª
        var evenNumbers = numbers.Filter(x => x % 2 == 0);
        Console.WriteLine("–ü–∞—Ä–Ω—ñ: " + string.Join(", ", evenNumbers));
        // –ü–∞—Ä–Ω—ñ: 2, 4, 6, 8, 10

        // –§—ñ–ª—å—Ç—Ä —á–∏—Å–µ–ª > 5
        var greaterThanFive = numbers.Filter(x => x > 5);
        Console.WriteLine("–ë—ñ–ª—å—à–µ 5: " + string.Join(", ", greaterThanFive));
        // –ë—ñ–ª—å—à–µ 5: 6, 7, 8, 9, 10
    }
}
```

::

## –†–µ–∑—é–º–µ

::card-group
::card{title="–î–µ–ª–µ–≥–∞—Ç–∏" icon="i-heroicons-code-bracket"}
–¢–∏–ø–æ–±–µ–∑–ø–µ—á–Ω—ñ –ø–æ–∫–∞–∂—á–∏–∫–∏ –Ω–∞ –º–µ—Ç–æ–¥–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–ª—è callback-—Ñ—É–Ω–∫—Ü—ñ–π, event handlers —Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π.
::

::card{title="Action & Func" icon="i-heroicons-bolt"}
–í–±—É–¥–æ–≤–∞–Ω—ñ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ –¥–µ–ª–µ–≥–∞—Ç–∏. `Action` –¥–ª—è void –º–µ—Ç–æ–¥—ñ–≤, `Func` –¥–ª—è –º–µ—Ç–æ–¥—ñ–≤ –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.
::

::card{title="–õ—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏" icon="i-heroicons-sparkles"}
–õ–∞–∫–æ–Ω—ñ—á–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –∞–Ω–æ–Ω—ñ–º–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π. –ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å closures —Ç–∞ type inference.
::

::card{title="–ü–æ–¥—ñ—ó" icon="i-heroicons-bell-alert"}
Publisher-Subscriber pattern –¥–ª—è loose coupling. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `EventHandler<T>` —Ç–∞ `EventArgs`.
::
::

### –ö–ª—é—á–æ–≤—ñ Takeaways

-   **–î–µ–ª–µ–≥–∞—Ç–∏** –¥–æ–∑–≤–æ–ª—è—é—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –≥–Ω—É—á–∫—ñ API
-   **Multicast delegates** –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –¥–µ–∫—ñ–ª—å–∫–∞ –º–µ—Ç–æ–¥—ñ–≤ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ
-   **Action/Func/Predicate** –∑–∞–º—ñ–Ω—é—é—Ç—å –±—ñ–ª—å—à—ñ—Å—Ç—å –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –¥–µ–ª–µ–≥–∞—Ç—ñ–≤
-   **–õ—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏** ‚Äî —Ü–µ —Å—É—á–∞—Å–Ω–∏–π —Å–ø–æ—Å—ñ–± —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–Ω–æ–Ω—ñ–º–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π
-   **Closures** –∑–∞—Ö–æ–ø–ª—é—é—Ç—å –∑–º—ñ–Ω–Ω—ñ –∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó –æ–±–ª–∞—Å—Ç—ñ –≤–∏–¥–∏–º–æ—Å—Ç—ñ (–±—É–¥—å—Ç–µ –æ–±–µ—Ä–µ–∂–Ω—ñ!)
-   **–ü–æ–¥—ñ—ó** –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å loose coupling —á–µ—Ä–µ–∑ Publisher-Subscriber pattern
-   –ó–∞–≤–∂–¥–∏ **–≤—ñ–¥–ø–∏—Å—É–π—Ç–µ—Å—å** –≤—ñ–¥ –ø–æ–¥—ñ–π, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ memory leaks

::tip
**–ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏**: –û–∑–Ω–∞–π–æ–º—Ç–µ—Å—è –∑ [–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏](./3.interfaces-deep-dive.md) —Ç–∞ [LINQ](../../5.standard-library/3.linq.md), –¥–µ –¥–µ–ª–µ–≥–∞—Ç–∏ —Ç–∞ –ª—è–º–±–¥–∞-–≤–∏—Ä–∞–∑–∏ —à–∏—Ä–æ–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è.
::

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ –†–µ—Å—É—Ä—Å–∏

-   [–û—Ñ—ñ—Ü—ñ–π–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Microsoft: Delegates](https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/delegates/)
-   [–û—Ñ—ñ—Ü—ñ–π–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Microsoft: Events](https://learn.microsoft.com/en-us/dotnet/csharp/events-overview)
-   [–û—Ñ—ñ—Ü—ñ–π–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è Microsoft: Lambda Expressions](https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/lambda-expressions)
-   [Standard .NET Event Patterns](https://learn.microsoft.com/en-us/dotnet/csharp/event-pattern)
