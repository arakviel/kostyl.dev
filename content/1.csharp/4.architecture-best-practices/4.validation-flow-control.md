---
title: 'Validation & Flow Control'
description: '–ì–ª–∏–±–æ–∫–µ –≤–∏–≤—á–µ–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é –ª–æ–≥—ñ–∫–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±–µ–∑ –≤–∏–Ω—è—Ç–∫—ñ–≤. –í—ñ–¥ Defensive Programming –¥–æ Railway Oriented Programming –∑ Result Pattern.'
---

# Validation & Flow Control

## –í—Å—Ç—É–ø —Ç–∞ –ö–æ–Ω—Ç–µ–∫—Å—Ç

–£—è–≤—ñ—Ç—å, —â–æ –≤–∏ –±—É–¥—É—î—Ç–µ —Å–∏—Å—Ç–µ–º—É –æ–Ω–ª–∞–π–Ω-–±–∞–Ω–∫—ñ–Ω–≥—É. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≥—Ä–æ—à—ñ:

```csharp
// ‚ùå Naive –ø—ñ–¥—Ö—ñ–¥ - —â–æ –º–æ–∂–µ –ø—ñ—Ç–∏ –Ω–µ —Ç–∞–∫?
public void TransferMoney(string fromAccount, string toAccount, decimal amount)
{
    var from = _accounts[fromAccount];
    var to = _accounts[toAccount];

    from.Balance -= amount;
    to.Balance += amount;

    _repository.Save(from);
    _repository.Save(to);
}
```

**–ü—Ä–æ–±–ª–µ–º–∏ —Ü—å–æ–≥–æ –∫–æ–¥—É:**

-   –©–æ, —è–∫—â–æ `fromAccount` –Ω–µ —ñ—Å–Ω—É—î? ‚Üí `KeyNotFoundException`
-   –©–æ, —è–∫—â–æ `amount` –≤—ñ–¥'—î–º–Ω–∏–π? ‚Üí –ü–æ–º–∏–ª–∫–æ–≤–∞ –ª–æ–≥—ñ–∫–∞
-   –©–æ, —è–∫—â–æ –±–∞–ª–∞–Ω—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π? ‚Üí –í—ñ–¥'—î–º–Ω–∏–π –±–∞–ª–∞–Ω—Å
-   –©–æ, —è–∫—â–æ `toAccount` –ø–æ—Ä–æ–∂–Ω—ñ–π? ‚Üí –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è
-   –©–æ, —è–∫—â–æ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞? ‚Üí Inconsistent state

–ö–æ–∂–Ω–∞ –∑ —Ü–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –≤–∏–Ω—è—Ç–∫—É (Exception), –∫—Ä–∞—Ö—É –ø—Ä–æ–≥—Ä–∞–º–∏ –∞–±–æ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –¥–∞–Ω–∏—Ö. **–ê–ª–µ –±—ñ–ª—å—à—ñ—Å—Ç—å –∑ –Ω–∏—Ö –Ω–µ —î "–≤–∏–Ω—è—Ç–∫–æ–≤–∏–º–∏"** ‚Äî —Ü–µ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω—ñ –±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó, —è–∫—ñ –º–∞—é—Ç—å –±—É—Ç–∏ —á–∞—Å—Ç–∏–Ω–æ—é –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏.

::caution
**–ü—Ä–æ–±–ª–µ–º–∞ "Exception Driven Development"**: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤–∏–Ω—è—Ç–∫—ñ–≤ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ:

-   **–ü–æ–≥—ñ—Ä—à–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ**: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è exception ‚Äî –¥–æ—Ä–æ–≥–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è (~10,000 —Ä–∞–∑—ñ–≤ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ –∑–∞ –∑–≤–∏—á–∞–π–Ω–∏–π `if`)
-   **–ù–µ–∑—Ä–æ–∑—É–º—ñ–ª–æ—Å—Ç—ñ –∫–æ–¥—É**: –ù–µ—è—Å–Ω–æ, —è–∫—ñ –ø–æ–º–∏–ª–∫–∏ –º–æ–∂–ª–∏–≤—ñ —Ç–∞ —è–∫ —ó—Ö –æ–±—Ä–æ–±–ª—è—Ç–∏
-   **–°–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è**: –í–∏–Ω—è—Ç–∫–∏ –≤–∞–∂–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ç–∞ —Å–∏–º—É–ª—é–≤–∞—Ç–∏
-   **–ù–µ—è–≤–Ω–æ—ó –ª–æ–≥—ñ–∫–∏**: –ë—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ —Ä–æ–∑–∫–∏–¥–∞–Ω—ñ –ø–æ `try-catch` –±–ª–æ–∫–∞—Ö

::

**–ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥** –ø–æ–ª—è–≥–∞—î –≤ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—ñ:

1.  **–í–∞–ª—ñ–¥–∞—Ü—ñ—è (Validation)**: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö _–ø–µ—Ä–µ–¥_ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º –æ–ø–µ—Ä–∞—Ü—ñ—ó
2.  **–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ç–æ–∫—É (Flow Control)**: –û–±—Ä–æ–±–∫–∞ –ª–æ–≥—ñ—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ —á–µ—Ä–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ (`Result<T>`), –∞ –Ω–µ –≤–∏–Ω—è—Ç–∫–∏
3.  **–í–∏–Ω—è—Ç–∫–∏ (Exceptions)**: _–¢—ñ–ª—å–∫–∏_ –¥–ª—è —Å–ø—Ä–∞–≤–¥—ñ –≤–∏–Ω—è—Ç–∫–æ–≤–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π (–º–µ—Ä–µ–∂–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –¥–∏—Å–∫ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–∏–π)

::mermaid

```mermaid
graph TD
    A[–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ] --> B{–í–∞–ª—ñ–¥–∞—Ü—ñ—è}
    B -->|–ù–µ–≤–∞–ª—ñ–¥–Ω—ñ| C[–ü–æ–≤–µ—Ä–Ω—É—Ç–∏ ValidationResult]
    B -->|–í–∞–ª—ñ–¥–Ω—ñ| D{–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞}
    D -->|–õ–æ–≥—ñ—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞| E[–ü–æ–≤–µ—Ä–Ω—É—Ç–∏ Result.Fail]
    D -->|–£—Å–ø—ñ—Ö| F[–ü–æ–≤–µ—Ä–Ω—É—Ç–∏ Result.Ok]
    D -->|–í–∏–Ω—è—Ç–∫–æ–≤–∞ —Å–∏—Ç—É–∞—Ü—ñ—è| G[Throw Exception]

    style A fill:#64748b,stroke:#334155,color:#ffffff
    style B fill:#f59e0b,stroke:#b45309,color:#ffffff
    style C fill:#ef4444,stroke:#b91c1c,color:#ffffff
    style D fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style E fill:#f59e0b,stroke:#b45309,color:#ffffff
    style F fill:#10b981,stroke:#059669,color:#ffffff
    style G fill:#ef4444,stroke:#b91c1c,color:#ffffff
```

::

### –ï–≤–æ–ª—é—Ü—ñ—è –ø—ñ–¥—Ö–æ–¥—ñ–≤ –¥–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ç–∞ –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫

–†–æ–∑—É–º—ñ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ –º–∏ –¥—ñ–π—à–ª–∏ –¥–æ —Å—É—á–∞—Å–Ω–∏—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤, –¥–æ–ø–æ–º–æ–∂–µ –æ—Ü—ñ–Ω–∏—Ç–∏ —ó—Ö–Ω—é —Ü—ñ–Ω–Ω—ñ—Å—Ç—å:

::steps

#### –ï—Ç–∞–ø 1: –Ü–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (1990-—ñ)

–ü—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç–∏ –ø–∏—Å–∞–ª–∏ –≤—Ä—É—á–Ω—É –≤—Å—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —á–µ—Ä–µ–∑ `if`:

```csharp
if (string.IsNullOrEmpty(email))
    throw new Exception("Email is required");
if (!email.Contains("@"))
    throw new Exception("Invalid email");
```

**–ü—Ä–æ–±–ª–µ–º–∏**: –î—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É, —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –ø—ñ–¥—Ç—Ä–∏–º–∫–∏, –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –ø–æ–º–∏–ª–∫–∏.

#### –ï—Ç–∞–ø 2: Data Annotations (2008, .NET 3.5 SP1)

–í–≤–µ–¥–µ–Ω–Ω—è –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:

```csharp
public class User
{
    [Required]
    [EmailAddress]
    public string Email { get; set; }
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**: –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å, –º–µ–Ω—à–µ –∫–æ–¥—É. **–ù–µ–¥–æ–ª—ñ–∫–∏**: –û–±–º–µ–∂–µ–Ω–∞ –≥–Ω—É—á–∫—ñ—Å—Ç—å, —Å–∫–ª–∞–¥–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–∂–∫–æ –≤–∏—Ä–∞–∑–∏—Ç–∏.

#### –ï—Ç–∞–ø 3: FluentValidation (2010-—ñ)

–í–∏–Ω–µ—Å–µ–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤ –æ–∫—Ä–µ–º—ñ –∫–ª–∞—Å–∏ –∑ fluent API:

```csharp
public class UserValidator : AbstractValidator<User>
{
    public UserValidator()
    {
        RuleFor(x => x.Email).NotEmpty().EmailAddress();
    }
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**: –†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç–µ–π, –ø–æ—Ç—É–∂–Ω–∞ –∫–æ–º–ø–æ–∑–∏—Ü—ñ—è –ø—Ä–∞–≤–∏–ª, —Ç–µ—Å—Ç–æ–≤–Ω—ñ—Å—Ç—å.

#### –ï—Ç–∞–ø 4: Result Pattern (2010-—ñ, Function Programming influence)

–í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –≤–∏–Ω—è—Ç–∫—ñ–≤ –¥–ª—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –Ω–∞ –∫–æ—Ä–∏—Å—Ç—å —è–≤–Ω–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:

```csharp
public Result<User> CreateUser(string email)
{
    if (string.IsNullOrEmpty(email))
        return Result.Fail<User>("Email is required");

    // ...
    return Result.Ok(user);
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏**: –Ø–≤–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫, Railway Oriented Programming, –∫—Ä–∞—â–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å.

::

### –¶—ñ–ª—ñ —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É

–ü—ñ—Å–ª—è –≤–∏–≤—á–µ–Ω–Ω—è —Ü—å–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ:

-   ‚úÖ –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Defensive Programming –∑ Guard Clauses
-   ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Data Annotations —Ç–∞ `IValidatableObject`
-   ‚úÖ –°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ FluentValidation
-   ‚úÖ –†–æ–∑—É–º—ñ—Ç–∏ –≤–∞—Ä—Ç—ñ—Å—Ç—å –≤–∏–Ω—è—Ç–∫—ñ–≤ —Ç–∞ –∫–æ–ª–∏ —ó—Ö —É–Ω–∏–∫–∞—Ç–∏
-   ‚úÖ –ó–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ Result Pattern –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ª–æ–≥—ñ—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫
-   ‚úÖ –ë—É–¥—É–≤–∞—Ç–∏ Railway Oriented Programming pipelines
-   ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ FluentResults —Ç–∞ ErrorOr

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

–ü–µ—Ä–µ–¥ –≤–∏–≤—á–µ–Ω–Ω—è–º —Ü—å–æ–≥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—É –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Ä–æ–∑—É–º—ñ—î—Ç–µ:

-   [–û—Å–Ω–æ–≤–∏ C# (–∑–º—ñ–Ω–Ω—ñ, —Ç–∏–ø–∏, –º–µ—Ç–æ–¥–∏)](/csharp/fundamentals/variables-data-types)
-   [–ö–ª–∞—Å–∏ —Ç–∞ –æ–±'—î–∫—Ç–∏](/csharp/oop/classes-objects)
-   [–í–∏–Ω—è—Ç–∫–∏ —Ç–∞ —ó—Ö –æ–±—Ä–æ–±–∫–∞](/csharp/fundamentals/control-flow#exceptions)
-   [Generics](/csharp/advanced-core/generics)

---

## –ß–∞—Å—Ç–∏–Ω–∞ 1: –¢–µ–æ—Ä—ñ—è –í–∞–ª—ñ–¥–∞—Ü—ñ—ó

### 1.1. –©–æ —Ç–∞–∫–µ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞ —á–æ–º—É –≤–æ–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞?

**–í–∞–ª—ñ–¥–∞—Ü—ñ—è (Validation)** ‚Äî —Ü–µ –ø—Ä–æ—Ü–µ—Å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –¥–∞–Ω—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º –ø—Ä–∞–≤–∏–ª–∞–º —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è–º _–ø–µ—Ä–µ–¥_ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ—Ü—ñ.

> –í–∞–ª—ñ–¥–∞—Ü—ñ—è ‚Äî —Ü–µ –ø–µ—Ä—à–∞ –ª—ñ–Ω—ñ—è –æ–±–æ—Ä–æ–Ω–∏ –ø—Ä–æ—Ç–∏ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö. –ë–µ–∑ –Ω–µ—ó —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ "GIGO" (Garbage In, Garbage Out).

#### –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

::field-group

:::field{name="Fail Fast Principle"}
–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–∞–Ω—ñ —è–∫–æ–º–æ–≥–∞ —Ä–∞–Ω—ñ—à–µ. –ù–µ –¥–æ–∑–≤–æ–ª—è–π—Ç–µ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–º –¥–∞–Ω–∏–º –ø—Ä–æ–π—Ç–∏ –¥–∞–ª—ñ –≤ —Å–∏—Å—Ç–µ–º—É.

```csharp
public void ProcessPayment(Payment payment)
{
    // ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Å–ø–æ—á–∞—Ç–∫—É
    ArgumentNullException.ThrowIfNull(payment);
    if (payment.Amount <= 0)
        throw new ArgumentException("Amount must be positive", nameof(payment.Amount));

    // –¢–µ–ø–µ—Ä –±–µ–∑–ø–µ—á–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ payment
    _gateway.Charge(payment);
}
```

:::

:::field{name="Separation of Concerns"}
–í–∞–ª—ñ–¥–∞—Ü—ñ—è –º–∞—î –±—É—Ç–∏ –≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–∞ –≤—ñ–¥ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏. –ù–µ –∑–º—ñ—à—É–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏.

```csharp
// ‚ùå –ó–º—ñ—à–∞–Ω–æ
public void CreateUser(string email)
{
    if (string.IsNullOrEmpty(email)) throw ...;
    if (!email.Contains("@")) throw ...;

    // –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞
    _repository.Add(new User(email));
}

// ‚úÖ –†–æ–∑–¥—ñ–ª–µ–Ω–æ
public Result CreateUser(string email)
{
    var validationResult = _validator.Validate(email);
    if (!validationResult.IsValid)
        return Result.Fail(validationResult.Errors);

    _repository.Add(new User(email));
    return Result.Ok();
}
```

:::

:::field{name="Clear Error Messages"}
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ –º–∞—é—Ç—å –±—É—Ç–∏ –∑—Ä–æ–∑—É–º—ñ–ª–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ —Ç–∞ –Ω–∞–¥–∞–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è.

```csharp
// ‚ùå –ù–µ–∑—Ä–æ–∑—É–º—ñ–ª–æ
"Invalid input"

// ‚úÖ –ó—Ä–æ–∑—É–º—ñ–ª–æ
"Email must be in format 'user@example.com'. Provided value: 'user@'"
```

:::

:::field{name="Comprehensive Validation"}
–í–∞–ª—ñ–¥—É–π—Ç–µ –≤—Å—ñ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞ –æ–¥–∏–Ω –ø—Ä–æ—Ö—ñ–¥, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏–≤ —É—Å—ñ –ø–æ–º–∏–ª–∫–∏ –≤—ñ–¥—Ä–∞–∑—É, –∞ –Ω–µ –ø–æ –æ–¥–Ω—ñ–π.

```csharp
var errors = new List<string>();

if (string.IsNullOrEmpty(user.Email))
    errors.Add("Email is required");

if (user.Age < 18)
    errors.Add("User must be at least 18 years old");

if (errors.Any())
    return Result.Fail(errors);
```

:::

::

### 1.2. –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

–í–∞–ª—ñ–¥–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –∫–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∑–∞ —Ä—ñ–∑–Ω–∏–º–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏. –†–æ–∑—É–º—ñ–Ω–Ω—è —Ü–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–æ–ø–æ–º–æ–∂–µ –≤–∏–±—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥.

#### –ó–∞ –º—ñ—Å—Ü–µ–º –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è          | –û–ø–∏—Å                                            | –ü—Ä–∏–∫–ª–∞–¥                           | –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏                    |
| :----------------- | :---------------------------------------------- | :-------------------------------- | :-------------------------------------- |
| **Client-side**    | –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ –∞–±–æ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–º—É –¥–æ–¥–∞—Ç–∫—É | JavaScript –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ñ–æ—Ä–º         | –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è UX, —à–≤–∏–¥–∫–∏–π —Ñ—ñ–¥–±–µ–∫           |
| **Server-side**    | –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –ø–µ—Ä–µ–¥ –æ–±—Ä–æ–±–∫–æ—é –¥–∞–Ω–∏—Ö     | ASP.NET Model Validation          | –û–±–æ–≤'—è–∑–∫–æ–≤–∞, —Ñ—ñ–Ω–∞–ª—å–Ω–∞ –ª—ñ–Ω—ñ—è –æ–±–æ—Ä–æ–Ω–∏     |
| **Database-level** | –û–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –ë–î (CHECK, UNIQUE, FK)       | SQL: `CHECK (age >= 18)`          | –¶—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö, multiple entry points |
| **Domain-level**   | –ë—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ domain –º–æ–¥–µ–ª—ñ          | `User.ChangeEmail()` –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é | DDD, —Å–∫–ª–∞–¥–Ω—ñ —ñ–Ω–≤–∞—Ä—ñ–∞–Ω—Ç–∏                 |

::warning
**–ö—Ä–∏—Ç–∏—á–Ω–æ**: _–ù—ñ–∫–æ–ª–∏_ –Ω–µ –ø–æ–∫–ª–∞–¥–∞–π—Ç–µ—Å—è –ª–∏—à–µ –Ω–∞ client-side –≤–∞–ª—ñ–¥–∞—Ü—ñ—é! –í–æ–Ω–∞ –ª–µ–≥–∫–æ –æ–±—Ö–æ–¥–∏—Ç—å—Å—è —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –≤–∏–∫–ª—é—á–Ω–æ –¥–ª—è UX. –°–µ—Ä–≤–µ—Ä –∑–∞–≤–∂–¥–∏ –ø–æ–≤–∏–Ω–µ–Ω –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –¥–∞–Ω—ñ –ø–æ–≤—Ç–æ—Ä–Ω–æ.
::

#### –ó–∞ —Ç–∏–ø–æ–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

::card-group

:::card
**–°–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è (Syntactic)**
–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É –¥–∞–Ω–∏—Ö –±–µ–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç—É.

```csharp
// –ß–∏ —î —Ä—è–¥–æ–∫ –≤–∞–ª—ñ–¥–Ω–∏–º email?
new EmailAddressAttribute().IsValid("user@example.com") // true

// –ß–∏ —î —Ä—è–¥–æ–∫ –≤–∞–ª—ñ–¥–Ω–∏–º JSON?
JsonDocument.Parse(jsonString) // –Ω–µ –∫–∏–¥–∞—î exception
```

**–ü—Ä–∏–∫–ª–∞–¥–∏**: Email format, Phone format, Date format, JSON/XML structure.
:::

:::card
**–°–µ–º–∞–Ω—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è (Semantic)**
–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –º–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è —Å–µ–Ω—Å —É –±—ñ–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ.

```csharp
// Email –≤–∞–ª—ñ–¥–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–æ, –∞–ª–µ —á–∏ —ñ—Å–Ω—É—î –¥–æ–º–µ–Ω?
await DnsLookup("@example.com")

// –î–∞—Ç–∞ –≤–∞–ª—ñ–¥–Ω–∞, –∞–ª–µ —á–∏ –Ω–µ –≤ –º–∏–Ω—É–ª–æ–º—É –¥–ª—è –ø–æ–¥—ñ—ó?
if (eventDate < DateTime.Now)
    return Error("Event date cannot be in the past");
```

**–ü—Ä–∏–∫–ª–∞–¥–∏**: Email domain exists, Date range logic, Business rules.
:::

:::card
**–°—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è (Structural)**
–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –º—ñ–∂ –ø–æ–ª—è–º–∏ —Ç–∞ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –æ–±'—î–∫—Ç–∞.

```csharp
// –î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É –º–∞—î –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –¥–∞—Ç–∏ –∫—ñ–Ω—Ü—è
if (startDate >= endDate)
    return Error("Start date must be before end date");

// –Ø–∫—â–æ –∑–Ω–∏–∂–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞, –≤–æ–Ω–∞ –º–∞—î –±—É—Ç–∏ > 0
if (discount.IsActive && discount.Percentage <= 0)
    return Error("Active discount must have a percentage > 0");
```

**–ü—Ä–∏–∫–ª–∞–¥–∏**: Cross-field validation, Conditional rules, Aggregate consistency.
:::

:::card
**–ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è (Contextual)**
–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É —Å–∏—Å—Ç–µ–º–∏ –∞–±–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

```csharp
// –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ª–∏—à–µ —Å–≤–æ—ó –≤–ª–∞—Å–Ω—ñ –ø–æ—Å—Ç–∏
if (post.AuthorId != currentUser.Id && !currentUser.IsAdmin)
    return Error("Unauthorized");

// –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –º–æ–∂–Ω–∞ —Å–∫–∞—Å—É–≤–∞—Ç–∏ –ª–∏—à–µ –≤ —Å—Ç–∞—Ç—É—Å—ñ "Pending"
if (order.Status != OrderStatus.Pending)
    return Error("Only pending orders can be cancelled");
```

**–ü—Ä–∏–∫–ª–∞–¥–∏**: Authorization checks, State-based rules, Tenant isolation.
:::

::

#### –ó–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—é

1.  **–ü—Ä–æ—Å—Ç–∞ (Simple)**: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è –±–µ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
    -   `NotNull`, `NotEmpty`, `MaxLength(50)`
2.  **–°–∫–ª–∞–¥–Ω–∞ (Complex)**: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑ –∫—ñ–ª—å–∫–æ–º–∞ —É–º–æ–≤–∞–º–∏ –∞–±–æ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏
    -   `Must(BeUnique)`, `Must(BeBetween(startDate, endDate))`
3.  **–ö–æ–º–ø–æ–∑–∏—Ç–Ω–∞ (Composite)**: –ö–æ–º–±—ñ–Ω–∞—Ü—ñ—è –∫—ñ–ª—å–∫–æ—Ö –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä—ñ–≤
    -   `RuleFor(x => x.Email).NotEmpty().EmailAddress().Must(BeUniqueEmail)`
4.  **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ (Async)**: –ü–æ—Ç—Ä–µ–±—É—î –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤
    -   `MustAsync(BeUniqueEmail)` ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ë–î
    -   `MustAsync(ExistInExternalApi)` ‚Üí HTTP –∑–∞–ø–∏—Ç

### 1.3. –í–∞–ª—ñ–¥–∞—Ü—ñ—è vs. –Ü–Ω—à—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó

–í–∞–∂–ª–∏–≤–æ –Ω–µ –ø–ª—É—Ç–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –∑ —Å—É–º—ñ–∂–Ω–∏–º–∏ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—è–º–∏:

| –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è          | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è                              | –ü—Ä–∏–∫–ª–∞–¥                                      |
| :----------------- | :--------------------------------------- | :------------------------------------------- |
| **Validation**     | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –¥–∞–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞–º | `Email` –º–∞—î –±—É—Ç–∏ –≤–∞–ª—ñ–¥–Ω–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º           |
| **Authorization**  | –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞       | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î —Ä–æ–ª—å Admin –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è      |
| **Sanitization**   | –û—á–∏—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤—ñ–¥ –Ω–µ–±–∞–∂–∞–Ω–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤    | –í–∏–¥–∞–ª–∏—Ç–∏ HTML —Ç–µ–≥–∏ –∑ –≤–≤–µ–¥–µ–Ω–Ω—è                |
| **Normalization**  | –ü—Ä–∏–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É | `"JOHN DOE"` ‚Üí `"John Doe"`                  |
| **Business Rules** | –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, —è–∫–∞ –≤–∏–∑–Ω–∞—á–∞—î –ø–æ–≤–µ–¥—ñ–Ω–∫—É    | –ó–Ω–∏–∂–∫–∞ 20% –ø—Ä–∏ –ø–æ–∫—É–ø—Ü—ñ >5 —Ç–æ–≤–∞—Ä—ñ–≤            |
| **Invariants**     | –£–º–æ–≤–∏, —â–æ –∑–∞–≤–∂–¥–∏ –º–∞—é—Ç—å –±—É—Ç–∏ —ñ—Å—Ç–∏–Ω–Ω–∏–º–∏    | –ë–∞–ª–∞–Ω—Å —Ä–∞—Ö—É–Ω–∫—É –Ω—ñ–∫–æ–ª–∏ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥'—î–º–Ω–∏–º |

::note
**–ü—Ä–∏–∫–ª–∞–¥ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è**: –ü—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

1.  **Sanitization**: –í–∏–¥–∞–ª—è—î–º–æ –∑–∞–π–≤—ñ –ø—Ä–æ–±—ñ–ª–∏ –∑ email: `" user@example.com "` ‚Üí `"user@example.com"`
2.  **Normalization**: –ü—Ä–∏–≤–æ–¥–∏–º–æ –¥–æ –Ω–∏–∂–Ω—å–æ–≥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É: `"User@Example.COM"` ‚Üí `"user@example.com"`
3.  **Validation**: –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ñ–æ—Ä–º–∞—Ç —Ç–∞ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å
4.  **Business Rule**: –î–æ–¥–∞—î–º–æ welcome bonus, —è–∫—â–æ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
5.  **Invariant**: Email –∑–∞–≤–∂–¥–∏ –º–∞—î –±—É—Ç–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ –º–æ–¥–µ–ª—ñ)

::

---

## –ß–∞—Å—Ç–∏–Ω–∞ 2: Defensive Programming

**Defensive Programming** ‚Äî —Ü–µ –ø—ñ–¥—Ö—ñ–¥ –¥–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∫–æ–¥—É, —è–∫–∏–π _–ø–µ—Ä–µ–¥–±–∞—á–∞—î_ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è —ó—Ö –ø–æ–ø–µ—Ä–µ–¥–∏—Ç–∏ –∞–±–æ –º—ñ–Ω—ñ–º—ñ–∑—É–≤–∞—Ç–∏ —ó—Ö –≤–ø–ª–∏–≤ —á–µ—Ä–µ–∑ —è–≤–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞ –∑–∞—Ö–∏—Å–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏.

> –ü–∏—à—ñ—Ç—å –∫–æ–¥ —Ç–∞–∫, –Ω—ñ–±–∏ –≤—ñ–Ω –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –Ω–∞–π–≥—ñ—Ä—à–∏–º —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–æ–º —É —Å–≤—ñ—Ç—ñ. –¶–∏–º —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–æ–º –º–æ–∂–µ—Ç–µ –≤–∏—è–≤–∏—Ç–∏—Å—è –≤–∏ —Å–∞–º—ñ —á–µ—Ä–µ–∑ —à—ñ—Å—Ç—å –º—ñ—Å—è—Ü—ñ–≤.

### 2.1. Guard Clauses (–û—Ö–æ—Ä–æ–Ω–Ω—ñ —É–º–æ–≤–∏)

**Guard Clause** ‚Äî —Ü–µ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ—á–∞—Ç–∫—É –º–µ—Ç–æ–¥—É, —è–∫–∞ _–Ω–µ–≥–∞–π–Ω–æ_ –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–±–æ –∫–∏–¥–∞—î –≤–∏–Ω—è—Ç–æ–∫, —è–∫—â–æ —É–º–æ–≤–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–µ –¥–æ—Ç—Ä–∏–º–∞–Ω—ñ.

#### –ö–ª–∞—Å–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥: Manual Guards

```csharp
public void ProcessOrder(Order order, User user)
{
    // ‚ùå –ë–µ–∑ guard clauses - nested hell
    if (order != null)
    {
        if (user != null)
        {
            if (order.Items.Count > 0)
            {
                if (user.IsActive)
                {
                    // –§–∞–∫—Ç–∏—á–Ω–∞ –ª–æ–≥—ñ–∫–∞ –¥–µ—Å—å —Ç—É—Ç...
                }
                else
                    throw new InvalidOperationException("User is not active");
            }
            else
                throw new ArgumentException("Order has no items");
        }
        else
            throw new ArgumentNullException(nameof(user));
    }
    else
        throw new ArgumentNullException(nameof(order));
}
```

```csharp
// ‚úÖ –ó guard clauses - linear and clear
public void ProcessOrder(Order order, User user)
{
    // Guards —Å–ø–æ—á–∞—Ç–∫—É - –≤–∏—Ö–æ–¥–∏–º–æ —Ä–∞–Ω–æ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
    ArgumentNullException.ThrowIfNull(order);
    ArgumentNullException.ThrowIfNull(user);

    if (order.Items.Count == 0)
        throw new ArgumentException("Order must contain at least one item", nameof(order));

    if (!user.IsActive)
        throw new InvalidOperationException("Cannot process order for inactive user");

    // Happy path - –±–µ–∑ –≤–∫–ª–∞–¥–µ–Ω–æ—Å—Ç—ñ
    var total = order.CalculateTotal();
    _paymentService.Charge(user, total);
    _emailService.SendConfirmation(user.Email, order);
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏ Guard Clauses:**

-   üìâ **–ó–º–µ–Ω—à–µ–Ω–Ω—è –∫–æ–≥–Ω—ñ—Ç–∏–≤–Ω–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**: –õ—ñ–Ω—ñ–π–Ω–∏–π –∫–æ–¥ –ª–µ–≥—à–µ —á–∏—Ç–∞—Ç–∏
-   üéØ **–Ø–≤–Ω—ñ –ø–µ—Ä–µ–¥—É–º–æ–≤–∏**: –û–¥—Ä–∞–∑—É –≤–∏–¥–Ω–æ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º–µ—Ç–æ–¥—É
-   üêõ **–®–≤–∏–¥–∫–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫**: Fail-fast principle
-   üß™ **–õ–µ–≥—à–µ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏**: –ö–æ–∂–Ω–∞ —É–º–æ–≤–∞ ‚Äî –æ–∫—Ä–µ–º–∏–π —Ç–µ—Å—Ç–æ–≤–∏–π –∫–µ–π—Å

#### .NET Built-in Guards

–ü–æ—á–∏–Ω–∞—é—á–∏ –∑ .NET 6, —î –≤–±—É–¥–æ–≤–∞–Ω—ñ helper –º–µ—Ç–æ–¥–∏ –¥–ª—è guard clauses:

```csharp
public class ArgumentNullExceptionExamples
{
    // ‚úÖ Modern way (.NET 6+)
    public void ModernGuards(string name, int age, List<string> items)
    {
        ArgumentNullException.ThrowIfNull(name);
        ArgumentNullException.ThrowIfNull(items);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(age);
        ArgumentOutOfRangeException.ThrowIfZero(items.Count);
    }

    // ‚ùå Old way (before .NET 6)
    public void OldGuards(string name, int age, List<string> items)
    {
        if (name == null)
            throw new ArgumentNullException(nameof(name));
        if (items == null)
            throw new ArgumentNullException(nameof(items));
        if (age <= 0)
            throw new ArgumentOutOfRangeException(nameof(age), "Age must be positive");
        if (items.Count == 0)
            throw new ArgumentOutOfRangeException(nameof(items), "Items cannot be empty");
    }
}
```

::tip
**Best Practice**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –≤–±—É–¥–æ–≤–∞–Ω—ñ guard methods, –¥–µ —Ü–µ –º–æ–∂–ª–∏–≤–æ ‚Äî –≤–æ–Ω–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ–∫—Ä–∞—â—É—é—Ç—å —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å.
::

#### –í–∏—á–µ—Ä–ø–Ω–∏–π —Å–ø–∏—Å–æ–∫ Built-in Guards (.NET 8)

::collapsible{title="–ü–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ ArgumentException guards" default-open="false"}

```csharp showLineNumbers
// Null checks
ArgumentNullException.ThrowIfNull(obj);
ArgumentNullException.ThrowIfNull(obj, nameof(obj));

// Numeric range checks
ArgumentOutOfRangeException.ThrowIfZero(number);
ArgumentOutOfRangeException.ThrowIfNegative(number);
ArgumentOutOfRangeException.ThrowIfNegativeOrZero(number);
ArgumentOutOfRangeException.ThrowIfGreaterThan(actual, threshold);
ArgumentOutOfRangeException.ThrowIfGreaterThanOrEqual(actual, threshold);
ArgumentOutOfRangeException.ThrowIfLessThan(actual, threshold);
ArgumentOutOfRangeException.ThrowIfLessThanOrEqual(actual, threshold);
ArgumentOutOfRangeException.ThrowIfEqual(actual, unexpected);
ArgumentOutOfRangeException.ThrowIfNotEqual(actual, expected);

// String checks
ArgumentException.ThrowIfNullOrEmpty(str);
ArgumentException.ThrowIfNullOrWhiteSpace(str); // .NET 8+
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –¶–µ –º–µ—Ç–æ–¥–∏ –∑ –Ω–µ–π–º—Å–ø–µ–π—Å—É `System`, –¥–æ—Å—Ç—É–ø–Ω—ñ –≥–ª–æ–±–∞–ª—å–Ω–æ.

::

#### Custom Guard Clauses

–î–ª—è —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤–ª–∞—Å–Ω—ñ guard –º–µ—Ç–æ–¥–∏:

```csharp showLineNumbers
public static class Guard
{
    public static void AgainstNullOrEmpty(string value, string paramName)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(value, paramName);
    }

    public static void AgainstNegative(decimal value, string paramName)
    {
        if (value < 0)
            throw new ArgumentOutOfRangeException(paramName, $"{paramName} cannot be negative");
    }

    public static void AgainstInvalidEmail(string email, string paramName)
    {
        if (!new EmailAddressAttribute().IsValid(email))
            throw new ArgumentException($"Invalid email format: {email}", paramName);
    }

    public static void AgainstPastDate(DateTime date, string paramName)
    {
        if (date < DateTime.Now)
            throw new ArgumentException($"{paramName} cannot be in the past", paramName);
    }

    public static void AgainstOutOfRange<T>(T value, T min, T max, string paramName)
        where T : IComparable<T>
    {
        if (value.CompareTo(min) < 0 || value.CompareTo(max) > 0)
            throw new ArgumentOutOfRangeException(paramName,
                $"{paramName} must be between {min} and {max}");
    }
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
public void ScheduleEvent(string title, DateTime eventDate, decimal ticketPrice)
{
    Guard.AgainstNullOrEmpty(title, nameof(title));
    Guard.AgainstPastDate(eventDate, nameof(eventDate));
    Guard.AgainstNegative(ticketPrice, nameof(ticketPrice));

    // Business logic
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∫–æ–¥—É –≤–∏—â–µ:**

-   **–†—è–¥–æ–∫ 1-3**: `AgainstNullOrEmpty` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤–±—É–¥–æ–≤–∞–Ω–∏–π `ThrowIfNullOrWhiteSpace` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ—Ä–æ–∂–Ω—ñ—Ö —Ä—è–¥–∫—ñ–≤
-   **–†—è–¥–æ–∫ 5-9**: `AgainstNegative` –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –Ω–µ –≤—ñ–¥'—î–º–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
-   **–†—è–¥–æ–∫ 11-15**: `AgainstInvalidEmail` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `EmailAddressAttribute` –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —Ñ–æ—Ä–º–∞—Ç—É email
-   **–†—è–¥–æ–∫ 17-21**: `AgainstPastDate` –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –¥–∞—Ç–∞ –Ω–µ –≤ –º–∏–Ω—É–ª–æ–º—É
-   **–†—è–¥–æ–∫ 23-29**: `AgainstOutOfRange` ‚Äî generic –º–µ—Ç–æ–¥ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥—ñ–∞–ø–∞–∑–æ–Ω—É –∑–Ω–∞—á–µ–Ω—å –±—É–¥—å-—è–∫–æ–≥–æ —Ç–∏–ø—É, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î `IComparable<T>`

::note
**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Custom Guards**: –°—Ç–≤–æ—Ä—é–π—Ç–µ –≤–ª–∞—Å–Ω—ñ guard –º–µ—Ç–æ–¥–∏, –∫–æ–ª–∏:

-   –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è –≤ –±–∞–≥–∞—Ç—å–æ—Ö –º—ñ—Å—Ü—è—Ö –∫–æ–¥—É
-   –ü–æ—Ç—Ä—ñ–±–Ω–∞ —Å–∫–ª–∞–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
-   –•–æ—á–µ—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ –≤ –ø—Ä–æ—î–∫—Ç—ñ

::

### 2.2. Null Safety Strategies

–û–±—Ä–æ–±–∫–∞ `null` ‚Äî –æ–¥–Ω–∞ –∑ –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏—Ö –ø—Ä–∏—á–∏–Ω –ø–æ–º–∏–ª–æ–∫ —É C#. –Ü—Å–Ω—É—î –∫—ñ–ª—å–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π –∑–∞—Ö–∏—Å—Ç—É:

#### Nullable Reference Types (C# 8.0+)

```csharp
#nullable enable

public class UserService
{
    // Compiler –ø–æ–ø–µ—Ä–µ–¥–∂–∞—î, —è–∫—â–æ –º–æ–∂–ª–∏–≤–∏–π null
    public void SendEmail(User user)  // user is non-nullable
    {
        Console.WriteLine(user.Email);  // Safe
    }

    public void SendEmailNullable(User? user)  // user is nullable
    {
        // ‚ùå Compiler warning: Possible null reference
        // Console.WriteLine(user.Email);

        // ‚úÖ Explicit null check
        if (user is not null)
        {
            Console.WriteLine(user.Email);
        }
    }
}
```

::tip
**–í–∫–ª—é—á–µ–Ω–Ω—è Nullable Reference Types**: –î–æ–¥–∞–π—Ç–µ –≤ `.csproj`:

```xml
<PropertyGroup>
    <Nullable>enable</Nullable>
</PropertyGroup>
```

–¶–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä—É –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ –≤–∏—è–≤–ª—è—Ç–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ `NullReferenceException` –Ω–∞ –µ—Ç–∞–ø—ñ —Ä–æ–∑—Ä–æ–±–∫–∏.
::

#### Null Coalescing —Ç–∞ Null-Conditional –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ–≤

```csharp showLineNumbers
public class NullSafetyExamples
{
    public string GetUserName(User? user)
    {
        // Null coalescing operator (??)
        return user?.Name ?? "Anonymous";  // –Ø–∫—â–æ null, –ø–æ–≤–µ—Ä—Ç–∞—î "Anonymous"
    }

    public int GetOrderCount(User? user)
    {
        // Null-conditional operator (?.) + null coalescing
        return user?.Orders?.Count ?? 0;  // –ë–µ–∑–ø–µ—á–Ω–∏–π –ª–∞–Ω—Ü—é–≥
    }

    public void ProcessUser(User? user)
    {
        // Null coalescing assignment (??=) - .NET 8+
        user ??= new User { Name = "Default" };  // –ü—Ä–∏—Å–≤–æ—é—î, —è–∫—â–æ null

        // –¢–µ–ø–µ—Ä user –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ –Ω–µ null
        Console.WriteLine(user.Name);
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 6**: `user?.Name` –ø–æ–≤–µ—Ä—Ç–∞—î `null`, —è–∫—â–æ `user` —î `null`, —ñ–Ω–∞–∫—à–µ –ø–æ–≤–µ—Ä—Ç–∞—î `Name`
-   **–†—è–¥–æ–∫ 12**: –õ–∞–Ω—Ü—é–≥ `?.` –¥–æ–∑–≤–æ–ª—è—î –±–µ–∑–ø–µ—á–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –≤–∫–ª–∞–¥–µ–Ω–∏–º–∏ nullable –æ–±'—î–∫—Ç–∞–º–∏
-   **–†—è–¥–æ–∫ 17**: `??=` –ø—Ä–∏—Å–≤–æ—é—î –∑–Ω–∞—á–µ–Ω–Ω—è _—Ç—ñ–ª—å–∫–∏_ —è–∫—â–æ –∑–º—ñ–Ω–Ω–∞ –¥–æ—Ä—ñ–≤–Ω—é—î `null`

---

## –ß–∞—Å—Ç–∏–Ω–∞ 3: Classic Validation

### 3.1. Data Annotations

**Data Annotations** ‚Äî —Ü–µ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏–π —Å–ø–æ—Å—ñ–± –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ –∞—Ç—Ä–∏–±—É—Ç–∏, —è–∫—ñ –∑–∞—Å—Ç–æ—Å–æ–≤—É—é—Ç—å—Å—è –¥–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π –º–æ–¥–µ–ª—ñ.

#### –û—Å–Ω–æ–≤–Ω—ñ –≤–±—É–¥–æ–≤–∞–Ω—ñ –∞—Ç—Ä–∏–±—É—Ç–∏

```csharp showLineNumbers
using System.ComponentModel.DataAnnotations;

public class RegisterUserDto
{
    [Required(ErrorMessage = "Email is required")]
    [EmailAddress(ErrorMessage = "Invalid email format")]
    [MaxLength(100, ErrorMessage = "Email cannot exceed 100 characters")]
    public string Email { get; set; }

    [Required]
    [StringLength(50, MinimumLength = 3, ErrorMessage = "Name must be between 3 and 50 characters")]
    public string Name { get; set; }

    [Range(18, 120, ErrorMessage = "Age must be between 18 and 120")]
    public int Age { get; set; }

    [Phone]
    public string? PhoneNumber { get; set; }

    [Url]
    public string? Website { get; set; }

    [RegularExpression(@"^[A-Z]{2}\d{4}$", ErrorMessage = "Invalid format. Expected: XX1234")]
    public string EmployeeCode { get; set; }

    [CreditCard]
    public string? CardNumber { get; set; }

    [Compare(nameof(Password), ErrorMessage = "Passwords do not match")]
    public string ConfirmPassword { get; set; }

    [Required]
    [MinLength(8, ErrorMessage = "Password must be at least 8 characters")]
    public string Password { get; set; }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∞—Ç—Ä–∏–±—É—Ç—ñ–≤:**

-   **–†—è–¥–æ–∫ 5-7**: `Email` –º–∞—î —Ç—Ä–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó: –æ–±–æ–≤'—è–∑–∫–æ–≤–µ –ø–æ–ª–µ, –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –¥–æ–≤–∂–∏–Ω–∞
-   **–†—è–¥–æ–∫ 11**: `StringLength` –ø–µ—Ä–µ–≤—ñ—Ä—è—î —ñ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É, —ñ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –¥–æ–≤–∂–∏–Ω—É
-   **–†—è–¥–æ–∫ 14**: `Range` –¥–ª—è —á–∏—Å–ª–æ–≤–∏—Ö –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ–≤
-   **–†—è–¥–æ–∫ 23**: `RegularExpression` –¥–ª—è custom —Ñ–æ—Ä–º–∞—Ç—ñ–≤ (—Ç—É—Ç: 2 –≤–µ–ª–∏–∫—ñ –ª—ñ—Ç–µ—Ä–∏ + 4 —Ü–∏—Ñ—Ä–∏)
-   **–†—è–¥–æ–∫ 29**: `Compare` –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–≤–æ—Ö –ø–æ–ª—ñ–≤ (–ø–∞—Ä–æ–ª—å —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è)

#### –í–∏–∫–æ–Ω–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

```csharp showLineNumbers
public class ValidationService
{
    public (bool IsValid, List<string> Errors) ValidateObject(object obj)
    {
        var context = new ValidationContext(obj);
        var results = new List<ValidationResult>();

        bool isValid = Validator.TryValidateObject(obj, context, results, validateAllProperties: true);

        var errors = results.Select(r => r.ErrorMessage ?? "Unknown error").ToList();

        return (isValid, errors);
    }
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
var dto = new RegisterUserDto
{
    Email = "invalid-email",  // ‚ùå Invalid format
    Name = "Jo",              // ‚ùå Too short
    Age = 15                  // ‚ùå Below minimum
};

var (isValid, errors) = new ValidationService().ValidateObject(dto);

if (!isValid)
{
    foreach (var error in errors)
        Console.WriteLine($"- {error}");

    // Output:
    // - Invalid email format
    // - Name must be between 3 and 50 characters
    // - Age must be between 18 and 120
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 5**: `ValidationContext` –∑–±–µ—Ä—ñ–≥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –æ–±'—î–∫—Ç, —â–æ –≤–∞–ª—ñ–¥—É—î—Ç—å—Å—è
-   **–†—è–¥–æ–∫ 8**: `Validator.TryValidateObject` –≤–∏–∫–æ–Ω—É—î –≤—Å—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∞—Ç—Ä–∏–±—É—Ç—ñ–≤. `validateAllProperties: true` –≤–∞–∂–ª–∏–≤–∏–π –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ _–≤—Å—ñ—Ö_ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π, –Ω–µ –ª–∏—à–µ —Ç–∏—Ö, —â–æ –∞–Ω–æ—Ç–æ–≤–∞–Ω—ñ `Required`
-   **–†—è–¥–æ–∫ 10**: –í–∏—Ç—è–≥—É—î–º–æ —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

### 3.2. IValidatableObject Interface

–ö–æ–ª–∏ Data Annotations –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è —Å–∫–ª–∞–¥–Ω–æ—ó –ª–æ–≥—ñ–∫–∏, –º–æ–∂–Ω–∞ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IValidatableObject` –¥–ª—è custom –≤–∞–ª—ñ–¥–∞—Ü—ñ–π.

```csharp showLineNumbers
public class EventBookingDto : IValidatableObject
{
    [Required]
    public DateTime StartDate { get; set; }

    [Required]
    public DateTime EndDate { get; set; }

    [Range(1, 1000)]
    public int Attendees { get; set; }

    [Required]
    public string EventType { get; set; }  // "Conference", "Workshop", etc.

    // Custom validation logic
    public IEnumerable<ValidationResult> Validate(ValidationContext validationContext)
    {
        // Cross-field validation: EndDate must be after StartDate
        if (EndDate <= StartDate)
        {
            yield return new ValidationResult(
                "End date must be after start date",
                new[] { nameof(EndDate) }  // Specify which property has error
            );
        }

        // Conditional validation: Conferences require at least 10 attendees
        if (EventType == "Conference" && Attendees < 10)
        {
            yield return new ValidationResult(
                "Conferences must have at least 10 attendees",
                new[] { nameof(Attendees) }
            );
        }

        // Time-based validation: Cannot book events less than 24 hours in advance
        if (StartDate < DateTime.Now.AddHours(24))
        {
            yield return new ValidationResult(
                "Events must be booked at least 24 hours in advance",
                new[] { nameof(StartDate) }
            );
        }
    }
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏ IValidatableObject:**

-   ‚úÖ **Cross-field validation**: –ú–æ–∂–Ω–∞ –ø–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –ø–æ–ª—ñ–≤ –º—ñ–∂ —Å–æ–±–æ—é
-   ‚úÖ **Conditional logic**: –†—ñ–∑–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω—å —ñ–Ω—à–∏—Ö –ø–æ–ª—ñ–≤
-   ‚úÖ **Complex business rules**: –ë—É–¥—å-—è–∫–∞ –ª–æ–≥—ñ–∫–∞ –Ω–∞ C#

**–ù–µ–¥–æ–ª—ñ–∫–∏:**

-   ‚ùå –ó–º—ñ—à—É—î –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –∑ –º–æ–¥–µ–ª–ª—é –¥–∞–Ω–∏—Ö (–ø–æ—Ä—É—à–µ–Ω–Ω—è SRP)
-   ‚ùå –í–∞–∂–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –æ–∫—Ä–µ–º–æ
-   ‚ùå –ù–µ –º–æ–∂–Ω–∞ –ª–µ–≥–∫–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –º—ñ–∂ –º–æ–¥–µ–ª—è–º–∏

::note
**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ IValidatableObject**: –î–ª—è –ø—Ä–æ—Å—Ç–∏—Ö cross-field –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ —É DTO, –∫–æ–ª–∏ FluentValidation ‚Äî overkill. –î–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ ‚Äî –∫—Ä–∞—â–µ FluentValidation.
::

### 3.3. FluentValidation ‚Äî –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥

**FluentValidation** ‚Äî —Ü–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ _strongly-typed_ –≤–∞–ª—ñ–¥–∞—Ü—ñ–π–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ —á–µ—Ä–µ–∑ fluent API, –ø–æ–≤–Ω—ñ—Å—Ç—é –≤—ñ–¥–æ–∫—Ä–µ–º–ª—é—é—á–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –≤—ñ–¥ –º–æ–¥–µ–ª–µ–π.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
dotnet add package FluentValidation
dotnet add package FluentValidation.DependencyInjectionExtensions
```

#### –ë–∞–∑–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥

```csharp showLineNumbers
using FluentValidation;

public class CreateUserDto
{
    public string Email { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
    public string Password { get; set; }
}

public class CreateUserValidator : AbstractValidator<CreateUserDto>
{
    public CreateUserValidator()
    {
        RuleFor(x => x.Email)
            .NotEmpty().WithMessage("Email is required")
            .EmailAddress().WithMessage("Invalid email format")
            .MaximumLength(100).WithMessage("Email is too long");

        RuleFor(x => x.Name)
            .NotEmpty()
            .Length(3, 50).WithMessage("Name must be between 3 and 50 characters")
            .Matches(@"^[a-zA-Z\s]+$").WithMessage("Name can only contain letters and spaces");

        RuleFor(x => x.Age)
            .InclusiveBetween(18, 120).WithMessage("Age must be between 18 and 120");

        RuleFor(x => x.Password)
            .NotEmpty()
            .MinimumLength(8).WithMessage("Password must be at least 8 characters")
            .Matches(@"[A-Z]").WithMessage("Password must contain at least one uppercase letter")
            .Matches(@"[a-z]").WithMessage("Password must contain at least one lowercase letter")
            .Matches(@"[0-9]").WithMessage("Password must contain at least one digit")
            .Matches(@"[@$!%*?&#]").WithMessage("Password must contain at least one special character");
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 11**: –í–∞–ª—ñ–¥–∞—Ç–æ—Ä –Ω–∞—Å–ª—ñ–¥—É—î—Ç—å—Å—è –≤—ñ–¥ `AbstractValidator<T>` —ñ —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω–∏–π –º–æ–¥–µ–ª–ª—é
-   **–†—è–¥–æ–∫ 15-18**: –õ–∞–Ω—Ü—é–∂–æ–∫ –ø—Ä–∞–≤–∏–ª –¥–ª—è `Email` –∑ custom –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ —á–µ—Ä–µ–∑ `.WithMessage()`
-   **–†—è–¥–æ–∫ 23**: `Matches` –ø—Ä–∏–π–º–∞—î regex –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫
-   **–†—è–¥–æ–∫ 31-34**: –ú–Ω–æ–∂–∏–Ω–Ω—ñ `Matches` –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≤–∏–º–æ–≥ –¥–æ –ø–∞—Ä–æ–ª—è ‚Äî –∫–æ–∂–µ–Ω –º–∞—Ç–∏–º–µ –≤–ª–∞—Å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É

#### –í–∏–∫–æ–Ω–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

```csharp showLineNumbers
var dto = new CreateUserDto
{
    Email = "invalid",
    Name = "Jo",
    Age = 15,
    Password = "weak"
};

var validator = new CreateUserValidator();
var result = validator.Validate(dto);

if (!result.IsValid)
{
    foreach (var error in result.Errors)
    {
        Console.WriteLine($"[{error.PropertyName}] {error.ErrorMessage}");
    }

    // Output:
    // [Email] Invalid email format
    // [Name] Name must be between 3 and 50 characters
    // [Age] Age must be between 18 and 120
    // [Password] Password must be at least 8 characters
    // [Password] Password must contain at least one uppercase letter
    // [Password] Password must contain at least one lowercase letter
    // [Password] Password must contain at least one digit
    // [Password] Password must contain at least one special character
}
```

**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É:**

-   **–†—è–¥–æ–∫ 10**: –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `Validate()`, –ø–æ–≤–µ—Ä—Ç–∞—î `ValidationResult`
-   **–†—è–¥–æ–∫ 16**: –ö–æ–∂–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –º—ñ—Å—Ç–∏—Ç—å `PropertyName` —Ç–∞ `ErrorMessage`, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ª–µ–≥–∫–æ –º–∞–ø–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –¥–æ –ø–æ–ª—ñ–≤ —É UI

#### –°–∫–ª–∞–¥–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó FluentValidation

::tabs

:::tab{label="Custom Validators"}

–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–æ–≥–æ –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä–∞ –¥–ª—è —Å–∫–ª–∞–¥–Ω–æ—ó –ª–æ–≥—ñ–∫–∏:

```csharp showLineNumbers
public class CreateUserValidator : AbstractValidator<CreateUserDto>
{
    private readonly IUserRepository _userRepository;

    public CreateUserValidator(IUserRepository userRepository)
    {
        _userRepository = userRepository;

        RuleFor(x => x.Email)
            .NotEmpty()
            .EmailAddress()
            .MustAsync(BeUniqueEmail).WithMessage("Email is already registered");
    }

    // Async custom validator
    private async Task<bool> BeUniqueEmail(string email, CancellationToken cancellationToken)
    {
        return !await _userRepository.ExistsAsync(email, cancellationToken);
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 12**: `MustAsync` –¥–æ–∑–≤–æ–ª—è—î –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å I/O (–ë–î, API)
-   **–†—è–¥–æ–∫ 16-19**: –ö–∞—Å—Ç–æ–º–Ω–∏–π –º–µ—Ç–æ–¥ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –ø–æ–≤–µ—Ä—Ç–∞—î `true`, —è–∫—â–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è _–ø—Ä–æ–π—à–ª–∞_ (email —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π)

:::

:::tab{label="Conditional Validation"}

–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –ª–∏—à–µ –∑–∞ –ø–µ–≤–Ω–∏—Ö —É–º–æ–≤:

```csharp showLineNumbers
public class OrderValidator : AbstractValidator<Order>
{
    public OrderValidator()
    {
        // –í–∞–ª—ñ–¥—É–≤–∞—Ç–∏ ShippingAddress —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ RequiresShipping = true
        When(x => x.RequiresShipping, () =>
        {
            RuleFor(x => x.ShippingAddress).NotEmpty();
            RuleFor(x => x.ShippingAddress.City).NotEmpty();
            RuleFor(x => x.ShippingAddress.PostalCode).Matches(@"^\d{5}$");
        });

        // –í–∞–ª—ñ–¥—É–≤–∞—Ç–∏ DiscountCode —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤—ñ–Ω –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π
        Unless(x => string.IsNullOrEmpty(x.DiscountCode), () =>
        {
            RuleFor(x => x.DiscountCode)
                .Length(6, 12)
                .Matches(@"^[A-Z0-9]+$");
        });
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 6-11**: `When` –≤–∏–∫–æ–Ω—É—î –≤–∫–ª–∞–¥–µ–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –ª–∏—à–µ —è–∫—â–æ —É–º–æ–≤–∞ —ñ—Å—Ç–∏–Ω–Ω–∞
-   **–†—è–¥–æ–∫ 14-19**: `Unless` ‚Äî –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ—Å—Ç—å `When`, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∫–æ–ª–∏ —É–º–æ–≤–∞ —Ö–∏–±–Ω–∞

:::

:::tab{label="RuleSet"}

–ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤:

```csharp showLineNumbers
public class UserValidator : AbstractValidator<User>
{
    public UserValidator()
    {
        // Default rules - –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è
        RuleFor(x => x.Id).NotEmpty();

        // RuleSet –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        RuleSet("Create", () =>
        {
            RuleFor(x => x.Email).NotEmpty().EmailAddress();
            RuleFor(x => x.Password).NotEmpty().MinimumLength(8);
        });

        // RuleSet –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
        RuleSet("Update", () =>
        {
            // –ü—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –ø–∞—Ä–æ–ª—å –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π
            RuleFor(x => x.Password)
                .MinimumLength(8)
                .When(x => !string.IsNullOrEmpty(x.Password));
        });
    }
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
var validator = new UserValidator();

// –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
var createResult = validator.Validate(user, options =>
{
    options.IncludeRuleSets("Create");
});

// –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
var updateResult = validator.Validate(user, options =>
{
    options.IncludeRuleSets("Update");
});
```

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ RuleSets**: –ö–æ–ª–∏ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ —Ä—ñ–∑–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö –∑ —Ä—ñ–∑–Ω–∏–º–∏ –≤–∏–º–æ–≥–∞–º–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó.

:::

:::tab{label="Child Validators"}

–í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤:

```csharp showLineNumbers
public class Address
{
    public string Street { get; set; }
    public string City { get; set; }
    public string PostalCode { get; set; }
}

public class AddressValidator : AbstractValidator<Address>
{
    public AddressValidator()
    {
        RuleFor(x => x.Street).NotEmpty();
        RuleFor(x => x.City).NotEmpty();
        RuleFor(x => x.PostalCode).Matches(@"^\d{5}$");
    }
}

public class User
{
    public string Name { get; set; }
    public Address HomeAddress { get; set; }
    public List<Address> PreviousAddresses { get; set; }
}

public class UserValidator : AbstractValidator<User>
{
    public UserValidator()
    {
        RuleFor(x => x.Name).NotEmpty();

        // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –æ–¥–Ω–æ–≥–æ –≤–∫–ª–∞–¥–µ–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞
        RuleFor(x => x.HomeAddress)
            .SetValidator(new AddressValidator());

        // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–ª–µ–∫—Ü—ñ—ó
        RuleForEach(x => x.PreviousAddresses)
            .SetValidator(new AddressValidator());
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 32-33**: `SetValidator` –∑–∞—Å—Ç–æ—Å–æ–≤—É—î —ñ—Å–Ω—É—é—á–∏–π –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä –¥–æ –≤–∫–ª–∞–¥–µ–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞
-   **–†—è–¥–æ–∫ 36-37**: `RuleForEach` –∑–∞—Å—Ç–æ—Å–æ–≤—É—î –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä –¥–æ –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –∫–æ–ª–µ–∫—Ü—ñ—ó

:::

::

#### –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ ASP.NET Core

```csharp showLineNumbers
// Program.cs –∞–±–æ Startup.cs
using FluentValidation;
using FluentValidation.AspNetCore;

var builder = WebApplication.CreateBuilder(args);

// –î–æ–¥–∞–≤–∞–Ω–Ω—è FluentValidation –¥–æ DI
builder.Services.AddControllers()
    .AddFluentValidation(config =>
    {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤—Å—ñ—Ö –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä—ñ–≤ –∑ assembly
        config.RegisterValidatorsFromAssemblyContaining<Program>();

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–∏ Model Binding
        config.AutomaticValidationEnabled = true;
    });

// Controller usage
[ApiController]
[Route("api/users")]
public class UsersController : ControllerBase
{
    [HttpPost]
    public IActionResult CreateUser([FromBody] CreateUserDto dto)
    {
        // –Ø–∫—â–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–æ–≤–∞–ª–µ–Ω–∞, ASP.NET –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î 400 Bad Request
        if (!ModelState.IsValid)
            return BadRequest(ModelState);

        // Business logic
        return Ok();
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 12**: `RegisterValidatorsFromAssemblyContaining<T>()` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ç–∞ —Ä–µ—î—Å—Ç—Ä—É—î –≤—Å—ñ –∫–ª–∞—Å–∏, —â–æ –Ω–∞—Å–ª—ñ–¥—É—é—Ç—å—Å—è –≤—ñ–¥ `AbstractValidator<T>`
-   **–†—è–¥–æ–∫ 27**: ASP.NET Core –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω—É—î –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –ø—ñ–¥ —á–∞—Å model binding —ñ –Ω–∞–ø–æ–≤–Ω—é—î `ModelState`

::tip
**–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—ñ–¥—Ö–æ–¥—ñ–≤ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó**:

| –ü—ñ–¥—Ö—ñ–¥                 | –ü–µ—Ä–µ–≤–∞–≥–∏                                | –ù–µ–¥–æ–ª—ñ–∫–∏                   | –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏               |
| :--------------------- | :-------------------------------------- | :------------------------- | :--------------------------------- |
| **Data Annotations**   | –ü—Ä–æ—Å—Ç–æ—Ç–∞, –≤–±—É–¥–æ–≤–∞–Ω–æ –≤ .NET              | –û–±–º–µ–∂–µ–Ω–∞ –≥–Ω—É—á–∫—ñ—Å—Ç—å         | –ü—Ä–æ—Å—Ç—ñ DTO –∑ –±–∞–∑–æ–≤–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏    |
| **IValidatableObject** | Cross-field validation, –ª–µ–≥–∫–∏–π —Å—Ç–∞—Ä—Ç    | –ó–º—ñ—à—É—î –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –∑ –º–æ–¥–µ–ª–ª—é | –ü—Ä–æ—Å—Ç—ñ cross-field –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤ DTO |
| **FluentValidation**   | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≥–Ω—É—á–∫—ñ—Å—Ç—å, SRP, —Ç–µ—Å—Ç–æ–≤–Ω—ñ—Å—Ç—å | –î–æ–¥–∞—Ç–∫–æ–≤–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞       | –°–∫–ª–∞–¥–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è, –≤–µ–ª–∏–∫—ñ –ø—Ä–æ—î–∫—Ç–∏  |
| **Guard Clauses**      | Fail-fast, –∑–∞—Ö–∏—Å—Ç –º–µ—Ç–æ–¥—ñ–≤               | –ù–µ –¥–ª—è UI-driven –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó | Defensive programming –≤ –º–µ—Ç–æ–¥–∞—Ö    |

::

---

## –ß–∞—Å—Ç–∏–Ω–∞ 4: –û–±—Ä–æ–±–∫–∞ –ª–æ–≥—ñ—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ –±–µ–∑ –≤–∏–Ω—è—Ç–∫—ñ–≤

### 4.1. –ü—Ä–æ–±–ª–µ–º–∞ Exception-Driven Development

–ë–∞–≥–∞—Ç–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –≤–∏–Ω—è—Ç–∫–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é _–∑–≤–∏—á–∞–π–Ω–æ–≥–æ_ –ø–æ—Ç–æ–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ "Exception-Driven Development" (EDD). –¶–µ anti-pattern.

#### –ü—Ä–∏–∫–ª–∞–¥ EDD

```csharp showLineNumbers
// ‚ùå Exception-Driven Development
public User GetUserByEmail(string email)
{
    var user = _repository.FindByEmail(email);

    if (user == null)
        throw new UserNotFoundException($"User with email {email} not found");

    if (!user.IsActive)
        throw new UserInactiveException("User account is deactivated");

    if (user.IsLocked)
        throw new UserLockedException("User account is locked");

    return user;
}

// Calling code
try
{
    var user = GetUserByEmail("test@example.com");
    ProcessUser(user);
}
catch (UserNotFoundException ex)
{
    return NotFound(ex.Message);
}
catch (UserInactiveException ex)
{
    return BadRequest(ex.Message);
}
catch (UserLockedException ex)
{
    return Forbidden(ex.Message);
}
```

**–ü—Ä–æ–±–ª–µ–º–∏ —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:**

1.  **–ü–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å**: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è exception –≤–∫–ª—é—á–∞—î –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é stack trace, —â–æ –¥–æ—Ä–æ–≥–æ
2.  **–°–µ–º–∞–Ω—Ç–∏–∫–∞**: –í–∏–Ω—è—Ç–∫–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è _–≤–∏–Ω—è—Ç–∫–æ–≤–∏—Ö_ —Å–∏—Ç—É–∞—Ü—ñ–π, –∞ –Ω–µ –¥–ª—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏
3.  **–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ç–æ–∫—É**: –ù–µ–∑—Ä–æ–∑—É–º—ñ–ª–æ, —è–∫—ñ –≤–∏–Ω—è—Ç–∫–∏ –º–æ–∂–µ –∫–∏–Ω—É—Ç–∏ –º–µ—Ç–æ–¥ (–Ω–µ–º–∞—î compile-time –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏)
4.  **–ß–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å**: –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ —Ä–æ–∑–∫–∏–¥–∞–Ω–∞ –ø–æ `catch` –±–ª–æ–∫–∞—Ö

#### –í–∞—Ä—Ç—ñ—Å—Ç—å –≤–∏–Ω—è—Ç–∫—ñ–≤: –±–µ–Ω—á–º–∞—Ä–∫

```csharp showLineNumbers
using BenchmarkDotNet.Attributes;
using BenchmarkDotNet.Running;

public class ExceptionVsResultBenchmark
{
    [Benchmark]
    public int ExceptionFlow()
    {
        try
        {
            return DivideWithException(10, 0);
        }
        catch
        {
            return -1;
        }
    }

    [Benchmark]
    public int ResultFlow()
    {
        var result = DivideWithResult(10, 0);
        return result.IsSuccess ? result.Value : -1;
    }

    private int DivideWithException(int a, int b)
    {
        if (b == 0) throw new DivideByZeroException();
        return a / b;
    }

    private Result<int> DivideWithResult(int a, int b)
    {
        if (b == 0) return Result.Fail<int>("Cannot divide by zero");
        return Result.Ok(a / b);
    }
}

// –ó–∞–ø—É—Å–∫: dotnet run -c Release
BenchmarkRunner.Run<ExceptionVsResultBenchmark>();
```

**–¢–∏–ø–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –±–µ–Ω—á–º–∞—Ä–∫—É:**

| Method        | Mean     | Error  | Ratio |
| :------------ | :------- | :----- | :---- |
| ResultFlow    | 5.2 ns   | 0.1 ns | 1.00x |
| ExceptionFlow | 8,450 ns | 120 ns | 1625x |

::caution
**–í–∏—Å–Ω–æ–≤–æ–∫**: Exception-driven flow **~1600 —Ä–∞–∑—ñ–≤ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏–π** –∑–∞ Result-based flow! –¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤ high-performance —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö (loops, API endpoints –∑ —Ç–∏—Å—è—á–∞–º–∏ RPS).
::

### 4.2. –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Exceptions?

**Exceptions** –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è _–≤–∏–Ω—è—Ç–∫–æ–≤–∏—Ö_, –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π, —è–∫—ñ –ø–æ—Ä—É—à—É—é—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π –ø–æ—Ç—ñ–∫ –ø—Ä–æ–≥—Ä–∞–º–∏.

::field-group

:::field{name="‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Exceptions –¥–ª—è"}

-   **–°–∏—Å—Ç–µ–º–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫**: OutOfMemoryException, StackOverflowException
-   **–Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º**: –ú–µ—Ä–µ–∂–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –¥–∏—Å–∫ –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–∏–π, –ë–î –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î
-   **–ü—Ä–æ–≥—Ä–∞–º–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫**: NullReferenceException (bug –≤ –∫–æ–¥—ñ), ArgumentException (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∏–∫–ª–∏–∫ API)
-   **–ù–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π**: –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤—ñ–¥—Å—É—Ç–Ω—è, —Ñ–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —Ç–∞–º, –¥–µ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏

```csharp
// ‚úÖ Good use of exceptions
public void SaveToFile(string path, string content)
{
    // System/Infra exception - cannot be predicted at compile time
    File.WriteAllText(path, content);  // –ú–æ–∂–µ –∫–∏–Ω—É—Ç–∏ IOException
}

public void ConfigureService()
{
    var config = Configuration.GetSection("Database");

    // Programming error - developer mistake
    if (config == null)
        throw new InvalidOperationException("Database configuration is missing");
}
```

:::

:::field{name="‚ùå –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Exceptions –¥–ª—è"}

-   **–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏**: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π, –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤, email –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π
-   **–í–∞–ª—ñ–¥–∞—Ü—ñ—ó**: –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç, –ø–æ—Ä–æ–∂–Ω—î –ø–æ–ª–µ, –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–∑–∞ –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º
-   **–ö–æ–Ω—Ç—Ä–æ–ª—é –ø–æ—Ç–æ–∫—É**: "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é exception –∑–∞–º—ñ—Å—Ç—å `if`"
-   **Expected failures**: –ë—É–¥—å-—è–∫—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó, —â–æ —î —á–∞—Å—Ç–∏–Ω–æ—é –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ñ–ª–æ—É

```csharp
// ‚ùå Bad use of exceptions
public User GetUser(int id)
{
    var user = _repository.Find(id);

    // This is business logic, not an exceptional situation!
    if (user == null)
        throw new UserNotFoundException();  // ‚ùå

    return user;
}

// ‚úÖ Correct approach
public Result<User> GetUser(int id)
{
    var user = _repository.Find(id);

    // Business logic failure - return Result
    if (user == null)
        return Result.Fail<User>("User not found");  // ‚úÖ

    return Result.Ok(user);
}
```

:::

::

### 4.3. Result Pattern ‚Äî Foundation

**Result Pattern** ‚Äî —Ü–µ –ø—ñ–¥—Ö—ñ–¥, –∫–æ–ª–∏ –º–µ—Ç–æ–¥ —è–≤–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î –æ–±'—î–∫—Ç, —â–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∞–±–æ —É—Å–ø—ñ—Ö –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º, –∞–±–æ –ø–æ–º–∏–ª–∫—É, –∑–∞–º—ñ—Å—Ç—å –∫–∏–¥–∞–Ω–Ω—è –≤–∏–Ω—è—Ç–∫—É.

#### –ë–∞–∑–æ–≤–∞ —ñ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è Result

```csharp showLineNumbers
public class Result
{
    public bool IsSuccess { get; }
    public bool IsFailure => !IsSuccess;
    public string Error { get; }

    protected Result(bool isSuccess, string error)
    {
        if (isSuccess && !string.IsNullOrEmpty(error))
            throw new InvalidOperationException("Success result cannot have an error");

        if (!isSuccess && string.IsNullOrEmpty(error))
            throw new InvalidOperationException("Failure result must have an error");

        IsSuccess = isSuccess;
        Error = error ?? string.Empty;
    }

    // Factory methods
    public static Result Ok() => new Result(true, null);
    public static Result Fail(string error) => new Result(false, error);
}

// Generic version for results with value
public class Result<T> : Result
{
    public T Value { get; }

    protected Result(T value, bool isSuccess, string error)
        : base(isSuccess, error)
    {
        Value = value;
    }

    // Factory methods
    public static Result<T> Ok(T value) => new Result<T>(value, true, null);
    public static Result<T> Fail(string error) => new Result<T>(default, false, error);
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 9-13**: –Ü–Ω–≤–∞—Ä—ñ–∞–Ω—Ç–∏: Success –Ω–µ –º–æ–∂–µ –º–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É, Failure _–ø–æ–≤–∏–Ω–Ω–∞_ –º–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É
-   **–†—è–¥–æ–∫ 20-21**: Factory methods –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ (–∑–∞–º—ñ—Å—Ç—å `new`)
-   **–†—è–¥–æ–∫ 25**: Generic –≤–µ—Ä—Å—ñ—è –¥–æ–∑–≤–æ–ª—è—î –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑ –∑–Ω–∞—á–µ–Ω–Ω—è–º `T`

#### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Result

```csharp showLineNumbers
public class UserService
{
    public Result<User> GetUserByEmail(string email)
    {
        // Validation
        if (string.IsNullOrWhiteSpace(email))
            return Result<User>.Fail("Email is required");

        var user = _repository.FindByEmail(email);

        // Business logic check
        if (user == null)
            return Result<User>.Fail("User not found");

        if (!user.IsActive)
            return Result<User>.Fail("User account is deactivated");

        if (user.IsLocked)
            return Result<User>.Fail("User account is locked");

        return Result<User>.Ok(user);
    }
}

// Calling code - —è–≤–Ω–∞ –æ–±—Ä–æ–±–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
var result = _userService.GetUserByEmail("test@example.com");

if (result.IsFailure)
{
    _logger.LogWarning("Failed to get user: {Error}", result.Error);
    return BadRequest(result.Error);
}

var user = result.Value;
ProcessUser(user);
```

**–ü–µ—Ä–µ–≤–∞–≥–∏ Result Pattern:**

-   ‚úÖ **–Ø–≤–Ω—ñ—Å—Ç—å**: –ú–µ—Ç–æ–¥ _—è–≤–Ω–æ_ –ø–æ–≤—ñ–¥–æ–º–ª—è—î, —â–æ –º–æ–∂–µ –ø—Ä–æ–≤–∞–ª–∏—Ç–∏—Å—è (—Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ç–∏–ø—É)
-   ‚úÖ **–ü–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å**: –ù–µ–º–∞—î overhead –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è stack trace
-   ‚úÖ **–ö–æ–º–ø–æ–∑–∏—Ü—ñ—è**: –õ–µ–≥–∫–æ –∫–æ–º–±—ñ–Ω—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ (Railway Oriented Programming)
-   ‚úÖ **–¢–µ—Å—Ç–æ–≤–Ω—ñ—Å—Ç—å**: –õ–µ–≥–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —É—Å–ø—ñ—à–Ω—ñ —Ç–∞ –Ω–µ—É—Å–ø—ñ—à–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó

### 4.4. Railway Oriented Programming (ROP)

**Railway Oriented Programming** ‚Äî —Ü–µ –º–µ—Ç–∞—Ñ–æ—Ä–∞ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Result Pattern, –¥–µ –∫–æ–¥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —è–∫ –ø–æ—Ç—è–≥ –ø–æ —Ä–µ–π–∫–∞—Ö:

-   **Success track** (–∑–µ–ª–µ–Ω–∞ –∫–æ–ª—ñ—è): –í—Å–µ –π–¥–µ –¥–æ–±—Ä–µ, –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ
-   **Failure track** (—á–µ—Ä–≤–æ–Ω–∞ –∫–æ–ª—ñ—è): –ü–æ–º–∏–ª–∫–∞ ‚Äî –ø–æ—Ç—è–≥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ failure track —ñ –ø—Ä–æ–ø—É—Å–∫–∞—î –≤—Å—ñ –Ω–∞—Å—Ç—É–ø–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

::mermaid

```mermaid
graph LR
    A[Input] --> B{Operation 1}
    B -->|Success| C{Operation 2}
    B -->|Failure| F1[Failure]
    C -->|Success| D{Operation 3}
    C -->|Failure| F2[Failure]
    D -->|Success| E[Success Result]
    D -->|Failure| F3[Failure]

    F1 --> F[Final Failure]
    F2 --> F
    F3 --> F

    style B fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style C fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style D fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style E fill:#10b981,stroke:#059669,color:#ffffff
    style F fill:#ef4444,stroke:#b91c1c,color:#ffffff
    style F1 fill:#ef4444,stroke:#b91c1c,color:#ffffff
    style F2 fill:#ef4444,stroke:#b91c1c,color:#ffffff
    style F3 fill:#ef4444,stroke:#b91c1c,color:#ffffff
```

::

#### –ë–∞–∑–æ–≤—ñ ROP Extension Methods

–†–æ–∑—à–∏—Ä–∏–º–æ –Ω–∞—à `Result` –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü—ñ—ó:

```csharp showLineNumbers
public class Result<T>
{
    // ... –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–¥ ...

    // Map: Transform value if success
    public Result<TNew> Map<TNew>(Func<T, TNew> mapper)
    {
        if (IsFailure)
            return Result<TNew>.Fail(Error);

        return Result<TNew>.Ok(mapper(Value));
    }

    // Bind (FlatMap): Chain operations that return Result
    public Result<TNew> Bind<TNew>(Func<T, Result<TNew>> binder)
    {
        if (IsFailure)
            return Result<TNew>.Fail(Error);

        return binder(Value);
    }

    // OnSuccess: Execute action if success
    public Result<T> OnSuccess(Action<T> action)
    {
        if (IsSuccess)
            action(Value);

        return this;
    }

    // OnFailure: Execute action if failure
    public Result<T> OnFailure(Action<string> action)
    {
        if (IsFailure)
            action(Error);

        return this;
    }

    // Match: Handle both cases
    public TResult Match<TResult>(
        Func<T, TResult> onSuccess,
        Func<string, TResult> onFailure)
    {
        return IsSuccess ? onSuccess(Value) : onFailure(Error);
    }
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤:**

-   **–†—è–¥–æ–∫ 6-12**: `Map` –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Result, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —É—Å–ø—ñ—Ö—É/–ø–æ–º–∏–ª–∫–∏
-   **–†—è–¥–æ–∫ 15-21**: `Bind` (—Ç–∞–∫–æ–∂ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è `FlatMap`) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ª–∞–Ω—Ü—é–∂–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ–π, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å Result
-   **–†—è–¥–æ–∫ 24-30**: `OnSuccess` –≤–∏–∫–æ–Ω—É—î side-effect (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ª–æ–≥—É–≤–∞–Ω–Ω—è) –ø—Ä–∏ —É—Å–ø—ñ—Ö—É
-   **–†—è–¥–æ–∫ 33-39**: `OnFailure` –≤–∏–∫–æ–Ω—É—î side-effect –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ
-   **–†—è–¥–æ–∫ 42-47**: `Match` ‚Äî pattern matching –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –æ–±–æ—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

#### ROP –≤ –¥—ñ—ó: –ø—Ä–∏–∫–ª–∞–¥ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—É –≥—Ä–æ—à–µ–π

```csharp showLineNumbers
public class BankingService
{
    public Result TransferMoney(string fromAccountId, string toAccountId, decimal amount)
    {
        return GetAccount(fromAccountId)
            .Bind(fromAccount => GetAccount(toAccountId)
                .Map(toAccount => (From: fromAccount, To: toAccount)))
            .Bind(accounts => ValidateTransfer(accounts.From, amount))
            .Bind(fromAccount => DebitAccount(fromAccount, amount))
            .Bind(fromAccount => CreditAccount(toAccountId, amount)
                .Map(_ => fromAccount))
            .OnSuccess(fromAccount =>
                _logger.LogInformation("Transfer completed from {From}", fromAccount.Id))
            .OnFailure(error =>
                _logger.LogWarning("Transfer failed: {Error}", error));
    }

    private Result<Account> GetAccount(string accountId)
    {
        var account = _repository.Find(accountId);
        return account != null
            ? Result<Account>.Ok(account)
            : Result<Account>.Fail($"Account {accountId} not found");
    }

    private Result<Account> ValidateTransfer(Account account, decimal amount)
    {
        if (amount <= 0)
            return Result<Account>.Fail("Amount must be positive");

        if (account.Balance < amount)
            return Result<Account>.Fail("Insufficient funds");

        return Result<Account>.Ok(account);
    }

    private Result<Account> DebitAccount(Account account, decimal amount)
    {
        account.Balance -= amount;
        _repository.Update(account);
        return Result<Account>.Ok(account);
    }

    private Result CreditAccount(string accountId, decimal amount)
    {
        return GetAccount(accountId)
            .Bind(account =>
            {
                account.Balance += amount;
                _repository.Update(account);
                return Result.Ok();
            });
    }
}
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1.  **–†—è–¥–æ–∫ 5**: –û—Ç—Ä–∏–º—É—î–º–æ –ø–µ—Ä—à–∏–π —Ä–∞—Ö—É–Ω–æ–∫ (`GetAccount` –ø–æ–≤–µ—Ä—Ç–∞—î `Result<Account>`)
2.  **–†—è–¥–æ–∫ 6**: –Ø–∫—â–æ —É—Å–ø—ñ—Ö ‚Äî –æ—Ç—Ä–∏–º—É—î–º–æ –¥—Ä—É–≥–∏–π —Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞ –∫–æ–º–±—ñ–Ω—É—î–º–æ —ó—Ö —É tuple
3.  **–†—è–¥–æ–∫ 8**: –í–∞–ª—ñ–¥—É—î–º–æ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä (–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≥—Ä–æ—à–µ–π?)
4.  **–†—è–¥–æ–∫ 9**: –ó–Ω—ñ–º–∞—î–º–æ –≥—Ä–æ—à—ñ –∑ –ø–µ—Ä—à–æ–≥–æ —Ä–∞—Ö—É–Ω–∫—É
5.  **–†—è–¥–æ–∫ 10**: –î–æ–¥–∞—î–º–æ –≥—Ä–æ—à—ñ –Ω–∞ –¥—Ä—É–≥–∏–π —Ä–∞—Ö—É–Ω–æ–∫
6.  **–†—è–¥–æ–∫ 12-15**: –õ–æ–≥—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ú–∞–≥—ñ—è**: –Ø–∫—â–æ _–±—É–¥—å-—è–∫–∏–π_ –∫—Ä–æ–∫ –ø–æ–≤–µ—Ä—Ç–∞—î Failure, –≤—Å—ñ –Ω–∞—Å—Ç—É–ø–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—å—Å—è, —ñ –º–∏ –æ–¥—Ä–∞–∑—É –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–æ–º–∏–ª–∫—É.

---

## –ß–∞—Å—Ç–∏–Ω–∞ 5: Production-Ready –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏

–ó–∞–º—ñ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –≤–ª–∞—Å–Ω–æ—ó —ñ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—ó Result, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏.

### 5.1. FluentResults

[FluentResults](https://github.com/altmann/FluentResults) ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Result Pattern —É .NET.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
dotnet add package FluentResults
```

#### –û—Å–Ω–æ–≤–∏ FluentResults

```csharp showLineNumbers
using FluentResults;

public class UserService
{
    public Result<User> CreateUser(string email, string password)
    {
        // Simple failure
        if (string.IsNullOrEmpty(email))
            return Result.Fail("Email is required");

        // Failure with typed error
        if (!IsValidEmail(email))
            return Result.Fail(new InvalidEmailError(email));

        // Multiple errors
        var errors = new List<IError>();

        if (password.Length < 8)
            errors.Add(new Error("Password too short"));

        if (!HasSpecialChar(password))
            errors.Add(new Error("Password must contain special character"));

        if (errors.Any())
            return Result.Fail(errors);

        var user = new User { Email = email };
        _repository.Add(user);

        // Success with value
        return Result.Ok(user);
    }
}

// Custom Error Type
public class InvalidEmailError : Error
{
    public InvalidEmailError(string email)
        : base($"Email '{email}' is invalid")
    {
        Metadata.Add("EmailValue", email);
    }
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏ FluentResults:**

-   ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫
-   ‚úÖ –¢–∏–ø—ñ–∑–æ–≤–∞–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –∑ metadata
-   ‚úÖ Success messages (–Ω–µ —Ç—ñ–ª—å–∫–∏ errors)
-   ‚úÖ –Ü—î—Ä–∞—Ä—Ö—ñ—è –ø–æ–º–∏–ª–æ–∫ (CausedBy)

#### FluentResults: –†–æ–±–æ—Ç–∞ –∑ –ø–æ–º–∏–ª–∫–∞–º–∏

```csharp showLineNumbers
var result = userService.CreateUser("invalid-email", "weak");

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
if (result.IsFailed)
{
    // –î–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö –ø–æ–º–∏–ª–æ–∫
    foreach (var error in result.Errors)
    {
        Console.WriteLine(error.Message);

        // Metadata
        if (error.Metadata.TryGetValue("EmailValue", out var email))
            Console.WriteLine($"Invalid email was: {email}");
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ specific error type
    if (result.HasError<InvalidEmailError>())
    {
        var emailError = result.Errors.OfType<InvalidEmailError>().First();
        Console.WriteLine($"Email error: {emailError.Message}");
    }
}

// Pattern matching
var response = result.Match(
    onSuccess: user => $"User created: {user.Email}",
    onFailure: errors => $"Failed: {string.Join(", ", errors.Select(e => e.Message))}"
);
```

#### FluentResults: –õ–∞–Ω—Ü—é–∂–æ–∫ –æ–ø–µ—Ä–∞—Ü—ñ–π

```csharp showLineNumbers
public Result ProcessOrder(int orderId)
{
    return GetOrder(orderId)
        .Bind(order => ValidateOrder(order))
        .Bind(order => ChargePayment(order))
        .Bind(order => SendConfirmation(order))
        .Log("Order processing"); // Built-in logging
}

private Result<Order> GetOrder(int id)
{
    var order = _repository.Find(id);
    return order != null
        ? Result.Ok(order)
        : Result.Fail($"Order {id} not found");
}

private Result<Order> ValidateOrder(Order order)
{
    if (order.Items.Count == 0)
        return Result.Fail("Order has no items");

    if (order.Total <= 0)
        return Result.Fail("Invalid order total");

    return Result.Ok(order);
}

private Result<Order> ChargePayment(Order order)
{
    try
    {
        _paymentGateway.Charge(order.Total);
        return Result.Ok(order);
    }
    catch (PaymentException ex)
    {
        // Wrapping exception as error
        return Result.Fail(new ExceptionalError(ex));
    }
}

private Result<Order> SendConfirmation(Order order)
{
    _emailService.SendOrderConfirmation(order);
    return Result.Ok(order);
}
```

::tip
**FluentResults.Extensions.AspNetCore**: –Ñ extension package –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ ASP.NET Core, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç—É—î `Result` –≤ `IActionResult`:

```bash
dotnet add package FluentResults.Extensions.AspNetCore
```

```csharp
[HttpPost]
public ActionResult<User> CreateUser(CreateUserDto dto)
{
    var result = _userService.CreateUser(dto.Email, dto.Password);
    return result.ToActionResult(); // Auto-converts to Ok() or BadRequest()
}
```

::

### 5.2. ErrorOr

[ErrorOr](https://github.com/amantinband/error-or) ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞, —ñ–Ω—Å–ø—ñ—Ä–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è–º.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
dotnet add package ErrorOr
```

#### –û—Å–Ω–æ–≤–∏ ErrorOr

```csharp showLineNumbers
using ErrorOr;

public class ProductService
{
    public ErrorOr<Product> GetProduct(int id)
    {
        var product = _repository.Find(id);

        if (product is null)
            return Error.NotFound(
                code: "Product.NotFound",
                description: $"Product with id {id} was not found");

        if (product.IsDiscontinued)
            return Error.Validation(
                code: "Product.Discontinued",
                description: "Product is no longer available");

        return product; // Implicit conversion to ErrorOr<Product>
    }
}
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ ErrorOr:**

-   ‚úÖ **Built-in error types**: NotFound, Validation, Conflict, Unauthorized, Forbidden, Failure, Unexpected
-   ‚úÖ **Discriminated Union**: `ErrorOr<T>` ‚Äî —Ü–µ union —Ç–∏–ø—É "–∞–±–æ –∑–Ω–∞—á–µ–Ω–Ω—è, –∞–±–æ –ø–æ–º–∏–ª–∫–∞"
-   ‚úÖ **Implicit conversions**: `return product;` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç—É—î—Ç—å—Å—è –≤ `ErrorOr<Product>`

#### ErrorOr: –í–±—É–¥–æ–≤–∞–Ω—ñ —Ç–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫

```csharp showLineNumbers
public ErrorOr<User> AuthenticateUser(string email, string password)
{
    var user = _repository.FindByEmail(email);

    // NotFound - —Ä–µ—Å—É—Ä—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ
    if (user is null)
        return Error.NotFound(
            code: "User.NotFound",
            description: "User not found");

    // Unauthorized - –Ω–µ–≤—ñ—Ä–Ω—ñ credentials
    if (!_passwordHasher.Verify(password, user.PasswordHash))
        return Error.Unauthorized(
            code: "User.InvalidCredentials",
            description: "Invalid email or password");

    // Forbidden - –¥–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏–π
    if (user.IsBanned)
        return Error.Forbidden(
            code: "User.Banned",
            description: "Your account has been banned");

    // Conflict - –∫–æ–Ω—Ñ–ª—ñ–∫—Ç —Å—Ç–∞–Ω—É
    if (user.IsAlreadyLoggedIn)
        return Error.Conflict(
            code: "User.AlreadyLoggedIn",
            description: "User is already logged in from another device");

    return user;
}
```

**Mapping error types –¥–æ HTTP status codes:**

| ErrorType    | HTTP Status        | –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è                      |
| :----------- | :----------------- | :-------------------------------- |
| NotFound     | 404 Not Found      | –†–µ—Å—É—Ä—Å –Ω–µ —ñ—Å–Ω—É—î                   |
| Validation   | 400 Bad Request    | –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ                   |
| Conflict     | 409 Conflict       | –ö–æ–Ω—Ñ–ª—ñ–∫—Ç —Å—Ç–∞–Ω—É (–¥—É–±–ª—ñ–∫–∞—Ç, locked) |
| Unauthorized | 401 Unauthorized   | –ù–µ–≤—ñ—Ä–Ω—ñ credentials               |
| Forbidden    | 403 Forbidden      | –ù–µ–º–∞—î –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É                |
| Failure      | 400 Bad Request    | –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞            |
| Unexpected   | 500 Internal Error | –ù–µ–ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∞ –ø–æ–º–∏–ª–∫–∞             |

#### ErrorOr: Pattern Matching

```csharp showLineNumbers
public IActionResult GetProduct(int id)
{
    ErrorOr<Product> result = _productService.GetProduct(id);

    // Match with value and errors
    return result.Match(
        value => Ok(value),
        errors => Problem(errors));

    // MatchFirst with value and first error only
    return result.MatchFirst(
        value => Ok(value),
        firstError => firstError.Type switch
        {
            ErrorType.NotFound => NotFound(firstError.Description),
            ErrorType.Validation => BadRequest(firstError.Description),
            _ => Problem(firstError.Description)
        });
}

// Helper –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –ø–æ–º–∏–ª–æ–∫ –≤ ProblemDetails
private IActionResult Problem(List<Error> errors)
{
    var statusCode = errors[0].Type switch
    {
        ErrorType.NotFound => StatusCodes.Status404NotFound,
        ErrorType.Validation => StatusCodes.Status400BadRequest,
        ErrorType.Conflict => StatusCodes.Status409Conflict,
        ErrorType.Unauthorized => StatusCodes.Status401Unauthorized,
        ErrorType.Forbidden => StatusCodes.Status403Forbidden,
        _ => StatusCodes.Status500InternalServerError
    };

    return Problem(
        statusCode: statusCode,
        title: "One or more errors occurred",
        detail: string.Join("; ", errors.Select(e => e.Description)));
}
```

#### ErrorOr: Fluent Chaining

```csharp showLineNumbers
public ErrorOr<OrderConfirmation> PlaceOrder(PlaceOrderRequest request)
{
    return ValidateRequest(request)
        .Then(req => CreateOrder(req))
        .Then(order => ReserveInventory(order))
        .Then(order => ProcessPayment(order))
        .Then(order => SendNotification(order))
        .Then(order => new OrderConfirmation(order.Id, order.Total));
}

private ErrorOr<PlaceOrderRequest> ValidateRequest(PlaceOrderRequest request)
{
    if (request.Items.Count == 0)
        return Error.Validation(
            code: "Order.NoItems",
            description: "Order must contain at least one item");

    return request;
}

private ErrorOr<Order> CreateOrder(PlaceOrderRequest request)
{
    var order = new Order
    {
        Items = request.Items,
        CustomerId = request.CustomerId
    };

    _repository.Add(order);
    return order;
}

private ErrorOr<Order> ReserveInventory(Order order)
{
    foreach (var item in order.Items)
    {
        var available = _inventory.GetAvailableQuantity(item.ProductId);
        if (available < item.Quantity)
            return Error.Conflict(
                code: "Inventory.Insufficient",
                description: $"Insufficient inventory for product {item.ProductId}");

        _inventory.Reserve(item.ProductId, item.Quantity);
    }

    return order;
}

private ErrorOr<Order> ProcessPayment(Order order)
{
    var paymentResult = _paymentGateway.Charge(order.CustomerId, order.Total);

    if (!paymentResult.IsSuccess)
        return Error.Failure(
            code: "Payment.Failed",
            description: paymentResult.ErrorMessage);

    order.PaymentId = paymentResult.TransactionId;
    return order;
}

private ErrorOr<Order> SendNotification(Order order)
{
    _emailService.SendOrderConfirmation(order);
    return order;
}
```

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è:**

-   **–†—è–¥–æ–∫ 3-7**: `.Then()` ‚Äî —Ü–µ ErrorOr –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç `Bind`. –ö–æ–∂–µ–Ω –∫—Ä–æ–∫ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —É—Å–ø—ñ—à–Ω–∏–π
-   **–Ø–∫—â–æ –±—É–¥—å-—è–∫–∏–π –∫—Ä–æ–∫ –ø–æ–≤–µ—Ä—Ç–∞—î Error**, –≤–µ—Å—å –ª–∞–Ω—Ü—é–∂–æ–∫ –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Ü—é –ø–æ–º–∏–ª–∫—É
-   **–†—è–¥–æ–∫ 8**: –§—ñ–Ω–∞–ª—å–Ω–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ `OrderConfirmation`

### 5.3. –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è FluentResults vs ErrorOr

| –ö—Ä–∏—Ç–µ—Ä—ñ–π                 | FluentResults                          | ErrorOr                              |
| :----------------------- | :------------------------------------- | :----------------------------------- |
| **–§—ñ–ª–æ—Å–æ—Ñ—ñ—è**            | Pragmatic, feature-rich                | Functional, minimalist               |
| **–ü–æ–º–∏–ª–∫–∏**              | Multiple errors per result             | –ú–æ–∂–µ –±—É—Ç–∏ —Å–ø–∏—Å–æ–∫, –∞–ª–µ –∑–∞–∑–≤–∏—á–∞–π –æ–¥–Ω–∞  |
| **–¢–∏–ø—ñ–∑–æ–≤–∞–Ω—ñ –ø–æ–º–∏–ª–∫–∏**   | Custom classes inheriting from `Error` | Enum-based `ErrorType` + metadata    |
| **Success metadata**     | –ü—ñ–¥—Ç—Ä–∏–º—É—î `Success` messages           | –¢—ñ–ª—å–∫–∏ value –∞–±–æ errors              |
| **Composability**        | `Bind`, `Map`, `Tap`, `Check`          | `Then`, `Else`, `Match`, `Switch`    |
| **Implicit conversions** | –ù—ñ                                     | –¢–∞–∫ (`return value;` ‚Üí `ErrorOr<T>`) |
| **Integration**          | Extensions –¥–ª—è ASP.NET, Logging        | Minimal, DIY                         |
| **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏** | –°–∫–ª–∞–¥–Ω—ñ scenarios, –±–∞–≥–∞—Ç–æ metadata     | –ß–∏—Å—Ç–∏–π Result Pattern, –ø—Ä–æ—Å—Ç–æ—Ç–∞      |

::note
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**: –î–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ –ø—Ä–æ—î–∫—Ç—ñ–≤ **ErrorOr** –ø—Ä–æ—Å—Ç—ñ—à–∏–π —ñ –±—ñ–ª—å—à type-safe —á–µ—Ä–µ–∑ implicit conversions. –î–ª—è enterprise –ø—Ä–æ—î–∫—Ç—ñ–≤ –∑ —Å–∫–ª–∞–¥–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é –ø–æ–º–∏–ª–æ–∫ —Ç–∞ metadata ‚Äî **FluentResults**.
::

---

## –ß–∞—Å—Ç–∏–Ω–∞ 6: –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó

### 6.1. E-Commerce: Checkout Flow –∑ –ø–æ–≤–Ω–æ—é –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é

```csharp showLineNumbers
using ErrorOr;

public class CheckoutService
{
    private readonly ICartRepository _cartRepository;
    private readonly IInventoryService _inventoryService;
    private readonly IPaymentService _paymentService;
    private readonly IValidator<CheckoutRequest> _validator;

    public async Task<ErrorOr<OrderConfirmation>> CheckoutAsync(
        int userId,
        CheckoutRequest request,
        CancellationToken ct)
    {
        // 1. –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö (FluentValidation)
        var validationResult = await _validator.ValidateAsync(request, ct);
        if (!validationResult.IsValid)
        {
            var errors = validationResult.Errors
                .Select(e => Error.Validation(
                    code: $"Checkout.{e.PropertyName}",
                    description: e.ErrorMessage))
                .ToList();
            return errors;
        }

        // 2. Railway Oriented Programming flow
        return await GetCart(userId)
            .Bind(cart => ValidateCart(cart))
            .Bind(cart => ReserveInventory(cart))
            .Bind(cart => ApplyDiscountCode(cart, request.DiscountCode))
            .Bind(cart => ProcessPayment(cart, request.PaymentDetails))
            .Bind(payment => CreateOrder(userId, payment))
            .Bind(order => SendConfirmation(order));
    }

    private ErrorOr<Cart> GetCart(int userId)
    {
        var cart = _cartRepository.GetByUserId(userId);

        if (cart is null)
            return Error.NotFound(
                code: "Cart.NotFound",
                description: "Shopping cart not found");

        return cart;
    }

    private ErrorOr<Cart> ValidateCart(Cart cart)
    {
        if (cart.Items.Count == 0)
            return Error.Validation(
                code: "Cart.Empty",
                description: "Cannot checkout with empty cart");

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –¥–æ—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ
        foreach (var item in cart.Items)
        {
            if (item.Product.IsDiscontinued)
                return Error.Validation(
                    code: "Cart.DiscontinuedProduct",
                    description: $"Product '{item.Product.Name}' is no longer available");
        }

        return cart;
    }

    private async Task<ErrorOr<Cart>> ReserveInventory(Cart cart)
    {
        foreach (var item in cart.Items)
        {
            var reservationResult = await _inventoryService
                .ReserveAsync(item.ProductId, item.Quantity);

            if (reservationResult.IsFailed)
                return Error.Conflict(
                    code: "Inventory.InsufficientStock",
                    description: $"Not enough stock for '{item.Product.Name}'");
        }

        return cart;
    }

    private ErrorOr<Cart> ApplyDiscountCode(Cart cart, string? discountCode)
    {
        if (string.IsNullOrEmpty(discountCode))
            return cart; // No discount - OK

        var discount = _discountRepository.FindByCode(discountCode);

        if (discount is null)
            return Error.NotFound(
                code: "Discount.InvalidCode",
                description: "Invalid discount code");

        if (discount.IsExpired)
            return Error.Validation(
                code: "Discount.Expired",
                description: "Discount code has expired");

        cart.ApplyDiscount(discount);
        return cart;
    }

    private async Task<ErrorOr<PaymentResult>> ProcessPayment(
        Cart cart,
        PaymentDetails paymentDetails)
    {
        try
        {
            var paymentResult = await _paymentService
                .ChargeAsync(cart.Total, paymentDetails);

            if (!paymentResult.IsSuccess)
                return Error.Failure(
                    code: "Payment.Failed",
                    description: paymentResult.ErrorMessage);

            return paymentResult;
        }
        catch (PaymentGatewayException ex)
        {
            // Exception –¥–ª—è —Å–ø—Ä–∞–≤–¥—ñ –≤–∏–Ω—è—Ç–∫–æ–≤–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π (–º–µ—Ä–µ–∂–∞)
            _logger.LogError(ex, "Payment gateway error");
            return Error.Unexpected(
                code: "Payment.GatewayError",
                description: "Payment service is temporarily unavailable");
        }
    }

    private ErrorOr<Order> CreateOrder(int userId, PaymentResult payment)
    {
        var order = new Order
        {
            UserId = userId,
            PaymentId = payment.TransactionId,
            Total = payment.Amount,
            Status = OrderStatus.Confirmed
        };

        _orderRepository.Add(order);
        return order;
    }

    private async Task<ErrorOr<OrderConfirmation>> SendConfirmation(Order order)
    {
        await _emailService.SendOrderConfirmationAsync(order);

        return new OrderConfirmation
        {
            OrderId = order.Id,
            Total = order.Total,
            EstimatedDelivery = DateTime.Now.AddDays(3)
        };
    }
}

// FluentValidation –¥–ª—è CheckoutRequest
public class CheckoutRequestValidator : AbstractValidator<CheckoutRequest>
{
    public CheckoutRequestValidator()
    {
        RuleFor(x => x.PaymentDetails.CardNumber)
            .NotEmpty()
            .CreditCard()
            .WithMessage("Invalid credit card number");

        RuleFor(x => x.PaymentDetails.ExpiryDate)
            .GreaterThan(DateTime.Now)
            .WithMessage("Card has expired");

        RuleFor(x => x.ShippingAddress.PostalCode)
            .NotEmpty()
            .Matches(@"^\d{5}(-\d{4})?$")
            .WithMessage("Invalid postal code format");

        When(x => !string.IsNullOrEmpty(x.DiscountCode), () =>
        {
            RuleFor(x => x.DiscountCode)
                .Length(6, 12)
                .WithMessage("Discount code must be 6-12 characters");
        });
    }
}
```

**–ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏ —Ü—å–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É:**

1.  **–†—è–¥–æ–∫ 16-25**: FluentValidation –¥–ª—è —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
2.  **–†—è–¥–æ–∫ 27-34**: Railway Oriented Programming ‚Äî –ª–∞–Ω—Ü—é–∂–æ–∫ –æ–ø–µ—Ä–∞—Ü—ñ–π, –¥–µ –∫–æ–∂–Ω–∞ –ø–æ–≤–µ—Ä—Ç–∞—î `ErrorOr<T>`
3.  **–†—è–¥–æ–∫ 69-81**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è (—Ä–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è inventory) —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞ –≤ ROP flow
4.  **–†—è–¥–æ–∫ 113-128**: Exception handling _—Ç—ñ–ª—å–∫–∏_ –¥–ª—è infra—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ (–º–µ—Ä–µ–∂–∞)
5.  **–†—ñ–∑–Ω—ñ —Ç–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫**: `NotFound`, `Validation`, `Conflict`, `Failure`, `Unexpected` ‚Äî –∫–æ–∂–µ–Ω –º–∞—î —Å–≤—ñ–π —Å–µ–Ω—Å

### 6.2. ASP.NET Core Controller –∑ ErrorOr

```csharp showLineNumbers
[ApiController]
[Route("api/checkout")]
public class CheckoutController : ControllerBase
{
    private readonly CheckoutService _checkoutService;

    [HttpPost]
    public async Task<IActionResult> Checkout(
        [FromBody] CheckoutRequest request,
        CancellationToken ct)
    {
        var userId = GetCurrentUserId();

        var result = await _checkoutService.CheckoutAsync(userId, request, ct);

        // Pattern matching –Ω–∞ ErrorType
        return result.MatchFirst(
            value => Ok(new CheckoutResponse
            {
                OrderId = value.OrderId,
                Total = value.Total,
                EstimatedDelivery = value.EstimatedDelivery
            }),
            error => error.Type switch
            {
                ErrorType.NotFound => NotFound(new ProblemDetails
                {
                    Status = 404,
                    Title = "Resource Not Found",
                    Detail = error.Description
                }),
                ErrorType.Validation => BadRequest(new ValidationProblemDetails
                {
                    Status = 400,
                    Title = "Validation Error",
                    Detail = error.Description
                }),
                ErrorType.Conflict => Conflict(new ProblemDetails
                {
                    Status = 409,
                    Title = "Conflict",
                    Detail = error.Description
                }),
                ErrorType.Failure => BadRequest(new ProblemDetails
                {
                    Status = 400,
                    Title = "Operation Failed",
                    Detail = error.Description
                }),
                ErrorType.Unexpected => StatusCode(500, new ProblemDetails
                {
                    Status = 500,
                    Title = "Internal Server Error",
                    Detail = "An unexpected error occurred"
                }),
                _ => StatusCode(500, new ProblemDetails
                {
                    Status = 500,
                    Title = "Unknown Error",
                    Detail = error.Description
                })
            });
    }

    private int GetCurrentUserId()
    {
        var userIdClaim = User.FindFirst(ClaimTypes.NameIdentifier);
        return int.Parse(userIdClaim?.Value ?? "0");
    }
}
```

**Best Practices –¥–ª—è Controllers:**

-   ‚úÖ **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `MatchFirst`** –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó `ErrorOr<T>` –≤ `IActionResult`
-   ‚úÖ **–ú–∞–ø—Ç–µ ErrorType –Ω–∞ HTTP codes** –ø—Ä–∞–≤–∏–ª—å–Ω–æ
-   ‚úÖ **–ü–æ–≤–µ—Ä—Ç–∞–π—Ç–µ ProblemDetails** –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
-   ‚úÖ **–ù–µ –≤–∏—Ç—ñ–∫–∞–π—Ç–µ internal details** –≤ production (—Ä—è–¥–æ–∫ 53 ‚Äî –∑–∞–≥–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è)

---

## –†–µ–∑—é–º–µ

::card-group

:::card{title="–í–∞–ª—ñ–¥–∞—Ü—ñ—è"}

**–ö–ª—é—á–æ–≤—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó:**

-   Defensive Programming –∑ Guard Clauses
-   Data Annotations –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤
-   `IValidatableObject` –¥–ª—è cross-field –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
-   FluentValidation –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏—Ö –ø—Ä–æ—î–∫—Ç—ñ–≤

**–ü—Ä–∏–Ω—Ü–∏–ø–∏:**

-   Fail Fast: –í–∞–ª—ñ–¥—É–π—Ç–µ —Ä–∞–Ω–æ
-   Separation of Concerns: –í–∞–ª—ñ–¥–∞—Ü—ñ—è –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –ª–æ–≥—ñ–∫–∏
-   Comprehensive: –ü–æ–∫–∞–∑—É–π—Ç–µ –≤—Å—ñ –ø–æ–º–∏–ª–∫–∏ –≤—ñ–¥—Ä–∞–∑—É

:::

:::card{title="Result Pattern"}

**–ü–µ—Ä–µ–≤–∞–≥–∏:**

-   –Ø–≤–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ (compile-time safety)
-   –í–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (~1600x —à–≤–∏–¥—à–µ –∑–∞ exceptions)
-   Railway Oriented Programming –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü—ñ—ó
-   –ß–∏—Å—Ç–∏–π, —Ç–µ—Å—Ç–æ–≤–Ω–∏–π –∫–æ–¥

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**

-   –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ (user not found, insufficient funds)
-   –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
-   Expected failures

**–ö–æ–ª–∏ –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**

-   –°–∏—Å—Ç–µ–º–Ω—ñ –ø–æ–º–∏–ª–∫–∏ (OOM, StackOverflow)
-   –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ (–º–µ—Ä–µ–∂–∞, –ë–î)

:::

:::card{title="–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏"}

**FluentResults:**

-   Feature-rich, –±–∞–≥–∞—Ç–æ metadata
-   –ú–Ω–æ–∂–∏–Ω–Ω—ñ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ success messages
-   –Ü—î—Ä–∞—Ä—Ö—ñ—è –ø–æ–º–∏–ª–æ–∫ (CausedBy)

**ErrorOr:**

-   Minimalist, functional approach
-   –í–±—É–¥–æ–≤–∞–Ω—ñ ErrorTypes
-   Implicit conversions

**–í–∏–±—ñ—Ä:**

-   –ü—Ä–æ—Å—Ç–æ—Ç–∞ ‚Üí ErrorOr
-   –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å ‚Üí FluentResults

:::

:::card{title="Best Practices"}

1.  **–í–∞–ª—ñ–¥–∞—Ü—ñ—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ FluentValidation –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –ø—Ä–∞–≤–∏–ª
2.  **Guard Clauses**: –ó–∞–≤–∂–¥–∏ –Ω–∞ –ø–æ—á–∞—Ç–∫—É –º–µ—Ç–æ–¥—ñ–≤
3.  **Exceptions**: –õ–∏—à–µ –¥–ª—è –≤–∏–Ω—è—Ç–∫–æ–≤–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π
4.  **Result Pattern**: –î–ª—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
5.  **ROP**: –ö–æ–º–ø–æ–Ω—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ `Bind`/`Then`
6.  **HTTP Mapping**: ErrorType ‚Üí –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π status code
7.  **Testing**: Result Pattern —Å–ø—Ä–æ—â—É—î —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

:::

::

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è

::steps

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: Guard Clauses Refactoring

–í—ñ–¥—Ä–µ—Ñ–∞–∫—Ç–æ—Ä—ñ—Ç—å –º–µ—Ç–æ–¥, –∑–∞–º—ñ–Ω–∏–≤—à–∏ –≤–∫–ª–∞–¥–µ–Ω—ñ `if` –Ω–∞ guard clauses:

```csharp
public void ProcessPayment(Payment payment, User user)
{
    if (payment != null)
    {
        if (user != null)
        {
            if (payment.Amount > 0)
            {
                if (user.Balance >= payment.Amount)
                {
                    user.Balance -= payment.Amount;
                    _repository.SavePayment(payment);
                }
                else
                {
                    throw new InsufficientFundsException();
                }
            }
            else
            {
                throw new ArgumentException("Amount must be positive");
            }
        }
        else
        {
            throw new ArgumentNullException(nameof(user));
        }
    }
    else
    {
        throw new ArgumentNullException(nameof(payment));
    }
}
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: FluentValidation

–°—Ç–≤–æ—Ä—ñ—Ç—å –≤–∞–ª—ñ–¥–∞—Ç–æ—Ä –¥–ª—è `RegisterUserDto`:

```csharp
public class RegisterUserDto
{
    public string Email { get; set; }
    public string Password { get; set; }
    public string ConfirmPassword { get; set; }
    public int Age { get; set; }
    public string PhoneNumber { get; set; }
}
```

**–í–∏–º–æ–≥–∏:**

-   Email: –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π, –≤–∞–ª—ñ–¥–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç, —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞)
-   Password: –º—ñ–Ω—ñ–º—É–º 8 —Å–∏–º–≤–æ–ª—ñ–≤, –º—ñ—Å—Ç–∏—Ç—å uppercase, lowercase, —Ü–∏—Ñ—Ä—É, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª
-   ConfirmPassword: –º–∞—î —Å–ø—ñ–≤–ø–∞–¥–∞—Ç–∏ –∑ Password
-   Age: 18-120
-   PhoneNumber: –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π, –∞–ª–µ —è–∫—â–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏–π ‚Äî —Ñ–æ—Ä–º–∞—Ç `+380XXXXXXXXX`

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: Result Pattern Conversion

–ü–µ—Ä–µ–ø–∏—à—ñ—Ç—å –º–µ—Ç–æ–¥ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Result Pattern (ErrorOr):

```csharp
public Order PlaceOrder(int userId, List<OrderItem> items)
{
    var user = _userRepository.Find(userId);
    if (user == null)
        throw new UserNotFoundException();

    if (items.Count == 0)
        throw new ArgumentException("Order must contain items");

    var total = items.Sum(i => i.Price * i.Quantity);

    if (user.Balance < total)
        throw new InsufficientFundsException();

    foreach (var item in items)
    {
        var product = _productRepository.Find(item.ProductId);
        if (product == null)
            throw new ProductNotFoundException(item.ProductId);

        if (product.Stock < item.Quantity)
            throw new InsufficientStockException(item.ProductId);

        product.Stock -= item.Quantity;
    }

    user.Balance -= total;
    var order = new Order { UserId = userId, Items = items, Total = total };
    _orderRepository.Add(order);

    return order;
}
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 4: Railway Oriented Programming

–†–µ–∞–ª—ñ–∑—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è–º –∞–∫–∞—É–Ω—Ç—É, –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é email —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è–º —á–µ—Ä–µ–∑ ROP:

```csharp
public Task<ErrorOr<UserRegistrationResult>> RegisterUserAsync(
    RegisterUserDto dto,
    CancellationToken ct);
```

**–ï—Ç–∞–ø–∏:**

1.  –í–∞–ª—ñ–¥—É–≤–∞—Ç–∏ DTO (FluentValidation)
2.  –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ email –Ω–µ –∑–∞–π–Ω—è—Ç–∏–π (async)
3.  –•–µ—à—É–≤–∞—Ç–∏ –ø–∞—Ä–æ–ª—å
4.  –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –ë–î
5.  –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ verification token
6.  –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ email –∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º
7.  –ó–∞–ª–æ–≥—É–≤–∞—Ç–∏ —É—Å–ø—ñ—à–Ω—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ `ErrorOr` —Ç–∞ –º–µ—Ç–æ–¥–∏ `Then`/`Bind` –¥–ª—è –ª–∞–Ω—Ü—é–∂–∫–∞.

::

---

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–Ω—å

–ó–∞–∫—Ä—ñ–ø—ñ—Ç—å –æ—Ç—Ä–∏–º–∞–Ω—ñ –∑–Ω–∞–Ω–Ω—è, –ø—Ä–æ–π—à–æ–≤—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç:

::note
**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–µ—Å—Ç –Ω–∞ [Tally.so](https://tally.so/create) –∑ –ø–∏—Ç–∞–Ω–Ω—è–º–∏ –ø—Ä–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é, Result Pattern —Ç–∞ Railway Oriented Programming, —Ç–∞ –Ω–∞–¥–∞–π—Ç–µ Embed ID –Ω–∏–∂—á–µ.
::

<!-- –¢—É—Ç –±—É–¥–µ Tally embed –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ—Å—Ç—É -->

---

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

-   [FluentValidation Documentation](https://docs.fluentvalidation.net/)
-   [FluentResults GitHub](https://github.com/altmann/FluentResults)
-   [ErrorOr GitHub](https://github.com/amantinband/error-or)
-   [Railway Oriented Programming (F# for fun and profit)](https://fsharpforfunandprofit.com/rop/)
-   [Exception Handling Best Practices (Microsoft)](https://learn.microsoft.com/en-us/dotnet/standard/exceptions/best-practices-for-exceptions)
-   [Result Pattern in C# (Vladimir Khorikov)](https://enterprisecraftsmanship.com/posts/functional-c-handling-failures-input-errors/)

::tip
**–ù–∞—Å—Ç—É–ø–Ω–∞ —Ç–µ–º–∞**: [Dependency Injection —Ç–∞ IoC](/csharp/architecture-best-practices/dependency-injection)

–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –º–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ, —è–∫ –ø–æ–±—É–¥—É–≤–∞—Ç–∏ loosely-coupled –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É —á–µ—Ä–µ–∑ Dependency Injection, Service Lifetime —Ç–∞ —ñ–Ω–≤–µ—Ä—Å—ñ—é –∫–æ–Ω—Ç—Ä–æ–ª—é.
::
