---
title: '–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Å—Ç–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏'
description: '–ü–∞—Ç—Ç–µ—Ä–Ω–∏ Transaction Script —Ç–∞ Active Record –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä–æ—Å—Ç–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ –≤ Domain-Driven Design'
---

# –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Å—Ç–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ (Implementing Simple Business Logic)

::note{icon="fluent:code-24-filled"}
**–ö–ª—é—á–æ–≤–∞ —ñ–¥–µ—è –≥–ª–∞–≤–∏**

–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ ‚Äî –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∞ —á–∞—Å—Ç–∏–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è. –°–∞–º–µ –≤–æ–Ω–∞ —î –ø–µ—Ä—à–æ—á–µ—Ä–≥–æ–≤–æ—é –º–µ—Ç–æ—é —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ü–ó. –ù–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ–≥–æ, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –ø—Ä–∏–≤–∞–±–ª–∏–≤–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∏ —à–≤–∏–¥–∫–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö, —è–∫—â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –º–∞—Ä–Ω–∞ –¥–ª—è –±—ñ–∑–Ω–µ—Å—É ‚Äî —Ü–µ –ª–∏—à–µ –¥–æ—Ä–æ–≥–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π.
::

## –í—Å—Ç—É–ø

–£ [–ì–ª–∞–≤—ñ 2](/ddd/domain-expert-knowledge) –º–∏ –¥—ñ–∑–Ω–∞–ª–∏—Å—è, —â–æ **–Ω–µ –≤—Å—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ**. –†—ñ–∑–Ω—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏ –º–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ —Ä—ñ–≤–Ω—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω–æ—ó –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ —Ç–∞ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ. –í —Ü—ñ–π –≥–ª–∞–≤—ñ —Ä–æ–∑–ø–æ—á–Ω–µ–º–æ –≤–∏–≤—á–µ–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è —Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏.

::tip{icon="ph:lightbulb"}
**–ß–æ–º—É –≤–∞–∂–ª–∏–≤–æ –æ–±–∏—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω?**

–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—ó –ª–æ–≥—ñ–∫–∏ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ **–Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–æ—ó —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ (accidental complexity)**. –ù–∞–≤–ø–∞–∫–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –¥–ª—è —Å–∫–ª–∞–¥–Ω–æ—ó –ª–æ–≥—ñ–∫–∏ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ **–≤–µ–ª–∏–∫–æ–≥–æ –∫–ª—É–±–∫–∞ –±—Ä—É–¥—É (big ball of mud)** ‚Äî –Ω–µ–º–æ–∂–ª–∏–≤–æ–≥–æ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∫–æ–¥—É.
::

### –©–æ –º–∏ –≤–∏–≤—á–∏–º–æ?

–ü–æ—á–Ω–µ–º–æ –∑ –¥–≤–æ—Ö –ø–∞—Ç—Ç–µ—Ä–Ω—ñ–≤ –¥–ª—è **–≤—ñ–¥–Ω–æ—Å–Ω–æ –ø—Ä–æ—Å—Ç–æ—ó** –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏:

::card-group
::card{icon="mdi:script-text"}
#title
Transaction Script
#description
–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏. –ö–æ–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è ‚Äî –æ–∫—Ä–µ–º–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π.
::

::card{icon="mdi:database-cog"}
#title
Active Record
#description
–û–±'—î–∫—Ç–∏ –¥–∞–Ω–∏—Ö –∑ –≤–±—É–¥–æ–≤–∞–Ω–∏–º–∏ CRUD-–º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑—ñ —Å—Ö–æ–≤–∏—â–µ–º.
::
::

---

## –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π (Transaction Script)

> –û—Ä–≥–∞–Ω—ñ–∑—É—î –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É –∑–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏, –¥–µ –∫–æ–∂–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ–±—Ä–æ–±–ª—è—î –æ–¥–∏–Ω –∑–∞–ø–∏—Ç –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
>
> ‚Äî **Martin Fowler**, Patterns of Enterprise Application Architecture

### –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞

::mermaid

```mermaid
graph LR
    A[–ü—É–±–ª—ñ—á–Ω–∏–π API] -->|–û–ø–µ—Ä–∞—Ü—ñ—è 1| B[–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ 1]
    A -->|–û–ø–µ—Ä–∞—Ü—ñ—è 2| C[–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ 2]
    A -->|–û–ø–µ—Ä–∞—Ü—ñ—è 3| D[–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ 3]

    B --> E[(–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö)]
    C --> E
    D --> E

    style A fill:#e3f2fd
    style B fill:#c8e6c9
    style C fill:#c8e6c9
    style D fill:#c8e6c9
    style E fill:#fff3e0
```

::

–ü—É–±–ª—ñ—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∏—Å—Ç–µ–º–∏ –º–æ–∂–Ω–∞ —Ä–æ–∑–≥–ª—è–¥–∞—Ç–∏ —è–∫ **–Ω–∞–±—ñ—Ä –±—ñ–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π**, –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–ø–æ–∂–∏–≤–∞—á–∞–º–∏. –¶—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –º–æ–∂—É—Ç—å:

- üìñ –ß–∏—Ç–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ —Å–∏—Å—Ç–µ–º–∏
- ‚úèÔ∏è –ó–º—ñ–Ω—é–≤–∞—Ç–∏ —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏
- üîÑ –í–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –æ–±–∏–¥–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

–ü–∞—Ç—Ç–µ—Ä–Ω **Transaction Script** –≤–∏–±—É–¥–æ–≤—É—î –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø—Ä–æ—Ü–µ–¥—É—Ä, –¥–µ:

‚úÖ –ö–æ–∂–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Ä–µ–∞–ª—ñ–∑—É—î **–æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é**  
‚úÖ –ü—É–±–ª—ñ—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —è–∫ **–º–µ–∂—ñ —ñ–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—ó**  
‚úÖ –ü—Ä–æ—Ü–µ–¥—É—Ä–∏ –º–æ–∂—É—Ç—å –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –¥–æ –ë–î –∞–±–æ —á–µ—Ä–µ–∑ —Ç–æ–Ω–∫–∏–π —à–∞—Ä –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó

### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

–ö–æ–∂–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ —É –≤–∏–≥–ª—è–¥—ñ **–ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é**. –Ñ–¥–∏–Ω–∞ –Ω–µ–ø–æ—Ö–∏—Ç–Ω–∞ –≤–∏–º–æ–≥–∞ ‚Äî **—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞**.

::warning{icon="ph:warning"}
**–ó–æ–ª–æ—Ç–µ –ø—Ä–∞–≤–∏–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π**

–ö–æ–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è –º–∞—î –∑–∞–≤–µ—Ä—à—É–≤–∞—Ç–∏—Å—è **–∞–±–æ —É—Å–ø—ñ—Ö–æ–º, –∞–±–æ –Ω–µ–≤–¥–∞—á–µ—é**, –∞–ª–µ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–∞–ª–∏—à–∞—Ç–∏ —Å–∏—Å—Ç–µ–º—É –≤ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–º—É —Å—Ç–∞–Ω—ñ.

–ù–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è –∑–±–æ—î–º —É –Ω–∞–π–Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—à–∏–π –º–æ–º–µ–Ω—Ç, —Å–∏—Å—Ç–µ–º–∞ –ø–æ–≤–∏–Ω–Ω–∞ –∑–∞–ª–∏—à–∞—Ç–∏—Å—å —É–∑–≥–æ–¥–∂–µ–Ω–æ—é ‚Äî —à–ª—è—Ö–æ–º –≤—ñ–¥–∫–æ—Ç—É –∑–º—ñ–Ω –∞–±–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–ø–µ–Ω—Å—É—é—á–∏—Ö –¥—ñ–π.
::

#### –ü—Ä–∏–∫–ª–∞–¥: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è JSON ‚Üí XML

```csharp
public class ConvertFileJob
{
    private IDatabase _db;

    public void Execute()
    {
        _db.StartTransaction();

        try
        {
            var job = _db.LoadNextJob();
            var json = LoadFile(job.Source);
            var xml = ConvertJsonToXml(json);

            WriteFile(job.Destination, xml.ToString());
            _db.MarkJobAsCompleted(job);

            _db.Commit();
        }
        catch
        {
            _db.Rollback();
            throw;
        }
    }
}
```

::accordion
::accordion-item{title="–ê–Ω–∞–ª—ñ–∑ –ø—Ä–∏–∫–ª–∞–¥—É"}
**–ß–æ–º—É (Why)**: –ù–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ JSON —É XML —è–∫ —á–∞—Å—Ç–∏–Ω–∞ ETL-–ø—Ä–æ—Ü–µ—Å—É. –û–ø–µ—Ä–∞—Ü—ñ—è –º–∞—î –±—É—Ç–∏ –∞—Ç–æ–º–∞—Ä–Ω–æ—é.

**–©–æ (What)**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Transaction Script –¥–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –ø—Ä–æ—Å—Ç–æ—ó process-based –ª–æ–≥—ñ–∫–∏.

**–Ø–∫ (How)**:

1. –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é
2. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–∞–≤–¥–∞–Ω–Ω—è
3. –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —Ñ–∞–π–ª
4. –§—ñ–∫—Å—É—î–º–æ –∑–º—ñ–Ω–∏ –∞–±–æ –≤—ñ–¥–∫–æ—á—É—î–º–æ –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ

**–ö–ª—é—á–æ–≤–∏–π –º–æ–º–µ–Ω—Ç**: –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∞–±–æ –≤—Å–µ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è —É—Å–ø—ñ—à–Ω–æ, –∞–±–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–º—ñ–Ω–∏—Ç—å—Å—è.
::
::

---

## –¶–µ –Ω–µ —Ç–∞–∫ –ø—Ä–æ—Å—Ç–æ, —è–∫ –∑–¥–∞—î—Ç—å—Å—è!

::note{icon="ph:student"}
**–ó –¥–æ—Å–≤—ñ–¥—É –≤–∏–∫–ª–∞–¥–∞–Ω–Ω—è DDD**

–ö–æ–ª–∏ —è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é –ø–∞—Ç—Ç–µ—Ä–Ω Transaction Script –Ω–∞ –∑–∞–Ω—è—Ç—Ç—è—Ö –∑ Domain-Driven Design, —Å—Ç—É–¥–µ–Ω—Ç–∏ —á–∞—Å—Ç–æ –∑–¥–∏–≤–æ–≤–∞–Ω—ñ: ¬´–ù–∞–≤—ñ—â–æ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ –Ω–∞ —Ü–µ —á–∞—Å? –•—ñ–±–∞ –º–∏ –Ω–µ –¥–ª—è —Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö –º–æ–¥–µ–ª–µ–π —Ç—É—Ç?¬ª

–°–ø—Ä–∞–≤–∞ –≤ —Ç–æ–º—É, —â–æ Transaction Script ‚Äî **–æ—Å–Ω–æ–≤–∞ –¥–ª—è —Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω—ñ–≤**. –Ü –Ω–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ —É—è–≤–Ω—É –ø—Ä–æ—Å—Ç–æ—Ç—É, —Å–∞–º–µ –≤ –Ω—å–æ–º—É **–Ω–∞–π–ª–µ–≥—à–µ –ø–æ–º–∏–ª–∏—Ç–∏—Å—è**.
::

–ë–µ–∑–ª—ñ—á production-–ø—Ä–æ–±–ª–µ–º, —è–∫—ñ —è –¥–æ–ø–æ–º–∞–≥–∞–≤ –≤—ñ–¥–ª–∞–≥–æ–¥–∂—É–≤–∞—Ç–∏, –∑–≤–æ–¥–∏–ª–∏—Å—è –¥–æ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏**.

### –¢—Ä–∏ –ø–æ—à–∏—Ä–µ–Ω—ñ –ø–æ–º–∏–ª–∫–∏

::steps

### –ö—Ä–æ–∫ 1: –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏

–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∞ –ø–æ–º–∏–ª–∫–∞ ‚Äî –≤–∏–ø—É—Å–∫ –∫—ñ–ª—å–∫–æ—Ö –æ–Ω–æ–≤–ª–µ–Ω—å –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó, —â–æ —ó—Ö –æ—Ö–æ–ø–ª—é—î.

### –ö—Ä–æ–∫ 2: –†–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

–°–ø—Ä–æ–±–∞ –∞—Ç–æ–º–∞—Ä–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏ –ë–î —ñ –æ–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—é –≤ —à–∏–Ω—ñ –ø–æ–≤—ñ–¥ –æ–º–ª–µ–Ω—å.

### –ö—Ä–æ–∫ 3: –ù–µ—è–≤–Ω—ñ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

–ù–∞–≤—ñ—Ç—å –æ–¥–Ωor—è–¥–∫–æ–≤–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—î—é!
::

---

### –ü–æ–º–∏–ª–∫–∞ ‚Ññ1: –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –º–µ—Ç–æ–¥, —â–æ –æ–Ω–æ–≤–ª—é—î –∑–∞–ø–∏—Å —É —Ç–∞–±–ª–∏—Ü—ñ `Users` —Ç–∞ –≤—Å—Ç–∞–≤–ª—è—î –∑–∞–ø–∏—Å —É `VisitsLog`:

```csharp
public class LogVisit
{
    private IDatabase _db;

    public void Execute(Guid userId, DateTime visitedOn)
    {
        // ‚ùå –ù–µ–±–µ–∑–ø–µ—á–Ω–æ! –î–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
        _db.Execute("UPDATE Users SET last_visit=@p1 WHERE user_id=@p2",
            visitedOn, userId);

        _db.Execute(@"INSERT INTO VisitsLog(user_id, visit_date)
            VALUES(@p1, @p2)", userId, visitedOn);
    }
}
```

::warning{icon="ph:bug"}
**–ü—Ä–æ–±–ª–µ–º–∞: Race Condition**

–Ø–∫—â–æ –ø—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è `Users` (—Ä—è–¥–æ–∫ 8), –∞–ª–µ **–¥–æ** —É—Å–ø—ñ—à–Ω–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤ `VisitsLog` (—Ä—è–¥–æ–∫ 11) —Å—Ç–∞–Ω–µ—Ç—å—Å—è –±—É–¥—å-—è–∫–∞ –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî —Å–∏—Å—Ç–µ–º–∞ –æ–ø–∏–Ω–∏—Ç—å—Å—è –≤ –Ω–µ—É–∑–≥–æ–¥–∂–µ–Ω–æ–º—É —Å—Ç–∞–Ω—ñ:

- ‚úÖ –¢–∞–±–ª–∏—Ü—è `Users` –æ–Ω–æ–≤–ª–µ–Ω–∞
- ‚ùå –ó–∞–ø–∏—Å —É `VisitsLog` –≤—ñ–¥—Å—É—Ç–Ω—ñ–π

**–ü—Ä–∏—á–∏–Ω–∏ –∑–±–æ—é**: –º–µ—Ä–µ–∂–µ–≤–∏–π –∑–±—ñ–π, timeout –ë–î, deadlock, –∑–±—ñ–π —Å–µ—Ä–≤–µ—Ä–∞, —Ç–æ—â–æ.
::

#### –†—ñ—à–µ–Ω–Ω—è: –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

```csharp
public class LogVisit
{
    private IDatabase _db;

    public void Execute(Guid userId, DateTime visitedOn)
    {
        try
        {
            _db.StartTransaction(); // ‚úÖ –ü–æ—á–∞—Ç–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

            _db.Execute("UPDATE Users SET last_visit=@p1 WHERE user_id=@p2",
                visitedOn, userId);

            _db.Execute(@"INSERT INTO VisitsLog(user_id, visit_date)
                VALUES(@p1, @p2)", userId, visitedOn);

            _db.Commit(); // ‚úÖ –§—ñ–∫—Å–∞—Ü—ñ—è –∑–º—ñ–Ω
        }
        catch
        {
            _db.Rollback(); // ‚úÖ –í—ñ–¥–∫–∞—Ç –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ
            throw;
        }
    }
}
```

::tip{icon="ph:check-circle"}
**–ü–µ—Ä–µ–≤–∞–≥–∏ —Ä—ñ—à–µ–Ω–Ω—è**

–†–µ–ª—è—Ü—ñ–π–Ω—ñ –ë–î –º–∞—é—Ç—å –≤–±—É–¥–æ–≤–∞–Ω—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∞—Ç–æ–º–∞—Ä–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ–π. –¶–µ **–ª–µ–≥–∫–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏**.
::

–ê–ª–µ —â–æ —Ä–æ–±–∏—Ç–∏, –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–Ω–æ–≤–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å—Ö–æ–≤–∏—â –¥–∞–Ω–∏—Ö, —è–∫—ñ –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó?

---

### –ü–æ–º–∏–ª–∫–∞ ‚Ññ2: –†–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

–£ —Å—É—á–∞—Å–Ω–∏—Ö —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∑–≤–∏—á–∞–π–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ ‚Äî **–≤–Ω–µ—Å—Ç–∏ –∑–º—ñ–Ω–∏ –≤ –ë–î, –∞ –ø–æ—Ç—ñ–º –æ–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—ó** –≤ —à–∏–Ω—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –æ–ø–æ–≤—ñ—â–µ–Ω–Ω—è —ñ–Ω—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤.

–ü—Ä–∏–ø—É—Å—Ç—ñ–º–æ, –∑–∞–º—ñ—Å—Ç—å –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—ñ–∑–∏—Ç—É –≤ —Ç–∞–±–ª–∏—Ü—é, –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–æ–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –ø–æ–¥—ñ—é**:

```csharp
public class LogVisit
{
    private IDatabase _db;
    private IMessageBus _messageBus;

    public void Execute(Guid userId, DateTime visitedOn)
    {
        // ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –¥–≤—ñ —Ä—ñ–∑–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ –±–µ–∑ –∑–∞–≥–∞–ª—å–Ω–æ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
        _db.Execute("UPDATE Users SET last_visit=@p1 WHERE user_id=@p2",
            visitedOn, userId);

        _messageBus.Publish("VISITS_TOPIC",
            new { UserId = userId, VisitDate = visitedOn });
    }
}
```

::warning{icon="ph:warning-octagon"}
**–ü—Ä–æ–±–ª–µ–º–∞: Dual Write**

–Ø–∫ —ñ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ, –±—É–¥—å-—è–∫–∏–π –∑–±—ñ–π –ø—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä—è–¥–∫–∞ 8, –∞–ª–µ –¥–æ —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä—è–¥–∫–∞ 11, –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—É:

- ‚úÖ –¢–∞–±–ª–∏—Ü—è `Users` –æ–Ω–æ–≤–ª–µ–Ω–∞
- ‚ùå –Ü–Ω—à—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ **–Ω–µ –æ–ø–æ–≤—ñ—â–µ–Ω—ñ** (–ø—É–±–ª—ñ–∫–∞—Ü—ñ—è –¥–∞–ª–∞ –∑–±—ñ–π)

**–ù–ï —ñ—Å–Ω—É—î –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä—ñ—à–µ–Ω–Ω—è!** –†–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó, —â–æ –æ—Ö–æ–ø–ª—é—é—Ç—å –∫—ñ–ª—å–∫–∞ —Å—Ö–æ–≤–∏—â –¥–∞–Ω–∏—Ö:

- üêå –°–∫–ª–∞–¥–Ω—ñ
- üìâ –í–∞–∂–∫–æ –º–∞—Å—à—Ç–∞–±—É—é—Ç—å—Å—è
- ‚ùå –ù–µ —Å—Ç—ñ–π–∫—ñ –¥–æ –ø–æ–º–∏–ª–æ–∫

::

::accordion
::accordion-item{title="–†—ñ—à–µ–Ω–Ω—è –¥–ª—è —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π"}
–Ü—Å–Ω—É—é—Ç—å —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è —Ü—ñ—î—ó –ø—Ä–æ–±–ª–µ–º–∏:

**Transactional Outbox Pattern** (–ì–ª–∞–≤–∞ 9)

- –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–¥—ñ—é –≤ –ë–î —Ä–∞–∑–æ–º —ñ–∑ –±—ñ–∑–Ω–µ—Å-–¥–∞–Ω–∏–º–∏ –≤ –æ–¥–Ω—ñ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
- –û–∫—Ä–µ–º–∏–π –ø—Ä–æ—Ü–µ—Å —á–∏—Ç–∞—î –ø–æ–¥—ñ—ó —Ç–∞ –ø—É–±–ª—ñ–∫—É—î —ó—Ö

**CQRS Pattern** (–ì–ª–∞–≤–∞ 8)

- –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö —Å—Ö–æ–≤–∏—â –¥–∞–Ω–∏—Ö
- –†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥ —ñ –∑–∞–ø–∏—Ç—ñ–≤

–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ —Ü—ñ –ø—ñ–¥—Ö–æ–¥–∏ –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –≥–ª–∞–≤–∞—Ö.
::
::

---

### –ü–æ–º–∏–ª–∫–∞ ‚Ññ3: –ù–µ—è–≤–Ω—ñ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –º–µ—Ç–æ–¥, —â–æ –≤–∏–≥–ª—è–¥–∞—î **–æ–±–º–∞–Ω–ª–∏–≤–æ –ø—Ä–æ—Å—Ç–∏–º**:

```csharp
public class LogVisit
{
    private IDatabase _db;

    public void Execute(Guid userId)
    {
        // –ó–¥–∞—î—Ç—å—Å—è –ø—Ä–æ—Å—Ç–æ? –ù–∞—Å–ø—Ä–∞–≤–¥—ñ —Ü–µ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è!
        _db.Execute("UPDATE Users SET visits=visits+1 WHERE user_id=@p1",
            userId);
    }
}
```

::note{icon="ph:question"}
**–ü–∏—Ç–∞–Ω–Ω—è –¥–ª—è —Ä–æ–∑–¥—É–º—ñ–≤**

–¶–µ–π –º–µ—Ç–æ–¥ –æ–Ω–æ–≤–ª—é—î –ª–∏—à–µ **–æ–¥–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –æ–¥–Ω—ñ–π —Ç–∞–±–ª–∏—Ü—ñ** –≤ –æ–¥–Ω—ñ–π –±–∞–∑—ñ –¥–∞–Ω–∏—Ö. –ß–æ–º—É —Ü–µ –≤—Å–µ –∂ —Ç–∞–∫–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è?
::

::mermaid

```mermaid
sequenceDiagram
    participant C as –ö–ª—ñ—î–Ω—Ç (Caller)
    participant M as –ú–µ—Ç–æ–¥ LogVisit
    participant DB as –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö

    C->>M: Execute(userId)
    activate M
    M->>DB: UPDATE visits+1
    activate DB
    DB-->>M: Success ‚úì
    deactivate DB
    M-->>C: Return (Success)
    deactivate M

    Note over C,DB: –©–æ —è–∫—â–æ –∑–≤'—è–∑–æ–∫ –æ–±—Ä–∏–≤–∞—î—Ç—å—Å—è<br/>–ü–Ü–°–õ–Ø —É—Å–ø—ñ—Ö—É, –∞–ª–µ –î–û –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è?
```

::

#### –ü—Ä–æ–±–ª–µ–º–∞: –í—Ç—Ä–∞—á–µ–Ω–∏–π ack (acknowledgment)

–¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ —î **—Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—î—é**, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–¥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤ **–¥–≤—ñ —Å–∏—Å—Ç–µ–º–∏**:

1. üíæ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
2. üìû –ó–æ–≤–Ω—ñ—à–Ω—ñ–π –ø—Ä–æ—Ü–µ—Å (–≤–∏–∫–ª–∏–∫–∞—á –º–µ—Ç–æ–¥—É)

::warning{icon="ph:network-slash"}
**–°—Ü–µ–Ω–∞—Ä—ñ—ó –∑–±–æ—é**

–ú–µ—Ç–æ–¥ `Execute` –º–∞—î —Ç–∏–ø `void` ‚Äî –Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—î –¥–∞–Ω–∏—Ö. –ê–ª–µ –≤—ñ–Ω **–≤—Å–µ –æ–¥–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª—è—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: —É —Ä–∞–∑—ñ –Ω–µ–≤–¥–∞—á—ñ –≤–∏–∫–ª–∏–∫–∞—á –æ—Ç—Ä–∏–º–∞—î –≤–∏–∫–ª—é—á–µ–Ω–Ω—è.

**–©–æ —è–∫—â–æ –º–µ—Ç–æ–¥ –∑–∞–≤–µ—Ä—à–∏–≤—Å—è —É—Å–ø—ñ—à–Ω–æ, –∞–ª–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –¥–∞–ª–æ –∑–±—ñ–π?**

- **REST-—Å–µ—Ä–≤—ñ—Å**: –ó–±—ñ–π –º–µ—Ä–µ–∂—ñ –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–æ–º —ñ –∫–ª—ñ—î–Ω—Ç–æ–º
- **–õ–æ–∫–∞–ª—å–Ω–∏–π –ø—Ä–æ—Ü–µ—Å**: –ü—Ä–æ—Ü–µ—Å –∑–∞–≤–µ—Ä—à–∏–≤—Å—è –∑—ñ –∑–±–æ—î–º –¥–æ —Ç–æ–≥–æ, —è–∫ –≤–∏–∫–ª–∏–∫–∞—á –≤—Å—Ç–∏–≥ –≤—ñ–¥—Å—Ç–µ–∂–∏—Ç–∏ —É—Å–ø—ñ—Ö

–í –æ–±–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö **—Å–ø–æ–∂–∏–≤–∞—á –ø—Ä–∏–ø—É—Å–∫–∞—î –ø–æ–º–∏–ª–∫—É** —ñ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `LogVisit` –∑–Ω–æ–≤—É. –ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ **–Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è** –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞: +2 –∑–∞–º—ñ—Å—Ç—å +1.
::

#### –†—ñ—à–µ–Ω–Ω—è ‚Ññ1: –Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–¥–∞—á—É –∑–Ω–∞—á–µ–Ω–Ω—è

–ó—Ä–æ–±–∏–º–æ –æ–ø–µ—Ä–∞—Ü—ñ—é **—ñ–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—é** ‚Äî –ø—Ä–∏–≤–æ–¥–∏—Ç–∏ –¥–æ –æ–¥–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ–º—É –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—ñ:

```csharp
public class LogVisit
{
    private IDatabase _db;

    // ‚úÖ –°–ø–æ–∂–∏–≤–∞—á –ø–µ—Ä–µ–¥–∞—î –æ—á—ñ–∫—É–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
    public void Execute(Guid userId, long visits)
    {
        // MEETING –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –≤–∏–∫–ª–∏–∫–∞—Ö –±—É–¥–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ç–µ —Å–∞–º–µ –∑–Ω–∞—á–µ–Ω–Ω—è
        _db.Execute("UPDATE Users SET visits = @p1 WHERE user_id=@p2",
            visits, userId);
    }
}
```

::tip{icon="ph:repeat"}
**–ß–æ–º—É —Ü–µ –ø—Ä–∞—Ü—é—î?**

1. –í–∏–∫–ª–∏–∫–∞—á —Å–ø–æ—á–∞—Ç–∫—É **–∑—á–∏—Ç—É—î** –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
2. –õ–æ–∫–∞–ª—å–Ω–æ **–∑–±—ñ–ª—å—à—É—î** –π–æ–≥–æ
3. –ü–µ—Ä–µ–¥–∞—î **–æ–Ω–æ–≤–ª–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è** —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä

–ù–∞–≤—ñ—Ç—å —è–∫—â–æ –æ–ø–µ—Ä–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤, –∫—ñ–Ω—Ü–µ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –∑–º—ñ–Ω–∏—Ç—å—Å—è!
::

#### –†—ñ—à–µ–Ω–Ω—è ‚Ññ2: –û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∞ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

–ü–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º `LogVisit` –≤–∏–∫–ª–∏–∫–∞—á –∑—á–∏—Ç—É—î –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –ø–µ—Ä–µ–¥–∞—î –π–æ–≥–æ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:

```csharp
public class LogVisit
{
    private IDatabase _db;

    // ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ expected value –¥–ª—è –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–æ—ó –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
    public void Execute(Guid userId, long expectedVisits)
    {
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è –¢–Ü–õ–¨–ö–ò —è–∫—â–æ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ –∑–º—ñ–Ω–∏–ª–æ—Å—å
        var rowsAffected = _db.Execute(
            @"UPDATE Users
              SET visits = visits + 1
              WHERE user_id=@p1 AND visits = @p2",
            userId, expectedVisits);

        if (rowsAffected == 0)
        {
            throw new ConcurrencyException("Visits count has changed");
        }
    }
}
```

::accordion
::accordion-item{title="–Ø–∫ –ø—Ä–∞—Ü—é—î –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∞ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è?"}
**–ú–µ—Ö–∞–Ω—ñ–∑–º**:

1. –í–∏–∫–ª–∏–∫–∞—á –∑—á–∏—Ç—É—î `visits = 5`
2. –ü–µ—Ä–µ–¥–∞—î `expectedVisits = 5`
3. UPDATE –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ** `visits = 5`
4. –Ø–∫—â–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–º—ñ–Ω–∏–ª–æ—Å—å (—ñ–Ω—à–∏–π –ø—Ä–æ—Ü–µ—Å –æ–Ω–æ–≤–∏–≤) ‚Äî `rowsAffected = 0`

**–ù–∞—Å—Ç—É–ø–Ω—ñ –≤–∏–∫–ª–∏–∫–∏** –∑ —Ç–∏–º–∏ –∂ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –Ω–µ –∑–º—ñ–Ω—è—Ç—å –¥–∞–Ω—ñ, –æ—Å–∫—ñ–ª—å–∫–∏ —É–º–æ–≤–∞ `WHERE...visits = @p2` –Ω–µ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è.

**–ü–µ—Ä–µ–≤–∞–≥–∏**:

- ‚úÖ –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å
- ‚úÖ –Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ—ó
- ‚úÖ –Ø–≤–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏

::

::

---

## –ö–æ–ª–∏ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ Transaction Script?

::card-group
::card{icon="mdi:thumb-up"}
#title
–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è
#description
**–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏ (Supporting Subdomains)** ‚Äî –ª–æ–≥—ñ–∫–∞ –∑–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º –Ω–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—é.

**ETL-–ø—Ä–æ—Ü–µ—Å–∏** ‚Äî extract-transform-load –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –ø—Ä–æ—Å—Ç–∏–º–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è–º–∏.

**–ê–¥–∞–ø—Ç–µ—Ä–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó** ‚Äî —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –∞–±–æ universal subdomains.

**Anti-Corruption Layer** ‚Äî —è–∫ —á–∞—Å—Ç–∏–Ω–∞ –∑–∞—Ö–∏—Å–Ω–æ–≥–æ —à–∞—Ä—É (–¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ –≤ –ì–ª–∞–≤—ñ 9).
::

::card{icon="mdi:thumb-down"}
#title
–ù–ï –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è
#description
**–û—Å–Ω–æ–≤–Ω—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏ (Core Subdomains)** ‚Äî –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è –∑ –≤–∏—Å–æ–∫–æ—é —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—é –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏.

**–°–∫–ª–∞–¥–Ω–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞** ‚Äî –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —Ç–∞ —Ä–æ–∑—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –∫–æ–¥—É.

**–ë–∞–≥–∞—Ç–æ –±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª** ‚Äî –≤–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —É–∑–≥–æ–¥–∂–µ–Ω—ñ—Å—Ç—å.
::
::

### –ü–µ—Ä–µ–≤–∞–≥–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞

| –ê—Å–ø–µ–∫—Ç              | –û–ø–∏—Å                                |
| ------------------- | ----------------------------------- |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞**        | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ–π     |
| **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**  | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –Ω–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏         |
| **–ó—Ä–æ–∑—É–º—ñ–ª—ñ—Å—Ç—å**    | –õ–µ–≥–∫–æ —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—è –≤ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó      |
| **–ü—Ä—è–º–æ–ª—ñ–Ω—ñ–π–Ω—ñ—Å—Ç—å** | –ü—Ä–µ–≤ –∑–≤'—è–∑–æ–∫ –º—ñ–∂ –æ–ø–µ—Ä–∞—Ü—ñ—î—é —Ç–∞ –∫–æ–¥–æ–º |

### –ù–µ–¥–æ–ª—ñ–∫–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞

::warning{icon="ph:warning-diamond"}
**–û–±–º–µ–∂–µ–Ω–Ω—è Transaction Script**

‚ùå **–î—É–±–ª—é–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–∫–∏** ‚Äî —á–∏–º —Å–∫–ª–∞–¥–Ω—ñ—à–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, —Ç–∏–º –±—ñ–ª—å—à–µ –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è –∫–æ–¥ –º—ñ–∂ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏

‚ùå **–†–æ–∑—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** ‚Äî –ø—Ä–æ–¥—É–±–ª—å–æ–≤–∞–Ω–∏–π –∫–æ–¥ –ª–µ–≥–∫–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —Ä—ñ–∑–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏

‚ùå **Big Ball of Mud** ‚Äî —Å–∫–ª–∞–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ –≤ Transaction Script –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ –Ω–µ–ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏–π –∫–ª—É–±–æ–∫

‚ùå **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** ‚Äî –≤–∞–∂–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –±–µ–∑ –ø–æ—Ä—É—à–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–æ—ó
::

::note{icon="ph:info"}
**–†–µ–ø—É—Ç–∞—Ü—ñ—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞**

–ü—Ä–æ—Å—Ç–æ—Ç–∞ Transaction Script —Å—Ç–≤–æ—Ä–∏–ª–∞ –π–æ–º—É —Å—É–º–Ω—ñ–≤–Ω—É —Ä–µ–ø—É—Ç–∞—Ü—ñ—é. –Ü–Ω–æ–¥—ñ –π–æ–≥–æ –Ω–∞–≤—ñ—Ç—å —Ä–æ–∑–≥–ª—è–¥–∞—é—Ç—å —è–∫ **–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω**.

–ê–ª–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—ñ–¥–∑–Ω–∞—á–∏—Ç–∏: –Ω–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –Ω–µ–¥–æ–ª—ñ–∫–∏, —Ü–µ–π –ø–∞—Ç—Ç–µ—Ä–Ω –æ—Ç—Ä–∏–º–∞–≤ —É —Ä–æ–∑—Ä–æ–±—Ü—ñ –ü–ó **–¥—É–∂–µ —à–∏—Ä–æ–∫–µ –ø–æ—à–∏—Ä–µ–Ω–Ω—è**. –í—Å—ñ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏, —â–æ —Ä–æ–∑–≥–ª—è–¥–∞—Ç–∏–º—É—Ç—å—Å—è –¥–∞–ª—ñ, —Ç–∞–∫ —á–∏ —ñ–Ω–∞–∫—à–µ **–±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ Transaction Script**.
::

---

## –ê–∫—Ç–∏–≤–Ω–∞ –∑–∞–ø–∏—Å (Active Record)

> –û–±'—î–∫—Ç, —â–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ä—è–¥–æ–∫ —É —Ç–∞–±–ª–∏—Ü—ñ –∞–±–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —ñ–Ω–∫–∞–ø—Å—É–ª—é—î –¥–æ—Å—Ç—É–ø –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —ñ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É, —â–æ –æ–ø–µ—Ä—É—î —Ü–∏–º–∏ –¥–∞–Ω–∏–º–∏.
>
> ‚Äî **Martin Fowler**, Patterns of Enterprise Application Architecture

### –í—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –≤—ñ–¥ Transaction Script

**Active Record**, —è–∫ —ñ Transaction Script, –ø—Ä–∏–¥–∞—Ç–Ω–∏–π –¥–ª—è –ø—Ä–æ—Å—Ç–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏. –ê–ª–µ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å:

::mermaid

```mermaid
graph TB
    subgraph "Transaction Script"
        TS1[–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ 1] --> DB1[(–ë–î)]
        TS2[–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ 2] --> DB1
        TS3[–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ 3] --> DB1
    end

    subgraph "Active Record"
        AR1[Active Record 1] <--> DB2[(–ë–î)]
        AR2[Active Record 2] <--> DB2
        AR3[Active Record 3] <--> DB2

        AR1 -.Contains.-> Data1[Data + CRUD]
        AR2 -.Contains.-> Data2[Data + CRUD]
        AR3 -.Contains.-> Data3[Data + CRUD]
    end

    style TS1 fill:#ffcdd2
    style TS2 fill:#ffcdd2
    style TS3 fill:#ffcdd2
    style AR1 fill:#c8e6c9
    style AR2 fill:#c8e6c9
    style AR3 fill:#c8e6c9
```

::

**Transaction Script** –ø—Ä–∞—Ü—é—î –∑ –ø—Ä–æ—Å—Ç–∏–º–∏ –¥–∞–Ω–∏–º–∏ —Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏.  
**Active Record** –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑—ñ **—Å–∫–ª–∞–¥–Ω–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –¥–∞–Ω–∏—Ö** ‚Äî –¥–µ—Ä–µ–≤–∞–º–∏ –æ–±'—î–∫—Ç—ñ–≤ —Ç–∞ —ñ—î—Ä–∞—Ä—Ö—ñ—è–º–∏.

### –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É

–†–æ–∑–≥–ª—è–Ω–µ–º–æ —Å–∫–ª–∞–¥–Ω—ñ—à—É –º–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö:

::mermaid

```mermaid
erDiagram
    USER ||--o{ ORDER : places
    ORDER ||--|{ ORDER_LINE : contains
    PRODUCT ||--o{ ORDER_LINE : "ordered in"
    PRODUCT }|--|{ CATEGORY : "belongs to"

    USER {
        uuid id PK
        string name
        string email
    }
    ORDER {
        uuid id PK
        uuid user_id FK
        datetime created_at
    }
    ORDER_LINE {
        uuid id PK
        uuid order_id FK
        uuid product_id FK
        int quantity
    }
    PRODUCT {
        uuid id PK
        string name
        decimal price
    }
    CATEGORY {
        uuid id PK
        string name
    }
```

::

::warning{icon="ph:copy"}
–†–æ–±–æ—Ç–∞ –∑ —Ç–∞–∫–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ **Transaction Script** –ø—Ä–∏–∑–≤–µ–ª–∞ –± –¥–æ **–≤–µ–ª–∏–∫–æ–≥–æ –æ–±—Å—è–≥—É –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω–æ–≥–æ –∫–æ–¥—É**: –∑—ñ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —ó—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è–º —É –ø–∞–º'—è—Ç—ñ –¥—É–±–ª—é–≤–∞–ª–æ—Å—è –± —Å–∫—Ä—ñ–∑—å.
::

### –†—ñ—à–µ–Ω–Ω—è: Active Record Objects

–ü–∞—Ç—Ç–µ—Ä–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –æ–±'—î–∫—Ç–∏ ‚Äî **Active Records** ‚Äî –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–∏—Ö:

```csharp
// ‚úÖ Active Record —ñ–Ω–∫–∞–ø—Å—É–ª—é—î —ñ –¥–∞–Ω—ñ, —ñ –¥–æ—Å—Ç—É–ø –¥–æ –ë–î
public class User
{
    public Guid Id { get; set; }
    public string Name { get; set; }
    public string Email { get; set; }

    // CRUD-–º–µ—Ç–æ–¥–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ –≤ –æ–±'—î–∫—Ç
    public void Save() { /* ORM logic */ }
    public static User Load(Guid id) { /* ORM logic */ }
    public void Delete() { /* ORM logic */ }
}

public class Order
{
    public Guid Id { get; set; }
    public Guid UserId { get; set; }
    public List<OrderLine> Lines { get; set; }

    public void Save() { /* ORM logic */ }
    public static Order Load(Guid id) { /* ORM logic */ }
}
```

::tip{icon="ph:database"}
**–ó–≤'—è–∑–æ–∫ –∑ ORM**

–û–±'—î–∫—Ç–∏ Active Record –∑–∞–∑–≤–∏—á–∞–π –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ **ORM-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏** (Entity Framework, Hibernate, ActiveRecord) –∞–±–æ —ñ–Ω—à–∏–º–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö.

–ù–∞–∑–≤–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –ø–æ—Ö–æ–¥–∏—Ç—å –≤—ñ–¥ —Ç–æ–≥–æ —Ñ–∞–∫—Ç—É, —â–æ –∫–æ–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö —î ¬´**–∞–∫—Ç–∏–≤–Ω–æ—é**¬ª ‚Äî —Ä–µ–∞–ª—ñ–∑—É—î –ª–æ–≥—ñ–∫—É –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö.
::

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ Transaction Script

–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –≤—Å–µ —â–µ –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–∞ —è–∫ **—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π**, –∞–ª–µ –∑–∞–º—ñ—Å—Ç—å –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –ë–î –º–∞–Ω—ñ–ø—É–ª—é—î –æ–±'—î–∫—Ç–∞–º–∏ Active Record:

```csharp
public class CreateUser
{
    private IDatabase _db;

    public void Execute(UserDetails userDetails)
    {
        try
        {
            _db.StartTransaction();

            // ‚úÖ –ü—Ä–∞—Ü—é—î–º–æ —á–µ—Ä–µ–∑ Active Record, –∞ –Ω–µ –∑ SQL –Ω–∞–ø—Ä—è–º—É
            var user = new User();
            user.Name = userDetails.Name;
            user.Email = userDetails.Email;
            user.Save(); // Active Record —Å–∞–º –∑–Ω–∞—î —è–∫ –∑–±–µ—Ä–µ–≥—Ç–∏—Å—å

            _db.Commit();
        }
        catch
        {
            _db.Rollback();
            throw;
        }
    }
}
```

::accordion
::accordion-item{title="–ú–µ—Ç–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Active Record"}
**–Ü–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—è —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ**

–ì–æ–ª–æ–≤–Ω–∞ –º–µ—Ç–∞ ‚Äî **—ñ–Ω–∫–∞–ø—Å—É–ª—é–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –∑—ñ—Å—Ç–∞–≤–ª–µ–Ω–Ω—è** –æ–±'—î–∫—Ç–∞ –≤ –ø–∞–º'—è—Ç—ñ –Ω–∞ —Å—Ö–µ–º—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.

**–©–æ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ Active Record?**

–ö—Ä—ñ–º –æ–ø–µ—Ä–∞—Ü—ñ–π –∑—ñ —Å—Ö–æ–≤–∏—â–µ–º, –æ–±'—î–∫—Ç–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏:

- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—é –Ω–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å –ø–µ—Ä–µ–¥ –ø—Ä–∏—Å–≤–æ—î–Ω–Ω—è–º
- ‚úÖ –ü—Ä–æ—Å—Ç–Ω—ñ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ–¥—É—Ä–∏ –¥–ª—è –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó –¥–∞–Ω–∏–º–∏
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫—É –±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

**–ö–ª—é—á–æ–≤–∞ –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å**

Active Record **—Ä–æ–∑–¥—ñ–ª—è—î —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö —ñ –ø–æ–≤–µ–¥—ñ–Ω–∫—É**. –ó–∞–∑–≤–∏—á–∞–π –ø–æ–ª—è –º–∞—é—Ç—å –ø—É–±–ª—ñ—á–Ω—ñ getter/setter, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∑–æ–≤–Ω—ñ—à–Ω—ñ–º –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Å—Ç–∞–Ω.
::
::

---

## –ö–æ–ª–∏ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ Active Record?

–ü–æ —Å—É—Ç—ñ, Active Record ‚Äî —Ü–µ **Transaction Script optimization –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –ë–î**:

::card-group
::card{icon="mdi:check-circle"}
#title
–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è
#description
**–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏** ‚Äî —è–∫ —ñ Transaction Script

**CRUD-–æ–ø–µ—Ä–∞—Ü—ñ—ó** ‚Äî –∑—ñ —Å–∫–ª–∞–¥–Ω–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –¥–∞–Ω–∏—Ö

**Generic Subdomains** ‚Äî —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Ä—ñ—à–µ–Ω—å

**Model transformation** ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–∏—Ö

**–°–∫–ª–∞–¥–Ω—ñ —Å—Ö–µ–º–∏ –ë–î** ‚Äî –º–Ω–æ–∂–∏–Ω–Ω—ñ –∑–≤'—è–∑–∫–∏ 1:N, N:M
::

::card{icon="mdi:alert-circle"}
#title
–ù–ï –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è
#description
**–û—Å–Ω–æ–≤–Ω—ñ –ø—ñ–¥–¥–æ–º–µ–Ω–∏** ‚Äî –Ω–µ –≤–ø–æ—Ä–∞—î—Ç—å—Å—è –∑—ñ —Å–∫–ª–∞–¥–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é

**–°–∫–ª–∞–¥–Ω—ñ –±—ñ–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞** ‚Äî –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ ¬´Anemic Domain Model¬ª

**–ë–∞–≥–∞—Ç–æ —ñ–Ω–≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤** ‚Äî –≤–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —É–∑–≥–æ–¥–∂–µ–Ω—ñ—Å—Ç—å
::
::

### –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ Transaction Script

| –ê—Å–ø–µ–∫—Ç              | Transaction Script          | Active Record             |
| ------------------- | --------------------------- | ------------------------- |
| **–ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞**   | –ü—Ä–æ—Å—Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞           | –ü—Ä–æ—Å—Ç–∞ CRUD-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–∞   |
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö** | –ü—Ä–æ—Å—Ç—ñ –∑–∞–ø–∏—Å–∏               | –°–∫–ª–∞–¥–Ω—ñ —ñ—î—Ä–∞—Ä—Ö—ñ—ó –æ–±'—î–∫—Ç—ñ–≤ |
| **–î–æ—Å—Ç—É–ø –¥–æ –ë–î**    | –ü—Ä—è–º–∏–π –∞–±–æ —Ç–æ–Ω–∫–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è | –ß–µ—Ä–µ–∑ ORM/Active Record   |
| **–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è**   | ETL, –ø—Ä–æ—Å—Çi –æ–ø–µ—Ä–∞—Ü—ñ—ó        | CRUD –∑—ñ —Å–∫–ª–∞–¥–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏  |
| **–î—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É** | –í–∏—Å–æ–∫–∞ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å          | –ó–º–µ–Ω—à–µ–Ω–æ —á–µ—Ä–µ–∑ ORM        |

---

## ¬´–ê–Ω–µ–º—ñ—á–Ω–∞ –º–æ–¥–µ–ª—å¬ª —á–∏ –Ω—ñ?

::note{icon="ph:scales"}
**–¢–µ—Ä–º—ñ–Ω–æ–ª–æ–≥—ñ—è —Ç–∞ —Å—Ç–∏–≥–º–∞**

Active Record —á–∞—Å—Ç–æ –Ω–∞–∑–∏–≤–∞—é—Ç—å **–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–º ¬´–∞–Ω–µ–º—ñ—á–Ω–∞ –º–æ–¥–µ–ª—å –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ¬ª** (Anemic Domain Model) –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–æ—é –¥–æ–º–µ–Ω–Ω–æ—é –º–æ–¥–µ–ª–ª—é.

–Ø –≤—ñ–¥–¥–∞—é –ø–µ—Ä–µ–≤–∞–≥—É **—É—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—å –≤—ñ–¥ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—ñ–¥—Ç–µ–∫—Å—Ç—É** —Å–ª—ñ–≤ ¬´–∞–Ω–µ–º—ñ—á–Ω–∏–π¬ª —Ç–∞ ¬´–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω¬ª.
::

::tip{icon="ph:toolbox"}
**–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∞**

–¶–µ–π –ø–∞—Ç—Ç–µ—Ä–Ω —î **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º**. –Ø–∫ —ñ –±—É–¥—å-—è–∫–∏–π —ñ–Ω—à–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:

‚úÖ –ú–æ–∂–µ –≤–∏—Ä—ñ—à—É–≤–∞—Ç–∏ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ñ –ø–µ—Ä–µ–¥ –Ω–∏–º –∑–∞–¥–∞—á—ñ  
‚ùå –ú–æ–∂–µ –∑–∞–≤–¥–∞—Ç–∏ —à–∫–æ–¥–∏, —è–∫—â–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –º—ñ—Å—Ü—ñ

–Ø–∫—â–æ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ **–Ω–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –æ—Å–æ–±–ª–∏–≤–æ—é —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—é**, —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ Active Records –Ω–µ–º–∞—î –Ω—ñ—á–æ–≥–æ –ø–æ–≥–∞–Ω–æ–≥–æ.

–ê–ª–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è **–±—ñ–ª—å—à —Å–∫–ª–∞–¥–Ω–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞** –¥–ª—è –ø—Ä–æ—Å—Ç–æ—ó –ª–æ–≥—ñ–∫–∏ —Ç–∞–∫–æ–∂ –∑–∞–≤–¥–∞—Å—Ç—å —à–∫–æ–¥–∏ ‚Äî –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ **–Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω–æ—ó —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ**.
::

–í –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –≥–ª–∞–≤—ñ —Ä–æ–∑–∫—Ä–∏—î–º–æ –ø–∞—Ç—Ç–µ—Ä–Ω **Domain Model** —ñ –ø–æ–∫–∞–∂–µ–º–æ, —á–∏–º –≤—ñ–Ω –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ Active Record.

::warning{icon="ph:note-pencil"}
**–í–∞–∂–ª–∏–≤–µ —É—Ç–æ—á–Ω–µ–Ω–Ω—è**

–£ —Ü—å–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ **Active Record** –æ–∑–Ω–∞—á–∞—î **–ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è**, –∞ –Ω–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Active Record.

–ù–∞–∑–≤—É –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –ø—Ä–∏–¥—É–º–∞–≤ **Martin Fowler** —É –∫–Ω–∏–∑—ñ ¬´Patterns of Enterprise Application Architecture¬ª. –§—Ä–µ–π–º–≤–æ—Ä–∫ –∑'—è–≤–∏–≤—Å—è –ø—ñ–∑–Ω—ñ—à–µ —è–∫ –æ–¥–∏–Ω —ñ–∑ —Å–ø–æ—Å–æ–±—ñ–≤ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ü—å–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞.

–¢—É—Ç –π–¥–µ—Ç—å—Å—è –ø—Ä–æ **–ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è** —Ç–∞ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó, —â–æ –ª–µ–∂–∞—Ç—å –≤ –π–æ–≥–æ –æ—Å–Ω–æ–≤—ñ, –∞ –Ω–µ –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É —Ä–µ–∞–ª–∏–∑–∞—Ü—ñ—é.
::

---

## –ü—Ä–∞–≥–º–∞—Ç–∏—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥

::note{icon="ph:balance"}
**–ë—ñ–∑–Ω–µ—Å vs –Ü–¥–µ–∞–ª—å–Ω—ñ—Å—Ç—å**

–•–æ—á–∞ –±—ñ–∑–Ω–µ—Å-–¥–∞–Ω—ñ –≤–∞–∂–ª–∏–≤—ñ, —ñ –∫–æ–¥ –ø–æ–≤–∏–Ω–µ–Ω –∑–∞–±–µ–∑–ø–µ—á—É–≤–∞—Ç–∏ —ó—Ö —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å, —É –¥–µ—è–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –∫—Ä–∞—â–µ –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—å **–ø—Ä–∞–≥–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É**.
::

### –ö–æ–ª–∏ –º–æ–∂–Ω–∞ –ø–æ—Å–ª–∞–±–∏—Ç–∏ –≥–∞—Ä–∞–Ω—Ç—ñ—ó?

–ë—É–≤–∞—é—Ç—å –≤–∏–ø–∞–¥–∫–∏, –∫–æ–ª–∏ **–≥–∞—Ä–∞–Ω—Ç—ñ—ó —É–∑–≥–æ–¥–∂–µ–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø–æ—Å–ª–∞–±–ª–µ–Ω—ñ**, –æ—Å–æ–±–ª–∏–≤–æ –ø—Ä–∏ –≤–∏—Å–æ–∫–∏—Ö –≤–∏–º–æ–≥–∞—Ö –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–æ—Å—Ç—ñ:

::accordion
::accordion-item{title="–ü—Ä–∏–∫–ª–∞–¥: IoT-—Å–∏—Å—Ç–µ–º–∞"}
**–°—Ü–µ–Ω–∞—Ä—ñ–π**: –°–∏—Å—Ç–µ–º–∞ —â–æ–¥–Ω—è –ø—Ä–∏–π–º–∞—î **–º—ñ–ª—å—è—Ä–¥–∏ –ø–æ–¥—ñ–π** –∑ IoT-–ø—Ä–∏—Å—Ç—Ä–æ—ó–≤.

**–ü–∏—Ç–∞–Ω–Ω—è**: –ß–∏ —Å—Ç–∞–Ω–µ –≤–µ–ª–∏–∫–æ—é –ø—Ä–æ–±–ª–µ–º–æ—é —Ç–µ, —â–æ 0.001% –ø–æ–¥—ñ–π –±—É–¥—É—Ç—å –ø—Ä–æ–¥—É–±–ª—å–æ–≤–∞–Ω—ñ –∞–±–æ –≤—Ç—Ä–∞—á–µ–Ω—ñ?

**–ö–æ–º–ø—Ä–æ–º—ñ—Å**:

- üìâ –í—Ç—Ä–∞—Ç–∞ 0.001% –¥–∞–Ω–∏—Ö
- üìà –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –Ω–∞ –º—ñ–ª—å—è—Ä–¥–∏ –ø–æ–¥—ñ–π
- üí∞ –ó–Ω–∞—á–Ω–∞ –µ–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤

::

::accordion-item{title="–ü—Ä–∏–∫–ª–∞–¥: –°–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å"}
**–°—Ü–µ–Ω–∞—Ä—ñ–π**: –õ—ñ—á–∏–ª—å–Ω–∏–∫ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—å —Å–∞–π—Ç—É

**–ü–∏—Ç–∞–Ω–Ω—è**: –ß–∏ –∫—Ä–∏—Ç–∏—á–Ω–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å –¥–æ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è?

**–ú–æ–∂–ª–∏–≤—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏**:

- üéØ **Eventual consistency** ‚Äî –ª—ñ—á–∏–ª—å–Ω–∏–∫ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ—Ç–æ—á–Ω–∏–º –ø–µ–≤–Ω–∏–π —á–∞—Å
- ‚ö° **–ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ä–∞–∑ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É –∑–∞–º—ñ—Å—Ç—å real-time
- üìä **Approx imation** ‚Äî –ø—Ä–∏–±–ª–∏–∑–Ω–∏–π –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –æ–±—Å—è–≥—ñ–≤

::

::

::warning{icon="ph:gavel"}
**–ó–æ–ª–æ—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–∞–≥–º–∞—Ç–∏–∑–º—É**

–£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏—Ö –∑–∞–∫–æ–Ω—ñ–≤ –ø—Ä–æ—Å—Ç–æ –Ω–µ —ñ—Å–Ω—É—î. –í—Å–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥:

1. **–û–±–ª–∞—Å—Ç—ñ –±—ñ–∑–Ω–µ—Å—É** ‚Äî —Ñ—ñ–Ω–∞–Ω—Å–∏ vs –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ vs —Å–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ
2. **–û—Ü—ñ–Ω–∫–∏ —Ä–∏–∑–∏–∫—ñ–≤** ‚Äî —â–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è –ø—Ä–∏ –≤—Ç—Ä–∞—Ç—ñ/–¥—É–±–ª—é–≤–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö?
3. **–ë—ñ–∑–Ω–µ—Å-–Ω–∞—Å–ª—ñ–¥–∫—ñ–≤** ‚Äî —è–∫ —Ü–µ –≤–ø–ª–∏–Ω–µ –Ω–∞ –ø—Ä–∏–±—É—Ç–∫–æ–≤—ñ—Å—Ç—å?

–ú–æ–∂–Ω–∞ ¬´–∑—Ä—ñ–∑–∞—Ç–∏ –∫—É—Ç–∏¬ª —Å–∫—Ä—ñ–∑—å, –¥–µ —Ü–µ –º–æ–∂–ª–∏–≤–æ, –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å, —â–æ **—Ä–∏–∑–∏–∫–∞–º —ñ –Ω–∞—Å–ª—ñ–¥–∫–∞–º –¥–ª—è –±—ñ–∑–Ω–µ—Å—É –¥–∞–Ω–∞ —Ä–æ–∑—É–º–Ω–∞ –æ—Ü–µ–Ω–∫–∞**.
::

---

## –í–∏—Å–Ω–æ–≤–æ–∫

–£ —Ü—ñ–π –≥–ª–∞–≤—ñ –Ω–∞—à—ñ —Ä–æ–∑–≥–ª—è–Ω—É–ª–∏ –¥–≤–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏:

::card-group
::card{icon="mdi:script-text"}
#title
Transaction Script
#description
–û—Ä–≥–∞–Ω—ñ–∑—É—î –æ–ø–µ—Ä–∞—Ü—ñ—ó —Å–∏—Å—Ç–µ–º–∏ —É –≤–∏–≥–ª—è–¥—ñ –ø—Ä–æ—Å—Ç–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤. –ü—Ä–æ—Ü–µ–¥—É—Ä–∏ –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å, —â–æ –∫–æ–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è —î **—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–æ—é** ‚Äî –∞–±–æ —É—Å–ø—ñ—à–Ω–æ—é, –∞–±–æ –Ω–µ–≤–¥–∞–ª–æ—é.

**–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è**: –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∏—Ö –ø—ñ–¥–¥–æ–º–µ–Ω—ñ–≤, –¥–µ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –Ω–∞–≥–∞–¥—É—î –ø—Ä–æ—Å—Ç—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —Ç–∏–ø—É ETL.
::

::card{icon="mdi:database-cog"}
#title
Active Record
#description
–ö–æ–ª–∏ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –Ω–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—é, –∞–ª–µ –ø—Ä–∞—Ü—é—î –∑—ñ **—Å–∫–ª–∞–¥–Ω–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –¥–∞–Ω–∏—Ö**, —Ü—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å—Å—è —è–∫ Active Records.

–û–±'—î–∫—Ç Active Record ‚Äî —Ü–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö, —â–æ –Ω–∞–¥–∞—î –ø—Ä–æ—Å—Ç—ñ **CRUD-–º–µ—Ç–æ–¥–∏** –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö.
::
::

::tip{icon="ph:arrow-right"}
**–©–æ –¥–∞–ª—ñ?**

–†–æ–∑–≥–ª—è–Ω—É—Ç—ñ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω—ñ –Ω–∞ –≤–∏–ø–∞–¥–∫–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è **–ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –ø—Ä–æ—Å—Ç–æ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏**.

–£ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –≥–ª–∞–≤—ñ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –±—ñ–ª—å—à —Å–∫–ª–∞–¥–Ω—É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É —ñ –∑–∞–ø—Ä–æ–ø–æ–Ω—É—î–º–æ —Å–ø–æ—Å–æ–±–∏ –ø–æ–¥–æ–ª–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö —Å–∫–ª–∞–¥–Ω–æ—â—ñ–≤ —à–ª—è—Ö–æ–º –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ **¬´–ú–æ–¥–µ–ª—å –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ¬ª (Domain Model)**.
::

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –≤–ø—Ä–∞–≤–∏

::accordion
::accordion-item{title="–í–ø—Ä–∞–≤–∞ 1: –í–∏–±—ñ—Ä –ø–∞—Ç—Ç–µ—Ä–Ω–∞"}
**–ü–∏—Ç–∞–Ω–Ω—è**: –Ø–∫–∏–º —ñ–∑ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω—ñ–≤ —Å–ª—ñ–¥ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏ **–æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—ñ–¥–¥–æ–º–µ–Ω—É (Core Subdomain)**?

–ê) Transaction Script  
–ë) Active Record  
**–í) –î–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó Core Subdomain –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—å –∂–æ–¥–µ–Ω —ñ–∑ —Ü–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω—ñ–≤**  
–ì) –î–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó Core Subdomain –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—å –æ–±–∏–¥–≤–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∏

::collapsible{title="–í—ñ–¥–ø–æ–≤—ñ–¥—å"}
**–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: –í**

Core Subdomains –º—ñ—Å—Ç—è—Ç—å –Ω–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à—É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó. Transaction Script —ñ Active Record –Ω–µ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∑ —Ü—ñ—î—é —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—é —Ç–∞ –ø—Ä–∏–∑–≤–µ–¥—É—Ç—å –¥–æ Big Ball of Mud.

–î–ª—è Core Subdomains –ø–æ—Ç—Ä—ñ–±–µ–Ω **Domain Model pattern** (–ì–ª–∞–≤–∞ 6).
::
::

::accordion-item{title="–í–ø—Ä–∞–≤–∞ 2: –ü—Ä–æ–±–ª–µ–º–∏ —É–∑–≥–æ–¥–∂–µ–Ω–æ—Å—Ç—ñ"}
–ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥:

```csharp
public void CreateTicket(TicketData data)
{
    var agent = FindLeastBusyAgent();

    agent.ActiveTickets = agent.ActiveTickets + 1;
    agent.Save();

    var ticket = new Ticket();
    ticket.Id = Guid.NewGuid();
    ticket.Data = data;
    ticket.AssignedAgent = agent;
    ticket.Save();

    _alerts.Send(agent, "You have a new ticket!");
}
```

**–ü–∏—Ç–∞–Ω–Ω—è**: –Ø–∫—â–æ –ø—Ä–∏–ø—É—Å—Ç–∏—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –≤–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤–æ–≥–æ –º–µ—Ö–∞–Ω—ñ–∑–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π, —è–∫—ñ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ —É–∑–≥–æ–¥–∂–µ–Ω—ñ—Å—Ç—é –¥–∞–Ω–∏—Ö –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–Ω—É—Ç–∏?

–ê) –õ—ñ—á–∏–ª—å–Ω–∏–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤ –∞–≥–µ–Ω—Ç–∞ –º–æ–∂–µ –±—É—Ç–∏ –∑–±—ñ–ª—å—à–µ–Ω–∏–π –±—ñ–ª—å—à–µ –Ω—ñ–∂ –Ω–∞ 1  
–ë) –õ—ñ—á–∏–ª—å–Ω–∏–∫ –º–æ–∂–µ –∑–±—ñ–ª—å—à–∏—Ç–∏—Å—å, –∞–ª–µ –∞–≥–µ–Ω—Ç—É –Ω–µ –±—É–¥–µ –ø—Ä–∏—Å–≤–æ—î–Ω–æ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç  
–í) –ê–≥–µ–Ω—Ç –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–æ–≤–∏–π –∑–∞–ø–∏—Ç, –∞–ª–µ –Ω–µ –±—É–¥–µ –ø—Ä–æ —Ü–µ –æ–ø–æ–≤—ñ—â–µ–Ω–∏–π  
**–ì) –ú–æ–∂–ª–∏–≤–µ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è –≤—Å—ñ—Ö –≤–∏—â–µ–ø–µ—Ä–µ–ª—ñ—á–µ–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º**

::collapsible{title="–í—ñ–¥–ø–æ–≤—ñ–¥—å —Ç–∞ –∞–Ω–∞–ª—ñ–∑"}
**–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: –ì (All of the above)**

**–ü—Ä–æ–±–ª–µ–º–∞ –ê**: –Ø–∫—â–æ `agent.Save()` —É—Å–ø—ñ—à–Ω–æ –≤–∏–∫–æ–Ω–∞–≤—Å—è, –∞–ª–µ process crashed –ø–µ—Ä–µ–¥ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º –¥–æ caller, –∫–ª—ñ—î–Ω—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ—é ‚Üí +2 –∑–∞–º—ñ—Å—Ç—å +1

**–ü—Ä–æ–±–ª–µ–º–∞ –ë**: –Ø–∫—â–æ `agent.Save()` —É—Å–ø—ñ—à–Ω–æ, –∞–ª–µ `ticket.Save()` falls ‚Üí –∞–≥–µ–Ω—Ç –º–∞—î –∑–±—ñ–ª—å—à–µ–Ω–∏–π –ª—ñ—á–∏–ª—å–Ω–∏–∫ –±–µ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ ticket

**–ü—Ä–æ–±–ª–µ–º–∞ –í**: –Ø–∫—â–æ –æ–±–∏–¥–≤–∞ `Save()` —É—Å–ø—ñ—à–Ω—ñ, –∞–ª–µ `_alerts.Send()` falls ‚Üí ticket —Å—Ç–≤–æ—Ä–µ–Ω–æ, –∞–ª–µ –∞–≥–µ–Ω—Ç –Ω–µ –æ–ø–æ–≤—ñ—â–µ–Ω–∏–π

**–†—ñ—à–µ–Ω–Ω—èvoltage**:

- –û–±–≥–æ—Ä–Ω—É—Ç–∏ –≤—Å–µ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –ë–î
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Outbox Pattern –¥–ª—è alerts
- –î–æ–¥–∞—Ç–∏ idempotency keys –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ retry

::

::

::accordion-item{title="–í–ø—Ä–∞–≤–∞ 3: –î–æ–¥–∞—Ç–∫–æ–≤–∏–π edge case"}
–ó–Ω–∞–π–¥—ñ—Ç—å **—â–µ –æ–¥–Ω—É** –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—É –ø—Ä–æ–±–ª–µ–º—É –≤ –∫–æ–¥—ñ –∑ –í–ø—Ä–∞–≤–∏ 2, —â–æ –º–æ–∂–µ –≤–Ω–µ—Å—Ç–∏ —Ä–æ–∑–ª–∞–¥ —É —Å—Ç–∞–Ω —Å–∏—Å—Ç–µ–º–∏.

::collapsible{title="–ü—ñ–¥–∫–∞–∑–∫–∞"}
–ü–æ–¥—É–º–∞–π—Ç–µ –ø—Ä–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏–π –¥–æ—Å—Ç—É–ø (concurrency) –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ ¬´–Ω–∞–π–º–µ–Ω—à –∑–∞–π–Ω—è—Ç–æ–≥–æ –∞–≥–µ–Ω—Ç–∞¬ª.
::

::collapsible{title="–í—ñ–¥–ø–æ–≤—ñ–¥—å"}
**Race Condition –ø—Ä–∏ FindLeastBusyAgent()**

–Ø–∫—â–æ **–¥–≤–∞ –∑–∞–ø–∏—Ç–∏** –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ:

1. –û–±–∏–¥–≤–∞ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å `FindLeastBusyAgent()` ‚Üí –æ—Ç—Ä–∏–º—É—é—Ç—å **—Ç–æ–≥–æ —Å–∞–º–æ–≥–æ –∞–≥–µ–Ω—Ç–∞**
2. –û–±–∏–¥–≤–∞ –∑–±—ñ–ª—å—à—É—é—Ç—å `ActiveTickets` –Ω–∞ 1
3. –û–±–∏–¥–≤–∞ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å –∑–º—ñ–Ω–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –õ—ñ—á–∏–ª—å–Ω–∏–∫ –∑–±—ñ–ª—å—à–µ–Ω–æ –Ω–∞ 2, –∞–ª–µ —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ (2 tickets –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ).

**–ê–õ–ï!** –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∞—Å—å –æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∞ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–µ—Ä—Å—ñ—ó, –æ–¥–∏–Ω –∑ `Save()` –º–æ–∂–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –∑–º—ñ–Ω–∏ —ñ–Ω—à–æ–≥–æ ‚Üí –ª—ñ—á–∏–ª—å–Ω–∏–∫ –∑–±—ñ–ª—å—à–∏—Ç—å—Å—è –ª–∏—à–µ –Ω–∞ 1 –∑–∞–º—ñ—Å—Ç—å 2.

**–†—ñ—à–µ–Ω–Ω—è**: –û–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–∞ –∞–±–æ –ø–µ—Å–∏–º—ñ—Å—Ç–∏—á–Ω–∞ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ `agent.ActiveTickets`.
::
::
::
