---
title: Глава 12. EventStorming
---

# Глава 12. EventStorming

Ми розглянули безліч інструментів DDD для аналізу та моделювання. Але як застосувати їх, коли ви працюєте не один, а з групою людей, які мають різний рівень розуміння бізнесу та технологій?
Тут на сцену виходить **EventStorming**.

EventStorming — це формат воркшопу для швидкого дослідження складних бізнес-доменів.

::card{title="Основна мета" icon="lightbulb"}
Замість того, щоб тижнями писати специфікації, які ніхто не читає, або малювати UML-діаграми, які застарівають ще до збереження файлу, ми збираємо **всіх** стейкхолдерів в одній кімнаті і моделюємо реальність за допомогою стікерів.
::

## Підготовка

Для успішного проведення EventStorming вам знадобиться правильне середовище.

### Матеріали

- **Простір**: Вам потрібна стіна. Багато стіни. Краще за все підходить рулон паперу для плоттера, розкатаний на 5-10 метрів.
- **Стікери**: Вам знадобиться багато стікерів різних кольорів. Кольори мають значення (див. легенду нижче).
- **Маркери**: Чорні маркери для всіх учасників. Ручки не підходять — їх не видно здалеку.
- **Їжа**: Сесія може тривати 2-4 години. Снеки обов'язкові.

### Люди

Кого запросити?

- **Розробники**: Вони знають, як система працює зараз (або як вона _не_ працює).
- **Бізнес-експерти**: Вони знають, як бізнес _має_ працювати.
- **QA, Тестувальники**: Вони знають всі граничні випадки (edge cases).
- **UX/UI Дизайнери**: Вони думають про досвід користувача.

::tip[Приберіть стільці]
Це може звучати дивно, але EventStorming проводиться **стоячи**.
Коли люди сидять, вони стають пасивними спостерігачами. Коли вони стоять, вони активні, ходять вздовж стіни і взаємодіють.
Залиште пару стільців для тих, кому фізично важко стояти, але решту приберіть.
::

### Легенда

Кожен колір стікера має чітке значення у граматиці EventStorming.

::card-group
::card{title="Domain Event" icon="ticket" style="background-color: #ffcc80; color: black"}
**Помаранчевий**.
Ключовий елемент. Щось, що трапилося в бізнесі.
Завжди дієслово в минулому часі: `OrderCreated`, `PaymentFailed`.
::
::card{title="Command" icon="terminal" style="background-color: #ddf2ff; color: black"}
**Блакитний**.
Дія, намір. Те, що спричиняє подію.
Наказовий спосіб: `CreateOrder`, `PayInvoice`.
::
::card{title="Aggregate" icon="cube" style="background-color: #fff9c4; color: black"}
**Жовтий (великий)**.
Логічна одиниця, яка обробляє команду і породжує подію.
Іменник: `Order`, `Payment`.
::
::card{title="Policy" icon="scroll" style="background-color: #e1bee7; color: black"}
**Ліловий**.
Реактивна логіка. "Коли трапляється подія А, зроби Б".
Або: "Якщо сума > X, потрібне погодження".
::
::card{title="Read Model" icon="eye" style="background-color: #c8e6c9; color: black"}
**Зелений**.
Інформація, яку бачить користувач перед прийняттям рішення.
Наприклад: `OrderSummaryView`.
::
::card{title="Pain Point" icon="alert-triangle" style="background-color: #ffcdd2; color: black"}
**Рожевий/Червоний**.
Проблема, питання, вузьке місце.
Клеїться будь-де, де виникає дискусія або сумнів.
::
::card{title="User / Actor" icon="user" style="background-color: #ffff8d; color: black"}
**Жовтий (маленький)**.
Людина або роль, яка виконує команду.
`Customer`, `Admin`.
::
::card{title="External System" icon="server" style="background-color: #f8bbd0; color: black"}
**Рожевий (великий)**.
Система, яку ми не контролюємо (PayPal, Legacy CRM).
::
::

---

## Процес (10 Кроків)

EventStorming проходить через серію етапів, кожен з яких додає новий шар знань до моделі.

::steps

### 1. Хаотичне Дослідження (Chaotic Exploration)

Всі учасники беруть **помаранчеві стікери** і починають писати події.
Це мозковий штурм. Не намагайтеся одразу впорядковувати.
Просто вивантажуйте з голови все, що знаєте про домен.

- `AccountRegistered`
- `EmailSent`
- `ItemAddedToCart`
- `OrderShipped`

**Мета**: Зібрати максимальну кількість фактів про систему.

### 2. Хронологія (Timeline)

Тепер впорядковуємо події в часі, зліва направо.

- Видаляємо дублікати.
- Знаходимо прогалини ("Чекай, а що відбувається між `OrderPlaced` і `OrderShipped`?").
- Починаємо з **Happy Path** (успішний сценарій).
- Потім додаємо альтернативні шляхи (помилки, відмови).
  Можна використовувати стрілки або просто розміщення, щоб показати розгалуження.

### 3. Болеві Точки (Pain Points)

Це критично важливий етап. Ми вже бачимо процес, тепер час його критикувати.
Клейте **рожеві стікери** (ромбом) там, де є проблеми:

- "Тут ми часто втрачаємо дані".
- "Це робиться вручну в Excel".
- "Тут ми чекаємо відповіді від банку 3 дні".
  Це карта ваших майбутніх покращень і технічного боргу.

### 4. Ключові Події (Pivotal Events)

Знайдіть події, які розділяють процес на великі фази.
Наприклад, `OrderConfirmed` може розділяти фазу "Вибір товарів" від фази "Доставка".
Позначте ці місця вертикальними лініями (скотчем або маркером).
Ці лінії — перші кандидати на межі **Обмежених Контекстів (Bounded Contexts)**.

### 5. Команди (Commands)

Події не трапляються самі по собі. Щось їх викликає.
Додайте **блакитні стікери** перед подіями.
`PlaceOrder` -> викликає -> `OrderPlaced`.
Якщо команду виконує людина, додайте маленький жовтий стікер (**Actor**) з роллю (`Customer`, `Manager`).

### 6. Політики (Policies)

Іноді подія викликає іншу команду автоматично. Це бізнес-правила.
Використовуйте **лілові стікери**.
`PaymentReceived` -> **[Policy: Якщо замовлення оплачено, почати збірку]** -> `StartPacking`.
Політики — це клей, який з'єднує процеси. Часто саме в них ховається найскладніша логіка ("Saga" або "Process Manager").

### 7. Моделі Читання (Read Models)

Користувач не натискає кнопки наосліп. Йому потрібна інформація.
Що користувач бачив _перед_ тим, як натиснути `ConfirmOrder`?
Він бачив `CartTotal` або `ShippingAddressPreview`.
Додайте **зелені стікери** перед командами. Це ваші майбутні проекції (Projections) або екрани UI.

### 8. Зовнішні Системи (External Systems)

Наша система не живе у вакуумі.
Позначте взаємодію з зовнішнім світом великими **рожевими стікерами**.

- `PaymentGateway` викликає подію `PaymentConfirmed`.
- `LegacyERP` отримує команду `UpdateStock`.

### 9. Агрегати (Aggregates)

Тепер, коли у нас є Команди і Події, ми можемо згрупувати їх.
Який об'єкт відповідає за прийняття рішення `PlaceOrder`? Мабуть, `Order`.
Додайте великі **жовті стікери** (Агрегати).
Агрегат отримує Команду, перевіряє інваріанти, і породжує Подію.
_Примітка: На цьому етапі ви можете виявити, що деякі агрегати занадто великі або мають нечіткі межі._

### 10. Обмежені Контексти (Bounded Contexts)

Подивіться на стіну. Ви побачите кластери стікерів, які тісно пов'язані між собою, і слабко пов'язані з іншими групами.
Обведіть ці групи. Це ваші кандидати на **Bounded Contexts** (мікросервіси або модулі).
::

---

## Варіації EventStorming

EventStorming — це гнучкий формат. Ви можете адаптувати його під свої цілі.

### Big Picture (Загальна Картина)

Використовується для дослідження або стратегічного планування.

- **Масштаб**: Вся організація або великий департамент.
- **Мета**: Знайти вузькі місця, зрозуміти загальний потік цінності, виявити конфлікти термінології.
- **Деталізація**: Зупиняємось на етапі 3 або 4 (Події + Болеві точки + Контексти). Не заглиблюємось в команди та агрегати.

### Process Modeling (Моделювання Процесу)

Використовується для проектування конкретної функції або фічі.

- **Масштаб**: Один бізнес-процес (наприклад, "Обробка повернення товару").
- **Мета**: Спроектувати надійну модель, готову до імплементації.
- **Деталізація**: Проходимо всі 10 кроків. Чітко визначаємо команди, політики та агрегати.

### Software Design (Проектування ПЗ)

Найглибший рівень.
Тут ми фактично "програмуємо стікерами".
Ми можемо сперечатися про те, чи має поле `amount` бути в `Order` чи в `Payment`.
Це перехід від стікерів безпосередньо до коду (Aggregates, Value Objects, Domain Services).

## Коли варто проводити EventStorming?

1.  **Створення Єдиної Мови (Ubiquitous Language)**: Коли розробники і бізнес розмовляють різними мовами ("Order" vs "Purchase"), EventStorming швидко виявляє ці конфлікти.
2.  **Запуск нового проекту**: Щоб не будувати на припущеннях.
3.  **Модернізація Legacy**: Щоб зрозуміти, що _насправді_ робить старий код, перш ніж переписувати його.
4.  **Onboarding новачків**: Найшвидший спосіб показати новій людині, як працює бізнес.
5.  **Пошук вузьких місць**: Коли бізнес каже "ми працюємо повільно", візуалізація часто показує, що проблема не в коді, а в ручному погодженні, яке триває тиждень.

::warning[Коли НЕ варто проводити]
Якщо процес тривіальний (наприклад, простий CRUD без бізнес-логіки), EventStorming буде тратою часу.
Не стріляйте з гармати по горобцях.
::

## Поради для Фасилітатора

Фасилітатор — це ведучий воркшопу. Його мета — підтримувати енергію і тримати фокус.

::accordion-group
::accordion{title="Слідкуйте за енергією"}
EventStorming виснажує. Робіть перерви щогодини.
Якщо дискусія зайшла в глухий кут — паркуйте питання ("Parking Lot") і рухайтесь далі.
::
::accordion{title="Залучайте мовчунів"}
Часто найкращі знання є у самих тихих людей.
Якщо хтось стоїть осторонь, дайте йому маркер і спитайте: "А як це виглядає з вашої точки зору?".
::
::accordion{title="Віддалений EventStorming"}
Інструменти типу **Miro** або **Mural** чудово підходять.
**Плюси**:

- Стікери не відклеюються.
- Нескінченне полотно.
- Можна копіювати-вставляти групи.
  **Мінуси**:
- Втрачається динаміка живого спілкування.
- Легше "відключитися" і перевіряти пошту.
  **Порада**: Тримайте сесії коротшими (максимум 2 години) і групи меншими (до 5-6 осіб).
  ::
  ::

## Висновок

EventStorming — це, мабуть, найефективніший інструмент для **Knowledge Crunching** (пережовування знань).
Він дозволяє за кілька годин отримати розуміння, на яке раніше йшли тижні.

Результат сесії — це не просто кольорова стіна. Це **спільне розуміння** (Shared Model) у головах всіх учасників. І це розуміння — головна передумова для успішного DDD.

---

### Вправи

1.  Кого слід запросити на EventStorming сесію, присвячену процесу "Звільнення співробітника"?
    - Тільки HR?
    - HR та розробників?
    - HR, розробників, юристів, службу безпеки та бухгалтерію?
      _(Підказка: процес зачіпає набагато більше доменів, ніж здається)_

2.  Ви виявили "Cluster" стікерів (групу), яка пов'язана з іншими групами лише через ID клієнта. Про що це свідчить?
    - Це, ймовірно, окремий Обмежений Контекст.
    - Це помилка моделювання.

3.  Чим Політика (Policy) відрізняється від Команди (Command)?
    - Команда — це намір користувача ("Зроби це").
    - Політика — це реакція системи ("Якщо трапилось це, то зроби те").
