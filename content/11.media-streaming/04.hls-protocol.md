# 04. HLS Protocol: HTTP Live Streaming —É –î–µ—Ç–∞–ª—è—Ö

## 1. –í—Å—Ç—É–ø —Ç–∞ –ö–æ–Ω—Ç–µ–∫—Å—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: –Ø–∫ YouTube –ø–ª–∞–≤–Ω–æ –ø–µ—Ä–µ–º–∏–∫–∞—î —è–∫—ñ—Å—Ç—å –≤—ñ–¥–µ–æ?

–£—è–≤—ñ—Ç—å —Å–∏—Ç—É–∞—Ü—ñ—é: –≤–∏ –¥–∏–≤–∏—Ç–µ—Å—å –≤—ñ–¥–µ–æ –Ω–∞ YouTube —É Full HD (1080p). –†–∞–ø—Ç–æ–º –≤–∞—à Wi-Fi –ø–æ–≥—ñ—Ä—à—É—î—Ç—å—Å—è (—Ö—Ç–æ—Å—å –ø–æ—á–∞–≤ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –≤–µ–ª–∏–∫–∏–π —Ñ–∞–π–ª). –í—ñ–¥–µ–æ –Ω–µ –∑–∞–≤–∏—Å–∞—î! –í–æ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è –Ω–∞ 720p, –ø–æ—Ç—ñ–º –Ω–∞ 480p. –ö–æ–ª–∏ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –∑–Ω–æ–≤—É —Å—Ç–∞–±—ñ–ª—ñ–∑—É—î—Ç—å—Å—è ‚Äî —è–∫—ñ—Å—Ç—å –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –¥–æ 1080p. **–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?**

–¶–µ –º–∞–≥—ñ—è HLS (HTTP Live Streaming) ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª—É, —è–∫–∏–π –∑–º—ñ–Ω–∏–≤ —ñ–Ω–¥—É—Å—Ç—Ä—ñ—é —Å—Ç—Ä—ñ–º—ñ–Ω–≥—É –Ω–∞–∑–∞–≤–∂–¥–∏.

### –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –µ–≤–æ–ª—é—Ü—ñ—è: –í—ñ–¥ RTMP –¥–æ HLS

::steps

### 2000-—Ç—ñ —Ä–æ–∫–∏: –ï–ø–æ—Ö–∞ RTMP (Flash)

–£ —á–∞—Å–∏ Flash Player –≤—ñ–¥–µ–æ —Å—Ç—Ä—ñ–º–∏–ª–æ—Å—å —á–µ—Ä–µ–∑ RTMP (Real-Time Messaging Protocol). –¶–µ –±—É–≤ **–±—ñ–Ω–∞—Ä–Ω–∏–π** –ø—Ä–æ—Ç–æ–∫–æ–ª, —è–∫–∏–π –ø—Ä–∞—Ü—é–≤–∞–≤ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç 1935.

**–ü—Ä–æ–±–ª–µ–º–∏ RTMP:**

- –§–∞—î—Ä–≤–æ–ª–∏ –±–ª–æ–∫—É–≤–∞–ª–∏ –ø–æ—Ä—Ç 1935 (–¥–æ–∑–≤–æ–ª–µ–Ω–∏–π —Ç—ñ–ª—å–∫–∏ HTTP 80/443)
- –ù–µ –±—É–ª–æ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—ó —è–∫–æ—Å—Ç—ñ (bitrate —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π)
- –ü–æ—Ç—Ä—ñ–±–µ–Ω —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –º–µ–¥—ñ–∞-—Å–µ—Ä–≤–µ—Ä (Adobe Media Server, Wowza)
- Flash Player –ø–æ–º–µ—Ä —É 2020 —Ä–æ—Ü—ñ

### 2009 —Ä—ñ–∫: Apple –≤–∏–Ω–∞—Ö–æ–¥–∏—Ç—å HLS

Apple —Ö–æ—Ç—ñ–ª–∞ —Å—Ç—Ä—ñ–º–∏—Ç–∏ –≤—ñ–¥–µ–æ –Ω–∞ iPhone 3GS. –ü—Ä–æ–±–ª–µ–º–∞: Flash –Ω–µ –ø—Ä–∞—Ü—é–≤–∞–≤ –Ω–∞ iOS. –†—ñ—à–µ–Ω–Ω—è: —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª, —è–∫–∏–π:

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∑–≤–∏—á–∞–π–Ω–∏–π HTTP (–ø–æ—Ä—Ç 80/443) ‚Äî –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –∫—Ä—ñ–∑—å –±—É–¥—å-—è–∫—ñ —Ñ–∞—î—Ä–≤–æ–ª–∏
- –ü—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ CDN (Content Delivery Network) ‚Äî –º–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è –Ω–∞ –º—ñ–ª—å–π–æ–Ω–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ü—ñ–¥—Ç—Ä–∏–º—É—î ABR (Adaptive Bitrate) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–º—ñ–Ω—é—î —è–∫—ñ—Å—Ç—å

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£ —á–µ—Ä–≤–Ω—ñ 2009 —Ä–æ–∫—É Apple –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∞ HLS —Ä–∞–∑–æ–º –∑ iPhone 3GS.

### 2010-—Ç—ñ: HLS —Å—Ç–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º

- **2011**: YouTube –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∑ Flash –Ω–∞ HTML5 + HLS
- **2017**: RFC 8216 (–æ—Ñ—ñ—Ü—ñ–π–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è HLS)
- **2020**: Flash –æ—Ñ—ñ—Ü—ñ–π–Ω–æ –ø–æ–º–µ—Ä. HLS –ø–µ—Ä–µ–º—ñ–≥

::

### –ß–æ–º—É HLS –ø–µ—Ä–µ–º—ñ–≥?

::card-group

::card{title="üåê –ü—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ HTTP" icon="i-lucide-globe"}
–î–ª—è —Å–µ—Ä–≤–µ—Ä–∞ —Å—Ç—Ä—ñ–º—ñ–Ω–≥ –≤–∏–≥–ª—è–¥–∞—î —è–∫ –∑–≤–∏—á–∞–π–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è JPG-–∑–æ–±—Ä–∞–∂–µ–Ω—å. –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ–¥—ñ–∞-—Å–µ—Ä–≤–µ—Ä–∏ ‚Äî –ø—ñ–¥—ñ–π–¥–µ –∑–≤–∏—á–∞–π–Ω–∏–π **Nginx** –∞–±–æ **Apache**.

::

::card{title="üìä Adaptive Bitrate" icon="i-lucide-trending-up"}
–ü–ª–µ—î—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±–∏—Ä–∞—î —è–∫—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —à–≤–∏–¥–∫–æ—Å—Ç—ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —ñ–∑ 4G –±–∞—á–∏—Ç—å 1080p, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —ñ–∑ 3G ‚Äî 360p.

::

::card{title="üöÄ CDN-—Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å" icon="i-lucide-rocket"}
–°—Ç—Ä—ñ–º—ñ–Ω–≥ –∫–µ—à—É—î—Ç—å—Å—è –Ω–∞ **CloudFront**, **Cloudflare**, **Fastly** —Ç–∞–∫ —Å–∞–º–æ, —è–∫ —Å—Ç–∞—Ç–∏—á–Ω—ñ —Ñ–∞–π–ª–∏ (CSS, JS). –¶–µ –¥–µ—à–µ–≤–æ —ñ —à–≤–∏–¥–∫–æ.

::

::card{title="üì± –ù–∞—Ç–∏–≤–Ω–∏–π –¥–ª—è Apple" icon="i-lucide-smartphone"}
iOS/macOS –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å HLS –Ω–∞ —Ä—ñ–≤–Ω—ñ –û–°. –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ ‚Äî –ø—Ä–∞—Ü—é—î –≤ Safari –∑ —Ç–µ–≥–æ–º `<video>`.

::

::

### –°—Ü–µ–Ω–∞—Ä—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

::tabs

::tabs-item{label="üî¥ Live Streaming" icon="i-lucide-radio"}

**–ü—Ä–∏–∫–ª–∞–¥–∏:** Twitch, YouTube Live, —Å–ø–æ—Ä—Ç–∏–≤–Ω—ñ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- Playlist –ø–æ—Å—Ç—ñ–π–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è (–∫–æ–∂–Ω—ñ 2-10 —Å–µ–∫—É–Ω–¥)
- –ó–∞—Ç—Ä–∏–º–∫–∞ (latency): 10-30 —Å–µ–∫—É–Ω–¥ (–∑–≤–∏—á–∞–π–Ω–∏–π HLS), 2-6 —Å–µ–∫—É–Ω–¥ (Low Latency HLS)
- –°–µ–≥–º–µ–Ω—Ç–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–µ–≤–Ω–æ–≥–æ —á–∞—Å—É (sliding window)

**Use case:**

```plaintext
–°—Ç—Ä—ñ–º–µ—Ä –≥—Ä–∞—î –≤ CS:GO ‚Üí OBS –∫–æ–¥—É—î –≤ HLS ‚Üí CDN —Ä–æ–∑–¥–∞—î 100,000 –≥–ª—è–¥–∞—á–∞–º
```

::

::tabs-item{label="üé¨ VOD (Video on Demand)" icon="i-lucide-film"}

**–ü—Ä–∏–∫–ª–∞–¥–∏:** Netflix, Amazon Prime, YouTube (–∑–∞–ø–∏—Å–∞–Ω—ñ –≤—ñ–¥–µ–æ)

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- Playlist —Å—Ç–∞—Ç–∏—á–Ω–∏–π (—Å—Ç–≤–æ—Ä–µ–Ω–∏–π –æ–¥–∏–Ω —Ä–∞–∑)
- –°–µ–≥–º–µ–Ω—Ç–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞–∑–∞–≤–∂–¥–∏ (–¥–æ–∫–∏ –Ω–µ –≤–∏–¥–∞–ª—è—Ç—å –≤—ñ–¥–µ–æ)
- –ú–æ–∂–Ω–∞ —à—É–∫–∞—Ç–∏ (seek) –ø–æ –≤—Å—å–æ–º—É –≤—ñ–¥–µ–æ

**Use case:**

```plaintext
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±–∏—Ä–∞—î —Å–µ—Ä—ñ–∞–ª ‚Üí CDN –≤—ñ–¥–¥–∞—î –≥–æ—Ç–æ–≤–∏–π HLS ‚Üí –ø–µ—Ä–µ–≥–ª—è–¥ –±–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—ó
```

::

::tabs-item{label="üì∫ DVR (Time-shifting)" icon="i-lucide-clock"}

**–ü—Ä–∏–∫–ª–∞–¥–∏:** IPTV-—Å–µ—Ä–≤—ñ—Å–∏, —Å–ø–æ—Ä—Ç–∏–≤–Ω—ñ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó –∑ –ø–µ—Ä–µ–º–æ—Ç–∫–æ—é

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

- Live —Å—Ç—Ä—ñ–º, –∞–ª–µ –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –ø–µ—Ä–µ–º–æ—Ç–∞—Ç–∏ –Ω–∞–∑–∞–¥
- Playlist –º—ñ—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ñ —Å–µ–≥–º–µ–Ω—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ—Å—Ç–∞–Ω–Ω—ñ 2 –≥–æ–¥–∏–Ω–∏)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `EXT-X-PLAYLIST-TYPE:EVENT`

**Use case:**

```plaintext
–§—É—Ç–±–æ–ª—å–Ω–∏–π –º–∞—Ç—á live ‚Üí –≥–ª—è–¥–∞—á –∑–∞–ø—ñ–∑–Ω–∏–≤—Å—è ‚Üí –ø–µ—Ä–µ–º–æ—Ç—É—î –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ ‚Üí –¥–∏–≤–∏—Ç—å—Å—è –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
```

::

::

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏ (Prerequisites)

–ü–µ—Ä–µ–¥ –≤–∏–≤—á–µ–Ω–Ω—è–º HLS –∫–æ—Ä–∏—Å–Ω–æ —Ä–æ–∑—É–º—ñ—Ç–∏:

- **HTTP/HTTPS**: –ú–µ—Ç–æ–¥–∏ GET, –∫–æ–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π (200, 404), –∑–∞–≥–æ–ª–æ–≤–∫–∏ (Content-Type, Cache-Control)
- **–í—ñ–¥–µ–æ-–∫–æ–¥–µ–∫–∏**: H.264/AVC, H.265/HEVC (–¥–∏–≤. [–ø–æ–ø–µ—Ä–µ–¥–Ω—é –≥–ª–∞–≤—É](./03.video-codecs.md))
- **–ê—É–¥—ñ–æ-–∫–æ–¥–µ–∫–∏**: AAC, MP3
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏**: MP4, MPEG-TS (–¥–∏–≤. [–∞–Ω–∞—Ç–æ–º—ñ—é –≤—ñ–¥–µ–æ](./02.audio-video-anatomy.md))

::note
**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –Ø–∫—â–æ –≤–∏ —Ä–æ–∑—É–º—ñ—î—Ç–µ, —è–∫ –ø—Ä–∞—Ü—é—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å –Ω–∞ –≤–µ–±-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (`<img src="photo.jpg">`), –≤–∏ –ª–µ–≥–∫–æ –∑—Ä–æ–∑—É–º—ñ—î—Ç–µ HLS ‚Äî —Ü–µ —Ç–æ–π —Å–∞–º–∏–π –ø—Ä–∏–Ω—Ü–∏–ø, –∞–ª–µ –¥–ª—è –≤—ñ–¥–µ–æ.
::

---

## 2. –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ñ –ö–æ–Ω—Ü–µ–ø—Ü—ñ—ó

### –©–æ —Ç–∞–∫–µ HLS? (Formal Definition)

**HLS (HTTP Live Streaming)** ‚Äî —Ü–µ –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–æ—Ç–æ–∫–æ–≤–æ—ó –ø–µ—Ä–µ–¥–∞—á—ñ –º–µ–¥—ñ–∞-–∫–æ–Ω—Ç–µ–Ω—Ç—É —á–µ—Ä–µ–∑ HTTP, —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π –∫–æ–º–ø–∞–Ω—ñ—î—é Apple. –í—ñ–Ω –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—ñ **—Å–µ–≥–º–µ–Ω—Ç–æ–≤–∞–Ω–æ–≥–æ —Å—Ç—Ä—ñ–º—ñ–Ω–≥—É** —Ç–∞ **–∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É –±—ñ—Ç—Ä–µ–π—Ç—É**.

**–ö–ª—é—á–æ–≤—ñ –ø–æ–Ω—è—Ç—Ç—è:**

- **Playlist (Manifest)**: –¢–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª —É —Ñ–æ—Ä–º–∞—Ç—ñ M3U8, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –º–µ—Ç–∞—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –¥–æ—Å—Ç—É–ø–Ω—ñ –ø–æ—Ç–æ–∫–∏ —Ç–∞ —Å–µ–≥–º–µ–Ω—Ç–∏
- **Segment**: –ö–æ—Ä–æ—Ç–∫–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –≤—ñ–¥–µ–æ (–∑–∞–∑–≤–∏—á–∞–π 2-10 —Å–µ–∫—É–Ω–¥), –∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–π —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä MPEG-TS (.ts) –∞–±–æ fMP4 (.m4s)
- **Adaptive Bitrate (ABR)**: –ú–µ—Ö–∞–Ω—ñ–∑–º –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É —è–∫–æ—Å—Ç—ñ –ø–æ—Ç–æ–∫—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø—Ä–æ–ø—É—Å–∫–Ω–æ—ó –∑–¥–∞—Ç–Ω–æ—Å—Ç—ñ –º–µ—Ä–µ–∂—ñ –∫–ª—ñ—î–Ω—Ç–∞

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ HLS: –û–≥–ª—è–¥

::mermaid

```mermaid
graph LR
    A["üé• –í—ñ–¥–µ–æ<br/>(MP4, AVI, MOV)"] --> B["üîÑ Encoder<br/>(FFmpeg, OBS)"]
    B --> C1["üìä 1080p<br/>(5 Mbps)"]
    B --> C2["üìä 720p<br/>(2.5 Mbps)"]
    B --> C3["üìä 480p<br/>(1 Mbps)"]
    B --> C4["üìä 360p<br/>(500 Kbps)"]

    C1 --> D["‚òÅÔ∏è Origin Server<br/>(Nginx, S3)"]
    C2 --> D
    C3 --> D
    C4 --> D

    D --> E["üåê CDN<br/>(CloudFront, Cloudflare)"]
    E --> F["üì± Player<br/>(hls.js, Safari, VLC)"]

    F --> G{{"üîç Bandwidth<br/>Detection"}}
    G -->|High Speed| C1
    G -->|Medium| C2
    G -->|Low| C4

    style A fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style B fill:#f59e0b,stroke:#b45309,color:#ffffff
    style D fill:#8b5cf6,stroke:#6d28d9,color:#ffffff
    style E fill:#10b981,stroke:#047857,color:#ffffff
    style F fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style G fill:#f59e0b,stroke:#b45309,color:#ffffff
```

::

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è –ø–æ—Ç–æ–∫—É:**

1. **Encoder** –æ—Ç—Ä–∏–º—É—î –≤–∏—Ö—ñ–¥–Ω–µ –≤—ñ–¥–µ–æ —ñ –∫–æ–¥—É—î –π–æ–≥–æ –≤ –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ —è–∫–æ—Å—Ç—ñ (1080p, 720p, 480p, 360p)
2. **Origin Server** –∑–±–µ—Ä—ñ–≥–∞—î –≤—Å—ñ —Å–µ–≥–º–µ–Ω—Ç–∏ —Ç–∞ –ø–ª–µ–π–ª—ñ—Å—Ç–∏
3. **CDN** –∫–µ—à—É—î –∫–æ–Ω—Ç–µ–Ω—Ç —ñ —Ä–æ–∑–¥–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –ø–æ –≤—Å—å–æ–º—É —Å–≤—ñ—Ç—É
4. **Player** –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –ø–ª–µ–π–ª—ñ—Å—Ç–∏, –≤–∏–∑–Ω–∞—á–∞—î —à–≤–∏–¥–∫—ñ—Å—Ç—å —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É —ñ –≤–∏–±–∏—Ä–∞—î –æ–ø—Ç–∏–º–∞–ª—å–Ω—É —è–∫—ñ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ HLS

::field-group

::field{name="Master Playlist (.m3u8)" type="File"}
–ì–æ–ª–æ–≤–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —è–∫–æ—Å—Ç—ñ (bitrate –≤–∞—Ä—ñ–∞–Ω—Ç–∏). –¶–µ –ø–µ—Ä—à–∏–π —Ñ–∞–π–ª, —è–∫–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –ø–ª–µ—î—Ä.

- **–ü—Ä–∏–∫–ª–∞–¥ —ñ–º–µ–Ω—ñ:** `master.m3u8`, `index.m3u8`, `playlist.m3u8`

::

::field{name="Media Playlist (.m3u8)" type="File"}
–°–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –º–µ–¥—ñ–∞-—Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –ø–µ–≤–Ω–æ—ó —è–∫–æ—Å—Ç—ñ. –ö–æ–∂–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç bitrate –º–∞—î —Å–≤—ñ–π Media Playlist.

- **–ü—Ä–∏–∫–ª–∞–¥ —ñ–º–µ–Ω—ñ:** `1080p/playlist.m3u8`, `720p/playlist.m3u8`

::

::field{name="Segment (.ts, .m4s)" type="File"}
–§—Ä–∞–≥–º–µ–Ω—Ç –≤—ñ–¥–µ–æ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—é 2-10 —Å–µ–∫—É–Ω–¥. –¶–µ —Ç–µ, —â–æ —Ä–µ–∞–ª—å–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —ñ –ø—Ä–æ–≥—Ä–∞—î—Ç—å—Å—è.

- **–§–æ—Ä–º–∞—Ç–∏:**

- `.ts` ‚Äî MPEG-2 Transport Stream (–∫–ª–∞—Å–∏—á–Ω–∏–π)
- `.m4s` ‚Äî Fragmented MP4 (—Å—É—á–∞—Å–Ω–∏–π, CMAF-—Å—É–º—ñ—Å–Ω–∏–π)

::

::field{name="Init Segment (init.mp4)" type="File" required="false"}
–û–±–æ–≤'—è–∑–∫–æ–≤–∏–π –¥–ª—è fMP4. –ú—ñ—Å—Ç–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω—ñ (–∫–æ–¥–µ–∫, —Ä–æ–∑–¥—ñ–ª—å–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å, sample rate), –±–µ–∑ —è–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–∏ –Ω–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–µ–∫–æ–¥–æ–≤–∞–Ω—ñ.

::

::

### –ê–Ω–∞–ª–æ–≥—ñ—è 1: –ö–Ω–∏–≥–∞ –∑ –ø–µ—Ä–µ–∫–ª–∞–¥–∞–º–∏

–£—è–≤—ñ—Ç—å –¥—É–∂–µ —Ç–æ–≤—Å—Ç—É –∫–Ω–∏–≥—É (—Ñ—ñ–ª—å–º –Ω–∞ 2 –≥–æ–¥–∏–Ω–∏):

::steps

### –ö—Ä–æ–∫ 1: –û–±–∏—Ä–∞—î—Ç–µ –º–æ–≤—É (Master Playlist)

–í–∏ –±–µ—Ä—ñ—Ç—å –∫–Ω–∏–≥—É —É —Ä—É–∫–∏ —ñ –±–∞—á–∏—Ç–µ –Ω–∞ –æ–±–∫–ª–∞–¥–∏–Ω—Ü—ñ:

```
"–¶—è –∫–Ω–∏–≥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –º–æ–≤–∞–º–∏:
- –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ (—Å—Ç–æ—Ä—ñ–Ω–∫–∞ 1)
- English (—Å—Ç–æ—Ä—ñ–Ω–∫–∞ 500)
- Deutsch (—Å—Ç–æ—Ä—ñ–Ω–∫–∞ 1000)"
```

–¶–µ **Master Playlist** ‚Äî –≤—ñ–Ω –∫–∞–∂–µ, —è–∫—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ.

### –ö—Ä–æ–∫ 2: –ó–Ω–∞—Ö–æ–¥–∏—Ç–µ –∑–º—ñ—Å—Ç (Media Playlist)

–í–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É 1 (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –≤–µ—Ä—Å—ñ—è) —ñ –±–∞—á–∏—Ç–µ **–∑–º—ñ—Å—Ç**:

```
–†–æ–∑–¥—ñ–ª 1: —Å—Ç–æ—Ä—ñ–Ω–∫–∏ 10-25
–†–æ–∑–¥—ñ–ª 2: —Å—Ç–æ—Ä—ñ–Ω–∫–∏ 26-40
–†–æ–∑–¥—ñ–ª 3: —Å—Ç–æ—Ä—ñ–Ω–∫–∏ 41-55
```

–¶–µ **Media Playlist** ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤.

### –ö—Ä–æ–∫ 3: –ß–∏—Ç–∞—î—Ç–µ –ø–æ —á–∞—Å—Ç–∏–Ω–∞—Ö (Segments)

–í–∏ –Ω–µ —á–∏—Ç–∞—î—Ç–µ –≤—Å—é –∫–Ω–∏–≥—É –∑–∞ —Ä–∞–∑. –í–∏ —á–∏—Ç–∞—î—Ç–µ –†–æ–∑–¥—ñ–ª 1 (15 —Å—Ç–æ—Ä—ñ–Ω–æ–∫), –ø–æ—Ç—ñ–º –†–æ–∑–¥—ñ–ª 2 (14 —Å—Ç–æ—Ä—ñ–Ω–æ–∫), —ñ —Ç–∞–∫ –¥–∞–ª—ñ.

–ö–æ–∂–Ω–∏–π —Ä–æ–∑–¥—ñ–ª ‚Äî —Ü–µ **Segment** (—Ñ—Ä–∞–≥–º–µ–Ω—Ç –≤—ñ–¥–µ–æ).

::

::tip
**–ö–ª—é—á–æ–≤–∞ —ñ–¥–µ—è**: –í–∏ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç–µ –≤–µ—Å—å —Ñ—ñ–ª—å–º (2 GB) –æ–¥—Ä–∞–∑—É. –í–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç–µ –º–∞–ª–µ–Ω—å–∫—ñ —à–º–∞—Ç–∫–∏ –ø–æ 2-5 MB (10 —Å–µ–∫—É–Ω–¥ –≤—ñ–¥–µ–æ) —ñ –ø–æ—á–∏–Ω–∞—î—Ç–µ –¥–∏–≤–∏—Ç–∏—Å—å, –ø–æ–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –Ω–∞—Å—Ç—É–ø–Ω—ñ.
::

### –ê–Ω–∞–ª–æ–≥—ñ—è 2: –†–µ—Å—Ç–æ—Ä–∞–Ω –∑ –º–µ–Ω—é

::card-group

::card{title="üìã –ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é" icon="i-lucide-book-open"}
**Master Playlist**

–í–∏ –∑–∞—Ö–æ–¥–∏—Ç–µ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω —ñ –æ—Ç—Ä–∏–º—É—î—Ç–µ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é:

```
–ú–µ–Ω—é:
- –ê–Ω–≥–ª—ñ–π—Å—å–∫–æ—é (—Å—Ç–æ—Ä—ñ–Ω–∫–∞ 2)
- –§—Ä–∞–Ω—Ü—É–∑—å–∫–æ—é (—Å—Ç–æ—Ä—ñ–Ω–∫–∞ 10)
- –ö–∏—Ç–∞–π—Å—å–∫–æ—é (—Å—Ç–æ—Ä—ñ–Ω–∫–∞ 20)
```

::

::card{title="üçï –†–æ–∑–¥—ñ–ª \"–ü—ñ—Ü–∞\"" icon="i-lucide-pizza"}
**Media Playlist**

–í–∏ –æ–±–∏—Ä–∞—î—Ç–µ –∞–Ω–≥–ª—ñ–π—Å—å–∫—É –≤–µ—Ä—Å—ñ—é —ñ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç–µ —Ä–æ–∑–¥—ñ–ª "–ü—ñ—Ü–∞":

```
–ü—ñ—Ü–∞:
1. –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞
2. –ü–µ–ø–µ—Ä–æ–Ω—ñ
3. –ß–æ—Ç–∏—Ä–∏ —Å–∏—Ä–∏
```

::

::card{title="üçΩÔ∏è –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —Å—Ç—Ä–∞–≤–∞" icon="i-lucide-utensils"}
**Segment**

–í–∏ –æ–±–∏—Ä–∞—î—Ç–µ "–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞" —ñ –æ—Ç—Ä–∏–º—É—î—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –ø–æ—Ä—Ü—ñ—é —ó–∂—ñ. –¶–µ —ñ —î —Å–µ–≥–º–µ–Ω—Ç ‚Äî —Ç–µ, —â–æ –≤–∏ —Ä–µ–∞–ª—å–Ω–æ "—Å–ø–æ–∂–∏–≤–∞—î—Ç–µ".

::

::

---

## 3. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –ú–µ—Ö–∞–Ω—ñ–∫–∞

### 3.1. –ê–Ω–∞—Ç–æ–º—ñ—è Master Playlist

Master Playlist ‚Äî —Ü–µ —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª UTF-8 –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º `.m3u8`. –§–æ—Ä–º–∞—Ç –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ M3U (MP3 URL), –∞–ª–µ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ —Ç–µ–≥–∞–º–∏ –¥–ª—è HLS.

#### –ü—Ä–∏–∫–ª–∞–¥ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ Master Playlist:

```m3u8
#EXTM3U
#EXT-X-VERSION:3

#EXT-X-STREAM-INF:BANDWIDTH=800000,RESOLUTION=640x360
360p/playlist.m3u8

#EXT-X-STREAM-INF:BANDWIDTH=1400000,RESOLUTION=1280x720
720p/playlist.m3u8

#EXT-X-STREAM-INF:BANDWIDTH=5000000,RESOLUTION=1920x1080
1080p/playlist.m3u8
```

#### –†–æ–∑–±—ñ—Ä –∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞:

::field-group

::field{name="#EXTM3U" type="–û–±–æ–≤'—è–∑–∫–æ–≤–∏–π —Ç–µ–≥" required="true"}
–ü–µ—Ä—à–∏–π —Ä—è–¥–æ–∫ **–±—É–¥—å-—è–∫–æ–≥–æ** HLS playlist. –ö–∞–∂–µ –ø–∞—Ä—Å–µ—Ä—É: "–¶–µ M3U8 —Ñ–∞–π–ª, –∞ –Ω–µ –∑–≤–∏—á–∞–π–Ω–∏–π —Ç–µ–∫—Å—Ç".

::

::field{name="#EXT-X-VERSION" type="Integer"}
–í–µ—Ä—Å—ñ—è –ø—Ä–æ—Ç–æ–∫–æ–ª—É HLS. –ú–æ–∂–ª–∏–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è: 1-7.

**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ:** –≤–µ—Ä—Å—ñ—è 3 (–ø—ñ–¥—Ç—Ä–∏–º–∫–∞ floating-point —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ —Å–µ–≥–º–µ–Ω—Ç—ñ–≤) –∞–±–æ –≤–∏—â–µ.

::

::field{name="#EXT-X-STREAM-INF" type="–û–±–æ–≤'—è–∑–∫–æ–≤–∏–π –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤"}
–û–ø–∏—Å—É—î –æ–¥–∏–Ω –≤–∞—Ä—ñ–∞–Ω—Ç –ø–æ—Ç–æ–∫—É. –ê—Ç—Ä–∏–±—É—Ç–∏:

- **BANDWIDTH** (–æ–±–æ–≤'—è–∑–∫–æ–≤–æ): –ü—ñ–∫–æ–≤–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å —É –±—ñ—Ç–∞—Ö/—Å–µ–∫ (800000 = 800 Kbps)
- **RESOLUTION**: –†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –≤—ñ–¥–µ–æ (—à–∏—Ä–∏–Ω–∞√ó–≤–∏—Å–æ—Ç–∞)
- **CODECS**: –ö–æ–¥–µ–∫–∏ –∞—É–¥—ñ–æ —ñ –≤—ñ–¥–µ–æ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, –∞–ª–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
- **FRAME-RATE**: –ß–∞—Å—Ç–æ—Ç–∞ –∫–∞–¥—Ä—ñ–≤ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ —Ç–µ–≥—É ‚Äî URL Media Playlist.

::

::

#### –ü—Ä–∏–∫–ª–∞–¥ —Ä–æ–∑—à–∏—Ä–µ–Ω–æ–≥–æ Master Playlist:

::code-collapse{title="–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤–Ω–∏–π Master Playlist –∑ —É—Å—ñ–º–∞ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏"}

```m3u8
#EXTM3U
#EXT-X-VERSION:6

# –í–∞—Ä—ñ–∞–Ω—Ç 1: 1080p 60fps (High Quality)
#EXT-X-STREAM-INF:BANDWIDTH=7800000,AVERAGE-BANDWIDTH=7200000,RESOLUTION=1920x1080,FRAME-RATE=60.000,CODECS="avc1.640028,mp4a.40.2",AUDIO="audio-high"
1080p60/playlist.m3u8

# –í–∞—Ä—ñ–∞–Ω—Ç 2: 1080p 30fps (Standard)
#EXT-X-STREAM-INF:BANDWIDTH=5000000,AVERAGE-BANDWIDTH=4500000,RESOLUTION=1920x1080,FRAME-RATE=30.000,CODECS="avc1.64001f,mp4a.40.2",AUDIO="audio-high"
1080p30/playlist.m3u8

# –í–∞—Ä—ñ–∞–Ω—Ç 3: 720p (Medium Quality)
#EXT-X-STREAM-INF:BANDWIDTH=2800000,AVERAGE-BANDWIDTH=2500000,RESOLUTION=1280x720,FRAME-RATE=30.000,CODECS="avc1.64001f,mp4a.40.2",AUDIO="audio-medium"
720p/playlist.m3u8

# –í–∞—Ä—ñ–∞–Ω—Ç 4: 480p (Low Quality)
#EXT-X-STREAM-INF:BANDWIDTH=1400000,AVERAGE-BANDWIDTH=1200000,RESOLUTION=854x480,FRAME-RATE=30.000,CODECS="avc1.64001e,mp4a.40.2",AUDIO="audio-low"
480p/playlist.m3u8

# –í–∞—Ä—ñ–∞–Ω—Ç 5: 360p (Mobile)
#EXT-X-STREAM-INF:BANDWIDTH=800000,AVERAGE-BANDWIDTH=700000,RESOLUTION=640x360,FRAME-RATE=30.000,CODECS="avc1.64001e,mp4a.40.2",AUDIO="audio-low"
360p/playlist.m3u8

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ –∞—É–¥—ñ–æ-—Ç—Ä–µ–∫–∏
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-high",NAME="English",LANGUAGE="en",AUTOSELECT=YES,DEFAULT=YES,URI="audio/en/playlist.m3u8"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-high",NAME="Ukrainian",LANGUAGE="uk",AUTOSELECT=NO,DEFAULT=NO,URI="audio/uk/playlist.m3u8"
```

::

::warning
**–í–∞–∂–ª–∏–≤–æ**: `BANDWIDTH` ‚Äî —Ü–µ **–ø—ñ–∫–æ–≤–∞** —à–≤–∏–¥–∫—ñ—Å—Ç—å (–º–∞–∫—Å–∏–º—É–º). `AVERAGE-BANDWIDTH` ‚Äî —Ü–µ —Å–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å. –ü–ª–µ—î—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è –≤–∏–±–æ—Ä—É —è–∫–æ—Å—Ç—ñ.

**–ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥:**

- –£ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å 6 Mbps
- –ü–ª–µ—î—Ä **–ù–ï** –æ–±–µ—Ä–µ –≤–∞—Ä—ñ–∞–Ω—Ç 1080p60 (7.8 Mbps), –±–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∑–∞–ø–∞—Å—É
- –ü–ª–µ—î—Ä –æ–±–µ—Ä–µ 1080p30 (5 Mbps) ‚Äî —î –∑–∞–ø–∞—Å 1 Mbps –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ

::

### 3.2. –ê–Ω–∞—Ç–æ–º—ñ—è Media Playlist

Media Playlist –º—ñ—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è.

#### –ü—Ä–∏–∫–ª–∞–¥ Media Playlist (VOD):

```m3u8
#EXTM3U
#EXT-X-VERSION:3
#EXT-X-TARGETDURATION:10
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD

#EXTINF:9.009,
segment_00001.ts
#EXTINF:9.009,
segment_00002.ts
#EXTINF:9.009,
segment_00003.ts
#EXTINF:9.009,
segment_00004.ts
#EXTINF:9.009,
segment_00005.ts

#EXT-X-ENDLIST
```

#### –†–æ–∑–±—ñ—Ä —Ç–µ–≥—ñ–≤:

::field-group

::field{name="#EXT-X-TARGETDURATION" type="Integer" required="true"}
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç–∞ (—É —Å–µ–∫—É–Ω–¥–∞—Ö). –ñ–æ–¥–µ–Ω —Å–µ–≥–º–µ–Ω—Ç –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –¥–æ–≤—à–∏–º –∑–∞ —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è.

**–ü—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è**: –ü–ª–µ—î—Ä –∑–Ω–∞—î, —Å–∫—ñ–ª—å–∫–∏ –±—É—Ñ–µ—Ä—É —Ç—Ä–∏–º–∞—Ç–∏. –Ø–∫—â–æ `TARGETDURATION=10`, –ø–ª–µ—î—Ä –±—É—Ñ–µ—Ä—É—î –º—ñ–Ω—ñ–º—É–º 30 —Å–µ–∫—É–Ω–¥ (3 —Å–µ–≥–º–µ–Ω—Ç–∏).

::

::field{name="#EXT-X-MEDIA-SEQUENCE" type="Integer"}
–ü–æ—Ä—è–¥–∫–æ–≤–∏–π –Ω–æ–º–µ—Ä –ø–µ—Ä—à–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ –ø–ª–µ–π–ª—ñ—Å—Ç—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è Live —Å—Ç—Ä—ñ–º—ñ–≤.

**–ü—Ä–∏–∫–ª–∞–¥ (Live):**

```m3u8
#EXT-X-MEDIA-SEQUENCE:1523  ‚Üê –ø–µ—Ä—à–∏–π —Å–µ–≥–º–µ–Ω—Ç –º–∞—î –Ω–æ–º–µ—Ä 1523
segment_01523.ts
segment_01524.ts
segment_01525.ts
```

::

::field{name="#EXT-X-PLAYLIST-TYPE" type="Enum"}
–¢–∏–ø –ø–ª–µ–π–ª—ñ—Å—Ç–∞. –ú–æ–∂–ª–∏–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è:

- **VOD** ‚Äî —Å—Ç–∞—Ç–∏—á–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç (–∫—ñ–Ω–µ—Ü—å —Ñ–∞–π–ª—É –ø–æ–∑–Ω–∞—á–µ–Ω–∏–π `#EXT-X-ENDLIST`)
- **EVENT** ‚Äî live –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –ø–µ—Ä–µ–º–æ—Ç—É–≤–∞–Ω–Ω—è (DVR)

–Ø–∫—â–æ —Ç–µ–≥ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π ‚Äî —Ü–µ **live** —Å—Ç—Ä—ñ–º –±–µ–∑ DVR.

::

::field{name="#EXTINF" type="Float,String"}
–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ (—É —Å–µ–∫—É–Ω–¥–∞—Ö). –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: –æ–ø–∏—Å –ø—ñ—Å–ª—è –∫–æ–º–∏.

- **–§–æ—Ä–º–∞—Ç:** `#EXTINF:<duration>,[description]`

**–ü—Ä–∏–∫–ª–∞–¥:**

```m3u8
#EXTINF:10.500,This is chapter 1
segment_001.ts
```

::

::field{name="#EXT-X-ENDLIST" type="Flag"}
–ü–æ–∑–Ω–∞—á–∞—î –∫—ñ–Ω–µ—Ü—å VOD-–≤—ñ–¥–µ–æ. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ —Ç–µ–≥–∞ —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –Ω–µ–º–∞—î. –ü–ª–µ—î—Ä –∑—É–ø–∏–Ω—è—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–ª–µ–π–ª—ñ—Å—Ç–∞.

- **–Ø–∫—â–æ —Ç–µ–≥ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π** ‚Üí —Ü–µ live —Å—Ç—Ä—ñ–º, –ø–ª–µ—î—Ä –ø—Ä–æ–¥–æ–≤–∂—É—î –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ø–ª–µ–π–ª—ñ—Å—Ç –∫–æ–∂–Ω—ñ `TARGETDURATION/2` —Å–µ–∫—É–Ω–¥.

::

::

#### –ü—Ä–∏–∫–ª–∞–¥ Media Playlist (Live):

```m3u8
#EXTM3U
#EXT-X-VERSION:3
#EXT-X-TARGETDURATION:6
#EXT-X-MEDIA-SEQUENCE:4521

#EXTINF:6.000,
segment_04521.ts
#EXTINF:6.000,
segment_04522.ts
#EXTINF:6.000,
segment_04523.ts
#EXTINF:6.000,
segment_04524.ts
#EXTINF:6.000,
segment_04525.ts
```

::note
**–ü—Ä–∏–º—ñ—Ç–∫–∞**: Live –ø–ª–µ–π–ª—ñ—Å—Ç **–ù–ï –º–∞—î** —Ç–µ–≥–∞ `#EXT-X-ENDLIST`. –ü–ª–µ—î—Ä –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î —Ü–µ–π —Ñ–∞–π–ª (–∫–æ–∂–Ω—ñ 3 —Å–µ–∫—É–Ω–¥–∏, —è–∫—â–æ `TARGETDURATION=6`), —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–æ–≤—ñ —Å–µ–≥–º–µ–Ω—Ç–∏.
::

### 3.3. –§–æ—Ä–º–∞—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç—ñ–≤: MPEG-TS vs fMP4

::tabs

::tabs-item{label="MPEG-TS (.ts)" icon="i-lucide-file-video"}

**MPEG-2 Transport Stream** ‚Äî –∫–ª–∞—Å–∏—á–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è HLS.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ TS Packet   ‚îÇ TS Packet   ‚îÇ TS Packet   ‚îÇ TS Packet   ‚îÇ
‚îÇ (188 bytes) ‚îÇ (188 bytes) ‚îÇ (188 bytes) ‚îÇ (188 bytes) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ö–æ–∂–µ–Ω –ø–∞–∫–µ—Ç:

- **Header (4 bytes)**: Sync byte (0x47), PID (—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –ø–æ—Ç–æ–∫—É), counters
- **Payload (184 bytes)**: –ê—É–¥—ñ–æ, –≤—ñ–¥–µ–æ –∞–±–æ –º–µ—Ç–∞–¥–∞–Ω—ñ

**–ü–µ—Ä–µ–≤–∞–≥–∏:**

- ‚úÖ –î—É–∂–µ –ø—Ä–æ—Å—Ç–∏–π —Ñ–æ—Ä–º–∞—Ç
- ‚úÖ –ú–æ–∂–Ω–∞ —Å–∫–ª–µ—ó—Ç–∏ —Ñ–∞–π–ª–∏ –∫–æ–º–∞–Ω–¥–æ—é `cat seg1.ts seg2.ts > full.ts`
- ‚úÖ –ü—Ä–∞—Ü—é—î –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —á–∞—Å—Ç–∏–Ω–∞ —Ñ–∞–π–ª—É –ø–æ—à–∫–æ–¥–∂–µ–Ω–∞ (error resilience)

**–ù–µ–¥–æ–ª—ñ–∫–∏:**

- ‚ùå –ë–∞–≥–∞—Ç–æ overhead (–∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–π–º–∞—é—Ç—å ~10-15% —Ä–æ–∑–º—ñ—Ä—É)
- ‚ùå –ù–µ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è DASH (–ø–æ—Ç—Ä—ñ–±–µ–Ω –æ–∫—Ä–µ–º–∏–π –Ω–∞–±—ñ—Ä —Å–µ–≥–º–µ–Ω—Ç—ñ–≤)

::

::tabs-item{label="fMP4 (.m4s, .mp4)" icon="i-lucide-box"}

**Fragmented MP4** ‚Äî —Å—É—á–∞—Å–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∑–∞—Å–Ω–æ–≤–∞–Ω–∏–π –Ω–∞ ISO Base Media File Format.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```
init.mp4 (Header: –∫–æ–¥–µ–∫–∏, —Ä–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å, sample rate)
   ‚Üì
segment_001.m4s (—Ç—ñ–ª—å–∫–∏ –≤—ñ–¥–µ–æ/–∞—É–¥—ñ–æ –¥–∞–Ω—ñ)
segment_002.m4s
segment_003.m4s
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**

- ‚úÖ –ë—ñ–ª—å—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π (–º–µ–Ω—à–µ overhead, –µ–∫–æ–Ω–æ–º—ñ—è 10-15% —Ä–æ–∑–º—ñ—Ä—É)
- ‚úÖ **CMAF-—Å—É–º—ñ—Å–Ω–∏–π**: –æ–¥–∏–Ω —ñ —Ç–æ–π –∂–µ —Å–µ–≥–º–µ–Ω—Ç –¥–ª—è HLS —ñ DASH (–µ–∫–æ–Ω–æ–º—ñ—è –º—ñ—Å—Ü—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –≤ 2 —Ä–∞–∑–∏!)
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å—É—á–∞—Å–Ω–∏—Ö –∫–æ–¥–µ–∫—ñ–≤ (AV1, HEVC) –∫—Ä–∞—â–∞

**–ù–µ–¥–æ–ª—ñ–∫–∏:**

- ‚ùå –ü–æ—Ç—Ä—ñ–±–µ–Ω `init.mp4` (–ø–ª–µ—î—Ä —Å–ø–µ—Ä—à—É –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î header, –ø–æ—Ç—ñ–º —Å–µ–≥–º–µ–Ω—Ç–∏)
- ‚ùå –°–∫–ª–∞–¥–Ω—ñ—à–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–Ω–µ –º–æ–∂–Ω–∞ –ø—Ä–æ—Å—Ç–æ —Å–∫–ª–µ—ó—Ç–∏ —Ñ–∞–π–ª–∏)

::

::

::tip
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è 2024+**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ **fMP4 (CMAF)**. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –º–∞—Ç–∏ –æ–¥–∏–Ω –Ω–∞–±—ñ—Ä —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –¥–ª—è HLS (Apple) —ñ DASH (Android). Google —Ä–µ–∫–æ–º–µ–Ω–¥—É—î CMAF –¥–ª—è YouTube.

- **–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏:**

```bash
ffmpeg -i input.mp4 \
  -c:v libx264 -c:a aac \
  -f hls -hls_segment_type fmp4 \
  -hls_playlist_type vod \
  output.m3u8
```

::

### 3.4. –Ø–∫ –ø—Ä–∞—Ü—é—î HLS –ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º

::plant-uml

```plantuml
@startuml
skinparam style plain
skinparam defaultFontName Arial

actor User
participant "üì± Player" as Player
participant "üåê CDN" as CDN
database "üíæ Origin" as Origin

User -> Player: –ù–∞—Ç–∏—Å–∫–∞—î Play
activate Player

Player -> CDN: GET /master.m3u8
activate CDN
CDN -> Origin: Cache miss?
activate Origin
Origin --> CDN: master.m3u8
deactivate Origin
CDN --> Player: master.m3u8
deactivate CDN

Player -> Player: –ü–∞—Ä—Å–∏–Ω–≥ master.m3u8\n–û–±–∏—Ä–∞—î 720p –≤–∞—Ä—ñ–∞–Ω—Ç

Player -> CDN: GET /720p/playlist.m3u8
activate CDN
CDN --> Player: playlist.m3u8\n(—Å–ø–∏—Å–æ–∫ —Å–µ–≥–º–µ–Ω—Ç—ñ–≤)
deactivate CDN

Player -> Player: –ü–∞—Ä—Å–∏–Ω–≥ playlist\n–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—è 3 —Å–µ–≥–º–µ–Ω—Ç—ñ–≤

loop –ö–æ–∂–Ω—ñ 6 —Å–µ–∫—É–Ω–¥
    Player -> CDN: GET /720p/segment_001.ts
    activate CDN
    CDN --> Player: segment_001.ts (2 MB)
    deactivate CDN

    Player -> Player: –î–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è H.264\n–í—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–µ–æ

    Player -> Player: Bandwidth Detection:\n–®–≤–∏–¥–∫—ñ—Å—Ç—å = 3 Mbps
    Player -> Player: –Ø–∫—ñ—Å—Ç—å 720p OK (2.5 Mbps)
end

note over Player
  –ü—ñ—Å–ª—è –∫–æ–∂–Ω–∏—Ö 3-5 —Å–µ–≥–º–µ–Ω—Ç—ñ–≤:
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —à–≤–∏–¥–∫–æ—Å—Ç—ñ ‚Üí
  –ú–æ–∂–ª–∏–≤–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ
end note

User -> Player: –ú–µ—Ä–µ–∂–∞ –ø–æ–≥—ñ—Ä—à–∏–ª–∞—Å—å
Player -> Player: Bandwidth: 1 Mbps üìâ
Player -> Player: –ü–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è –Ω–∞ 480p

Player -> CDN: GET /480p/playlist.m3u8
activate CDN
CDN --> Player: playlist.m3u8
deactivate CDN

Player -> CDN: GET /480p/segment_015.ts
activate CDN
CDN --> Player: segment (–º–µ–Ω—å—à–∏–π —Ä–æ–∑–º—ñ—Ä)
deactivate CDN

Player -> Player: –ë–µ–∑—à–æ–≤–Ω–µ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è\n–Ø–∫—ñ—Å—Ç—å –∑–Ω–∏–∑–∏–ª–∞—Å—å, –∞–ª–µ –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω–Ω—è

@enduml
```

::

**–ü–æ—è—Å–Ω–µ–Ω–Ω—è –∫—Ä–æ–∫—ñ–≤:**

::steps

### 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Master Playlist

–ü–ª–µ—î—Ä –∑–∞–≤–∂–¥–∏ –ø–æ—á–∏–Ω–∞—î –∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è `master.m3u8`. –Ø–∫—â–æ —Ñ–∞–π–ª –∑–∞–∫–µ—à–æ–≤–∞–Ω–∏–π –Ω–∞ CDN ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∑–∞ 50-100 –º—Å.

### 2. –í–∏–±—ñ—Ä –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —è–∫–æ—Å—Ç—ñ

–ü–ª–µ—î—Ä **–Ω–µ –∑–Ω–∞—î** —à–≤–∏–¥–∫–æ—Å—Ç—ñ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É –Ω–∞ —Å—Ç–∞—Ä—Ç—ñ. –¢–æ–º—É –æ–±–∏—Ä–∞—î **—Å–µ—Ä–µ–¥–Ω—é** —è–∫—ñ—Å—Ç—å (–∑–∞–∑–≤–∏—á–∞–π 720p –∞–±–æ 480p). –ê–≥—Ä–µ—Å–∏–≤–Ω—ñ –ø–ª–µ—î—Ä–∏ (YouTube) –ø–æ—á–∏–Ω–∞—é—Ç—å –∑ –Ω–∞–π–≤–∏—â–æ—ó —è–∫–æ—Å—Ç—ñ.

### 3. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Media Playlist

–û–±—Ä–∞–≤—à–∏ —è–∫—ñ—Å—Ç—å (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 720p), –ø–ª–µ—î—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î `/720p/playlist.m3u8` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Å–µ–≥–º–µ–Ω—Ç—ñ–≤.

### 4. –ü–æ—á–∞—Ç–∫–æ–≤–∞ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—è

–ü–ª–µ—î—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î **3-5 —Å–µ–≥–º–µ–Ω—Ç—ñ–≤** (30-50 —Å–µ–∫—É–Ω–¥ –≤—ñ–¥–µ–æ) –≤ –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è. –¶–µ –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –º—ñ–∫—Ä–æ-–∑–∞–≤–∏—Å–∞–Ω—å.

### 5. –ü–∞—Ä–∞–ª–µ–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è

–ü–æ–∫–∏ –ø—Ä–æ–≥—Ä–∞—î –ø–µ—Ä—à–∏–π —Å–µ–≥–º–µ–Ω—Ç, –ø–ª–µ—î—Ä **–≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î** 4-–π, 5-–π —Å–µ–≥–º–µ–Ω—Ç–∏. –¶–µ –∫–æ–Ω–≤–µ—î—Ä (pipelining).

### 6. –í–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ (Bandwidth Detection)

–ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ –ø–ª–µ—î—Ä –≤–∏–º—ñ—Ä—é—î:

```
–®–≤–∏–¥–∫—ñ—Å—Ç—å = (–†–æ–∑–º—ñ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ –±—ñ—Ç–∞—Ö) / (–ß–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)
```

**–ü—Ä–∏–∫–ª–∞–¥:**

- –°–µ–≥–º–µ–Ω—Ç: 2 MB = 16 –ú–±—ñ—Ç
- –ß–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: 4 —Å–µ–∫—É–Ω–¥–∏
- –®–≤–∏–¥–∫—ñ—Å—Ç—å: 16 / 4 = **4 Mbps**

### 7. –†—ñ—à–µ–Ω–Ω—è –ø—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è

–ö–æ–∂–Ω—ñ 3-5 —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –ø–ª–µ—î—Ä –∞–Ω–∞–ª—ñ–∑—É—î:

```
–Ø–∫—â–æ (–°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å > –ü–æ—Ç–æ—á–Ω–∏–π bitrate √ó 1.2):
    –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏—â—É —è–∫—ñ—Å—Ç—å
–Ø–∫—â–æ (–°–µ—Ä–µ–¥–Ω—è —à–≤–∏–¥–∫—ñ—Å—Ç—å < –ü–æ—Ç–æ—á–Ω–∏–π bitrate √ó 0.8):
    –¢–ï–†–ú–Ü–ù–û–í–û –∑–Ω–∏–∑–∏—Ç–∏ —è–∫—ñ—Å—Ç—å
```

### 8. Seamless Switch (–±–µ–∑—à–æ–≤–Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è)

–ü–ª–µ—î—Ä **–ù–ï** –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è. –í—ñ–Ω –ø—Ä–æ—Å—Ç–æ:

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î playlist –Ω–æ–≤–æ—ó —è–∫–æ—Å—Ç—ñ (`/480p/playlist.m3u8`)
2. –ó–Ω–∞—Ö–æ–¥–∏—Ç—å —Å–µ–≥–º–µ–Ω—Ç –∑ —Ç–∞–∫–æ—é —Å–∞–º–æ—é **—á–∞—Å–æ–≤–æ—é –º—ñ—Ç–∫–æ—é** (timestamp)
3. –ü—Ä–æ–¥–æ–≤–∂—É—î –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ –Ω–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫—É

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –∑–º—ñ–Ω—É —è–∫–æ—Å—Ç—ñ, –∞–ª–µ **–±–µ–∑ –ø–∞—É–∑–∏**.

::

---

## 3.5. Adaptive Bitrate (ABR): –°–µ—Ä—Ü–µ HLS

**ABR** ‚Äî —Ü–µ –∞–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É —è–∫–æ—Å—Ç—ñ. –ë–µ–∑ –Ω—å–æ–≥–æ HLS –±—É–≤ –±–∏ –∑–≤–∏—á–∞–π–Ω–∏–º –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –≤—ñ–¥–µ–æ.

### –Ø–∫ –ø—Ä–∞—Ü—é—î ABR

::mermaid

```mermaid
graph TD
    A["üé¨ –ü–æ—á–∞—Ç–æ–∫ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è"] --> B["üìä –û–±—Ä–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—É —è–∫—ñ—Å—Ç—å<br/>(Medium, 720p)"]
    B --> C["üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç"]
    C --> D["‚è±Ô∏è –í–∏–º—ñ—Ä—è—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å<br/>Speed = Size / Time"]
    D --> E{"ü§î –®–≤–∏–¥–∫—ñ—Å—Ç—å<br/>–¥–æ—Å—Ç–∞—Ç–Ω—è?"}

    E -->|"–®–≤–∏–¥–∫—ñ—Å—Ç—å > 120% bitrate"| F["‚¨ÜÔ∏è –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏—â—É —è–∫—ñ—Å—Ç—å"]
    E -->|"–®–≤–∏–¥–∫—ñ—Å—Ç—å OK"| G["‚úÖ –ó–∞–ª–∏—à–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—É —è–∫—ñ—Å—Ç—å"]
    E -->|"–®–≤–∏–¥–∫—ñ—Å—Ç—å < 80% bitrate"| H["‚¨áÔ∏è –¢–ï–†–ú–Ü–ù–û–í–û –∑–Ω–∏–∑–∏—Ç–∏ —è–∫—ñ—Å—Ç—å"]

    F --> C
    G --> C
    H --> C

    E -->|"–ë—É—Ñ–µ—Ä –ø–æ—Ä–æ–∂–Ω—ñ–π!"| I["üö® PANIC: –ù–∞–π–Ω–∏–∂—á–∞ —è–∫—ñ—Å—Ç—å"]
    I --> C

    style A fill:#3b82f6,stroke:#1d4ed8,color:#ffffff
    style E fill:#f59e0b,stroke:#b45309,color:#ffffff
    style F fill:#10b981,stroke:#047857,color:#ffffff
    style H fill:#ef4444,stroke:#dc2626,color:#ffffff
    style I fill:#dc2626,stroke:#991b1b,color:#ffffff
```

::

### –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—å–Ω–æ–≥–æ ABR-–∞–ª–≥–æ—Ä–∏—Ç–º—É (—Å–ø—Ä–æ—â–µ–Ω–∏–π)

```javascript
// –¶–µ –ø—Å–µ–≤–¥–æ–∫–æ–¥, —â–æ –ø–æ–∫–∞–∑—É—î –ª–æ–≥—ñ–∫—É hls.js
class ABRController {
    constructor() {
        this.bandwidthHistory = [] // –Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å —à–≤–∏–¥–∫–æ—Å—Ç—ñ
        this.currentLevel = 2 // –ü–æ—Ç–æ—á–Ω–∞ —è–∫—ñ—Å—Ç—å (0=lowest, 4=highest)
    }

    // –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
    onSegmentLoaded(segmentSize, downloadTime) {
        // 1. –í–∏–º—ñ—Ä—è—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å
        const bandwidth = (segmentSize * 8) / downloadTime // –±—ñ—Ç–∏/—Å–µ–∫
        this.bandwidthHistory.push(bandwidth)

        // –¢—Ä–∏–º–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—ñ 5 –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å
        if (this.bandwidthHistory.length > 5) {
            this.bandwidthHistory.shift()
        }

        // 2. –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —Å–µ—Ä–µ–¥–Ω—é —à–≤–∏–¥–∫—ñ—Å—Ç—å (Exponential Moving Average)
        const avgBandwidth = this.calculateEMA()

        // 3. –î–æ—Å—Ç—É–ø–Ω—ñ —è–∫–æ—Å—Ç—ñ (bitrate'–∏ –≤ –±—ñ—Ç–∞—Ö/—Å–µ–∫)
        const levels = [
            { bitrate: 500000, name: '360p' }, // 0
            { bitrate: 1000000, name: '480p' }, // 1
            { bitrate: 2500000, name: '720p' }, // 2
            { bitrate: 5000000, name: '1080p' }, // 3
            { bitrate: 8000000, name: '1080p60' }, // 4
        ]

        // 4. –ó–Ω–∞–π—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É —è–∫—ñ—Å—Ç—å –∑ –∑–∞–ø–∞—Å–æ–º 20%
        const targetBandwidth = avgBandwidth * 0.8 // –ó–∞–ø–∞—Å 20%
        let newLevel = 0

        for (let i = levels.length - 1; i >= 0; i--) {
            if (levels[i].bitrate <= targetBandwidth) {
                newLevel = i
                break
            }
        }

        // 5. –ê–Ω—Ç–∏—Ñ–ª—ñ–∫–µ—Ä: –Ω–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —è–∫—ñ—Å—Ç—å –∑–∞–Ω–∞–¥—Ç–æ —á–∞—Å—Ç–æ
        if (Math.abs(newLevel - this.currentLevel) === 1) {
            // –Ø–∫—â–æ —Ä—ñ–∑–Ω–∏—Ü—è —Ç—ñ–ª—å–∫–∏ 1 —Ä—ñ–≤–µ–Ω—å ‚Äî —á–µ–∫–∞—î–º–æ —â–µ 2 —Å–µ–≥–º–µ–Ω—Ç–∏
            return
        }

        // 6. –ù–µ–≥–∞–π–Ω–µ –∑–Ω–∏–∂–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
        const bufferLength = this.getBufferLength()
        if (bufferLength < 10) {
            // –ú–µ–Ω—à–µ 10 —Å–µ–∫—É–Ω–¥ —É –±—É—Ñ–µ—Ä—ñ
            console.warn('‚ö†Ô∏è Low buffer! Switching to lower quality')
            newLevel = Math.max(0, this.currentLevel - 2)
        }

        // 7. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è
        if (newLevel !== this.currentLevel) {
            console.log(`üìä Quality switch: ${levels[this.currentLevel].name} ‚Üí ${levels[newLevel].name}`)
            this.currentLevel = newLevel
            this.switchToLevel(newLevel)
        }
    }

    calculateEMA() {
        // Exponential Moving Average: –Ω–æ–≤—ñ—à—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∞–∂–∞—Ç—å –±—ñ–ª—å—à–µ
        let ema = this.bandwidthHistory[0]
        const alpha = 0.3 // Sensitivity factor

        for (let i = 1; i < this.bandwidthHistory.length; i++) {
            ema = alpha * this.bandwidthHistory[i] + (1 - alpha) * ema
        }

        return ema
    }
}
```

### 6.2. Performance Optimization (–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è)

::card-group

::card{title="üöÄ Preloading" icon="i-lucide-zap"}

–ë—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–µ—Ä—à—ñ —Å–µ–≥–º–µ–Ω—Ç–∏ **–î–û** —Ç–æ–≥–æ, —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–Ω–µ Play.

```html
<link rel="preload" as="fetch" href="https://cdn.example.com/master.m3u8" crossorigin />
<link rel="preload" as="fetch" href="https://cdn.example.com/720p/segment_000.ts" crossorigin />
```

–ï–∫–æ–Ω–æ–º—ñ—è: 500-800ms —à–≤–∏–¥—à–µ —Å—Ç–∞—Ä—Ç –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è.

::

::card{title="üì¶ Segment Size Tuning" icon="i-lucide-package"}

**–ü—Ä–∞–≤–∏–ª–æ:** –†–æ–∑–º—ñ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ = Bitrate √ó Duration

**–ü—Ä–∏–∫–ª–∞–¥:**

- Bitrate: 2.5 Mbps = 2,500,000 bits/sec
- Duration: 6 —Å–µ–∫—É–Ω–¥
- –†–æ–∑–º—ñ—Ä: 2,500,000 √ó 6 √∑ 8 = **1.875 MB**

**–û–ø—Ç–∏–º–∞–ª—å–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è:**

- Mobile (3G/4G): 1-2 MB (4-6 —Å–µ–∫ –ø–æ 2 Mbps)
- Desktop (Wi-Fi): 3-5 MB (6-10 —Å–µ–∫ –ø–æ 5 Mbps)

::

::card{title="üåê CDN Caching Headers" icon="i-lucide-server"}

–ü—Ä–∞–≤–∏–ª—å–Ω—ñ Cache-Control headers –µ–∫–æ–Ω–æ–º–ª—è—Ç—å bandwidth:

```nginx
# Master Playlist: –∫–æ—Ä–æ—Ç–∫–∏–π TTL (–¥–ª—è Live)
location ~ master\.m3u8$ {
    add_header Cache-Control "public, max-age=5, stale-while-revalidate=10";
}

# Media Playlist: —Å–µ—Ä–µ–¥–Ω—ñ–π TTL
location ~ \.m3u8$ {
    add_header Cache-Control "public, max-age=10, stale-while-revalidate=30";
}

# Segments: –¥–æ–≤–≥–∏–π TTL (immutable)
location ~ \.(ts|m4s)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
}
```

::

::card{title="‚ö° HTTP/2 Server Push" icon="i-lucide-trending-up"}

–°–µ—Ä–≤–µ—Ä –º–æ–∂–µ "–ø—Ä–æ—à—Ç–æ–≤—Ö–Ω—É—Ç–∏" —Å–µ–≥–º–µ–Ω—Ç–∏ —Ä–∞–∑–æ–º –∑ –ø–ª–µ–π–ª—ñ—Å—Ç–æ–º:

```nginx
http2_push /720p/segment_000.ts;
http2_push /720p/segment_001.ts;
```

–ï–∫–æ–Ω–æ–º—ñ—è: 1 RTT (Round Trip Time) –Ω–∞ –∫–æ–∂–µ–Ω —Å–µ–≥–º–µ–Ω—Ç.

::

::

### 6.3. Low Latency HLS (LL-HLS)

**Traditional HLS latency:** 20-40 —Å–µ–∫—É–Ω–¥

**LL-HLS latency:** 2-6 —Å–µ–∫—É–Ω–¥ (—è–∫ —É WebRTC!)

#### –ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏ –≤ LL-HLS:

::field-group

::field{name="Partial Segments" type="Feature"}
–°–µ–≥–º–µ–Ω—Ç –¥—ñ–ª–∏—Ç—å—Å—è –Ω–∞ **—á–∞—Å—Ç–∫–æ–≤—ñ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏** (0.5-1 —Å–µ–∫—É–Ω–¥–∞). –ü–ª–µ—î—Ä –Ω–µ —á–µ–∫–∞—î –ø–æ–≤–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞ (6 —Å–µ–∫), –∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –ø–æ 0.5 —Å–µ–∫.

```m3u8
#EXT-X-PART:DURATION=0.500,URI="segment_001_part_0.m4s"
#EXT-X-PART:DURATION=0.500,URI="segment_001_part_1.m4s"
#EXT-X-PART:DURATION=0.500,URI="segment_001_part_2.m4s"
```

::

::field{name="Playlist Delta Updates" type="Feature"}
–ü–ª–µ—î—Ä –æ—Ç—Ä–∏–º—É—î **—Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ —Ä—è–¥–∫–∏** –ø–ª–µ–π–ª—ñ—Å—Ç–∞, –∞ –Ω–µ –≤–µ—Å—å —Ñ–∞–π–ª. –ï–∫–æ–Ω–æ–º—ñ—è bandwidth.

::

::field{name="Blocking Playlist Reload" type="Feature"}
HTTP –∑–∞–ø–∏—Ç –¥–æ –ø–ª–µ–π–ª—ñ—Å—Ç–∞ **–Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è** –¥–æ—Ç–∏, –ø–æ–∫–∏ –Ω–µ –∑'—è–≤–∏—Ç—å—Å—è –Ω–æ–≤–∏–π —Å–µ–≥–º–µ–Ω—Ç. –¶–µ —É–Ω–∏–∫–∞—î –∑–∞–π–≤–∏—Ö polling-–∑–∞–ø–∏—Ç—ñ–≤.

**HTTP/2 Server Push** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è instant delivery.

::

::

::warning
**–£–≤–∞–≥–∞**: LL-HLS –≤–∏–º–∞–≥–∞—î:

- HTTP/2 (–∞–±–æ HTTP/3)
- –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π origin server (Apple Unified Streaming, Wowza, AWS MediaLive)
- iOS 14+ / macOS 11+ –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ—ó –ø—ñ–¥—Ç—Ä–∏–º–∫–∏
- hls.js v1.1.0+ –¥–ª—è —ñ–Ω—à–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤

**Use case:** –°–ø–æ—Ä—Ç–∏–≤–Ω—ñ —Å—Ç–∞–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ live —à–æ—É, –∞—É–∫—Ü—ñ–æ–Ω–∏.
::

### 6.4. Demos —Ç–∞ –ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏

#### Demo 1: –†—É—á–Ω–∏–π HLS –ü–ª–µ—î—Ä (Shell Script)

–ù–∞–ø–∏—à–µ–º–æ –ø–ª–µ—î—Ä –Ω–∞ Bash, —è–∫–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ç–∞ –ø—Ä–æ–≥—Ä–∞—î HLS –≤—Ä—É—á–Ω—É:

```bash
#!/bin/bash

HLS_URL="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"
OUTPUT_DIR="hls_download"

mkdir -p $OUTPUT_DIR
cd $OUTPUT_DIR

echo "üì• Step 1: Download Master Playlist"
curl -s "$HLS_URL" > master.m3u8
cat master.m3u8

echo -e "\nüìä Step 2: Choose quality (picking first variant)"
VARIANT_URL=$(grep -v '^#' master.m3u8 | head -1)
BASE_HLS_URL="https://test-streams.mux.dev/x36xhzz"
FULL_VARIANT_URL="$BASE_HLS_URL/$VARIANT_URL"

echo "Selected: $FULL_VARIANT_URL"

echo -e "\nüì• Step 3: Download Media Playlist"
curl -s "$FULL_VARIANT_URL" > playlist.m3u8
cat playlist.m3u8

echo -e "\nüé¨ Step 4: Download first 5 segments"
BASE_URL=$(dirname "$FULL_VARIANT_URL")
SEGMENTS=$(grep -v '^#' playlist.m3u8 | head -5)

i=1
for segment in $SEGMENTS; do
    echo "Downloading segment $i: $segment"
    curl -s "$BASE_URL/$segment" > "segment_$i.m4s"
    i=$((i+1))
done

echo -e "\n‚úÖ Done! Downloaded 5 segments"
ls -lh *.m4s

echo -e "\n‚ñ∂Ô∏è  Step 5: Play (requires ffplay)"
# Concatenate segments and play
cat segment_*.m4s > combined.m4s
ffplay combined.m4s

# Or open in default video player
# open combined.m4s  # macOS
# xdg-open combined.m4s  # Linux
```

**–ó–∞–ø—É—Å–∫:**

```bash
chmod +x hls_manual_player.sh
./hls_manual_player.sh
```

**–©–æ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ:**

```
üì• Step 1: Download Master Playlist
#EXTM3U
#EXT-X-VERSION:6
#EXT-X-STREAM-INF:BANDWIDTH=2227464,AVERAGE-BANDWIDTH=2218327,RESOLUTION=960x540...

üìä Step 2: Choose quality (picking first variant)
Selected: https://.../v2/prog_index.m3u8

üì• Step 3: Download Media Playlist
#EXTM3U
#EXT-X-TARGETDURATION:6
#EXTINF:6.00600,...

üé¨ Step 4: Download first 5 segments
Downloading segment 1: main1.m4s
Downloading segment 2: main2.m4s
...

‚úÖ Done! Downloaded 5 segments
-rw-r--r--  1 user  staff   1.2M main1.m4s
...
```

#### Demo 2: –°–∏–º—É–ª—è—Ü—ñ—è Live Streaming

–°—Ç–≤–æ—Ä–∏–º–æ fake live stream –∑ —ñ—Å–Ω—É—é—á–æ–≥–æ –≤—ñ–¥–µ–æ:

::code-collapse{title="–ü–æ–∫–∞–∑–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç —Å–∏–º—É–ª—è—Ü—ñ—ó live streaming"}

```bash
#!/bin/bash

INPUT_VIDEO="movie.mp4"
OUTPUT_DIR="live_stream"
SEGMENT_DURATION=4

mkdir -p $OUTPUT_DIR

# –ö—Ä–æ–∫ 1: –†–æ–∑–±–∏—Ç–∏ –≤—ñ–¥–µ–æ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∏
echo "üî™ Segmenting video..."
ffmpeg -i "$INPUT_VIDEO" \
  -c copy \
  -f segment \
  -segment_time $SEGMENT_DURATION \
  -reset_timestamps 1 \
  "$OUTPUT_DIR/segment_%05d.ts"

# –ö—Ä–æ–∫ 2: –°–∏–º—É–ª—é–≤–∞—Ç–∏ live –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –¥–æ playlist
echo "üî¥ Starting live simulation..."

PLAYLIST="$OUTPUT_DIR/live.m3u8"
MEDIA_SEQUENCE=0
MAX_SEGMENTS=5  # Sliding window (—Ç—Ä–∏–º–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ 5 –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —Å–µ–≥–º–µ–Ω—Ç—ñ–≤)

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è playlist
cat > "$PLAYLIST" <<EOF
#EXTM3U
#EXT-X-VERSION:3
#EXT-X-TARGETDURATION:$SEGMENT_DURATION
#EXT-X-MEDIA-SEQUENCE:$MEDIA_SEQUENCE
EOF

# –î–æ–¥–∞—î–º–æ —Å–µ–≥–º–µ–Ω—Ç–∏ –ø–æ –æ–¥–Ω–æ–º—É (–∫–æ–∂–Ω—ñ 4 —Å–µ–∫—É–Ω–¥–∏)
for segment in $OUTPUT_DIR/segment_*.ts; do
    SEGMENT_NAME=$(basename "$segment")

    echo "‚ûï Adding segment: $SEGMENT_NAME (sequence: $MEDIA_SEQUENCE)"

    # –î–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π —Å–µ–≥–º–µ–Ω—Ç
    echo "#EXTINF:$SEGMENT_DURATION.0," >> "$PLAYLIST"
    echo "$SEGMENT_NAME" >> "$PLAYLIST"

    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—ñ N —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ (sliding window)
    TOTAL_SEGMENTS=$(grep -c "^segment_" "$PLAYLIST")
    if [ $TOTAL_SEGMENTS -gt $MAX_SEGMENTS ]; then
        # –í–∏–¥–∞–ª—è—î–º–æ –ø–µ—Ä—à–∏–π —Å–µ–≥–º–µ–Ω—Ç –∑ –ø–ª–µ–π–ª—ñ—Å—Ç–∞
        sed -i.bak '/#EXTINF/,+1d' "$PLAYLIST"  # –í–∏–¥–∞–ª—è—î –ø–µ—Ä—à—ñ 2 —Ä—è–¥–∫–∏ (#EXTINF + filename)
        MEDIA_SEQUENCE=$((MEDIA_SEQUENCE + 1))

        # –û–Ω–æ–≤–ª—é—î–º–æ MEDIA-SEQUENCE
        sed -i.bak "s/#EXT-X-MEDIA-SEQUENCE:.*/#EXT-X-MEDIA-SEQUENCE:$MEDIA_SEQUENCE/" "$PLAYLIST"
    fi

    echo "üìÑ Current playlist:"
    cat "$PLAYLIST"
    echo ""

    # –ß–µ–∫–∞—î–º–æ 4 —Å–µ–∫—É–Ω–¥–∏ (—Å–∏–º—É–ª—è—Ü—ñ—è real-time)
    sleep 4
done

# –î–æ–¥–∞—î–º–æ ENDLIST (—Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—è –∑–∞–∫—ñ–Ω—á–∏–ª–∞—Å—å)
echo "#EXT-X-ENDLIST" >> "$PLAYLIST"
echo "‚úÖ Live simulation ended"
```

::

**–ó–∞–ø—É—Å–∫:**

```bash
./simulate_live.sh
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**

1. –í—ñ–¥–µ–æ —Ä–æ–∑–±–∏–≤–∞—î—Ç—å—Å—è –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∏ –ø–æ 4 —Å–µ–∫—É–Ω–¥–∏
2. –ö–æ–∂–Ω—ñ 4 —Å–µ–∫—É–Ω–¥–∏ –Ω–æ–≤–∏–π —Å–µ–≥–º–µ–Ω—Ç –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ `live.m3u8`
3. –°—Ç–∞—Ä—ñ —Å–µ–≥–º–µ–Ω—Ç–∏ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è (sliding window)
4. `MEDIA-SEQUENCE` –∑–±—ñ–ª—å—à—É—î—Ç—å—Å—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–∏ –±–∞—á–∏—Ç–µ, —è–∫ –ø–ª–µ–π–ª—ñ—Å—Ç live stream –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ real-time!

#### Demo 3: –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —è–∫–æ—Å—Ç—ñ ABR

–°—Ç–≤–æ—Ä–∏–º–æ HTML —Å—Ç–æ—Ä—ñ–Ω–∫—É, —è–∫–∞ –ø–æ–∫–∞–∑—É—î –∑–º—ñ–Ω–∏ —è–∫–æ—Å—Ç—ñ –≤ real-time:

::code-collapse{title="–ü–æ–∫–∞–∑–∞—Ç–∏ HTML + JavaScript –∫–æ–¥"}

```html
<!DOCTYPE html>
<html>
    <head>
        <title>HLS ABR Visualizer</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background: #0f172a;
                color: #e2e8f0;
            }

            video {
                width: 100%;
                max-width: 800px;
                border-radius: 8px;
            }

            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-top: 20px;
            }

            .stat-card {
                background: #1e293b;
                padding: 15px;
                border-radius: 8px;
                border-left: 4px solid #3b82f6;
            }

            .stat-label {
                font-size: 12px;
                color: #94a3b8;
                text-transform: uppercase;
            }

            .stat-value {
                font-size: 24px;
                font-weight: bold;
                margin-top: 5px;
            }

            #quality-chart {
                margin-top: 30px;
                height: 200px;
                background: #1e293b;
                border-radius: 8px;
                padding: 20px;
                position: relative;
            }

            .quality-bar {
                height: 100%;
                display: flex;
                align-items: flex-end;
                gap: 2px;
            }

            .bar {
                flex: 1;
                background: #3b82f6;
                border-radius: 2px 2px 0 0;
                transition: height 0.3s;
            }
        </style>
    </head>
    <body>
        <h1>üé¨ HLS Adaptive Bitrate Visualizer</h1>

        <video id="video" controls></video>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Current Quality</div>
                <div class="stat-value" id="current-quality">-</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Bandwidth</div>
                <div class="stat-value" id="bandwidth">- Mbps</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Buffer Length</div>
                <div class="stat-value" id="buffer">- sec</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Dropped Frames</div>
                <div class="stat-value" id="dropped-frames">0</div>
            </div>
        </div>

        <div id="quality-chart">
            <h3>Quality History (Last 60 seconds)</h3>
            <div class="quality-bar" id="quality-bars"></div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
        <script>
            const video = document.getElementById('video')
            const HLS_URL = 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8'

            const qualityHistory = []
            const MAX_HISTORY = 60

            if (Hls.isSupported()) {
                const hls = new Hls({
                    debug: false,
                    enableWorker: true,
                })

                hls.loadSource(HLS_URL)
                hls.attachMedia(video)

                // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É
                setInterval(() => {
                    updateStats(hls)
                }, 1000)

                // –í—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω —è–∫–æ—Å—Ç—ñ
                hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
                    const level = hls.levels[data.level]
                    console.log(`Quality switched to: ${level.height}p`)

                    qualityHistory.push(level.height)
                    if (qualityHistory.length > MAX_HISTORY) {
                        qualityHistory.shift()
                    }

                    updateQualityChart()
                })

                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    video.play()
                })
            }

            function updateStats(hls) {
                const level = hls.levels[hls.currentLevel]
                if (!level) return

                // Current Quality
                document.getElementById('current-quality').textContent = `${level.height}p`

                // Bandwidth (Mbps)
                const bandwidth = (hls.bandwidthEstimate / 1000000).toFixed(2)
                document.getElementById('bandwidth').textContent = `${bandwidth} Mbps`

                // Buffer Length
                const buffer = video.buffered.length > 0 ? (video.buffered.end(0) - video.currentTime).toFixed(1) : 0
                document.getElementById('buffer').textContent = `${buffer} sec`

                // Dropped Frames
                const dropped = video.getVideoPlaybackQuality?.().droppedVideoFrames || 0
                document.getElementById('dropped-frames').textContent = dropped
            }

            function updateQualityChart() {
                const container = document.getElementById('quality-bars')
                container.innerHTML = ''

                const maxQuality = Math.max(...qualityHistory)

                qualityHistory.forEach((quality) => {
                    const bar = document.createElement('div')
                    bar.className = 'bar'
                    const heightPercent = (quality / maxQuality) * 100
                    bar.style.height = `${heightPercent}%`

                    // –ö–æ–ª—ñ—Ä –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —è–∫–æ—Å—Ç—ñ
                    if (quality >= 1080) bar.style.background = '#10b981'
                    else if (quality >= 720) bar.style.background = '#3b82f6'
                    else if (quality >= 480) bar.style.background = '#f59e0b'
                    else bar.style.background = '#ef4444'

                    container.appendChild(bar)
                })
            }
        </script>
    </body>
</html>
```

::

**–©–æ –ø–æ–∫–∞–∑—É—î –¥–µ–º–æ:**

- –ü–æ—Ç–æ—á–Ω—É —è–∫—ñ—Å—Ç—å –≤—ñ–¥–µ–æ (360p / 720p / 1080p)
- –í–∏–º—ñ—Ä—è–Ω—É —à–≤–∏–¥–∫—ñ—Å—Ç—å —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –î–æ–≤–∂–∏–Ω—É –±—É—Ñ–µ—Ä–∞
- –ì—Ä–∞—Ñ—ñ–∫ –∑–º—ñ–Ω —è–∫–æ—Å—Ç—ñ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—é —Ö–≤–∏–ª–∏–Ω—É

---

## 7. Troubleshooting —Ç–∞ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 7.1. –¢–∏–ø–æ–≤—ñ –ü—Ä–æ–±–ª–µ–º–∏

::accordion

::accordion-item{label="‚ùå CORS Error: No 'Access-Control-Allow-Origin' header" icon="i-lucide-alert-circle"}

**–°–∏–º–ø—Ç–æ–º:**

```
Access to fetch at 'https://cdn.example.com/master.m3u8' from origin 'https://mysite.com'
has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present
```

**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–µ—Ä –Ω–µ –≤—ñ–¥–¥–∞—î CORS headers.

**–†—ñ—à–µ–Ω–Ω—è:**

–î–æ–¥–∞–π—Ç–µ –≤ Nginx –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é:

```nginx
location ~ \.(m3u8|ts|m4s)$ {
    add_header Access-Control-Allow-Origin * always;
    add_header Access-Control-Allow-Methods 'GET, OPTIONS' always;
    add_header Access-Control-Allow-Headers 'Range' always;

    if ($request_method = OPTIONS) {
        return 204;
    }
}
```

::

::accordion-item{label="‚è∏Ô∏è –í—ñ–¥–µ–æ –ø–æ—Å—Ç—ñ–π–Ω–æ –±—É—Ñ–µ—Ä–∏–∑—É—î—Ç—å—Å—è (–∑–∞–≤–∏—Å–∞—î)" icon="i-lucide-loader"}

**–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:**

1. **–®–≤–∏–¥–∫—ñ—Å—Ç—å —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É < bitrate –≤—ñ–¥–µ–æ**
    - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: –í—ñ–¥–∫—Ä–∏–π—Ç–µ DevTools ‚Üí Network ‚Üí –ø–æ–¥–∏–≤—ñ—Ç—å—Å—è —à–≤–∏–¥–∫—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–µ–≥–º–µ–Ω—Ç—ñ–≤
    - –†—ñ—à–µ–Ω–Ω—è: ABR –º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∏–∑–∏—Ç–∏ —è–∫—ñ—Å—Ç—å. –Ø–∫—â–æ –Ω—ñ ‚Äî —Ü–µ –±–∞–≥ –ø–ª–µ—î—Ä–∞

2. **CDN –ø–æ–≤—ñ–ª—å–Ω–∏–π –∞–±–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π**
    - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: `curl -w "@curl-format.txt" https://cdn.example.com/segment.ts`
    - –†—ñ—à–µ–Ω–Ω—è: –ó–º—ñ–Ω—ñ—Ç—å CDN –∞–±–æ –¥–æ–¥–∞–π—Ç–µ fallback origin

3. **Segments –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫—ñ**
    - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: –†–æ–∑–º—ñ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ > 5 MB –ø—Ä–∏ —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ 6 —Å–µ–∫ = bitrate > 6.7 Mbps (–¥—É–∂–µ –≤–∏—Å–æ–∫–∏–π)
    - –†—ñ—à–µ–Ω–Ω—è: –ü–µ—Ä–µ–∫–æ–¥—É–π—Ç–µ –∑ –º–µ–Ω—à–∏–º bitrate –∞–±–æ –∑–±—ñ–ª—å—à—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ —è–∫–æ—Å—Ç—ñ

::

::accordion-item{label="üîÑ –Ø–∫—ñ—Å—Ç—å –ø–æ—Å—Ç—ñ–π–Ω–æ –º—ñ –≥–∞—î (flickering)" icon="i-lucide-activity"}

**–°–∏–º–ø—Ç–æ–º:** –í—ñ–¥–µ–æ –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è –º—ñ–∂ 720p —ñ 1080p –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥.

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å—Ç–∞–±—ñ–ª—å–Ω–∞ –º–µ—Ä–µ–∂–∞ –∞–±–æ –Ω–∞–¥—Ç–æ –∞–≥—Ä–µ—Å–∏–≤–Ω–∏–π ABR –∞–ª–≥–æ—Ä–∏—Ç–º.

**–†—ñ—à–µ–Ω–Ω—è:**

```javascript
// –ù–∞–ª–∞—à—Ç—É–π—Ç–µ hls.js –¥–ª—è –±—ñ–ª—å—à–æ—ó —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ
const hls = new Hls({
    abrEwmaDefaultEstimate: 1000000, // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π estimate (1 Mbps)
    abrBandWidthFactor: 0.95, // –ë—ñ–ª—å—à –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∏–π –≤–∏–±—ñ—Ä (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 0.95)
    abrBandWidthUpFactor: 0.7, // –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ
})
```

::

::accordion-item{label="üì± Playlist –Ω–µ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è (Live —Å—Ç—Ä—ñ–º)" icon="i-lucide-refresh-cw"}

**–°–∏–º–ø—Ç–æ–º:** Live —Å—Ç—Ä—ñ–º –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è 5-–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞.

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–ª–µ—î—Ä –ø—Ä–∏–ø–∏–Ω–∏–≤ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ playlist (–ø–æ–±–∞—á–∏–≤ `#EXT-X-ENDLIST`).

**–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —î ENDLIST –≤ playlist
curl https://cdn.example.com/live/playlist.m3u8 | grep ENDLIST
```

**–†—ñ—à–µ–Ω–Ω—è:**

- –í–∏–¥–∞–ª—ñ—Ç—å `#EXT-X-ENDLIST` –∑ Live –ø–ª–µ–π–ª—ñ—Å—Ç–∞
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ encoder –¥–æ–¥–∞—î –Ω–æ–≤—ñ —Å–µ–≥–º–µ–Ω—Ç–∏

::

::accordion-item{label="üéµ –ê—É–¥—ñ–æ —î, –≤—ñ–¥–µ–æ –Ω–µ–º–∞—î (–∞–±–æ –Ω–∞–≤–ø–∞–∫–∏)" icon="i-lucide-volume-2"}

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Å—É–º—ñ—Å–Ω–∏–π –∫–æ–¥–µ–∫.

**–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–¥–µ–∫–∏ –≤ –ø–ª–µ–π–ª—ñ—Å—Ç—ñ
curl https://cdn.example.com/master.m3u8 | grep CODECS

# –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# CODECS="avc1.64001f,mp4a.40.2"
#         ^^^^^^^^^^^ ^^^^^^^^^
#         H.264       AAC
```

**–†—ñ—à–µ–Ω–Ω—è:**

- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ H.264 (AVC) –¥–ª—è –≤—ñ–¥–µ–æ (–Ω–µ VP9, –Ω–µ AV1 ‚Äî Safari –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ AAC –¥–ª—è –∞—É–¥—ñ–æ (–Ω–µ Opus ‚Äî Safari –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤ HLS)

::

::accordion-item{label=" –ü–æ–º–∏–ª–∫–∞ 404 –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ö" icon="i-lucide-file-question"}

**–°–∏–º–ø—Ç–æ–º:**

```
Failed to load resource: the server responded with a status of 404 (Not Found)
https://cdn.example.com/segment_045.ts
```

**–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:**

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –±–∞–∑–æ–≤–∏–π URL**
    - –ü–ª–µ–π–ª—ñ—Å—Ç –º—ñ—Å—Ç–∏—Ç—å –≤—ñ–¥–Ω–æ—Å–Ω—ñ —à–ª—è—Ö–∏, –∞–ª–µ –±—Ä–∞—É–∑–µ—Ä –∑–±–∏—Ä–∞—î URL –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

2. **–°–µ–≥–º–µ–Ω—Ç–∏ —Ñ—ñ–∑–∏—á–Ω–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ**
    - Encoder not —Å—Ç–≤–æ—Ä–∏–≤ —Ñ–∞–π–ª –∞–±–æ –≤–∏–¥–∞–ª–∏–≤ –∑–∞–Ω–∞–¥—Ç–æ —Ä–∞–Ω–æ

**–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# –°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–µ–≥–º–µ–Ω—Ç –≤—Ä—É—á–Ω—É
curl -I https://cdn.example.com/segment_045.ts

# –Ø–∫—â–æ 404 ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —Ñ–∞–π–ª —ñ—Å–Ω—É—î –Ω–∞ origin
ssh user@origin-server "ls -lh /var/www/hls/segment_045.ts"
```

::

::

### 7.2. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

::card-group

::card{title="üîç Chrome DevTools Network Tab" icon="i-lucide-network"}

**–Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ DevTools (F12)
2. –í–∫–ª–∞–¥–∫–∞ **Network**
3. –§—ñ–ª—å—Ç—Ä: –ó–∞–ª–∏—à—ñ—Ç—å —Ç—ñ–ª—å–∫–∏ `.m3u8` —Ç–∞ `.ts` —Ñ–∞–π–ª–∏
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Play –Ω–∞ –≤—ñ–¥–µ–æ

**–©–æ –¥–∏–≤–∏—Ç–∏—Å—å:**

- **Time**: –ß–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (–º–∞—î –±—É—Ç–∏ < —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ —Å–µ–≥–º–µ–Ω—Ç–∞)
- **Size**: –†–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É (–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ `bitrate √ó duration`)
- **Status**: –ö–æ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (200 = OK, 404 = –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ, 403 = –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ)

::

::card{title="üìä VLC Media Info" icon="i-lucide-info"}

VLC –ø–æ–∫–∞–∑—É—î –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å—Ç—Ä—ñ–º:

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ HLS –≤ VLC: **Media ‚Üí Open Network Stream**
2. –í—Å—Ç–∞–≤—Ç–µ `https://cdn.example.com/master.m3u8`
3. **Tools ‚Üí Codec Information** (Ctrl+J)

**–©–æ –¥–∏–≤–∏—Ç–∏—Å—å:**

- –ö–æ–¥–µ–∫–∏ (–º–∞—î –±—É—Ç–∏ H.264 + AAC)
- Bitrate (—Ä–µ–∞–ª—å–Ω–∏–π vs –æ—á—ñ–∫—É–≤–∞–Ω–∏–π)
- Dropped frames (—è–∫—â–æ > 0 ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –∑ decode)

::

::card{title="‚öôÔ∏è FFprobe –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —Å–µ–≥–º–µ–Ω—Ç—ñ–≤" icon="i-lucide-terminal"}

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–¥–µ–∫–∏
ffprobe -v error -show_streams segment_001.ts

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å
ffprobe -v error -show_entries format=duration segment_001.ts

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ bitrate
ffprobe -v error -show_entries format=bit_rate segment_001.ts
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π output:**

```
duration=6.006000
bit_rate=2534567
```

::

::card{title="üåê Online HLS Validators" icon="i-lucide-check-circle"}

**–°–µ—Ä–≤—ñ—Å–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:**

- [HLS Validator by Apple](https://developer.apple.com/documentation/http_live_streaming/about_apple_s_http_live_streaming_tools)
- [Cloudflare Stream Tester](https://www.cloudflare.com/en-gb/learning/video/what-is-http-live-streaming/)

–í—Å—Ç–∞–≤—Ç–µ URL –≤–∞—à–æ–≥–æ `master.m3u8` —ñ –æ—Ç—Ä–∏–º–∞–π—Ç–µ –∑–≤—ñ—Ç –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏.

::

::

---

## 8. HLS vs –Ü–Ω—à—ñ –ü—Ä–æ—Ç–æ–∫–æ–ª–∏

### 8.1. HLS vs DASH

::tabs

::tabs-item{label="HLS" icon="i-lucide-apple"}

**HTTP Live Streaming** –≤—ñ–¥ Apple

**–ü–µ—Ä–µ–≤–∞–≥–∏:**

- ‚úÖ –ù–∞—Ç—ñ–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ iOS/macOS/Safari
- ‚úÖ –ü—Ä–æ—Å—Ç—ñ—à–∏–π —Ñ–æ—Ä–º–∞—Ç (M3U8 —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–ª–µ–π–ª—ñ—Å—Ç–∏)
- ‚úÖ –ú–µ–Ω—à–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ setup (—à–≤–∏–¥—à–µ —Å—Ç–∞—Ä—Ç—É—î)
- ‚úÖ –ö—Ä–∞—â–∞ –µ–∫–æ—Å–∏—Å—Ç–µ–º–∞ (–±—ñ–ª—å—à–µ CDN provider'—ñ–≤ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å)

**–ù–µ–¥–æ–ª—ñ–∫–∏:**

- ‚ùå –§–æ—Ä–º–∞—Ç –ø–ª–µ–π–ª—ñ—Å—Ç–∞ –Ω–µ XML (—Å–∫–ª–∞–¥–Ω—ñ—à–µ –ø–∞—Ä—Å–∏—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ)
- ‚ùå –ú–µ–Ω—à–µ –æ–ø—Ü—ñ–π –¥–ª—è DRM (—Ç—ñ–ª—å–∫–∏ FairPlay –¥–ª—è Apple)

::

::tabs-item{label="DASH" icon="i-lucide-play-circle"}

**Dynamic Adaptive Streaming over HTTP** –≤—ñ–¥ MPEG Industry

**–ü–µ—Ä–µ–≤–∞–≥–∏:**

- ‚úÖ –í—ñ–¥–∫—Ä–∏—Ç–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç (ISO/IEC 23009)
- ‚úÖ –ö—Ä–∞—â–∏–π DRM (Widevine, PlayReady)
- ‚úÖ XML-based manifest (–ø—Ä–æ—Å—Ç—ñ—à–µ –≤–∞–ª—ñ–¥—É–≤–∞—Ç–∏)
- ‚úÖ –ë—ñ–ª—å—à–µ –≥–Ω—É—á–∫–æ—Å—Ç—ñ (–ø—ñ–¥—Ç—Ä–∏–º–∫–∞ Timeline, SegmentTemplate)

**–ù–µ–¥–æ–ª—ñ–∫–∏:**

- ‚ùå Safari –ù–ï –ø—ñ–¥—Ç—Ä–∏–º—É—î –Ω–∞—Ç–∏–≤–Ω–æ (–ø–æ—Ç—Ä—ñ–±–µ–Ω dash.js)
- ‚ùå –°–∫–ª–∞–¥–Ω—ñ—à–∏–π —Ñ–æ—Ä–º–∞—Ç (MPD XML vs M3U8)

::

::

**–ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è:**

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞                | HLS              | DASH                |
| ----------------------------- | ---------------- | ------------------- |
| **–†–æ–∑—Ä–æ–±–Ω–∏–∫**                 | Apple            | MPEG                |
| **–§–æ—Ä–º–∞—Ç Manifest**           | M3U8 (—Ç–µ–∫—Å—Ç)     | MPD (XML)           |
| **–ù–∞—Ç–∏–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ iOS**     | ‚úÖ –¢–∞–∫           | ‚ùå –ü–æ—Ç—Ä—ñ–±–µ–Ω dash.js |
| **–ù–∞—Ç–∏–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ Android** | ‚ö†Ô∏è –ß–∞—Å—Ç–∫–æ–≤–æ      | ‚úÖ –¢–∞–∫ (ExoPlayer)  |
| **–õ–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å (—Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∞)**  | 20-40 —Å–µ–∫        | 10-30 —Å–µ–∫           |
| **–õ–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å (Low Latency)** | 2-6 —Å–µ–∫ (LL-HLS) | 3-5 —Å–µ–∫ (LL-DASH)   |
| **DRM**                       | FairPlay         | Widevine, PlayReady |
| **CDN –ø—ñ–¥—Ç—Ä–∏–º–∫–∞**             | –í—ñ–¥–º—ñ–Ω–Ω–∞         | –î—É–∂–µ –¥–æ–±—Ä–∞          |
| **–ï–∫–æ—Å–∏—Å—Ç–µ–º–∞**                | –ë—ñ–ª—å—à–∞           | –ú–µ–Ω—à–∞               |

::tip
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è 2024+:**

- –Ø–∫—â–æ –≤–∞—à–∞ –∞—É–¥–∏—Ç–æ—Ä—ñ—è primarily iOS/Safari ‚Üí **HLS**
- –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω DRM (Netflix-style protection) ‚Üí **DASH + Widevine**
- **–û–ø—Ç–∏–º–∞–ª—å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è:** CMAF (Common Media Application Format) ‚Äî –æ–¥–∏–Ω –Ω–∞–±—ñ—Ä —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ —ñ –¥–ª—è HLS, —ñ –¥–ª—è DASH!

```bash
ffmpeg -i input.mp4 \
  -c:v libx264 -c:a aac \
  -f hls -hls_segment_type fmp4 \  ‚Üê fMP4 (CMAF-—Å—É–º—ñ—Å–Ω–∏–π)
  output_hls.m3u8

# –¢–æ–π —Å–∞–º–∏–π –Ω–∞–±—ñ—Ä .m4s —Ñ–∞–π–ª—ñ–≤ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–ª—è DASH
```

::

### 8.2. HLS vs RTMP

|                         | HLS                                          | RTMP                                     |
| ----------------------- | -------------------------------------------- | ---------------------------------------- |
| **–ü—Ä–æ—Ç–æ–∫–æ–ª**            | HTTP/HTTPS                                   | TCP (–ø–æ—Ä—Ç 1935)                          |
| **Firewall friendly**   | ‚úÖ –¢–∞–∫ (–ø–æ—Ä—Ç 80/443)                         | ‚ùå –ë–ª–æ–∫—É—î—Ç—å—Å—è —Ñ–∞—î—Ä–≤–æ–ª–∞–º–∏                 |
| **CDN**                 | ‚úÖ –ü—Ä–∞—Ü—é—î                                    | ‚ùå –ü–æ—Ç—Ä—ñ–±–µ–Ω —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä           |
| **–õ–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å**         | 20-40 —Å–µ–∫ (traditional)<br/>2-6 —Å–µ–∫ (LL-HLS) | 2-5 —Å–µ–∫                                  |
| **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±—Ä–∞—É–∑–µ—Ä—ñ–≤** | ‚úÖ –í—Å—ñ (–Ω–∞—Ç–∏–≤–Ω–æ –∞–±–æ hls.js)                  | ‚ùå –ü–æ–º–µ—Ä –∑ Flash                         |
| **Use case**            | VOD, Live, DVR                               | –¢—ñ–ª—å–∫–∏ Live (–±—ñ–ª—å—à–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è) |

::caution
**RTMP –ø–æ–º–µ—Ä —É 2020 —Ä–æ—Ü—ñ** —Ä–∞–∑–æ–º —ñ–∑ Flash Player. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç—ñ–ª—å–∫–∏ –¥–ª—è:

- Ingest (OBS ‚Üí —Å–µ—Ä–≤–µ—Ä –∫–æ–¥—É–≤–∞–Ω–Ω—è)
- Legacy systems (—Å—Ç–∞—Ä—ñ –∫–∞–º–µ—Ä–∏ –≤—ñ–¥–µ–æ—Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è)

–î–ª—è delivery –¥–æ –≥–ª—è–¥–∞—á—ñ–≤ **–∑–∞–≤–∂–¥–∏** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ HLS –∞–±–æ DASH.
::

---

## 9. –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ó–∞–≤–¥–∞–Ω–Ω—è

::steps

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –°—Ç–≤–æ—Ä–∏—Ç–∏ HLS —Å—Ç—Ä—ñ–º –∑ MP4

**–ú–µ—Ç–∞:** –ü–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ `movie.mp4` –Ω–∞ HLS –∑ 3 –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏ —è–∫–æ—Å—Ç—ñ.

**–ö—Ä–æ–∫–∏:**

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å FFmpeg
2. –°—Ç–≤–æ—Ä—ñ—Ç—å bash-—Å–∫—Ä–∏–ø—Ç, —è–∫–∏–π –≥–µ–Ω–µ—Ä—É—î —Ç—Ä–∏ –≤–∞—Ä—ñ–∞–Ω—Ç–∏: 360p (800 Kbps), 720p (2.5 Mbps), 1080p (5 Mbps)
3. –°—Ç–≤–æ—Ä—ñ—Ç—å Master Playlist –≤—Ä—É—á–Ω—É
4. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –ª–æ–∫–∞–ª—å–Ω–∏–π HTTP —Å–µ—Ä–≤–µ—Ä (Python –∞–±–æ Nginx)
5. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ

**–ö—Ä–∏—Ç–µ—Ä—ñ—ó —É—Å–ø—ñ—Ö—É:**

- –ü–ª–µ—î—Ä –ø–µ—Ä–µ–º–∏–∫–∞—î —è–∫—ñ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (–º–æ–∂–Ω–∞ –ø–æ–±–∞—á–∏—Ç–∏ –≤ DevTools)
- –í—ñ–¥–µ–æ –ø—Ä–æ–≥—Ä–∞—î –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω—å

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Nginx –¥–ª—è HLS

**–ú–µ—Ç–∞:** –°—Ç–≤–æ—Ä–∏—Ç–∏ production-ready Nginx –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é.

**–í–∏–º–æ–≥–∏:**

- CORS headers (—â–æ–± –ø—Ä–∞—Ü—é–≤–∞–≤ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –¥–æ–º–µ–Ω—É)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ñ Cache-Control headers (10 —Å–µ–∫ –¥–ª—è .m3u8, 1 —Ä—ñ–∫ –¥–ª—è .ts)
- Gzip compression –¥–ª—è –ø–ª–µ–π–ª—ñ—Å—Ç—ñ–≤
- –õ–æ–≥—É–≤–∞–Ω–Ω—è (–æ–∫—Ä–µ–º–∏–π access.log –¥–ª—è HLS)

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:**

```bash
curl -I https://your-domain.com/master.m3u8 | grep Cache-Control
# –ú–∞—î –±—É—Ç–∏: Cache-Control: public, max-age=10
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —Å—Ç—Ä—ñ–º–∞

**–î–∞–Ω–∏–π buggy HLS:**

```
https://test-broken-hls.example.com/master.m3u8
```

**–ü—Ä–æ–±–ª–µ–º–∏:**

- –í—ñ–¥–µ–æ –∑–∞–≤–∏—Å–∞—î –∫–æ–∂–Ω—ñ 20 —Å–µ–∫—É–Ω–¥
- –Ø–∫—ñ—Å—Ç—å –Ω–µ –ø–µ—Ä–µ–º–∏–∫–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- –£ Safari –ø—Ä–∞—Ü—é—î, —É Chrome ‚Äî –Ω—ñ

**–ó–∞–≤–¥–∞–Ω–Ω—è:**

1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ DevTools Network tab
2. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ master.m3u8 —Ç–∞ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ
3. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–µ—Ä—à–∏–π —Å–µ–≥–º–µ–Ω—Ç —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ FFprobe
4. –ó–Ω–∞–π–¥—ñ—Ç—å —Ç–∞ –æ–ø–∏—à—ñ—Ç—å –º—ñ–Ω—ñ–º—É–º 3 –ø—Ä–æ–±–ª–µ–º–∏

**–ü—ñ–¥–∫–∞–∑–∫–∞:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ CORS, bitrate mismatch, codec compatibility.

::

---

## 10. FAQ (–ß–∞—Å—Ç—ñ –ü–∏—Ç–∞–Ω–Ω—è)

::accordion

::accordion-item{label="Q: –ß–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ HLS –¥–ª—è –≤—ñ–¥–µ–æ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü—ñ–π?" icon="i-lucide-message-circle-question"}

**A:** –ù—ñ, HLS –º–∞—î –∑–∞—Ç—Ä–∏–º–∫—É 2-40 —Å–µ–∫—É–Ω–¥ (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–µ–∂–∏–º—É). –î–ª—è real-time –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–µ–Ω **WebRTC** (–ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å < 500 ms).

**Use case HLS:** –í–µ–±—ñ–Ω–∞—Ä–∏, –¥–µ –∑–≤–æ—Ä–æ—Ç–Ω—ñ–π –∑–≤'—è–∑–æ–∫ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∏–π.
**Use case WebRTC:** Zoom, Google Meet, Discord calls.

::

::accordion-item{label="Q: –°–∫—ñ–ª—å–∫–∏ –∫–æ—à—Ç—É—î CDN –¥–ª—è HLS?" icon="i-lucide-dollar-sign"}

**A:** –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Ç—Ä–∞—Ñ—ñ–∫—É:

- **AWS CloudFront:** $0.085/GB (–ø–µ—Ä—à—ñ 10 TB)
- **Cloudflare:** $0.04/GB (–∞–±–æ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –≤ –º–µ–∂–∞—Ö —Ç–∞—Ä–∏—Ñ–Ω–æ–≥–æ –ø–ª–∞–Ω—É)
- **Bunny CDN:** $0.01/GB (–Ω–∞–π–¥–µ—à–µ–≤—à–∏–π)

**–ü—Ä–∏–∫–ª–∞–¥:** 1000 –≥–ª—è–¥–∞—á—ñ–≤, –∫–æ–∂–µ–Ω –¥–∏–≤–∏—Ç—å—Å—è 1 –≥–æ–¥–∏–Ω—É (2 Mbps —è–∫—ñ—Å—Ç—å):

```
1000 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ √ó 1 –≥–æ–¥–∏–Ω–∞ √ó 2 Mbps = 2,000,000 –ú–±—ñ—Ç = 250 GB
–í–∞—Ä—Ç—ñ—Å—Ç—å: 250 GB √ó $0.04 = $10
```

::

::accordion-item{label="Q: –Ø–∫ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –≤—ñ–¥ –≤–∏–∫—Ä–∞–¥–µ–Ω–Ω—è?" icon="i-lucide-shield"}

**A:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é –º–µ—Ç–æ–¥—ñ–≤:

1. **AES-128 encryption** (–±–∞–∑–æ–≤–∏–π –∑–∞—Ö–∏—Å—Ç)
2. **Signed URLs** (—Ç–æ–∫–µ–Ω–∏ –∑ expiration time)
3. **DRM** (FairPlay, Widevine) ‚Äî –¥–ª—è premium –∫–æ–Ω—Ç–µ–Ω—Ç—É

::note
**–í–∞–∂–ª–∏–≤–æ:** 100% –∑–∞—Ö–∏—Å—Ç—É –Ω–µ —ñ—Å–Ω—É—î. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–≤–∂–¥–∏ –º–æ–∂–µ –∑–∞–ø–∏—Å–∞—Ç–∏ –µ–∫—Ä–∞–Ω. DRM —Ç—ñ–ª—å–∫–∏ —É—Å–∫–ª–∞–¥–Ω—é—î –ø—ñ—Ä–∞—Ç—Å—Ç–≤–æ, –∞–ª–µ –Ω–µ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ –Ω–µ–º–æ–∂–ª–∏–≤–∏–º.
::

::

::accordion-item{label="Q: –ß–∏ –º–æ–∂–Ω–∞ —Å—Ç—Ä—ñ–º–∏—Ç–∏ 4K —á–µ—Ä–µ–∑ HLS?" icon="i-lucide-monitor"}

**A:** –¢–∞–∫! –ü–æ—Ç—Ä—ñ–±–µ–Ω:

- –ö–æ–¥–µ–∫: H.265/HEVC –∞–±–æ AV1 (H.264 –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π bitrate –¥–ª—è 4K)
- Bitrate: 15-25 Mbps –¥–ª—è 4K 30fps, 35-50 Mbps –¥–ª—è 4K 60fps
- Safari –ø—ñ–¥—Ç—Ä–∏–º—É—î HEVC –Ω–∞—Ç–∏–≤–Ω–æ, Chrome –ø–æ—Ç—Ä—ñ–±–µ–Ω –∞–ø–∞—Ä–∞—Ç–Ω–∏–π –¥–µ–∫–æ–¥–µ—Ä

**–ü—Ä–∏–∫–ª–∞–¥:**

```bash
ffmpeg -i input_4k.mp4 \
  -c:v libx265 -preset medium -crf 23 \
  -c:a aac -b:a 192k \
  -f hls -hls_time 6 \
  output_4k.m3u8
```

::

::accordion-item{label="Q: –Ø–∫ –∑—Ä–æ–±–∏—Ç–∏ HLS –ø—Ä–∞—Ü—é–≤–∞—â–∏–º offline?" icon="i-lucide-wifi-off"}

**A:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ **Service Worker** –∞–±–æ **IndexedDB**:

```javascript
// –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å—ñ —Å–µ–≥–º–µ–Ω—Ç–∏ –Ω–∞–ø–µ—Ä–µ–¥
async function downloadForOffline(masterUrl) {
    const response = await fetch(masterUrl)
    const playlist = await response.text()

    // Parse playlist, get segments URLs
    const segments = extractSegmentUrls(playlist)

    // Download and store in IndexedDB
    for (const segmentUrl of segments) {
        const segmentBlob = await fetch(segmentUrl).then((r) => r.blob())
        await saveToIndexedDB(segmentUrl, segmentBlob)
    }
}
```

**iOS/Android apps:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –Ω–∞—Ç–∏–≤–Ω—ñ API (AVAssetDownloadTask –¥–ª—è iOS).

::

::accordion-item{label="Q: –ß–æ–º—É –º—ñ–π live —Å—Ç—Ä—ñ–º –º–∞—î –∑–∞—Ç—Ä–∏–º–∫—É 30 —Å–µ–∫—É–Ω–¥?" icon="i-lucide-clock"}

**A:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ HLS —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑:

```
Encoder (2-4 —Å–µ–∫) +
Segmentation (6-10 —Å–µ–∫) +
CDN propagation (1-3 —Å–µ–∫) +
Player buffer (15-30 —Å–µ–∫)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
= 24-47 —Å–µ–∫—É–Ω–¥
```

**–†—ñ—à–µ–Ω–Ω—è:**

1. –ó–º–µ–Ω—à—ñ—Ç—å segment duration (4 —Å–µ–∫ –∑–∞–º—ñ—Å—Ç—å 10)
2. –ó–º–µ–Ω—à—ñ—Ç—å player buffer (hls.js config: `maxBufferLength: 15`)
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ LL-HLS (Low Latency HLS) ‚Äî –∑–∞—Ç—Ä–∏–º–∫–∞ 2-6 —Å–µ–∫

::

::

---

## 11. –†–µ–∑—é–º–µ —Ç–∞ –ö–ª—é—á–æ–≤—ñ –í–∏—Å–Ω–æ–≤–∫–∏

::card-group

::card{title="üéØ –©–æ —Ç–∞–∫–µ HLS" icon="i-lucide-lightbulb"}

- –ü—Ä–æ—Ç–æ–∫–æ–ª —Å—Ç—Ä—ñ–º—ñ–Ω–≥—É —á–µ—Ä–µ–∑ –∑–≤–∏—á–∞–π–Ω–∏–π HTTP
- –í—ñ–¥–µ–æ –Ω–∞—Ä—ñ–∑–∞—î—Ç—å—Å—è –Ω–∞ –º–∞–ª–µ–Ω—å–∫—ñ —Å–µ–≥–º–µ–Ω—Ç–∏ (2-10 —Å–µ–∫)
- –¢–µ–∫—Å—Ç–æ–≤–∏–π –ø–ª–µ–π–ª—ñ—Å—Ç (.m3u8) –∫–∞–∂–µ –ø–ª–µ—î—Ä—É, —â–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏
- ABR –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±–∏—Ä–∞—î —è–∫—ñ—Å—Ç—å

::

::card{title="üìê –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞" icon="i-lucide-layout"}

1. **Encoder** —Å—Ç–≤–æ—Ä—é—î –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ —è–∫–æ—Å—Ç—ñ
2. **Origin** –∑–±–µ—Ä—ñ–≥–∞—î —Å–µ–≥–º–µ–Ω—Ç–∏
3. **CDN** –∫–µ—à—É—î —Ç–∞ —Ä–æ–∑–¥–∞—î
4. **Player** –≤–∏–º—ñ—Ä—é—î —à–≤–∏–¥–∫—ñ—Å—Ç—å —Ç–∞ –ø–µ—Ä–µ–º–∏–∫–∞—î —è–∫—ñ—Å—Ç—å

::

::card{title="‚öôÔ∏è –Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ HLS" icon="i-lucide-settings"}

```bash
ffmpeg -i input.mp4 \
  -c:v libx264 -c:a aac \
  -f hls -hls_time 6 \
  output.m3u8
```

–î–ª—è –±–∞–≥–∞—Ç–æ—è–∫—ñ—Å–Ω–æ–≥–æ: –∫–æ–¥—É–π—Ç–µ –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ + —Å—Ç–≤–æ—Ä—ñ—Ç—å master.m3u8

::

::card{title="üîê –ë–µ–∑–ø–µ–∫–∞" icon="i-lucide-lock"}

- AES-128 encryption (–±–∞–∑–æ–≤–∏–π –∑–∞—Ö–∏—Å—Ç)
- Signed URLs (token authentication)
- DRM (FairPlay / Widevine) –¥–ª—è premium –∫–æ–Ω—Ç–µ–Ω—Ç—É

::

::

### –ö–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ HLS:

::field-group

::field{name="Segment Duration" type="4-10 seconds"}
–ë–∞–ª–∞–Ω—Å –º—ñ–∂ –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—é —Ç–∞ HTTP overhead.

::

::field{name="Bitrate Ladder" type="5-7 variants"}
–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 360p, 480p, 720p, 1080p, 1080p60.

::

::field{name="Target Buffer" type="30-60 seconds"}
–î–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω—å.

::

::field{name="ABR Safety Margin" type="20%"}
–û–±–∏—Ä–∞—Ç–∏ —è–∫—ñ—Å—Ç—å –Ω–∞ 20% –Ω–∏–∂—á–µ –≤–∏–º—ñ—Ä—è–Ω–æ—ó —à–≤–∏–¥–∫–æ—Å—Ç—ñ.

::

::

---

## 12. –ü–æ–¥–∞–ª—å—à–µ –ù–∞–≤—á–∞–Ω–Ω—è

::card-group

::card{title="üìö –û—Ñ—ñ—Ü—ñ–π–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è" icon="i-lucide-book-open" to="https://developer.apple.com/streaming/" target="\_blank"}

Apple HLS Authoring Specification (RFC 8216)

::

::card{title="üé• –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ —Ç—É—Ç–æ—Ä—ñ–∞–ª–∏" icon="i-lucide-youtube" to="https://www.youtube.com/results?search_query=HLS+streaming+tutorial" target="\_blank"}

YouTube —Ç—É—Ç–æ—Ä—ñ–∞–ª–∏ –ø–æ FFmpeg —Ç–∞ HLS

::

::card{title="üß™ –¢–µ—Å—Ç–æ–≤—ñ —Å—Ç—Ä—ñ–º–∏" icon="i-lucide-flask" to="https://test-streams.mux.dev/" target="\_blank"}

–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ HLS —Å—Ç—Ä—ñ–º–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

::

::card{title="üí¨ –°–ø—ñ–ª—å–Ω–æ—Ç–∞" icon="i-lucide-users" to="https://video.stackexchange.com/" target="\_blank"}

Stack Exchange: Video Production

::

::

---

::tip{icon="i-lucide-trophy"}
**–í—ñ—Ç–∞—î–º–æ!** –í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≥–ª–∏–±–æ–∫–µ –∑–∞–Ω—É—Ä–µ–Ω–Ω—è –≤ HLS Protocol. –¢–µ–ø–µ—Ä –≤–∏ —Ä–æ–∑—É–º—ñ—î—Ç–µ:

- –Ø–∫ YouTube –ø–µ—Ä–µ–º–∏–∫–∞—î —è–∫—ñ—Å—Ç—å –±–µ–∑ –∑–∞–≤–∏—Å–∞–Ω—å
- –ß–æ–º—É Netflix –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î DASH, –∞ Twitch ‚Äî HLS
- –Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤–ª–∞—Å–Ω–∏–π —Å—Ç—Ä—ñ–º—ñ–Ω–≥-—Å–µ—Ä–≤—ñ—Å

**–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫:** –í–∏–≤—á—ñ—Ç—å [DASH Protocol](./05.dash-protocol.md) –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∞–±–æ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ [CDN Architecture](./07.cdn-architecture.md) –¥–ª—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è.
::
