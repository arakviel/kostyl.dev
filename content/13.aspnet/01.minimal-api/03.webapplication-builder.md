---
title: WebApplication, Builder —Ç–∞ Dependency Injection
description: –ì–ª–∏–±–∏–Ω–Ω–∏–π —Ä–æ–∑–±—ñ—Ä –ø–∞—Ç–µ—Ä–Ω—É Builder –≤ ASP.NET Core, —Ä–æ–∑—É–º—ñ–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ Dependency Injection, –º–µ—Ç–æ–¥—ñ–≤ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ç–∞ –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É –¥–æ–¥–∞—Ç–∫–∞.
---

# WebApplication, Builder —Ç–∞ –§—ñ–ª–æ—Å–æ—Ñ—ñ—è Dependency Injection

::note
**–ü—Ä–∏–º—ñ—Ç–∫–∞ –¥–ª—è —á–∏—Ç–∞—á–∞**: –Ø–∫—â–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –º–æ–¥—É–ª—ñ –±—É–ª–∏ –≤—Å—Ç—É–ø–æ–º –¥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É —ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏, —Ü–µ–π –º–æ–¥—É–ª—å —î —ñ–Ω—ñ—Ü—ñ–∞—Ü—ñ—î—é –≤ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∏. –ú–∏ —Ä–æ–∑–±–µ—Ä–µ–º–æ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à—É –∫–æ–Ω—Ü–µ–ø—Ü—ñ—é —Å—É—á–∞—Å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è ‚Äî Dependency Injection (–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –ó–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π). –ú–∏ –∑–∞–≥–ª—è–Ω–µ–º–æ –ø—ñ–¥ –∫–∞–ø–æ—Ç `WebApplicationBuilder` —ñ –¥—ñ–∑–Ω–∞—î–º–æ—Å—è, —è–∫ –≤—ñ–Ω –∫–µ—Ä—É—î –≤—Å—ñ–º –∂–∏—Ç—Ç—è–º –≤–∞—à–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É.
::

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç: –ü–∞—Ç–µ—Ä–Ω Builder —Ç–∞ –π–æ–≥–æ –º–µ—Ç–∞

–ó–≥–∞–¥–∞–π—Ç–µ –Ω–∞—à 4-—Ä—è–¥–∫–æ–≤–∏–π `Program.cs`:

```csharp
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
app.MapGet("/", () => "Hello, World!");
app.Run();
```

–ß–æ–º—É –º–∏ –Ω–µ —Å—Ç–≤–æ—Ä—é—î–º–æ –¥–æ–¥–∞—Ç–æ–∫ –ø—Ä–æ—Å—Ç–æ —è–∫ `new WebApplication()`?
ASP.NET Core ‚Äî —Ü–µ –≥—ñ–≥–∞–Ω—Ç—Å—å–∫–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º. –í—ñ–Ω –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω–∏–π –ø–∞—Ä—Å–µ—Ä –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π (JSON, XML, Environment Variables), —Å–∏—Å—Ç–µ–º—É –ª–æ–≥—É–≤–∞–Ω–Ω—è, —Å–∏—Å—Ç–µ–º—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó, CORS, —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–æ—â–æ. –Ø–∫—â–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–ª–∞—Å `WebApplication` –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –≤—ñ–Ω –º–∞–≤ –±–∏ —Ç–∏—Å—è—á—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤. –¶–µ –≤—ñ–¥–æ–º–∏–π –∞–Ω—Ç–∏–ø–∞—Ç–µ—Ä–Ω "Telescoping Constructor".

–ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å **–ü–∞—Ç–µ—Ä–Ω Builder (–ë—É–¥—ñ–≤–µ–ª—å–Ω–∏–∫)**.
–í–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ "–ø–æ—Ä–æ–∂–Ω—ñ–π –∞—Ä–∫—É—à" –±—É–¥—ñ–≤–µ–ª—å–Ω–∏–∫–∞ (`builder`), –Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç–µ –≤—Å–µ, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ (–¥–æ–¥–∞—î—Ç–µ —Å–µ—Ä–≤—ñ—Å–∏, –∑–º—ñ–Ω—é—î—Ç–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è), –∞ –ø–æ—Ç—ñ–º –∫–∞–∂–µ—Ç–µ "–ø–æ–±—É–¥—É–π!" (`Build()`). –ü—ñ—Å–ª—è –≤–∏–∫–ª–∏–∫—É `Build()` –¥–æ–¥–∞—Ç–æ–∫ —Å—Ç–∞—î _–Ω–µ–∑–º—ñ–Ω–Ω–∏–º (immutable)_ —â–æ–¥–æ —Å–≤–æ—ó—Ö –±–∞–∑–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤. –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –ø—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏ —Ç–∏—Å—è—á –∑–∞–ø–∏—Ç—ñ–≤.

::field-group
::field{name="WebApplicationBuilder" type="Class"}
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:**
–ö–ª–∞—Å, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ `WebApplication`. –ú—ñ—Å—Ç–∏—Ç—å –ø'—è—Ç—å –≥–æ–ª–æ–≤–Ω–∏—Ö –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ —Ö–æ—Å—Ç–∞:

- `Services` (`IServiceCollection`) - —ñ–Ω'—î–∫—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
- `Configuration` (`ConfigurationManager`) - –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- `Environment` (`IWebHostEnvironment`) - —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- `Logging` (`ILoggingBuilder`) - —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ª–æ–≥–∞–º–∏
- `Host` / `WebHost` - –Ω–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

::
::

## 2. –ì–ª–∏–±–∏–Ω–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞: –¢—ñ—Å–Ω–∞ –∑–≤'—è–∑–Ω—ñ—Å—Ç—å (Tight Coupling)

–©–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å `builder.Services`, –º–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑—Ä–æ–±–∏—Ç–∏ –∫—Ä–æ–∫ –Ω–∞–∑–∞–¥ —ñ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è –Ω–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É –ø—Ä–æ–±–ª–µ–º—É –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è: **–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ**.

–£—è–≤—ñ—Ç—å, —â–æ –≤–∏ –ø–∏—à–µ—Ç–µ –¥–æ–¥–∞—Ç–æ–∫, —è–∫–∏–π –ø—Ä–∞—Ü—é—î –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î email'–∏.

::code-collapse{title="–ê–Ω—Ç–∏–ø–∞—Ç–µ—Ä–Ω: –¢—ñ—Å–Ω–∞ –ó–≤'—è–∑–Ω—ñ—Å—Ç—å" defaultOpen="false"}

```csharp
public class OrderService
{
    private SqlDatabase _db;
    private SmtpEmailSender _emailSender;

    public OrderService()
    {
        // –ü–†–û–ë–õ–ï–ú–ê –¢–£–¢! OrderService —Å–∞–º —Å—Ç–≤–æ—Ä—é—î —Å–≤–æ—ó –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
        _db = new SqlDatabase("Server=myServer;Database=myDataBase;");
        _emailSender = new SmtpEmailSender("smtp.gmail.com");
    }

    public void ProcessOrder(Order order)
    {
        _db.Save(order);
        _emailSender.Send(order.CustomerEmail, "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ");
    }
}
```

::

### –ß–æ–º—É —Ü–µ–π –∫–æ–¥ –∂–∞—Ö–ª–∏–≤–∏–π?

1. **–ù–µ–º–æ–∂–ª–∏–≤–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ (No Unit Tests)**. –Ø–∫—â–æ –≤–∏ –∑–∞—Ö–æ—á–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É `OrderService`, –≤—ñ–Ω _–∑–∞–≤–∂–¥–∏_ –Ω–∞–º–∞–≥–∞—Ç–∏–º–µ—Ç—å—Å—è –ø–∏—Å–∞—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω—É `SqlDatabase` —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ —Ä–µ–∞–ª—å–Ω–∏–π email. –í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø—ñ–¥—Å—É–Ω—É—Ç–∏ –π–æ–º—É "—Ñ–µ–π–∫–æ–≤—É" (mock) –±–∞–∑—É.
2. **–ù—É–ª—å–æ–≤–∞ –≥–Ω—É—á–∫—ñ—Å—Ç—å**. –Ø–∫—â–æ –≤–∏ –≤–∏—Ä—ñ—à–∏—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ `SqlDatabase` –Ω–∞ `MongoDatabase`, –∞–±–æ `SmtpEmailSender` –Ω–∞ `SendGridEmailSender`, –≤–∞–º –¥–æ–≤–µ–¥–µ—Ç—å—Å—è –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞—Ç–∏ –∫–ª–∞—Å `OrderService`. –ê —â–æ, —è–∫ —Ü–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ 500?
3. **–í–∏—Ç–æ–∫ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ–π**. `OrderService` (—è–∫–∏–π –∑–∞–π–º–∞—î—Ç—å—Å—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–æ—é) –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –∑–Ω–∞—Ç–∏ —Ä—è–¥–∫–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è (Connection Strings) –∞–±–æ –∞–¥—Ä–µ—Å–∏ —Å–µ—Ä–≤–µ—Ä—ñ–≤ —Ä–æ–∑—Å–∏–ª–∫–∏.

–°–≤—è—â–µ–Ω–Ω–∏–π –≥—Ä–∞–∞–ª—å –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏: **SOLID** (–∑–æ–∫—Ä–µ–º–∞ –±—É–∫–≤–∞ **D** - Dependency Inversion). –ö–ª–∞—Å–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–ª–µ–∂–∞—Ç–∏ –≤—ñ–¥ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ–π (—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤), –∞ –Ω–µ –≤—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π.

---

## 3. Inversion of Control (IoC) —Ç–∞ –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –ó–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (DI)

–ú–∏ –≤–∏—Ä—ñ—à—É—î–º–æ –ø—Ä–æ–±–ª–µ–º—É –≤–∏—â–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **Dependency Injection** (–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π).

::code-group

```csharp [–ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤]
public interface IDatabase { void Save(Order order); }
public interface IEmailSender { void Send(string to, string text); }

// –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó
public class SqlDatabase : IDatabase { ... }
public class SmtpEmailSender : IEmailSender { ... }
```

```csharp [–ö—Ä–æ–∫ 2: –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä]
public class OrderService
{
    private readonly IDatabase _db;
    private readonly IEmailSender _emailSender;

    // OrderService –±—ñ–ª—å—à–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∫–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ 'new'!
    // –í—ñ–Ω –ü–†–û–°–ò–¢–¨ –¥–∞—Ç–∏ –π–æ–º—É –≥–æ—Ç–æ–≤—ñ –æ–±'—î–∫—Ç–∏.
    public OrderService(IDatabase db, IEmailSender emailSender)
    {
        _db = db;
        _emailSender = emailSender;
    }

    public void ProcessOrder(Order order)
    {
        _db.Save(order);
        _emailSender.Send(order.CustomerEmail, "Success");
    }
}
```

::

–¢–µ–ø–µ—Ä `OrderService` —á–∏—Å—Ç–∏–π, —ñ–¥–µ–∞–ª—å–Ω–æ —Ç–µ—Å—Ç—É—î—Ç—å—Å—è —ñ –≥–Ω—É—á–∫–∏–π. –ê–ª–µ –≤–∏–Ω–∏–∫–∞—î —ñ–Ω—à–∞ –ø—Ä–æ–±–ª–µ–º–∞: **—Ö—Ç–æ** —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏–º–µ —ñ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏–º–µ —Ü—ñ –æ–±'—î–∫—Ç–∏ (`db` —ñ `email`) –≤—Å–µ—Ä–µ–¥–∏–Ω—É `OrderService`? –Ø–∫—â–æ —Ü–µ —Ä–æ–±–∏—Ç–∏ –≤—Ä—É—á–Ω—É, —Ü–µ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç—å—Å—è –Ω–∞ —Ö–∞–æ—Å.

–°–∞–º–µ —Ç—É—Ç –Ω–∞ –∞—Ä–µ–Ω—É –≤–∏—Ö–æ–¥–∏—Ç—å **ASP.NET Core DI Container** (IoC –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä) ‚Äî —Ü–µ —Ñ–∞–±—Ä–∏–∫–∞ –æ–±'—î–∫—Ç—ñ–≤. –¶–µ —ñ —î –Ω–∞—à `builder.Services`.

–í–∏ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –ø–æ—á–∞—Ç–∫—É –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É —Ä–µ—î—Å—Ç—Ä—É—î—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è: "–ì–µ–π, –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ! –Ø–∫—â–æ —Ö—Ç–æ—Å—å –ø–æ–ø—Ä–æ—Å–∏—Ç—å `IDatabase`, –¥–∞–π –π–æ–º—É –µ–∫–∑–µ–º–ø–ª—è—Ä `SqlDatabase`". –ê —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –æ–±'—î–∫—Ç —ñ "–≤–ø–æ—Ä—Å–Ω–µ" (inject) –π–æ–≥–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `OrderService`.

---

## 4. builder.Services: –ö–æ–ª–µ–∫—Ü—ñ—è –°–µ—Ä–≤—ñ—Å—ñ–≤ (`IServiceCollection`)

–ó–∞–∑–∏—Ä–Ω—ñ—Ç—å —É –Ω–∞—à –±—É–¥—ñ–≤–µ–ª—å–Ω–∏–∫:

```csharp
var builder = WebApplication.CreateBuilder(args);

// –†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø –°–ï–†–í–Ü–°–Ü–í!
builder.Services.AddTransient<IDatabase, SqlDatabase>();
builder.Services.AddSingleton<IEmailSender, SmtpEmailSender>();
builder.Services.AddScoped<OrderService>();
```

::field-group
::field{name="IServiceCollection" type="Interface"}
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:**
–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Å–æ–±–æ—é –∫–æ–ª–µ–∫—Ü—ñ—é –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ñ–≤ —Å–µ—Ä–≤—ñ—Å—ñ–≤ (`ServiceDescriptor`).
–¶—è –∫–æ–ª–µ–∫—Ü—ñ—è –∑–±–∏—Ä–∞—î –≤—Å—ñ "—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó", —è–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –æ–±'—î–∫—Ç–∏. –ö–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è `builder.Build()`, —Ü—è –∫–æ–ª–µ–∫—Ü—ñ—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î—Ç—å—Å—è —É –Ω–µ–∑–º—ñ–Ω–Ω–∏–π —Ñ–∞–±—Ä–∏—á–Ω–∏–π –æ–±'—î–∫—Ç `IServiceProvider`, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è ASP.NET –¥–ª—è –ø–æ–¥–∞—á—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –Ω–∞ –∑–∞–ø–∏—Ç.
::
::field-group

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ —Å–ª–æ–≤–∞ `AddTransient`, `AddSingleton`, `AddScoped`. –¶–µ **–ñ–∏—Ç—Ç—î–≤—ñ –¶–∏–∫–ª–∏ (Lifetimes)** –æ–±'—î–∫—Ç—ñ–≤. –¶–µ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∞ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—è, —è–∫—É –≤–∏ –º–∞—î—Ç–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –≤ ASP.NET.

### 4.1. Singleton (–Ñ–¥–∏–Ω–∏–π)

```csharp
builder.Services.AddSingleton<IEmailSender, SmtpEmailSender>();
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–≤–æ—Ä—é—î –æ–±'—î–∫—Ç –†–Ü–í–ù–û –û–î–ò–ù –†–ê–ó –∑–∞ –≤–µ—Å—å —á–∞—Å —Ä–æ–±–æ—Ç–∏ —Å–µ—Ä–≤–µ—Ä—É. –ö–æ–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –ø–µ—Ä—à–∏–π –∑–∞–ø–∏—Ç —ñ –ø—Ä–æ—Å–∏—Ç—å `IEmailSender`, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–≤–æ—Ä—é—î –π–æ–≥–æ —ñ –∑–±–µ—Ä—ñ–≥–∞—î –≤ –ø–∞–º'—è—Ç—ñ. –í—Å—ñ –Ω–∞—Å—Ç—É–ø–Ω—ñ –º—ñ–ª—å–π–æ–Ω–∏ –∑–∞–ø–∏—Ç—ñ–≤ –±—É–¥—É—Ç—å –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ **—Ü–µ–π —Å–∞–º–∏–π** –æ–±'—î–∫—Ç –∑ –ø–∞–º'—è—Ç—ñ.

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:** –ö–µ—à—É–≤–∞–Ω–Ω—è –≤ –ø–∞–º'—è—Ç—ñ (In-Memory Cache), –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É, —Å–µ—Ä–≤—ñ—Å–∏-—É—Ç–∏–ª—ñ—Ç–∏, —è–∫—ñ –Ω–µ –º–∞—é—Ç—å –∑–º—ñ–Ω–Ω–æ–≥–æ —Å—Ç–∞–Ω—É (stateless).

> [!WARNING]
> –Ø–∫—â–æ –≤–∏ –∑–±–µ—Ä–µ–∂–µ—Ç–µ –∑–º—ñ–Ω–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Singleton, –≤—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∞–π—Ç—É –∑–º–æ–∂—É—Ç—å —ó—Ö –ø–æ–±–∞—á–∏—Ç–∏! –£–Ω–∏–∫–∞–π—Ç–µ —Ç–∞–º –¥–∞–Ω–∏—Ö, –ø—Ä–∏–≤'—è–∑–∞–Ω–∏—Ö –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞.

### 4.2. Transient (–¢—Ä–∞–Ω–∑–∏—Ç–Ω–∏–π / –ö–æ—Ä–æ—Ç–∫–æ—Å—Ç—Ä–æ–∫–æ–≤–∏–π)

```csharp
builder.Services.AddTransient<IRandomNumberGenerator, RandomNumberGenerator>();
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î:** –ö–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –±—É–¥—å-—è–∫–∏–π –æ–±'—î–∫—Ç –ø—Ä–æ—Å–∏—Ç—å —Ü—é –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–≤–æ—Ä—é—î **–ù–û–í–ò–ô** –µ–∫–∑–µ–º–ø–ª—è—Ä. –Ø–∫—â–æ `ControllerA` —ñ `ServiceB` –ø—Ä–æ—Å—è—Ç—å –π–æ–≥–æ –ø—Ä–æ—Ç—è–≥–æ–º –æ–¥–Ω–æ–≥–æ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–≥–æ –∑–∞–ø–∏—Ç—É, –≤–æ–Ω–∏ –æ—Ç—Ä–∏–º–∞—é—Ç—å _–¥–≤–∞ —Ä—ñ–∑–Ω—ñ_ –æ–±'—î–∫—Ç–∏ –≤ –ø–∞–º'—è—Ç—ñ.

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:** –õ–µ–≥–∫—ñ –∫–ª–∞—Å–∏ –±–µ–∑ —Å—Ç–∞–Ω—É (Math Helpers). –í–æ–Ω–∏ —à–≤–∏–¥–∫–æ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è Garbage Collector-–æ–º –∑ –ø–∞–º'—è—Ç—ñ (Gen 0).

### 4.3. Scoped (–í –º–µ–∂–∞—Ö –∑–∞–ø–∏—Ç—É) - –ù–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏–π!

```csharp
builder.Services.AddScoped<IDatabase, SqlDatabase>();
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î:** –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –†–ê–ó –Ω–∞ –∫–æ–∂–µ–Ω HTTP-–∑–∞–ø–∏—Ç. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á A –∫–ª—ñ–∫–∞—î –∫–Ω–æ–ø–∫—É –Ω–∞ —Å–∞–π—Ç—ñ -> —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π `HttpContext`. –î–ª—è —Ü—å–æ–≥–æ —ñ –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –æ–¥–∏–Ω –µ–∫–∑–µ–º–ø–ª—è—Ä `SqlDatabase`. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á B –∫–ª—ñ–∫–∞—î –∫–Ω–æ–ø–∫—É —Å–µ–∫—É–Ω–¥–æ—é –ø—ñ–∑–Ω—ñ—à–µ -> –¥–ª—è –Ω—å–æ–≥–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —Å–≤—ñ–π –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–π –æ–±'—î–∫—Ç. –ê–ª–µ —è–∫—â–æ –ø—ñ–¥ —á–∞—Å –æ–±—Ä–æ–±–∫–∏ –ó–∞–ø–∏—Ç—É A —Ç—Ä–∏ —Ä—ñ–∑–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å–∏ –ø—Ä–æ—Å—è—Ç—å –ë–î, –≤–æ–Ω–∏ –æ—Ç—Ä–∏–º–∞—é—Ç—å _—Ç–æ—é —Å–∞–º–∏–π_ –æ–±'—î–∫—Ç. –¶–µ –≥–µ–Ω—ñ–∞–ª—å–Ω–æ –¥–ª—è –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π!

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:** –ú–∞–π–∂–µ –≤—Å—è –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (Entity Framework `DbContext`), —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

::plant-uml
@startuml
skinparam handwritten true
title –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ñ–∏—Ç—Ç—î–≤–∏—Ö –¶–∏–∫–ª—ñ–≤ (Lifetimes)

participant "Client A Request" as ReqA
participant "Client B Request" as ReqB

database "Singleton" as Singleton #Red
database "Scoped (ReqA)" as ScopedA #Blue
database "Scoped (ReqB)" as ScopedB #Blue
database "Transient" as Transient #Green

ReqA -> Singleton : –ó–∞–≤–∂–¥–∏ –û–î–ò–ù –µ–∫–∑–µ–º–ø–ª—è—Ä
ReqA -> ScopedA : –û–¥–∏–Ω –Ω–∞ –∑–∞–ø–∏—Ç
ReqA -> Transient : –ö–æ–∂–µ–Ω —Ä–∞–∑ –ù–û–í–ò–ô (T1, T2)

ReqB -> Singleton : –ó–∞–≤–∂–¥–∏ –û–î–ò–ù –µ–∫–∑–µ–º–ø–ª—è—Ä
ReqB -> ScopedB : –û–¥–∏–Ω –Ω–∞ –∑–∞–ø–∏—Ç (–ù–æ–≤–∏–π –¥–ª—è ReqB)
ReqB -> Transient : –ö–æ–∂–µ–Ω —Ä–∞–∑ –ù–û–í–ò–ô (T3, T4)

@enduml
::

---

## 5. –ê–Ω–∞—Ç–æ–º—ñ—è –ú–µ—Ç–æ–¥—ñ–≤ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è (Extension Methods)

–ß–∞—Å—Ç–æ, —á–∏—Ç–∞—é—á–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é Microsoft, –≤–∏ –±–∞—á–∏—Ç–µ –∫–æ–¥ —Ç–∏–ø—É:

```csharp
builder.Services.AddControllers();
builder.Services.AddSwaggerGen();
```

–©–æ —Ü–µ –∑–∞ –º–∞–≥—ñ—á–Ω—ñ –º–µ—Ç–æ–¥–∏ `AddControllers`? –í–∏ –Ω–µ –∑–Ω–∞–π–¥–µ—Ç–µ —ó—Ö –≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ `IServiceCollection`.
–¶–µ ‚Äî **–ú–µ—Ç–æ–¥–∏ –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è (Extension Methods)**.

–£ .NET —î —Å–æ—Ç–Ω—ñ —Å–µ—Ä–≤—ñ—Å—ñ–≤ –¥–ª—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Swagger, Entity Framework —á–∏ Identity. –Ø–∫–±–∏ –º–∏ —Ä–µ—î—Å—Ç—Ä—É–≤–∞–ª–∏ –∫–æ–∂–µ–Ω —Å–µ—Ä–≤—ñ—Å –≤—Ä—É—á–Ω—É, –Ω–∞—à `Program.cs` –≤–∏–≥–ª—è–¥–∞–≤ –±–∏ –∂–∞—Ö–ª–∏–≤–æ:

::code-collapse{title="–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Swagger –±–µ–∑ –º–µ—Ç–æ–¥—ñ–≤ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è (–ê–Ω—Ç–∏–ø–∞—Ç–µ—Ä–Ω)" defaultOpen="false"}

```csharp
builder.Services.AddTransient<ISwaggerProvider, SwaggerGenerator>();
builder.Services.AddTransient<ISchemaGenerator, DefaultSchemaGenerator>();
builder.Services.AddTransient<IApiDescriptionGroupCollectionProvider, ApiDescriptionGroupCollectionProvider>();
// ...—ñ —â–µ 30 —Ä—è–¥–∫—ñ–≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –ª–∏—à–µ –¥–ª—è Swagger
```

::

–©–æ–± —Å—Ö–æ–≤–∞—Ç–∏ —Ü–µ–π –∂–∞—Ö, —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫ –ø–∏—à—É—Ç—å –º–µ—Ç–æ–¥–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è. –¶–µ –∑–≤–∏—á–∞–π–Ω—ñ —Å—Ç–∞—Ü—ñ–æ–Ω–∞—Ä–Ω—ñ –º–µ—Ç–æ–¥–∏, —è–∫—ñ "–ø—Ä–∏–∫–ª–µ—é—é—Ç—å—Å—è" –¥–æ –æ–±'—î–∫—Ç–∞ `IServiceCollection`.

### –Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤–ª–∞—Å–Ω–∏–π Extension Method?

–ö–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ `this` –ø–µ—Ä–µ–¥ –ø–µ—Ä—à–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º!

```csharp
// –û–∫—Ä–µ–º–∏–π —Ñ–∞–π–ª: MyDependenciesExtension.cs
public static class MyDependenciesExtension
{
    public static IServiceCollection AddMyBusinessLogic(this IServiceCollection services)
    {
        // –•–æ–≤–∞—î–º–æ –≤—Å—é —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —Ç—É—Ç
        services.AddScoped<IOrderService, OrderService>();
        services.AddScoped<IPaymentGateway, StripePaymentGateway>();
        services.AddTransient<IEmailSender, SmtpEmailSender>();

        return services; // –û–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ "–ª–∞–Ω—Ü—é–≥–∞" –≤–∏–∫–ª–∏–∫—ñ–≤
    }
}
```

–¢–µ–ø–µ—Ä –Ω–∞—à `Program.cs` —Å—Ç–∞—î –Ω–µ–π–º–æ–≤—ñ—Ä–Ω–æ –∫—Ä–∞—Å–∏–≤–∏–º, —á–∏—Å—Ç–∏–º –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∏–º —à–µ–¥–µ–≤—Ä–æ–º:

```csharp
var builder = WebApplication.CreateBuilder(args);

// –í–∏–∫–ª–∏–∫–∞—î–º–æ –Ω–∞—à –≤–ª–∞—Å–Ω–∏–π –º–µ—Ç–æ–¥ "–∑–±—ñ—Ä–∫–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π"
builder.Services.AddMyBusinessLogic();

var app = builder.Build();
```

–¶–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è "–ó–±—ñ—Ä–∫–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π —É –º–æ–¥—É–ª—ñ". –í–µ–ª–∏–∫—ñ –ø—Ä–æ–µ–∫—Ç–∏ (Clean Architecture) –º–∞—é—Ç—å –±–∞–≥–∞—Ç–æ —Ç–∞–∫–∏—Ö –º–µ—Ç–æ–¥—ñ–≤-—Ä–æ–∑—à–∏—Ä–µ–Ω—å –¥–ª—è —ñ–∑–æ–ª—è—Ü—ñ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `AddInfrastructure`, `AddApplication`). –¶–µ —î –≥–∞–ª—É–∑–µ–≤–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º —É —Å—É—á–∞—Å–Ω–æ–º—É .NET.

---

## 6. –Ü–Ω—à—ñ –ü–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–Ω—è `WebApplicationBuilder`

–û–∫—Ä—ñ–º –°–µ—Ä–≤—ñ—Å—ñ–≤, Builder –∫–µ—Ä—É—î –≥–ª–æ–±–∞–ª—å–Ω–∏–º–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ –¥–æ–¥–∞—Ç–∫—É –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ –≤—ñ–Ω —Å–∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è.

### 6.1. –ì–ª–æ–±–∞–ª—å–Ω–∞ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (`builder.Configuration`)

–†–∞–Ω—ñ—à–µ –º–∏ –±–∞—á–∏–ª–∏ —Ñ–∞–π–ª `appsettings.json`. –•—Ç–æ –π–æ–≥–æ —á–∏—Ç–∞—î? Builder! –í—ñ–Ω —Ä–æ–±–∏—Ç—å —Ü–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–ª–∏–∫—É `WebApplication.CreateBuilder(args)`.

–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤ ASP.NET Core ‚Äî —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ —Ñ–∞–π–ª—É. –¶–µ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π —à–µ–¥–µ–≤—Ä, –∑–∞—Å–Ω–æ–≤–∞–Ω–∏–π –Ω–∞ **–®–∞—Ä–∞—Ö –ü–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è (Hierarchy of Configuration Providers)**.

#### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞—Ö–∞—Ä–¥–∫–æ–¥–∂–µ–Ω—ñ —Å–µ–∫—Ä–µ—Ç–∏

–£—è–≤—ñ—Ç—å, —â–æ –≤–∏ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç–µ—Å—å –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∞–±–æ —ñ–Ω—Ç–µ–≥—Ä—É—î—Ç–µ Stripe –¥–ª—è –ø–ª–∞—Ç–µ–∂—ñ–≤. –í–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–∞—Ä–æ–ª—å –∞–±–æ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π API –∫–ª—é—á.

::code-collapse{title="–ê–Ω—Ç–∏–ø–∞—Ç–µ—Ä–Ω: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ —É –∫–æ–¥—ñ –∞–±–æ –±–∞–∑–æ–≤–æ–º—É JSON" defaultOpen="false"}

```json [appsettings.json]
{
    "ConnectionStrings": {
        "DefaultConnection": "Server=myServer;User Id=arakviel;Password=SuperSecretPassword123!"
    },
    "Stripe": {
        "ApiKey": "sk_live_verySecretKey"
    }
}
```

::

–Ø–∫—â–æ –≤–∏ –∑–∞–∫–æ–º—ñ—Ç–∏—Ç–µ —Ç–∞–∫–∏–π `appsettings.json` —É GitHub, –±–æ—Ç–∏ –∑–Ω–∞–π–¥—É—Ç—å –≤–∞—à –∫–ª—é—á Stripe –∑–∞ 5 —Å–µ–∫—É–Ω–¥ —ñ –ø–æ—á–Ω—É—Ç—å –∑–Ω—ñ–º–∞—Ç–∏ –≥—Ä–æ—à—ñ –∑ –≤–∞—à–æ–≥–æ —Ä–∞—Ö—É–Ω–∫—É. –ë–∞–∑–æ–≤–∏–π `appsettings.json` –π–¥–µ —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π, —Ç–æ–º—É –≤—ñ–Ω **–Ω—ñ–∫–æ–ª–∏** –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ —Ä–µ–∞–ª—å–Ω–∏—Ö —Å–µ–∫—Ä–µ—Ç—ñ–≤. –õ–∏—à–µ –ø–æ—Ä–æ–∂–Ω—ñ —à–∞–±–ª–æ–Ω–∏ –∞–±–æ –±–µ–∑–ø–µ—á–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `LogLevel: Warning`).

#### –†—ñ—à–µ–Ω–Ω—è: Configuration Providers (–î–∂–µ—Ä–µ–ª–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó)

ASP.NET Core —Å—Ç–≤–æ—Ä—é—î —Ç–∞–∫ –∑–≤–∞–Ω–∏–π `IConfiguration` –æ–±'—î–∫—Ç, —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∫–ª–µ—é—î –¥–∞–Ω—ñ –∑ —Ä—ñ–∑–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª.
–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `WebApplication.CreateBuilder(args)` –Ω–∞–ª–∞—à—Ç–æ–≤—É—î –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è –≤ —Ç–∞–∫–æ–º—É —Ç–æ—á–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É (–∫–æ–∂–µ–Ω –Ω–∞—Å—Ç—É–ø–Ω–∏–π –ø—É–Ω–∫—Ç **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î** –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ):

1. **`appsettings.json`**: –ë–∞–∑–æ–≤—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–∫–æ–º—ñ—Ç—è—Ç—å—Å—è –≤ Git).
2. **`appsettings.{Environment}.json`**: –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –¥–ª—è —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `appsettings.Development.json`).
3. **User Secrets (–°–µ–∫—Ä–µ—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞)**: –°–ø–µ—Ü—ñ–∞–ª—å–Ω–µ —Å—Ö–æ–≤–∏—â–µ –Ω–∞ –≤–∞—à–æ–º—É –∫–æ–º–ø'—é—Ç–µ—Ä—ñ, —è–∫–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è _–ø–æ–∑–∞_ –ø–∞–ø–∫–æ—é –≤–∞—à–æ–≥–æ –∫–æ–¥—É (—Ç–æ–±—Ç–æ git –π–æ–≥–æ –Ω–µ –ø–æ–±–∞—á–∏—Ç—å). –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ –ø—ñ–¥ —á–∞—Å —Ä–æ–∑—Ä–æ–±–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ).
4. **Environment Variables (–ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –û–°)**: –ö–ª—é—á–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –¥–µ–ø–ª–æ—é (Docker, Linux —Å–µ—Ä–≤–µ—Ä–∏, AWS).
5. **Command-line arguments (`args`)**: –¢–µ, —â–æ –≤–∏ –ø–µ—Ä–µ–¥–∞—î—Ç–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–≥—Ä–∞–º–∏ –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `dotnet run --urls=http://localhost:8080`).

::tip
**–ê–Ω–∞–ª–æ–≥—ñ—è: –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞**
–ü–æ–¥—É–º–∞–π—Ç–µ –ø—Ä–æ —Ü–µ —è–∫ –ø—Ä–æ –∑–∞–∫–æ–Ω–∏ –≤ –¥–µ—Ä–∂–∞–≤—ñ.

1. `appsettings.json` ‚Äî —Ü–µ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü—ñ—è –∫—Ä–∞—ó–Ω–∏ (–≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –≤—Å—ñ—Ö).
2. `Environment Variables` ‚Äî —Ü–µ —Ä–æ–∑–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è –º–µ—Ä–∞ –≤–∞—à–æ–≥–æ –º—ñ—Å—Ç–∞ (–ø–µ—Ä–µ–∫—Ä–∏–≤–∞—î –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü—ñ—é –≤ –ø–µ–≤–Ω–∏—Ö –ª–æ–∫–∞–ª—å–Ω–∏—Ö –ø–∏—Ç–∞–Ω–Ω—è—Ö –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞).
3. `Command-line args` ‚Äî —Ü–µ –ø—Ä—è–º–∏–π –Ω–∞–∫–∞–∑ –≤—ñ–¥ –ø–æ–ª—ñ—Ü–µ–π—Å—å–∫–æ–≥–æ –Ω–∞ –≤—É–ª–∏—Ü—ñ (–Ω–∞–π–≤–∏—â–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑).

–ó–∞–≤–¥—è–∫–∏ —Ü—å–æ–º—É –≤–∞–º _–Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º—ñ–Ω—è—Ç–∏ –∫–æ–¥_, —â–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—ñ! –î–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–æ—Å—Ç–æ –∑–∞–¥–∞—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω—É –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.
::

#### –Ø–∫ —á–∏—Ç–∞—Ç–∏ —Ü—ñ –¥–∞–Ω—ñ?

–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–±–∏—Ä–∞—î—Ç—å—Å—è —É –≤–µ–ª–∏–∫–∏–π "—Å–ª–æ–≤–Ω–∏–∫" (Key-Value), –¥–æ—Å—Ç—É–ø –¥–æ —è–∫–æ–≥–æ –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —î–¥–∏–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –Ü—î—Ä–∞—Ä—Ö—ñ—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Stripe -> ApiKey`) –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –¥–≤–æ–∫—Ä–∞–ø–∫—É `:`:

```csharp
var builder = WebApplication.CreateBuilder(args);

// –ß–∏—Ç–∞–Ω–Ω—è —Ä—è–¥–∫–∞ –¥–ª—è Stripe
string stripeKey = builder.Configuration["Stripe:ApiKey"];

// –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —à–æ—Ä—Ç–∫–∞—Ç –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î (—á–∏—Ç–∞—î –∑ –±–ª–æ–∫—É "ConnectionStrings")
string dbString = builder.Configuration.GetConnectionString("DefaultConnection");

app.MapGet("/", () => $"Stripe Key is: {stripeKey ?? "Not Found"}");

app.Run();
```

–ö–æ–ª–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î —Ü–µ–π –∫–æ–¥, ASP.NET Core –Ω–µ —Ö–≤–∏–ª—é—î, _–∑–≤—ñ–¥–∫–∏_ –ø—Ä–∏–π—à–æ–≤ `Stripe:ApiKey`. –í—ñ–Ω –º—ñ–≥ –±—É—Ç–∏ –≤ JSON, –∞–±–æ –≤ –∑–º—ñ–Ω–Ω—ñ–π —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ Linux `export Stripe__ApiKey=sk_live_...` (–≤ Linux –∑–∞–º—ñ—Å—Ç—å `:` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `__`), –∞–±–æ –≤ User Secrets. –ö–æ–¥ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–µ–∑–º—ñ–Ω–Ω–∏–º!

#### –ü–∞—Ç–µ—Ä–Ω –ì–ª–∏–±–æ–∫–æ—ó –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (Options Pattern)

–î–ª—è –≤–µ–ª–∏–∫–∏—Ö –ø—Ä–æ—î–∫—Ç—ñ–≤ —á–∏—Ç–∞—Ç–∏ —Ä—è–¥–∫–∏ –Ω–∞–ø—Ä—è–º—É —á–µ—Ä–µ–∑ `["JwtSettings:SecretKey"]` –≤–≤–∞–∂–∞—î—Ç—å—Å—è –ø–æ–≥–∞–Ω–∏–º —Ç–æ–Ω–æ–º (–º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É –≤ —Ç–µ–∫—Å—Ç—ñ). –ü—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å **Options Pattern**. –í–æ–Ω–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å C# –∫–ª–∞—Å, —è–∫–∏–π —ñ–¥–µ–∞–ª—å–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ JSON.

```json [appsettings.json]
{
    "JwtConfig": {
        "Secret": "SuperSecretKey123",
        "ExpirationDays": 7
    }
}
```

```csharp [Program.cs]
// 1. –°—Ç–≤–æ—Ä—é—î–º–æ C# –ö–ª–∞—Å
public class JwtConfig
{
    public string Secret { get; set; } = string.Empty;
    public int ExpirationDays { get; set; }
}

// 2. –£ Program.cs –ø—Ä–∏–≤'—è–∑—É—î–º–æ —Å–µ–∫—Ü—ñ—é JSON –¥–æ –∫–ª–∞—Å—É —ñ –∫–ª–∞–¥–µ–º–æ –≤ DI –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä
var builder = WebApplication.CreateBuilder(args);
builder.Services.Configure<JwtConfig>(builder.Configuration.GetSection("JwtConfig"));

var app = builder.Build();

// 3. –¢–µ–ø–µ—Ä –±—É–¥—å-—è–∫–∏–π —Å–µ—Ä–≤—ñ—Å –º–æ–∂–µ –ø–æ–ø—Ä–æ—Å–∏—Ç–∏ IOptions<JwtConfig> —á–µ—Ä–µ–∑ Dependency Injection!
app.MapGet("/token", (IOptions<JwtConfig> options) =>
{
    var config = options.Value;
    return $"–°–µ–∫—Ä–µ—Ç: {config.Secret}, –î—ñ—î –¥–Ω—ñ–≤: {config.ExpirationDays}";
});
```

–¶–µ –≤–µ—Ä—à–∏–Ω–∞ –µ–≤–æ–ª—é—Ü—ñ—ó —Ä–æ–±–æ—Ç–∏ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏: –≤–æ–Ω–∏ —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–æ–º —ñ –ª–µ–≥–∫–æ –ø—ñ–¥–º—ñ–Ω—è—é—Ç—å—Å—è –≤ unit-—Ç–µ—Å—Ç–∞—Ö!

::callout{icon="i-lucide-dumbbell" color="primary"}
**–ü—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è: –ü–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó**
–ú–µ—Ç–∞: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (Environment Variables) –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—Ç—å –±–∞–∑–æ–≤–∏–π JSON-—Ñ–∞–π–ª –±–µ–∑ –∑–º—ñ–Ω–∏ –∫–æ–¥—É.
::

::steps

### –ö—Ä–æ–∫ 1: –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è JSON

–£ —Ñ–∞–π–ª—ñ `appsettings.json` –¥–æ–¥–∞–π—Ç–µ –Ω–æ–≤—É —Å–µ–∫—Ü—ñ—é `PaymentGateway` –∑ –ø–æ–ª–µ–º `ApiKey`: `"DefaultJsonSecret"`.

### –ö—Ä–æ–∫ 2: –ß–∏—Ç–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

–£ `Program.cs` –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –≤–∏–≤–µ–¥—ñ—Ç—å –Ω–∞ –µ–∫—Ä–∞–Ω:

```csharp
app.MapGet("/config", (IConfiguration config) => config["PaymentGateway:ApiKey"]);
```

### –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ JSON

–ó–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫ —á–µ—Ä–µ–∑ `dotnet run` —ñ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ `localhost:XXXX/config`. –í–∏ –ø–æ–±–∞—á–∏—Ç–µ `"DefaultJsonSecret"`.

### –ö—Ä–æ–∫ 4: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–¢–µ–ø–µ—Ä –∑—É–ø–∏–Ω—ñ—Ç—å —Å–µ—Ä–≤–µ—Ä (:kbd{value="Ctrl"} + :kbd{value="C"}) —ñ –∑–∞–ø—É—Å—Ç—ñ—Ç—å –π–æ–≥–æ –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –∑ –ø–µ—Ä–µ–¥–∞—á–µ—é –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –ø–æ–¥–≤—ñ–π–Ω–µ –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è `__` –∑–∞–º—ñ—Å—Ç—å –¥–≤–æ–∫—Ä–∞–ø–∫–∏ `:`!

::code-group

```powershell [Windows (PowerShell)]
$env:PaymentGateway__ApiKey="ProductionSecret"; dotnet run
```

```bash [macOS / Linux]
export PaymentGateway__ApiKey="ProductionSecret" && dotnet run
```

::

### –ö—Ä–æ–∫ 5: –†–µ–∑—É–ª—å—Ç–∞—Ç

–û–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –±—Ä–∞—É–∑–µ—Ä–∞. –ó–Ω–∞—á–µ–Ω–Ω—è –∑–º—ñ–Ω–∏–ª–æ—Å—è –Ω–∞ `"ProductionSecret"`, —Ö–æ—á–∞ –∫–æ–¥ –≤–∏ **–Ω–µ —á—ñ–ø–∞–ª–∏**! –¶–µ —ñ —î –º–∞–≥—ñ—è —à–∞—Ä—É–≤–∞—Ç–æ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó ASP.NET Core, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –±–µ–∑–ø–µ—á–Ω–æ –¥–µ–ø–ª–æ—ó—Ç–∏ –¥–æ–¥–∞—Ç–∫–∏.

::

### 6.2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –õ–æ–≥—ñ–≤ (`builder.Logging`)

ASP.NET –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω—É —Å–∏—Å—Ç–µ–º—É –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∏—Ö –ª–æ–≥—ñ–≤ (—â–æ–± –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π `Console.WriteLine()` –∞–±–æ `NLog` –ø—Ä—è–º–æ –≤ –∫–æ–¥—ñ). –ë—É–¥—ñ–≤–µ–ª—å–Ω–∏–∫ –∑–±–∏—Ä–∞—î —Ü–µ –≤—Å–µ —Ç—É—Ç:

```csharp
builder.Logging.ClearProviders(); // –û—á–∏—â–∞—î–º–æ –≤—Å—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –≤–∏–≤–æ–¥–∏ (–≤–∫–ª—é—á–∞—é—á–∏ –∫–æ–Ω—Å–æ–ª—å)
builder.Logging.AddConsole();     // –î–æ–¥–∞—î–º–æ –Ω–∞–∑–∞–¥ –∫–æ–Ω—Å–æ–ª—å
builder.Logging.AddDebug();       // –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤ –ø–∞–Ω–µ–ª—å Debug Visual Studio
```

> [!TIP]
> –£ —Å—É—á–∞—Å–Ω—ñ–π —Ä–æ–∑—Ä–æ–±—Ü—ñ –≤–∏ –∑–∞–∑–≤–∏—á–∞–π –∑–∞–ª–∏—à–∞—î—Ç–µ `builder.Logging` –ø–æ—Ä–æ–∂–Ω—ñ–º, —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ –ø–æ—Ç—É–∂–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ —Ç–∏–ø—É **Serilog**, —è–∫—ñ –¥–æ–¥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–ª–∞—Å–Ω–∏–π –º–µ—Ç–æ–¥ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `builder.Host.UseSerilog()`).

---

## 7. –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –¥–æ–¥–∞—Ç–∫–∞ (Application Lifecycle)

–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤–∏ —Å–∫–æ–Ω—Ñ—ñ–≥—É—Ä—É–≤–∞–ª–∏ –≤—Å–µ, –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ:

```csharp
var app = builder.Build();
```

–¢–µ–ø–µ—Ä `app` –∫–µ—Ä—É—î _–ñ–∏—Ç—Ç—î–≤–∏–º –¶–∏–∫–ª–æ–º (Lifecycle)_ –≤–∞—à–æ–≥–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞. –¶–µ –ø–µ—Ä–µ—Ö—ñ–¥ –≤—ñ–¥ —Å—Ç–∞–¥—ñ—ó "–ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏" –¥–æ —Å—Ç–∞–¥—ñ—ó "–≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è".

–ö–æ–ª–∏ –º–∏ –∑–∞–ø—É—Å–∫–∞—î–º–æ `app.Run()`, –≤–æ–Ω–æ –Ω–∞—Å—Ç—ñ–ª—å–∫–∏ –≥–ª–∏–±–æ–∫–æ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –≤ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—É —Å–∏—Å—Ç–µ–º—É, —â–æ –≤–º—ñ—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫–∏–¥–∞—Ç–∏—Å—è —ñ –∑–∞–≤–µ—Ä—à—É–≤–∞—Ç–∏—Å—è.

–í–∞–º –º–æ–∂–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–¥ –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä _—Ç—ñ–ª—å–∫–∏-–Ω–æ_ —Å—Ç–∞—Ä—Ç—É–≤–∞–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –¥–∞–Ω—ñ –≤ –∫–µ—à) –∞–±–æ _–ø–µ—Ä–µ–¥_ —Å–∞–º–∏–º –∑–∞–∫—Ä–∏—Ç—Ç—è–º (–≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –Ω–∞ Slack "–Ø –≤–ø–∞–≤"). –î–ª—è —Ü—å–æ–≥–æ –º–∏ –º–∞—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IHostApplicationLifetime` (–≤—ñ–Ω –∂–∏–≤–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ DI —ñ –≤–∏–ª—É—á–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `app.Lifetime`).

### –¢—Ä–∏ –≥–∞—á–∫–∏ –ø–æ–¥—ñ–π (Hooks)

1. `ApplicationStarted`: –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ —Ö–æ—Å—Ç –ø–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞–ª–∞—à—Ç—É–≤–∞–≤—Å—è —ñ –ø–æ—á–∞–≤ —Å–ª—É—Ö–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏.
2. `ApplicationStopping`: –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –≤–∏ –Ω–∞—Ç–∏—Å–Ω—É–ª–∏ Ctrl+C. –î–æ–¥–∞—Ç–æ–∫ –ø—Ä–∏–ø–∏–Ω—è—î –ø—Ä–∏–π–º–∞—Ç–∏ _–Ω–æ–≤—ñ_ –∑–∞–ø–∏—Ç–∏, –∞–ª–µ –¥–∞—î —á–∞—Å –∑–∞–∫—ñ–Ω—á–∏—Ç–∏—Å—è _–≤–∂–µ –∞–∫—Ç–∏–≤–Ω–∏–º_ (—Ü–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è Graceful Shutdown).
3. `ApplicationStopped`: –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –≤—Å—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ, –¥–æ–¥–∞—Ç–æ–∫ –ø–æ–º–∏—Ä–∞—î —ñ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –ø–∞–º'—è—Ç—ñ.

–û—Å—å —è–∫ –ø—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ —Ü—ñ –ø–æ–¥—ñ—ó:

```csharp
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ app.Lifetime –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –ø–æ–¥—ñ–π –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É
app.Lifetime.ApplicationStarted.Register(() =>
{
    Console.WriteLine("‚úÖ –°–µ—Ä–≤–µ—Ä Kestrel —É—Å–ø—ñ—à–Ω–æ –ø—ñ–¥–Ω—è—Ç–æ. –†–æ–±–∏–º–æ —Ä–æ–∑—ñ–≥—Ä—ñ–≤ –∫–µ—à—É...");
});

app.Lifetime.ApplicationStopping.Register(() =>
{
    Console.WriteLine("‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –æ—Ç—Ä–∏–º—É—î —Å–∏–≥–Ω–∞–ª –≤–∏–º–∫–Ω–µ–Ω–Ω—è. –ë–ª–æ–∫—É—î–º–æ –Ω–æ–≤—ñ –∑–∞–ø–∏—Ç–∏.");
});

app.Lifetime.ApplicationStopped.Register(() =>
{
    Console.WriteLine("üõë –°–µ—Ä–≤–µ—Ä –≤–∏–º–∫–Ω–µ–Ω–æ. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω—ñ –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª...");
});

app.MapGet("/", () => "Hello Lifecycle!");

app.Run();
```

–ö–æ–ª–∏ –≤–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–∞–∫–∏–π –∫–æ–¥ —ñ –ø–æ—Ç—ñ–º –Ω–∞—Ç–∏—Å–Ω–µ—Ç–µ **Ctrl+C** –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ, —è–∫ Kestrel —ñ–¥–µ–∞–ª—å–Ω–æ –≤–∏–∫–æ–Ω—É—î –≤–∞—à—ñ –ø–æ–¥—ñ—ó –≤ –∑–∞–¥–∞–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É. –¶–µ —î –æ–∑–Ω–∞–∫–æ—é Enterprise-—Å–∏—Å—Ç–µ–º–∏: –¥–æ–¥–∞—Ç–æ–∫ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω "–ø—Ä–æ—Å—Ç–æ –≤–º–∏—Ä–∞—Ç–∏" –∂–æ—Ä—Å—Ç–∫–æ –æ–±—Ä–∏–≤–∞—é—á–∏ –ø–∞–º'—è—Ç—å; –≤—ñ–Ω –ø–æ–≤–∏–Ω–µ–Ω –∑–∞–∫—Ä–∏—Ç–∏ –≤—Å—ñ —Ñ–∞–π–ª–∏, –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î —ñ –∫—É–ª—å—Ç—É—Ä–Ω–æ –ø—ñ—Ç–∏.

–ú–µ—Ç–æ–¥–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ö–æ—Å—Ç–æ–º (–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó `WebApplication`):

- `Run()`: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∑–∞–ø—É—Å–∫.
- `RunAsync()`: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∑–∞–ø—É—Å–∫. –ë–ª–æ–∫—É—î –ø–æ—Ç—ñ–∫, –ø–æ–∫–∏ –¥–æ–¥–∞—Ç–æ–∫ –Ω–µ –≤–ø–∞–¥–µ/–∑—É–ø–∏–Ω–∏—Ç—å—Å—è.
- `StartAsync()`: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞—î –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è. –í–æ–Ω–æ –í–Ü–î–†–ê–ó–£ –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–ª—ñ –ø–æ –∫–æ–¥—É! –í–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä —ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ —Ä–æ–±–∏—Ç–∏ —â–æ—Å—å —ñ–Ω—à–µ –≤ —ñ–Ω—à–æ–º—É –ø–æ—Ç–æ—Ü—ñ!
- `StopAsync()`: –ü—Ä–æ–≥—Ä–∞–º–Ω–∏–π –∑–∞–ø–∏—Ç –Ω–∞ –∑—É–ø–∏–Ω–∫—É —Å–µ—Ä–≤–µ—Ä–∞ (—è–∫—â–æ –º–∏ —Ö–æ—á–µ–º–æ –∑–∞–≥–∞—Å–∏—Ç–∏ —Å–∞–π—Ç –±–µ–∑ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–Ω–æ–ø–æ–∫).

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –º–æ–∂–Ω–∞ –ø—ñ–¥–Ω—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ —ñ –≤–±–∏—Ç–∏ –π–æ–≥–æ:

```csharp
await app.StartAsync(); // –°–µ—Ä–≤–µ—Ä —Å—Ç–∞—Ä—Ç—É–≤–∞–≤
await Task.Delay(10000); // –ß–µ–∫–∞—î–º–æ 10 —Å–µ–∫—É–Ω–¥...
await app.StopAsync(); // –°–µ—Ä–≤–µ—Ä –∑—É–ø–∏–Ω–∏–≤—Å—è.
```

–¶—ñ –Ω–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤—ñ –º–µ—Ç–æ–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑–¥–µ–±—ñ–ª—å—à–æ–≥–æ –¥–ª—è –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è (Integration Testing), –∫–æ–ª–∏ –∫–æ–º–ø'—é—Ç–µ—Ä —Å–∞–º –ø—ñ–¥–Ω—ñ–º–∞—î –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —É —Ç–µ—Å—Ç–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î —Ç—É–¥–∏ –∑–∞–ø–∏—Ç —ñ –≤–±–∏–≤–∞—î —Å–µ—Ä–≤–µ—Ä.

---

## 8. –ü—ñ–¥—Å—É–º–æ–∫ –º–æ–¥—É–ª—è

- **Builder Pattern** –¥–æ–∑–≤–æ–ª—è—î –Ω–∞–º –∫–æ–Ω—Ñ—ñ–≥—É—Ä—É–≤–∞—Ç–∏ –Ω–∞–¥—Å–∫–ª–∞–¥–Ω—É —Å–∏—Å—Ç–µ–º—É (ASP.NET Core) –ø–æ—Å—Ç—É–ø–æ–≤–æ, –¥–æ–¥–∞—é—á–∏ —Å–µ—Ä–≤—ñ—Å–∏ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó.
- **Dependency Injection** ‚Äî —Ü–µ –Ω–µ —è–∫–∞—Å—å "–º–∞–≥—ñ—è", –∞ –ø—Ä–æ—Å—Ç–æ —Å–ø–æ—Å—ñ–± –ø–∏—Å–∞—Ç–∏ —á–∏—Å—Ç–∏–π –∫–æ–¥ (SOLID), –ø–µ—Ä–µ–∫–ª–∞–¥–∞—é—á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ –Ω–∞ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä.
- **Service Lifetimes (Singleton, Scoped, Transient)** ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞–º'—è—Ç—Ç—é –æ–±'—î–∫—Ç—ñ–≤. –í—ñ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É –∑–∞–ª–µ–∂–∏—Ç—å, —á–∏ –∑–º–æ–∂–µ –≤–∞—à –¥–æ–¥–∞—Ç–æ–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –ø—Ä–∏ –≤–µ–ª–∏–∫–æ–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ, —á–∏ –ø–∞–º'—è—Ç—å —à–≤–∏–¥–∫–æ –ø–æ—Ç–µ—á–µ (Memory Leak).
- **Extension Methods** –¥–ª—è DI –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∑—Ä–æ–±–∏—Ç–∏ —Ñ–∞–π–ª `Program.cs` —á–∏—Å—Ç–∏–º, –≤–∏–Ω—ñ—Å—à–∏ —Å–æ—Ç–Ω—ñ —Ä—è–¥–∫—ñ–≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `AddControllers`) —É –∫—Ä–∞—Å–∏–≤—ñ, –ª–∞–∫–æ–Ω—ñ—á–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ `services.AddMyAwesomeFeature()`.
- **Application Lifecycle** (`IHostApplicationLifetime`) –¥–∞—î –≤–∞–º –∑–º–æ–≥—É –≤—Ç—Ä—É—Ç–∏—Ç–∏—Å—è –≤ –ø—Ä–æ—Ü–µ—Å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è —ñ —Å–º–µ—Ä—Ç—ñ –¥–æ–¥–∞—Ç–∫–∞, —â–æ —î –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º —É —Å–∫–ª–∞–¥–Ω–∏—Ö –º—ñ–∫—Ä–æ—Å–µ—Ä–≤—ñ—Å–Ω–∏—Ö —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö (Kubernetes).

–©–æ –Ω–∞–º –∑–∞–ª–∏—à–∏–ª–æ—Å—è —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏ –≤ –∞–Ω–∞—Ç–æ–º—ñ—ó Minimal API? –ú–∏ –∑—Ä–æ–∑—É–º—ñ–ª–∏, —è–∫ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –¥–æ–¥–∞—Ç–æ–∫. –Ø–∫ –π–æ–≥–æ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞. –ê–ª–µ –º–∏ —â–µ –Ω–µ –∑—Ä–æ–∑—É–º—ñ–ª–∏, —è–∫ –≤—ñ–Ω –æ–±—Ä–æ–±–ª—è—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∑–∞–ø–∏—Ç –≤—ñ–¥ –±—Ä–∞—É–∑–µ—Ä–∞! –®–ª—è—Ö –∑–∞–ø–∏—Ç—É ("Request Pipeline") ‚Äî —Ü–µ –Ω–∞–π—Ü—ñ–∫–∞–≤—ñ—à–µ –º—ñ—Å—Ü–µ, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥—Å–ª—É—Ö–æ–≤—É–≤–∞—Ç–∏, –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —ñ –≤—ñ–¥–±–∏–≤–∞—Ç–∏ –∞—Ç–∞–∫–∏. –Ü –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –º–æ–¥—É–ª—ñ –º–∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ –ø—Ä–æ Middleware!

---

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–Ω—å

::tally-embed{id="YOUR_FORM_ID_HERE" title="–¢–µ—Å—Ç: Dependency Injection —Ç–∞ Builder"}
::

–Ø–∫—â–æ —Ç–µ—Å—Ç –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è, —Å–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Ä–æ–∑–¥—É–º—ñ–≤:

1. **–©–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è**, —è–∫—â–æ –≤ `Singleton` —Å–µ—Ä–≤—ñ—Å –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ `Scoped` —Å–µ—Ä–≤—ñ—Å —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä? (–ü—ñ–¥–∫–∞–∑–∫–∞: —Ü–µ –≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞ "Captive Dependency", –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–∫–∏–Ω–µ –≤–∏–Ω—è—Ç–æ–∫).
2. **–ß–æ–º—É –º–µ—Ç–æ–¥ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è** –¥–ª—è `IServiceCollection` –ø–æ–≤–∏–Ω–µ–Ω –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –±—É—Ç–∏ —Å—Ç–∞—Ç–∏—á–Ω–∏–º –∫–ª–∞—Å–æ–º —ñ –º–∞—Ç–∏ —Å–ª–æ–≤–æ `this`?
3. –í —á–æ–º—É —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –ø–æ–¥—ñ—î—é **ApplicationStopping** —Ç–∞ **ApplicationStopped**? –î–µ –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–∫—Ä–∏–≤–∞—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö?
