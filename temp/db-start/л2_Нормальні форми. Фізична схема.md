## Лекція №2 «Нормальні форми. Фізична схема » {#slide-1}

1НФ, 2НФ, 3НФ, 3НФ+,  SQL, DDL, DML, DQL,  цілісність даних

ПРИРОДНИЧО-ГУМАНІТАРНИЙ 

Ф АХОВИЙ КОЛЕДЖ  ДВНЗ « УжНУ »

Викладач: Верещагін О.О.

## Відеоуроки  від  dmdev {#slide-2}

\_

![](./images2/ppt/media/image1.jpeg "Picture 2")

## Обмеження цілісності {#slide-3}

Цілісність  сприймається як правильність даних у любий момент часу. Підтримка цілісності бази даних може розглядатися як захист даних від неправильних змін або руйнувань (не плутати з незаконними змінами та руйнуваннями, що є проблемою безпеки). Виділяють три групи правил цілісності:

Цілісність за первинними ключами  (не допускається, щоб будь-які кортежі відносини мали співпадіння первинних ключів або будь- якиий  атрибут, що бере участь у первинному ключі, приймав невизначене значення -  NULL- значення);

Цілісність за зовнішніми ключами  (значення зовнішнього ключа має бути рівним значенню первинного ключа цілі, або бути повністю невизначеним, тобто, значення всіх атрибутів, що беруть участь у зовнішньому ключі, мають бути невизначеними ( NULL) );

## Обмеження цілісності {#slide-4}

Цілісність, що визначається користувачем . При складанні власних правил слід пам\'ятати, що найчастіше   контролюється:

Унікальність значень деяких атрибутів,

належність діапазону значень (наприклад, відсоток правильних відповідей не може бути меншим за нуль або більше   ста),

належність  набору  значень  ( наприклад ,  екзаменаційна   оцінка   може   набувати   значень :  незадовільно,задовільно , добре,  чудово ).

## Обмеження цілісності {#slide-5}

У  базі   даних   системи  Особиста  бібліотека   прийнято   такіобмеження   цілісності :

Атрибути  Copy(id), Person(id), Publication(id), Request(id),Shelf(id), Status(id)  та пара атрибутів ( Copy, Request)  відносини  Request_Copy  --  первинні ключі;

Атрибути  Copy (Publication), Copy (Shelf), Person (Status),   Request(Person),  Request_Copy (Copy),  Request_Copy (Request),   Session(Person) --  зовнішні ключі;

Усі атрибути, крім  Person(Status), Person( MiddleName ),   Request(Allow)  і  Copy(Shelf)  повинні мати певні значення у кожному кортежі відносини;

Атрибут  Person(Login)  повинен мати унікальне значення кожному кортежі відносини;

Атрибут  Status (Name)  може мати значення  Owner  або  Reader.·  атрибут  Request(Allow)  може мати  NULL- значення, значення  Yes  або  No.

## Нормалізація бази даних {#slide-6}

Процес нормалізації  -- приведення структури бази даних у відповідність із деяким набором формальних правил.  Остаточна мета нормалізації  зводиться отримання такого проекту бази даних, у якому кожен факт з\'являється лише в одному місці, тобто, виключено  надмірність інформації . Це робиться не стільки з метою економії пам\'яті, скільки для  виключення можливої ​​суперечливості даних , що зберігаються. 

Як правило, нормалізація проводиться за допомогою  декомпозиції , яка є заміною вихідного відношення на кілька інших відносин, що володіють кращими властивостями. При цьому нас цікавить лише  декомпозиція без втрат , тобто така, за якої  невідбувається  втрата інформації. Відмінною рисою такої декомпозиції є її  обратимість  ( reversibility ) . 

## Нормальні форми . 1 НФ {#slide-7}

Для перевірки правильності розробленої структури застосовують так звані  нормальні форми  -- правила, яким мають відповідати відносини (таблиці). Нормальні форми пронумеровані та мають  вкладений взаємозв\'язок . 

Відношення відповідає  першій нормальній формі   (1НФ), якщо кожен його кортеж містить точно одне значення для кожного з атрибутів, і це значення є допустимим. Іншими словами, ніякому атрибуту в кортежі не можна надати два значення або більше, навіть якщо кожне з них окремо є допустимим. Фактично, умови 1НФ входять у визначення відносини як такого, тому будь-яке відношення завжди належить 1НФ.

## 2НФ {#slide-8}

Кажуть, що відношення перебуває у  другій нормальній формі   (2НФ), якщо воно задовольняє визначенню 1НФ та всі його атрибути, що не входять до первинного ключа, пов\'язані повною функціональною залежністю з первинним ключем. 

Як приклад розглянемо відношення {Співробітник, Посада, Зарплата, Паспорт}, у якому атрибути (Співробітник, Посада) становлять первинний ключ.  Випишемо  повні нетривіальні функціональні залежності відношення:

(Співробітник, Посада) - \>  Зарплата,

Співробітник - \>  Паспорт.

Звідси випливає, що атрибут Паспорт не пов\'язаний з повною функціональною залежністю з первинним ключем, тому відношення не задовольняє вимогам 2НФ і необхідно замінити його двома відносинами, кожне з яких перебуватиме у 2НФ:

{Співробітник, Посада, Зарплата}, атрибути (Співробітник,   Посада) -- первинний ключ;

{Співробітник, Паспорт}, атрибут Співробітник -- первинний ключ.

## 3 НФ {#slide-9}

Відповідно до визначення відношення знаходиться в  третій нормальній формі  (3НФ), якщо воно задовольняє визначенню 2НФ і не один з його неключових атрибутів не залежить функціонально від будь-якого іншого  неключового атрибута . 

Відношення {Конференція, Країна, Місто} з первинним ключем Конференція не задовольняє зазначеній  вимозі , так як, існує функціональна залежність Місто - \>  Країна, детермінантом якої є неключовий атрибут. Це відношення необхідно замінити двома відносинами у 3НФ:

{Конференція, Місто}, атрибут Конференція -- первинний ключ;

{Місто, Країна}, атрибут Місто -- первинний ключ.

## 3 НФ+  або  НФБК {#slide-10}

Нормальна форма  Бойса-Кодда   (НФБК) є суворішою порівняно з попередніми формами. Ця форма вимагає, щоб детермінантами всіх повних нетривіальних функціональних залежностей відношення були підмножини атрибутів, які можуть розглядатися як первинні ключі. 

Наприклад, відношення {Повна назва дисципліни, Скорочена назва дисципліни, Студент, Оцінка} в властивості первинного ключа можна вибрати пару атрибутів (Повна назва дисципліни, Студент) або (Скорочена назва дисципліни, Студент), однак існує функціональна залежність між атрибутами. та скорочена назва дисципліни, а це означає, що відношення не задовольняє вимогам НФБК. Тому потрібно здійснити декомпозицію вихідного відношення, наприклад, ввівши до розгляду такі відносини:

{Скорочена назва дисципліни, Повна назва дисципліни}, атрибут Скорочена назва дисципліни --первинний ключ;

{Скорочена назва дисципліни, Студент}, атрибут Скорочена назва дисципліни -- первинний ключ.

Крім описаних вище форм існують форми вищого порядку, саме: четверта і п\'ята нормальні форми. Як правило, відносини, які відповідають вимогам НФБК, також відповідають умовам четвертої та п\'ятої нормальних форм. Так, наприклад, усі відносини проекту бази даних системи «Особиста бібліотека» задовольняють вимогам як НФБК, і форм вищого порядку.

## Фізична схема  {#slide-11}

Фізична схема  реляційної бази даних програмується мовою  SQL (Structured Query Language --  мова структурованих запитів), реалізації якого різних СУБД мають характерні особливості. У СУБД  Oracle  мова  SQL (Oracle SQL)  є розширенням стандарту SQL:1999,  розробленого Американським національним інститутом стандартів ( ANSI)  та Міжнародною організацією зі стандартизації ( ISO)  у 1999 році.

## JOINS {#slide-12}

https://joins.spathon.com/

## \_ {#slide-13}

\_

![](./images2/ppt/media/image2.png "Рисунок 4")

## Стиль коду  SQL. Naming  Convation {#slide-14}

https://www.sqlstyle.guide/  

## Класифікація   таблиць  у  реляційних  базах  даних  за  ознаками   цілісності  та  надмірності   даних {#slide-15}

Цілісність даних  -- це властивість здатності за одними даними відновлювати інші, при цьому не втрачаючи семантичну єдність цих даних і відносини між ними (між даними).

Надмірність даних  -- це стан бази даних, у якому в таблицях присутні зайві дані.

Статичний довідник  - довідник, дані про об\'єкти, суб\'єкти, зв\'язки в якому або ніколи не піддаються модифікації після первинної модифікації, або настільки рідко піддаються модифікації, що цим можна знехтувати.  

Прикладом таких  довідників   можуть  бути список  місяців  з  назвами  та номерами, список  днів   тижня , список пори року, список  океанів   тощо ...

## \_ {#slide-16}

\_

![](./images2/ppt/media/image3.png "Рисунок 4")

## Статично-динамічний довідник {#slide-17}

Статично- динамічний   довідник  --  довідник , у  якому   зберігаються   дані   відношення ,  якщо   відношення   носять   довідковий  характер. У такому  довіднику   можуть  бути  ключі .

Найбільш   вдалим  прикладом буде  таблиця  з такими  медичними   даними , як вага. Список людей, вага  яких   вимірюється ,  змінюється  не так часто. А ось  дані   щодо   їхньої  ваги  можуть   змінюватися   щодня . Статично- динамічні   довідники  є  єдиними   довідниками , де  усвідомлено   можна   повторювати  будь-яку  інформацію .  Ще  одним прикладом  може  бути  довідник   окладів  за посадами (за кодом посади).

  Код посади   Оклад    Дата оновлення
  ------------ -------- ----------------
  1001         12 000   05.02.2015
  1002         17 000   01.02.2015
  1003         11 500   01.02.2015
  1004         25 450   01.02.2015
  1005         10 000   01.02.2015
  1006         6000     04.02.2015

## Динамічні довідники {#slide-18}

Динамічні довідники  - це таблиці, дані про об\'єкти, суб\'єкти, зв\'язки в яких часто змінюються і використовуються в інших таблицях. Від статичних довідників відрізняються лише частотою модифікації у яких даних.

Приклад таких таблиць можуть бути списки проектів. Насправді дані про відкриття або закриття проектів можуть знаходитися в самому довіднику проектів, що в більшості випадків неправильно і порушує цілісність. З іншого боку, якщо зберігати історію змін щодо відкриття та закриття (зупинення) проектів, то можна отримати надмірність даних. Цілісність та надмірність даних боротимуться з один одним ще довго, так само як і зима з літом.

## \_ {#slide-19}

\_

  Код проекту   Проект                      Нормативний термін виконання   дата додавання   Користувач
  ------------- --------------------------- ------------------------------ ---------------- ------------
  PT102         Фарбування вікон            15                             03.01.2014       1547
  PT103         Установка дверей            10                             04.01.2014       9874
  PT587         Перевірка пожежних кранів   2                              04.01.2014       1456
  PT588         Заміна люків                3                              02.01.2014       0147
  PT133         Очищення каналів            11                             09.02.2015       1547

## Види зв\'язок {#slide-20}

Таблиці-зв\'язки можна поділити на два види.

Це  довідник-зв\'язок  (відразу ж уточнимо, що довідник-зв\'язок довідником не є, названий так, тому що в ньому існують поля, які утворюють довідник, але в довідник виділено бути не можуть). Таблиця, в якій зберігаються зовнішні ключі, дані, які не є довідковими та поля, що містять дані, що утворюють довідник, але не можуть бути виділені в окрему таблицю-довідник.

Прикладом  довідника-зв\'язку  буде  таблиця   платіжних   транзакцій . Або  таблиця  з  даними  про  футбольний  матч.

  Код транзакції   Платник   Одержувач   Сума     Дата         Коментар
  ---------------- --------- ----------- -------- ------------ -----------
  EEVS-doodi4      100045    57457       -10000   25.07.2014   На чоботи
  UDFD-ioeed9      455780    10024       -900     24.06.2014   НУЛЬ
  PEDD-jdksl4      144770    56698       -6980    01.01.2015   НУЛЬ
  FDFE-keiiii0     447757    1           120      08.07.2014   НУЛЬ

## Види зв\'язок {#slide-21}

І  зв\'язування  (так, просто зв\'язування). Це таблиця в якій зберігаються лише зовнішні ключі та дані, які не можна віднести до довідкових, наприклад, дата або значення логічних полів.

Прикладом зв\'язування буде таблиця автоматичного  логування  терміналу обробки даних.

До речі, легко здогадатися, що зв\'язки майже ніде не використовуються, оскільки найчастіше знаходяться дані, які можуть бути записані в базу, але не містяться в довідниках, тому неможливо порівняти зовнішній ключ.

  код    Код клієнта   Показники лічильника   Місяць
  ------ ------------- ---------------------- -------------
  2334   35643         50                     01.01.2015
  2335   235673        49                     01.01.2015
  2335   436345        56                      01.01.2015
  2335   574733        24                      01.01.2015

## Віртуальні таблиці {#slide-22}

https://habr.com/ru/post/47031/

## Збережувані  процедури {#slide-23}

https://youtu.be/IOucTs8HV_4

## Відеоуроки  від  dmdev {#slide-24}

\_
